<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #32</title><link rel="stylesheet" href="../../messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / questions #32</h1><div class="pager"><a href="../../html/C5666B6BB/31.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a><a href="../../html/C5666B6BB/33.html" class="pager__next">Next</a></div><div class="message_list"><div class="message" id="message-1543826850.007000"><div class="message__timestamp">2018-12-03<br/>17:47:30 +0900</div><div class="message__header">igrep</div><div class="message__body">うまくいったようです。ありがとうございます！ :clap:</div></div><div class="message" id="message-1544168335.008100"><div class="message__timestamp">2018-12-07<br/>16:38:55 +0900</div><div class="message__header">kameoka.ryota</div><div class="message__body">@kameoka.ryota has joined the channel</div></div><div class="message" id="message-1544181931.008400"><div class="message__timestamp">2018-12-07<br/>20:25:31 +0900</div><div class="message__header">irxnjhtchlnrw</div><div class="message__body">@irxnjhtchlnrw has joined the channel</div></div><div class="message" id="message-1544200877.008800"><div class="message__timestamp">2018-12-08<br/>01:41:17 +0900</div><div class="message__header">kobori.tomoyuki</div><div class="message__body">@kobori.tomoyuki has joined the channel</div></div><div class="message" id="message-1544247441.009100"><div class="message__timestamp">2018-12-08<br/>14:37:21 +0900</div><div class="message__header">irissetosa976</div><div class="message__body">@irissetosa976 has joined the channel</div></div><div class="message" id="message-1544356253.009400"><div class="message__timestamp">2018-12-09<br/>20:50:53 +0900</div><div class="message__header">wakaka2277</div><div class="message__body">@wakaka2277 has joined the channel</div></div><div class="message" id="message-1544361151.009700"><div class="message__timestamp">2018-12-09<br/>22:12:31 +0900</div><div class="message__header">t-era</div><div class="message__body">@t-era has joined the channel</div></div><div class="message" id="message-1544401078.010000"><div class="message__timestamp">2018-12-10<br/>09:17:58 +0900</div><div class="message__header">lyrical.magical.techn</div><div class="message__body">@lyrical.magical.techn has joined the channel</div></div><div class="message" id="message-1544590221.011000"><div class="message__timestamp">2018-12-12<br/>13:50:21 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">Textなどをコンソールに出力する際に通常だと"\n"や"\t"があるとnewlineやtabに変換されますが、<br/>それををそのままプリントする方法ってありますか？<br/>例えば "Hello \n World"を出力する際に "\n"をそのままにして、"Hello \n World"として出力するみたいな。</div></div><div class="message" id="message-1544590280.011100"><div class="message__timestamp">2018-12-12<br/>13:51:20 +0900</div><div class="message__header">kakkun61</div><div class="message__body"><code>show</code> でそうなりませんかね</div></div><div class="message" id="message-1544590296.011300"><div class="message__timestamp">2018-12-12<br/>13:51:36 +0900</div><div class="message__header">igrep</div><div class="message__body"><code>show</code> じゃダメってことですよね。細かいニーズを考えたら作るしかないと思います。。。</div></div><div class="message" id="message-1544590310.011500"><div class="message__timestamp">2018-12-12<br/>13:51:50 +0900</div><div class="message__header">kakkun61</div><div class="message__body">そうなのかー</div></div><div class="message" id="message-1544590359.011700"><div class="message__timestamp">2018-12-12<br/>13:52:39 +0900</div><div class="message__header">igrep</div><div class="message__body">いや、私が深読みしすぎているだけかもしれないですが。。。 :sweat_drops:</div></div><div class="message" id="message-1544590397.011900"><div class="message__timestamp">2018-12-12<br/>13:53:17 +0900</div><div class="message__header">junji.hashimoto</div><div class="message__body">jsonにするとか？</div></div><div class="message" id="message-1544590454.012200"><div class="message__timestamp">2018-12-12<br/>13:54:14 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">なるほど、一度JSONにしてから出力すればいいのか！</div></div><div class="message" id="message-1544590517.012400"><div class="message__timestamp">2018-12-12<br/>13:55:17 +0900</div><div class="message__header">kakkun61</div><div class="message__body"><blockquote><blockquote><blockquote><blockquote>putStrLn $ show ("\n" :: Text)</blockquote>"\n"</blockquote></blockquote></blockquote></div></div><div class="message" id="message-1544590680.012600"><div class="message__timestamp">2018-12-12<br/>13:58:00 +0900</div><div class="message__header">igrep</div><div class="message__body">JSONへの変換でよくてshowじゃダメな理由って何ですか？</div></div><div class="message" id="message-1544590728.012800"><div class="message__timestamp">2018-12-12<br/>13:58:48 +0900</div><div class="message__header">kakkun61</div><div class="message__body"><code>show</code> がダメというのは @igrep さんの誤読なのでは……？</div></div><div class="message" id="message-1544590830.013000"><div class="message__timestamp">2018-12-12<br/>14:00:30 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">とくにないです。。<br/><code>show</code>でくるんだらできました。。自分は疲れてるかもしれない。</div></div><div class="message" id="message-1544590872.013300"><div class="message__timestamp">2018-12-12<br/>14:01:12 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">ありがとうー</div></div><div class="message" id="message-1544605206.013900"><div class="message__timestamp">2018-12-12<br/>18:00:06 +0900</div><div class="message__header">hiratara</div><div class="message__body">蛇足だとは思いますが、 <code>"\n"</code> と <code>"\\n"</code> はまったく別の文字列ですので、要件は整理したほうがいいと思いますよ。処理したいのが <code>"\\n"</code> という文字列でそれを表示したいのであれば、文字列の生成時に <code>\</code> を適切にエスケープすべきです。逆に、改行文字を含む文字をエスケープして画面に出したいのであれば、改行文字をエスケープする関数( <code>show</code> はその一種だが、 <code>"</code> で括ったりするのでエスケープ方法としては独特)を作ってそれを噛ませて表示すべきです。</div></div><div class="message" id="message-1544747872.014400"><div class="message__timestamp">2018-12-14<br/>09:37:52 +0900</div><div class="message__header">goto.ryota</div><div class="message__body">@goto.ryota has joined the channel</div></div><div class="message" id="message-1544775666.014700"><div class="message__timestamp">2018-12-14<br/>17:21:06 +0900</div><div class="message__header">overkill.red99999</div><div class="message__body">@overkill.red99999 has joined the channel</div></div><div class="message" id="message-1544829240.015000"><div class="message__timestamp">2018-12-15<br/>08:14:00 +0900</div><div class="message__header">kagilinn</div><div class="message__body">@kagilinn has joined the channel</div></div><div class="message" id="message-1544846046.017000"><div class="message__timestamp">2018-12-15<br/>12:54:06 +0900</div><div class="message__header">karoyakani</div><div class="message__body">「Haskellによる並列・並行プログラミング」_Parallel and Concurrent Programming in Haskell_ (<https://www.oreilly.com/library/view/parallel-and-concurrent/9781449335939/ch04.html>)  の p.69 `Rate-limiting the Producer` にある流量制限をする `exercise` の解を教えて下さい　非力のため実行時エラーが取れません<br/>`stack overflow` (<https://stackoverflow.com/questions/24773130/parallel-haskell-rate-limiting-the-producer>)　にヒントがありますが　完全解は省略されています<br/>よろしくお願いします</div></div><div class="message" id="message-1544860031.017300"><div class="message__timestamp">2018-12-15<br/>16:47:11 +0900</div><div class="message__header">igrep</div><div class="message__body">ちょっとまだ状況把握できてないので解けるかどうかも自信がないのですが、いずれにしても、<br/>@karoyakani さんが自分でどこまで書いてみてどううまくいかなかったのか、教えていただけないでしょうか？<br/>そうでなければアドバイスしにくいです。</div></div><div class="message" id="message-1544863867.017500"><div class="message__timestamp">2018-12-15<br/>17:51:07 +0900</div><div class="message__header">karoyakani</div><div class="message__body">`parconc-examples` から `rsa-pipleline.hs` と `Stream.hs` を取り出して　`streamFromList` や他を次のように変えると　エラーになります　``` $ cabal unpack parconc-examples<br/>$ cd parconc-examples-0.4.7<br/>$ cabal install --only-dependencies<br/><br/>$ diff rsa-pipeline2.hs rsa-pipeline.hs<br/>14c14<br/>&lt; import Stream2<br/>---<br/>&gt; import Stream<br/>42c42<br/>&lt;   s0 &lt;- streamFromList f c (chunk (size n) b)<br/>---<br/>&gt;   s0 &lt;- streamFromList (chunk (size n) b)<br/>47,49d46<br/>&lt;   where<br/>&lt;   f = 100<br/>&lt;   c = 200<br/><br/><br/>$ diff Stream2.hs Stream.hs<br/>10c10<br/>&lt; module Stream2<br/>---<br/>&gt; module Stream<br/>25d24<br/>&lt;   | Fork (Par ()) (IList a)<br/>34d32<br/>&lt;   rnf (Fork _ a) = rnf a<br/>40,41c38,39<br/>&lt; streamFromList :: NFData a =&gt; Int -&gt; Int -&gt; [a] -&gt; Par (Stream a)<br/>&lt; streamFromList f c xs = do<br/>---<br/>&gt; streamFromList :: NFData a =&gt; [a] -&gt; Par (Stream a)<br/>&gt; streamFromList xs = do<br/>43c41<br/>&lt;   fork $ loop f c xs var                -- &lt;2&gt;<br/>---<br/>&gt;   fork $ loop xs var                    -- &lt;2&gt;<br/>46,51c44,45<br/>&lt;   loop _ _ [] var = put var Nil         -- &lt;4&gt;<br/>&lt;   loop 0 c (x:xs) var = do<br/>&lt;     tail &lt;- new<br/>&lt;     let op = loop 0 c xs tail<br/>&lt;     put var (Fork op (Cons x tail))<br/>&lt;   loop f c (x:xs) var = do              -- &lt;5&gt;<br/>---<br/>&gt;   loop [] var = put var Nil             -- &lt;4&gt;<br/>&gt;   loop (x:xs) var = do                  -- &lt;5&gt;<br/>54c48<br/>&lt;     loop (f-1) c xs tail                -- &lt;8&gt;<br/>---<br/>&gt;     loop xs tail                        -- &lt;8&gt;<br/>67,68c61,62<br/>&lt;       Nil               -&gt; put outstrm Nil<br/>&lt;       Cons h t          -&gt; do<br/>---<br/>&gt;       Nil -&gt; put outstrm Nil<br/>&gt;       Cons h t -&gt; do<br/>72d65<br/>&lt;       Fork p (Cons h t) -&gt; fork p &gt;&gt; streamMap fn t &gt;&gt; return ()<br/>83,85c76,77<br/>&lt;     Nil               -&gt; return acc<br/>&lt;     Cons h t          -&gt; streamFold fn (fn acc h) t<br/>&lt;     Fork p (Cons h t) -&gt; fork p &gt;&gt; streamFold fn (fn acc h) t<br/>---<br/>&gt;     Nil      -&gt; return acc<br/>&gt;     Cons h t -&gt; streamFold fn (fn acc h) t<br/><br/><br/>$ ghc -O2 -threaded -rtsopts  rsa-pipeline2.hs<br/><br/>$ ./rsa-pipeline2 /usr/share/dict/words &gt;/dev/null +RTS -N2<br/>rsa-pipeline2: no result<br/>CallStack (from HasCallStack):<br/>  error, called at ./Control/Monad/Par/Scheds/TraceInternal.hs:250:11 in monad-par-0.3.4.8-6smWrlrr5w82FJ0Oii5wmF:Control.Monad.Par.Scheds.TraceInternal<br/>```<br/>長くなってすみません</div></div><div class="message" id="message-1544864425.017700"><div class="message__timestamp">2018-12-15<br/>18:00:25 +0900</div><div class="message__header">igrep</div><div class="message__body">diffを当てるのも面倒なので、gistあたりに書いたものをアップロードしちゃってください。<br/>別にこのSlackに完結する必要はないです。</div></div><div class="message" id="message-1544888022.018700"><div class="message__timestamp">2018-12-16<br/>00:33:42 +0900</div><div class="message__header">ide_0109</div><div class="message__body">@ide_0109 has joined the channel</div></div><div class="message" id="message-1544890905.018900"><div class="message__timestamp">2018-12-16<br/>01:21:45 +0900</div><div class="message__header">karoyakani</div><div class="message__body">遅れましたがこちらになります　`<https://gist.github.com/karoyakani/3ef51ac74e0a7b72e44a1c6a418c44ec>`</div></div><div class="message" id="message-1544943394.019200"><div class="message__timestamp">2018-12-16<br/>15:56:34 +0900</div><div class="message__header">kakkun61</div><div class="message__body">どれかのライブラリーに用意されてますかね？ <a href='https://twitter.com/kakkun61/status/1073752004244033536'>https://twitter.com/kakkun61/status/1073752004244033536</a></div></div><div class="message" id="message-1544944017.023100"><div class="message__timestamp">2018-12-16<br/>16:06:57 +0900</div><div class="message__header">yharuhi39</div><div class="message__body">これって、昔どっかで見たけど、[Word8] をWord32に変換する関数はありますかってやつと同じですよね？ ByteStringはLazyな方という仮定ですけど その質問の回答のコピーですと 無いです 探せばあるかもですが、、、</div></div><div class="message" id="message-1544945460.023300"><div class="message__timestamp">2018-12-16<br/>16:31:00 +0900</div><div class="message__header">kakkun61</div><div class="message__body"><code>[Word8]</code> 経由しない方がパフォーマンス的にはいいっちゃいいですけど<br/>とりあえず経由してもいいです</div></div><div class="message" id="message-1544945499.023500"><div class="message__timestamp">2018-12-16<br/>16:31:39 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">ヒントをいうと， <code>streamMap</code> の実装がおかしいと思います</div></div><div class="message" id="message-1544947825.023900"><div class="message__timestamp">2018-12-16<br/>17:10:25 +0900</div><div class="message__header">negi23</div><div class="message__body">@negi23 has joined the channel</div></div><div class="message" id="message-1544951437.024100"><div class="message__timestamp">2018-12-16<br/>18:10:37 +0900</div><div class="message__header">kakkun61</div><div class="message__body"><pre>
fromIntegral (word32 bytestring) :: Int32
</pre><br/>でよさそう<br/><a href='https://www.stackage.org/haddock/lts-12.22/network-byte-order-0.0.0.0/Network-ByteOrder.html#v:word32'>https://www.stackage.org/haddock/lts-12.22/network-byte-order-0.0.0.0/Network-ByteOrder.html#v:word32</a></div></div><div class="message" id="message-1544965184.025500"><div class="message__timestamp">2018-12-16<br/>21:59:44 +0900</div><div class="message__header">t160d011</div><div class="message__body">@t160d011 has joined the channel</div></div><div class="message" id="message-1545040142.025700"><div class="message__timestamp">2018-12-17<br/>18:49:02 +0900</div><div class="message__header">kohsho2015</div><div class="message__body">@kohsho2015 has joined the channel</div></div><div class="message" id="message-1545133272.026300"><div class="message__timestamp">2018-12-18<br/>20:41:12 +0900</div><div class="message__header">e1q18048</div><div class="message__body">@e1q18048 has joined the channel</div></div><div class="message" id="message-1545201727.030200"><div class="message__timestamp">2018-12-19<br/>15:42:07 +0900</div><div class="message__header">igrep</div><div class="message__body">型レベルリストに対する結合演算 <a href='http://hackage.haskell.org/package/extensible-0.4.10.1/docs/Data-Extensible-Struct.html#t:-43--43-'>http://hackage.haskell.org/package/extensible-0.4.10.1/docs/Data-Extensible-Struct.html#t:-43--43-</a> を使った際、結合則がGHCに認識されないのか、<br/><code>Couldn't match type ‘(xs ++ ys) ++ zs’ with ‘xs ++ (ys ++ zs)’</code><br/>というエラーになってしまうことがあります。<br/>これを、（型注釈をつけられた） <b>式を変えない</b> かつ 型注釈の <code>xs ++ ys ++ zs</code> という箇所に、（ <code>xs ++ (ys ++ zs)</code> のように）明示的に括弧を加えないで型チェックを通すことはできるでしょうか？<br/><a href='https://gist.github.com/igrep/b3391a2287a0fcf093472cb6c57048db'>https://gist.github.com/igrep/b3391a2287a0fcf093472cb6c57048db</a> に、テストケースとして使えるファイルを上げておきました。</div></div><div class="message" id="message-1545201729.030300"><div class="message__timestamp">2018-12-19<br/>15:42:09 +0900</div><div class="message__header">igrep</div><div class="message__body"></div></div><div class="message" id="message-1545203808.030600"><div class="message__timestamp">2018-12-19<br/>16:16:48 +0900</div><div class="message__header">notogawa</div><div class="message__body"><blockquote>式を変えない</blockquote>って， <pre>xs `happend` (ys `happend` zs)</pre> にもしないという意味ですか？</div></div><div class="message" id="message-1545203888.031000"><div class="message__timestamp">2018-12-19<br/>16:18:08 +0900</div><div class="message__header">igrep</div><div class="message__body">そうです。</div></div><div class="message" id="message-1545204284.031200"><div class="message__timestamp">2018-12-19<br/>16:24:44 +0900</div><div class="message__header">notogawa</div><div class="message__body">逆にどんなことならしてもいいんですか？GHCプラグインを挿すとかですか？</div></div><div class="message" id="message-1545204442.031400"><div class="message__timestamp">2018-12-19<br/>16:27:22 +0900</div><div class="message__header">igrep</div><div class="message__body">型宣言 <code>happend3 :: Record xs -&gt; Record ys -&gt; Record zs -&gt; Record (xs ++ ys ++ zs)</code><br/>の <code>xs ++ ys ++ zs</code> 以外の箇所は変えてもいいです。<br/>GHCのプラグインはありだと思います。そういえばまさにそれをやるためのがあったような。。。 :thinking_face:</div></div><div class="message" id="message-1545204461.031600"><div class="message__timestamp">2018-12-19<br/>16:27:41 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">それは一般に非自明なので前者を後者に変換する関数(証明)を定義してそれを全体にかぶせるとかになると思います<br/>(LiquidHaskellならこれくらいは解けたりしないのかな…量化子入ってると流石に厳しいか</div></div><div class="message" id="message-1545204537.031900"><div class="message__timestamp">2018-12-19<br/>16:28:57 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">結合律さえいえれば(x = y) -&gt; F x = F yとかを使ってゴニョゴニョやるとコンパイルも通ると思います(どうみてもただの定理証明ですが)</div></div><div class="message" id="message-1545204545.032100"><div class="message__timestamp">2018-12-19<br/>16:29:05 +0900</div><div class="message__header">notogawa</div><div class="message__body">たぶん普通は <code>singletons</code> で <code>Sing</code> な結合則の証明オブジェクトを作ってそれで検査器に「わからせる」</div></div><div class="message" id="message-1545204547.032300"><div class="message__timestamp">2018-12-19<br/>16:29:07 +0900</div><div class="message__header">igrep</div><div class="message__body">ああ、そうですね。<br/><blockquote>前者を後者に変換する関数(証明)を定義</blockquote>の具体的なやり方を知りたいです。</div></div><div class="message" id="message-1545204611.032800"><div class="message__timestamp">2018-12-19<br/>16:30:11 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">上に同じくsingletons使うのが普通だと思います</div></div></div><div class="pager"><a href="../../html/C5666B6BB/31.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a><a href="../../html/C5666B6BB/33.html" class="pager__next">Next</a></div></body></html>