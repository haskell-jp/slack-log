<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / random #47</title><link rel="stylesheet" href="/messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / random #47</h1><div class="pager"><a href="/html/C4M4TT8JJ/46.html" class="pager__previous">Previous</a><a href="/" class="pager__top">Top</a><a href="/html/C4M4TT8JJ/48.html" class="pager__next">Next</a></div><div class="message_list"><div class="message" id="message-1555628844.048100"><div class="message__timestamp">2019-04-19<br/>08:07:24 +0900</div><div class="message__header">maoe</div><div class="message__body">どういう文脈でTsuru Capitalが出てきているのでしょうか</div></div><div class="message" id="message-1555629326.050800"><div class="message__timestamp">2019-04-19<br/>08:15:26 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">ファイナンシャル関係でHaskellを実務で利用している代表的な企業としてTsuru Capital が挙げられてました。</div></div><div class="message" id="message-1555629377.051000"><div class="message__timestamp">2019-04-19<br/>08:16:17 +0900</div><div class="message__header">maoe</div><div class="message__body">なるほど、そうなんですね。ありがとうございます。</div></div><div class="message" id="message-1555629673.053200"><div class="message__timestamp">2019-04-19<br/>08:21:13 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">ライブ配信されてたので、その箇所があったらここにリンクを貼ります。</div></div><div class="message" id="message-1555632072.053600"><div class="message__timestamp">2019-04-19<br/>09:01:12 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body"><a href='https://youtu.be/0Bn2NQP2i7A?t=908'>https://youtu.be/0Bn2NQP2i7A?t=908</a></div></div><div class="message" id="message-1555632088.053900"><div class="message__timestamp">2019-04-19<br/>09:01:28 +0900</div><div class="message__header">maoe</div><div class="message__body">ありがとうございます！</div></div><div class="message" id="message-1555645043.055300"><div class="message__timestamp">2019-04-19<br/>12:37:23 +0900</div><div class="message__header">kazu</div><div class="message__body">haskell-cafe で MonadFail の話題が盛り上がらない。ライブラリのメインテナーが苦労すればいい、オレ stackage を使うから関係ないって感じなのか？</div></div><div class="message" id="message-1555646705.055800"><div class="message__timestamp">2019-04-19<br/>13:05:05 +0900</div><div class="message__header">furugomu</div><div class="message__body">@furugomu has joined the channel</div></div><div class="message" id="message-1555657283.059200"><div class="message__timestamp">2019-04-19<br/>16:01:23 +0900</div><div class="message__header">fumieval</div><div class="message__body">マルチスレッド環境でnetwork-3.0を使っているとき、ソケットが予期しないタイミングで閉じられるというバグが発見されました。Stackageはまだ2.8なのでstackユーザーには影響はなさそうですが、しばらく移行は見送ったほうがよさそうです　<https://github.com/haskell/network/issues/396></div></div><div class="message" id="message-1555658151.062100"><div class="message__timestamp">2019-04-19<br/>16:15:51 +0900</div><div class="message__header">fumieval</div><div class="message__body">逆説的ですが、stackageではなくHackageの最新版を追いかけることの重要性を感じました。使わなければバグは見つからず何ヶ月も放置されてしまうので…</div></div><div class="message" id="message-1555658336.062500"><div class="message__timestamp">2019-04-19<br/>16:18:56 +0900</div><div class="message__header">kazu</div><div class="message__body">ごめんなさい。</div></div><div class="message" id="message-1555658368.063300"><div class="message__timestamp">2019-04-19<br/>16:19:28 +0900</div><div class="message__header">kazu</div><div class="message__body">まだ、よくわかってないですが、accept の中で、どうしてソケットが GC されちゃうんでしょうか？</div></div><div class="message" id="message-1555658572.063500"><div class="message__timestamp">2019-04-19<br/>16:22:52 +0900</div><div class="message__header">fumieval</div><div class="message__body"><a href='https://github.com/haskell/network/blob/7e3f16d57b8745ef12cec8c9164bb91eeac90b5b/Network/Socket/Internal.hs#L194'>https://github.com/haskell/network/blob/7e3f16d57b8745ef12cec8c9164bb91eeac90b5b/Network/Socket/Internal.hs#L194</a> この関数の中で発生します。fdSocketでFdを取り出したら元のIORefは必要なくなるので、threadWaitRead fdしている間にGCされる可能性があります</div></div><div class="message" id="message-1555658681.064800"><div class="message__timestamp">2019-04-19<br/>16:24:41 +0900</div><div class="message__header">kazu</div><div class="message__body">「fdSocketでFdを取り出したら元のIORefは必要なくなる」が理解できなかったんですが、高野さんのサンプルコードだと、accept が呼ばれたら、どこからも sock が指されてないってことですかね？</div></div><div class="message" id="message-1555658930.065600"><div class="message__timestamp">2019-04-19<br/>16:28:50 +0900</div><div class="message__header">kazu</div><div class="message__body"><code>_ &lt;- accept sock</code> の次に <code>print sock</code> を入れると問題は起きないので、そういうことかな。</div></div><div class="message" id="message-1555659116.067000"><div class="message__timestamp">2019-04-19<br/>16:31:56 +0900</div><div class="message__header">kazu</div><div class="message__body"><code>fdSocket</code> が原因とされている理由がまだ分かりません。ブロックするAPIが、ソケットがGCされないことを保守すればよい(できるか分からないけど)？</div></div><div class="message" id="message-1555659327.068800"><div class="message__timestamp">2019-04-19<br/>16:35:27 +0900</div><div class="message__header">fumieval</div><div class="message__body">はい。一度しかacceptやrecvしないようなプログラムではこの問題が起こります</div></div><div class="message" id="message-1555659472.070400"><div class="message__timestamp">2019-04-19<br/>16:37:52 +0900</div><div class="message__header">fumieval</div><div class="message__body"><a href='https://github.com/haskell/network/pull/352'>https://github.com/haskell/network/pull/352</a>　このPRで実装されているように、acceptの終わり際にtouch#(あるいはwith#)する必要がありそうです</div></div><div class="message" id="message-1555659986.073400"><div class="message__timestamp">2019-04-19<br/>16:46:26 +0900</div><div class="message__header">kazu</div><div class="message__body">fdSocketは原因ではないけど、使われている場所では問題が起きやすいから、安全なAPIを作って、それに移行しましょうということですね。</div></div><div class="message" id="message-1555660207.074400"><div class="message__timestamp">2019-04-19<br/>16:50:07 +0900</div><div class="message__header">fumieval</div><div class="message__body">いつ閉じられるかわからないリソースを返す関数は危険ですからね</div></div><div class="message" id="message-1555661630.075000"><div class="message__timestamp">2019-04-19<br/>17:13:50 +0900</div><div class="message__header">fumieval</div><div class="message__body">@kazu PR送りました :curling_stone: <a href='https://github.com/haskell/network/pull/398'>https://github.com/haskell/network/pull/398</a></div></div><div class="message" id="message-1555666545.075500"><div class="message__timestamp">2019-04-19<br/>18:35:45 +0900</div><div class="message__header">1to100pen</div><div class="message__body">肖像画みたいなのはどういう人々ですか。</div></div><div class="message" id="message-1555679274.075900"><div class="message__timestamp">2019-04-19<br/>22:07:54 +0900</div><div class="message__header">info731</div><div class="message__body">@info731 has joined the channel</div></div><div class="message" id="message-1555680184.076100"><div class="message__timestamp">2019-04-19<br/>22:23:04 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">IOHKではカルダノっていう暗号通貨を開発してて、そこでは予定している大型アップデートにそれぞれ著名人の名前がつけられます。なので、うしろの絵はその人たちの肖像画ですね。<br/>Cardano, Ada, Byron, Shelley, Goguen, Basho, Voltaire</div></div><div class="message" id="message-1555739302.076500"><div class="message__timestamp">2019-04-20<br/>14:48:22 +0900</div><div class="message__header">superfluidbcsbec</div><div class="message__body">@superfluidbcsbec has joined the channel</div></div><div class="message" id="message-1555759868.076900"><div class="message__timestamp">2019-04-20<br/>20:31:08 +0900</div><div class="message__header">takebe</div><div class="message__body">@takebe has joined the channel</div></div><div class="message" id="message-1555764574.077200"><div class="message__timestamp">2019-04-20<br/>21:49:34 +0900</div><div class="message__header">stephan.donin</div><div class="message__body">@stephan.donin has joined the channel</div></div><div class="message" id="message-1555768584.077500"><div class="message__timestamp">2019-04-20<br/>22:56:24 +0900</div><div class="message__header">kensukehot</div><div class="message__body">@kensukehot has joined the channel</div></div><div class="message" id="message-1555775195.077800"><div class="message__timestamp">2019-04-21<br/>00:46:35 +0900</div><div class="message__header">karthik.ravikanti</div><div class="message__body">@karthik.ravikanti has joined the channel</div></div><div class="message" id="message-1555777497.078100"><div class="message__timestamp">2019-04-21<br/>01:24:57 +0900</div><div class="message__header">snamiki1212</div><div class="message__body">@snamiki1212 has joined the channel</div></div><div class="message" id="message-1555817019.079400"><div class="message__timestamp">2019-04-21<br/>12:23:39 +0900</div><div class="message__header">t-uchida</div><div class="message__body">@igrep 本日のもくもく会、所用で（ギリギリですが）17時ごろの参加となりそうです。恐れ入りますがよろしくお願いいたします。</div></div><div class="message" id="message-1555817203.079500"><div class="message__timestamp">2019-04-21<br/>12:26:43 +0900</div><div class="message__header">igrep</div><div class="message__body">了解です。特にご連絡はなくても大丈夫ですよ！<br/>するとしてもどちらかというと <a href='https://haskell-jp.connpass.com/event/125266/'>https://haskell-jp.connpass.com/event/125266/</a> のコメント機能の方が助かります。</div></div><div class="message" id="message-1555817445.079800"><div class="message__timestamp">2019-04-21<br/>12:30:45 +0900</div><div class="message__header">t-uchida</div><div class="message__body">承知しました。ありがとうございます。</div></div><div class="message" id="message-1555826510.080100"><div class="message__timestamp">2019-04-21<br/>15:01:50 +0900</div><div class="message__header">r6eve179f</div><div class="message__body">@r6eve179f has joined the channel</div></div><div class="message" id="message-1555829314.081000"><div class="message__timestamp">2019-04-21<br/>15:48:34 +0900</div><div class="message__header">igrep</div><div class="message__body">@kayhide 口頭で触れた、Defunctionalizationを生かしてTypeFamilyをより柔軟に使えるようにする話です。<br/><a href='https://haskell-jp.slack.com/archives/C5666B6BB/p1554435528020400?thread_ts=1554427355.015200&amp;cid=C5666B6BB'>https://haskell-jp.slack.com/archives/C5666B6BB/p1554435528020400?thread_ts=1554427355.015200&amp;cid=C5666B6BB</a></div></div><div class="message" id="message-1555855094.084700"><div class="message__timestamp">2019-04-21<br/>22:58:14 +0900</div><div class="message__header">fumieval</div><div class="message__body"><a href='https://github.com/fumieval/membership'>https://github.com/fumieval/membership</a> 以前からおびただしい数の再実装がされており共通化の必要性が叫ばれていた、拡張可能レコード・バリアント・エフェクトなどに応用できる型レベルリストのためのライブラリを新しく作りました(ほとんどextensibleから切り取っただけですが)。今後extensibleを上回るようなものが出るかどうかはともかく、似たようなライブラリを作る際に面倒な部分をやる必要がなくなります</div></div><div class="message" id="message-1555901632.087500"><div class="message__timestamp">2019-04-22<br/>11:53:52 +0900</div><div class="message__header">kazu</div><div class="message__body">@fumieval 土日を挟んで遅くなりましたが、修正の PR を出しました。</div></div><div class="message" id="message-1555920685.090600"><div class="message__timestamp">2019-04-22<br/>17:11:25 +0900</div><div class="message__header">fumieval</div><div class="message__body">Haskell performance(色々なパッケージのベンチマークをしている謎の組織)にwineryで殴り込みをかけてみました。<https://github.com/fumieval/serialization/blob/master/report.md>　スピード特化のstoreやflatにも迫る、期待以上の結果が出ました</div></div><div class="message" id="message-1555927519.091700"><div class="message__timestamp">2019-04-22<br/>19:05:19 +0900</div><div class="message__header">mmsato11</div><div class="message__body">@mmsato11 has joined the channel</div></div><div class="message" id="message-1555936269.093500"><div class="message__timestamp">2019-04-22<br/>21:31:09 +0900</div><div class="message__header">fumieval</div><div class="message__body">ちょっとしたサーベイなんですが、最近Haskellで取り組んでいる問題や、知りたい情報などがあれば教えていただけませんか？今後のネタ作りに使います</div></div><div class="message" id="message-1555936277.093600"><div class="message__timestamp">2019-04-22<br/>21:31:17 +0900</div><div class="message__header">fumieval</div><div class="message__body">↓こちらから↓</div></div><div class="message" id="message-1555939653.093800"><div class="message__timestamp">2019-04-22<br/>22:27:33 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">最近あきらめたのが（extensible の話で少し退屈かもだけど）<br/><pre>
class C a b | a -&gt; b where
    ...

hoge :: Forall2 (ValueIs C) as bs =&gt; Record as  -&gt; Record bs
</pre><br/>みたいな関数を作ること。<br/>ユースケースとしてはコマンドライン引数から特定のレコード型を構築できないかなと考えてた。<br/>コマンドラインからは ID 的なのを与えて。<br/>（うーん…出来ないような気がするけど…）<br/><br/>あとは GraphQL クライアントが欲しいなぁとずっと考えてる（とくにデコード先が extesnible record になる）<br/><br/>こんな感じ？</div></div><div class="message" id="message-1555941569.094200"><div class="message__timestamp">2019-04-22<br/>22:59:29 +0900</div><div class="message__header">fumieval</div><div class="message__body">限りなくそれに近いメカニズムを考えてみました <a href='https://github.com/fumieval/extensible/blob/promote/src/Data/Extensible/Promote.hs'>https://github.com/fumieval/extensible/blob/promote/src/Data/Extensible/Promote.hs</a></div></div><div class="message" id="message-1555942199.094800"><div class="message__timestamp">2019-04-22<br/>23:09:59 +0900</div><div class="message__header">fumieval</div><div class="message__body">GraphQLクライアント、確かに欲しい…リクエストとレスポンスの関係があるがそれがwell-definedではないというのが厄介なところですね</div></div><div class="message" id="message-1555942290.095100"><div class="message__timestamp">2019-04-22<br/>23:11:30 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">なるほど。 <code>C a b</code> の <code>b</code> 側を <code>h :* xs</code>  の <code>h</code> に載せるのか。TypeFamily で。<br/>あざっす！（爆速で終わっちゃたけど…）</div></div><div class="message" id="message-1555942473.095300"><div class="message__timestamp">2019-04-22<br/>23:14:33 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">あ、そうだ。<br/>別にHaskellで取り組んでた問題とかじゃないけど、RubyKaigiでクックパッドの遠藤さんと笹田さんが、 <code>ソースコードに任意のテキスト書き加えて "Hello world" と出力させるクイズ</code> をやってました。<br/>書き加えるテキストの文字数が少ないほど良いというルールで（なお全て1文字で解ける）</div></div><div class="message" id="message-1555942809.095900"><div class="message__timestamp">2019-04-22<br/>23:20:09 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">こういうの (メモから書き起こしてるので間違ってるかも)<br/><pre>
include Math

Out, *,
     Count = $&gt;,
             $&lt;, E ** (2 * PI)
Out.puts("Hello world" *
         Count.abs.round)
</pre><br/><pre>
def say
  }-&gt; {
    "Hello world"
  }
  yield
end

puts say { "Goodbye world" }
</pre><br/>まぁ Haskell だと、Ruby ほどの自由度はないかもだけど。。。</div></div><div class="message" id="message-1555942953.096200"><div class="message__timestamp">2019-04-22<br/>23:22:33 +0900</div><div class="message__header">fumieval</div><div class="message__body">クイズ面白そうですね</div></div><div class="message" id="message-1555943319.097500"><div class="message__timestamp">2019-04-22<br/>23:28:39 +0900</div><div class="message__header">fumieval</div><div class="message__body">常用漢字2136字を出力するプログラムを、2136文字以内のコードで実装するという問題を思いつきました</div></div><div class="message" id="message-1555981133.097900"><div class="message__timestamp">2019-04-23<br/>09:58:53 +0900</div><div class="message__header">lotz</div><div class="message__body">最近Haskellで取り組んでいるのはRecursion Schemesで知りたいのはその応用例です…!!</div></div></div><div class="pager"><a href="/html/C4M4TT8JJ/46.html" class="pager__previous">Previous</a><a href="/" class="pager__top">Top</a><a href="/html/C4M4TT8JJ/48.html" class="pager__next">Next</a></div></body></html>