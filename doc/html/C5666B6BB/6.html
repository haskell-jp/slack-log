<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #6</title><link rel="stylesheet" href="/messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / questions #6</h1><div class="pager"><a href="/html/C5666B6BB/5.html" class="pager__previous">Previous</a><a href="/" class="pager__top">Top</a><a href="/html/C5666B6BB/7.html" class="pager__next">Next</a></div><div class="message_list"><div class="message" id="message-1511842590.000264"><div class="message__timestamp">2017-11-28<br/>13:16:30 +0900</div><div class="message__header">kazu</div><div class="message__body">tar.gzを書くと、extra-depsの設定がないとか言われちゃいますね。</div></div><div class="message" id="message-1511843064.000049"><div class="message__timestamp">2017-11-28<br/>13:24:24 +0900</div><div class="message__header">kazu</div><div class="message__body">stack.yamlですが、ターゲットのパッケージのフラグはどのように記述するのでしょうか？ 依存パッケージのフラグは書けるようですが。。。</div></div><div class="message" id="message-1511844449.000100"><div class="message__timestamp">2017-11-28<br/>13:47:29 +0900</div><div class="message__header">wado</div><div class="message__body">こういう感じのフラグですか？<br/><a href='https://github.com/haskell/haskell-ide-engine/blob/master/stack.yaml'>https://github.com/haskell/haskell-ide-engine/blob/master/stack.yaml</a></div></div><div class="message" id="message-1511845343.000183"><div class="message__timestamp">2017-11-28<br/>14:02:23 +0900</div><div class="message__header">kazu</div><div class="message__body">それですが、stack.yamlを置いてあるパッケージ自体のフラグをどうやって書けばいいのか分かりません。</div></div><div class="message" id="message-1511845389.000100"><div class="message__timestamp">2017-11-28<br/>14:03:09 +0900</div><div class="message__header">kazu</div><div class="message__body">とりあえず、こんな感じになりました。</div></div><div class="message" id="message-1511845390.000178"><div class="message__timestamp">2017-11-28<br/>14:03:10 +0900</div><div class="message__header">kazu</div><div class="message__body"><a href='https://github.com/vincenthz/hs-tls/issues/167#issuecomment-261823286'>https://github.com/vincenthz/hs-tls/issues/167#issuecomment-261823286</a></div></div><div class="message" id="message-1511845482.000096"><div class="message__timestamp">2017-11-28<br/>14:04:42 +0900</div><div class="message__header">kazu</div><div class="message__body">@notogawa わざわざありがとうございます！</div></div><div class="message" id="message-1511845829.000146"><div class="message__timestamp">2017-11-28<br/>14:10:29 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">ターゲットのパッケージのフラグを定義するってことですよね<br/>cabal ファイルがそのまま使えますよ<br/>stack.yaml はあくまでも依存パッケージなどのバージョンや場所を記述してるだけです(正確にはもっとイロンナことがかけますが…)</div></div><div class="message" id="message-1511846321.000091"><div class="message__timestamp">2017-11-28<br/>14:18:41 +0900</div><div class="message__header">wado</div><div class="message__body"><code>stack.yaml</code> にパッケージ名と好きなフラグを定義して、各パッケージの <code>.cabal</code> でそのフラグを使って処理すると思います。<br/><br/>具体的にはこんな感じですか。<br/><br/><pre>
flags:
  tls:
    compat: true
    network: true
  tls-debug:
    xxxx: true
</pre></div></div><div class="message" id="message-1511846540.000145"><div class="message__timestamp">2017-11-28<br/>14:22:20 +0900</div><div class="message__header">igrep</div><div class="message__body"><a href='https://github.com/kazu-yamamoto/mighttpd2/blob/tls13/stack.yaml'>https://github.com/kazu-yamamoto/mighttpd2/blob/tls13/stack.yaml</a> のことですかね？<br/>いずれにしてもできたのであればよかったです！</div></div><div class="message" id="message-1511847160.000079"><div class="message__timestamp">2017-11-28<br/>14:32:40 +0900</div><div class="message__header">kazu</div><div class="message__body">ありがとうございました。</div></div><div class="message" id="message-1511847233.000079"><div class="message__timestamp">2017-11-28<br/>14:33:53 +0900</div><div class="message__header">kazu</div><div class="message__body">@matsubara0507  cabal ファイルのデフォルトを書き換えることで対応しました。トピックブランチだから、まぁいいやって感じで。</div></div><div class="message" id="message-1511851807.000198"><div class="message__timestamp">2017-11-28<br/>15:50:07 +0900</div><div class="message__header">brackss1</div><div class="message__body">@khibino HRRの質問です。<br/>Relation型のプレースホルダーはなんのために…あるんですか？<br/>あと、ドキュメントにある <code>$(defineTable "example.db" "account") </code>の構文を教えてください。</div></div><div class="message" id="message-1511863878.000041"><div class="message__timestamp">2017-11-28<br/>19:11:18 +0900</div><div class="message__header">as_capabl</div><div class="message__body">個人的には、使いたいリポジトリをプロジェクト直下にsubmodule addしてpackagesに追加しちゃう事が多いですね</div></div><div class="message" id="message-1511918366.000197"><div class="message__timestamp">2017-11-29<br/>10:19:26 +0900</div><div class="message__header">igrep</div><div class="message__body">代わりに知っている範囲で答えちゃいます。<br/><blockquote>Relation型のプレースホルダーはなんのために…あるんですか？</blockquote><br/>SQLのPrepared Statementsを作るためのものだったかと思います。<br/><br/><blockquote>あと、ドキュメントにある <code>$(defineTable "example.db" "account") </code>の構文を教えてください。</blockquote><br/>Template Haskellを使った、型定義の自動生成です、というので答えになってますかね？</div></div><div class="message" id="message-1511936222.000034"><div class="message__timestamp">2017-11-29<br/>15:17:02 +0900</div><div class="message__header">brackss1</div><div class="message__body">Prepared Statements?ですか。<br/>TemplateHaskellの構文なんですか経験がないのでわかりませんでした。<br/>ありがとうございます:musical_note:</div></div><div class="message" id="message-1511947030.000123"><div class="message__timestamp">2017-11-29<br/>18:17:10 +0900</div><div class="message__header">naohaq</div><div class="message__body">プレースホルダについては、SQLそのものに関わる機構なので、まずはSQLについて調べるのがよいかと思います。参考: <a href='https://qiita.com/Morinikiz/items/dfdb33f25df4df0f672c'>https://qiita.com/Morinikiz/items/dfdb33f25df4df0f672c</a></div></div><div class="message" id="message-1511999996.000326"><div class="message__timestamp">2017-11-30<br/>08:59:56 +0900</div><div class="message__header">taketarou2</div><div class="message__body">@taketarou2 has joined the channel</div></div><div class="message" id="message-1512016590.000086"><div class="message__timestamp">2017-11-30<br/>13:36:30 +0900</div><div class="message__header">mt_caret</div><div class="message__body">Hakyllの質問です。pygmentizeを走らせたりするためにSystem.ProcessのreadCreateProcessを使ってIO StringをHakyll.Core.CompilerのunsafeCompilerでCompiler Stringに変換して使っていました。Hakyll.Core.UnixFilterのことを知ってそちらの方を使うように書き換えた所、`hGetContents: invalid argument (invalid byte sequence)`と出て上手く使えません。<https://jaspervdj.be/hakyll/tutorials/faq.html> にあるようにE.setLocaleEncoding E.utf8を使おうにも、IOとCompilerでは型が合いません。unixFilterを使うにはどうすればよいでしょうか？</div></div><div class="message" id="message-1512019116.000120"><div class="message__timestamp">2017-11-30<br/>14:18:36 +0900</div><div class="message__header">igrep</div><div class="message__body">FAQにもあるとおり、<br/><code>hakyll</code> に渡した <code>do</code> ブロックじゃなくて <code>main</code> 関数の中でやるのはダメなんですかね？<br/>それがダメなら、 <code>compilerUnsafeIO</code> というのがあるみたいです。 <a href='https://hackage.haskell.org/package/hakyll-4.9.8.0/docs/Hakyll-Core-Compiler-Internal.html#v:compilerUnsafeIO'>https://hackage.haskell.org/package/hakyll-4.9.8.0/docs/Hakyll-Core-Compiler-Internal.html#v:compilerUnsafeIO</a><br/>あるいは、 <code>unixFilterLBS</code> を使って、 <code>ByteString</code> として読んでみてはいかがでしょうか？<br/><a href='https://hackage.haskell.org/package/hakyll-4.9.8.0/docs/Hakyll-Core-UnixFilter.html#v:unixFilterLBS'>https://hackage.haskell.org/package/hakyll-4.9.8.0/docs/Hakyll-Core-UnixFilter.html#v:unixFilterLBS</a></div></div><div class="message" id="message-1512019205.000089"><div class="message__timestamp">2017-11-30<br/>14:20:05 +0900</div><div class="message__header">igrep</div><div class="message__body">あ、あと、FAQでは触れてないみたいですが、Windowsであれば <code>chcp 65001</code> と言うコマンドを実行すれば回避できます。<br/>Linuxと違って端末を立ち上げる都度実行しないといけないのが悩ましいですが。。。</div></div><div class="message" id="message-1512020684.000021"><div class="message__timestamp">2017-11-30<br/>14:44:44 +0900</div><div class="message__header">mt_caret</div><div class="message__body">返信ありがとうございます！ <code>unsafeCompiler = compilerUnsafeIO</code> となっていますね、 <code>unsafeCompiler (E.setLocaleEncoding E.utf8) &gt;&gt; unixFilter ...</code> みたいな感じで使うということでしょうか？ <code>unixFilterLBS</code> を使うのは確かに手ですね、両方試してみます。</div></div><div class="message" id="message-1512035534.000154"><div class="message__timestamp">2017-11-30<br/>18:52:14 +0900</div><div class="message__header">kakkun61</div><div class="message__body">お願いしますー</div></div><div class="message" id="message-1512035595.000274"><div class="message__timestamp">2017-11-30<br/>18:53:15 +0900</div><div class="message__header">igrep</div><div class="message__body">ちょっと今試す余裕ないんで自信ないんですが、 ScopedTypeVariablesでなんとかなる？</div></div><div class="message" id="message-1512035629.000139"><div class="message__timestamp">2017-11-30<br/>18:53:49 +0900</div><div class="message__header">tomo426.sakura1281m</div><div class="message__body">@tomo426.sakura1281m has joined the channel</div></div><div class="message" id="message-1512036008.000409"><div class="message__timestamp">2017-11-30<br/>19:00:08 +0900</div><div class="message__header">kakkun61</div><div class="message__body"><code>runST</code> 後の <code>do</code> 式の型を明示して <code>forall s.</code> して、それを中で使う形ですかね？</div></div><div class="message" id="message-1512036062.000571"><div class="message__timestamp">2017-11-30<br/>19:01:02 +0900</div><div class="message__header">igrep</div><div class="message__body">恐らく。</div></div><div class="message" id="message-1512036284.000208"><div class="message__timestamp">2017-11-30<br/>19:04:44 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">ホントだすごい<br/><pre>
{-# LANGUAGE ScopedTypeVariables #-}

module Main where

import <http://Control.Monad.ST|Control.Monad.ST>
import <http://Data.Array.ST|Data.Array.ST>

main :: IO ()
main = print $ runST st

st :: forall s . ST s Int
st = do
  array &lt;- newArray (0, 1) 0 :: ST s (STArray s Int Int)
  let
      go :: Int -&gt; ST s Int
      go = readArray array
  writeArray array 1 1
  go 1
  -- go array 1
</pre></div></div><div class="message" id="message-1512036320.000041"><div class="message__timestamp">2017-11-30<br/>19:05:20 +0900</div><div class="message__header">igrep</div><div class="message__body">@matsubara0507 手柄は譲った！ :bow:</div></div><div class="message" id="message-1512036746.000480"><div class="message__timestamp">2017-11-30<br/>19:12:26 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">@kakkun61 さんが質問したのか(笑)<br/>こんがらがった(笑)<br/>じゃぁ向こうにも書いておきます</div></div><div class="message" id="message-1512037069.000474"><div class="message__timestamp">2017-11-30<br/>19:17:49 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">DONE</div></div><div class="message" id="message-1512040586.000169"><div class="message__timestamp">2017-11-30<br/>20:16:26 +0900</div><div class="message__header">kakkun61</div><div class="message__body">@matsubara0507あ、ですです 分かりにくくてすみません</div></div><div class="message" id="message-1512040727.000042"><div class="message__timestamp">2017-11-30<br/>20:18:47 +0900</div><div class="message__header">kakkun61</div><div class="message__body">@igrep @matsubara0507ありがとうございました</div></div><div class="message" id="message-1512040941.000209"><div class="message__timestamp">2017-11-30<br/>20:22:21 +0900</div><div class="message__header">kakkun61</div><div class="message__body">実際に問題になってたコードはもうちょっと複雑だったんですがそちらも同様に解決しました</div></div><div class="message" id="message-1512055697.000264"><div class="message__timestamp">2017-12-01<br/>00:28:17 +0900</div><div class="message__header">ah</div><div class="message__body">@ah has joined the channel</div></div><div class="message" id="message-1512090076.000238"><div class="message__timestamp">2017-12-01<br/>10:01:16 +0900</div><div class="message__header">kazu</div><div class="message__body">お騒がせしているstackですが、少し理解できました。依存パッケージだけ見えて、ターゲットのパッケージが見えないのは、<br/><br/><pre>
packages:
- location: .
</pre><br/><br/>を書いてないからでした。これは、.cabal ファイルへのパスだと思えばよいのですね。パス状にある .cabal ファイル全ての一覧を取得し、ファイル名をパッケージ名として扱うようです。</div></div><div class="message" id="message-1512090496.000312"><div class="message__timestamp">2017-12-01<br/>10:08:16 +0900</div><div class="message__header">igrep</div><div class="message__body">そうです！ <code>stack init</code> とか <code>stack new</code> していれば自動でその部分はやってくれるはずですが、一から書いてしまいましたか。。。 :sweat_smile:</div></div><div class="message" id="message-1512090724.000009"><div class="message__timestamp">2017-12-01<br/>10:12:04 +0900</div><div class="message__header">kazu</div><div class="message__body">試しに`stack.yaml`を決して、`stack init`してみたけど、`stack.yaml`は作られません。</div></div><div class="message" id="message-1512091317.000227"><div class="message__timestamp">2017-12-01<br/>10:21:57 +0900</div><div class="message__header">kazu</div><div class="message__body">フラグの件ですが、`location: .` を加えたら、ターゲットのフラグも指定できるようになったようです。</div></div><div class="message" id="message-1512091411.000080"><div class="message__timestamp">2017-12-01<br/>10:23:31 +0900</div><div class="message__header">kazu</div><div class="message__body"><code>stack exec foo</code> で起動される <code>foo</code>がどこにあるか調べる方法はないですか？ <code>stack which foo</code> とかできればいいのですが。。。</div></div><div class="message" id="message-1512091557.000232"><div class="message__timestamp">2017-12-01<br/>10:25:57 +0900</div><div class="message__header">igrep</div><div class="message__body">うーん、直接調べる方法ではありませんが、<br/><code>stack path --bin-path</code> して出てくるパスから調べることになりますかね。。。<br/>あ、 <code>stack exec which foo</code> ならいかがでしょうか？</div></div><div class="message" id="message-1512091618.000200"><div class="message__timestamp">2017-12-01<br/>10:26:58 +0900</div><div class="message__header">matsubara0507</div><div class="message__body"><code>find .stack-work -name foo</code> でうまくいかないかなぁ(笑)</div></div><div class="message" id="message-1512091696.000004"><div class="message__timestamp">2017-12-01<br/>10:28:16 +0900</div><div class="message__header">kazu</div><div class="message__body"><code>stack exec which foo</code> がよさそう。ありがとうございます。</div></div><div class="message" id="message-1512091725.000049"><div class="message__timestamp">2017-12-01<br/>10:28:45 +0900</div><div class="message__header">kazu</div><div class="message__body"><code>find</code> だと、`.stack-work`以外にあるコマンドが起動されていた場合に探せないのです。</div></div><div class="message" id="message-1512099810.000091"><div class="message__timestamp">2017-12-01<br/>12:43:30 +0900</div><div class="message__header">naohaq</div><div class="message__body">Prelude の <code>(^)</code> の定義が多相になっているため、 <code>phi^7</code> などと書くと「Integer に defaulting したよ！」っていう警告が出てしまうんですが <code>phi^(7 :: Int)</code> と書く以外に何か回避策ってあるでしょうか？</div></div><div class="message" id="message-1512102148.000056"><div class="message__timestamp">2017-12-01<br/>13:22:28 +0900</div><div class="message__header">cohei</div><div class="message__body">ただ警告を出さないだけなら <code>-fno-warn-type-defaults</code> というオプションがあります。ほかに試してみたところでは、 default 宣言を使って <code>default(Int)</code> としても警告は出てしまうようです。</div></div><div class="message" id="message-1512103037.000013"><div class="message__timestamp">2017-12-01<br/>13:37:17 +0900</div><div class="message__header">naohaq</div><div class="message__body">とりあえず<br/><code>import Prelude hiding ( (^) )</code><br/><code>import qualified Prelude as Pre ( (^) )</code><br/><code>(^) :: (Num a) =&gt; a -&gt; Int -&gt; a</code><br/><code>x ^ y = x Pre.^ y</code><br/>と再定義して回避しました。</div></div><div class="message" id="message-1512287930.000010"><div class="message__timestamp">2017-12-03<br/>16:58:50 +0900</div><div class="message__header">igrep</div><div class="message__body">@syocy 敢えてRedditのスレにしてみたんですが、 <a href='https://www.reddit.com/r/haskell_jp/comments/7h89ey/a_tour_of_go_in_haskell%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A8go%E3%81%A8haskell%E3%81%AE%E6%AF%94%E8%BC%83_syocys/'>https://www.reddit.com/r/haskell_jp/comments/7h89ey/a_tour_of_go_in_haskell%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%A8go%E3%81%A8haskell%E3%81%AE%E6%AF%94%E8%BC%83_syocys/</a> どうなんでしょ？</div></div><div class="message" id="message-1512288609.000031"><div class="message__timestamp">2017-12-03<br/>17:10:09 +0900</div><div class="message__header">syocy</div><div class="message__body">:naruhodo:</div></div><div class="message" id="message-1512735206.000045"><div class="message__timestamp">2017-12-08<br/>21:13:26 +0900</div><div class="message__header">maru10tgg</div><div class="message__body">@maru10tgg has joined the channel</div></div></div><div class="pager"><a href="/html/C5666B6BB/5.html" class="pager__previous">Previous</a><a href="/" class="pager__top">Top</a><a href="/html/C5666B6BB/7.html" class="pager__next">Next</a></div></body></html>