<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #92</title><link rel="stylesheet" href="../../main.css" type="text/css" media="screen"></head><body><div class="ui container"><h1>haskell-jp / questions #92</h1><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/91.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div><div class="message_list ui feed"><div class="message event" id="message-1603582003.075300"><div class="content"><div class="summary"><div class="message__header user">ttaakkee</div><div class="message__timestamp date"><a class="date" href="#message-1603582003.075300">2020-10-25&nbsp;08:26:43 +0900</a></div></div><div class="message__body description">そのやり方をしたら今度は <code>reply b msg</code>  の部分で型推論できなくてエラーになっちゃいましたorz<br/>どうすれば・・・</div></div></div><div class="message event" id="message-1603596663.075500"><div class="content"><div class="summary"><div class="message__header user">fumieval</div><div class="message__timestamp date"><a class="date" href="#message-1603596663.075500">2020-10-25&nbsp;12:31:03 +0900</a></div></div><div class="message__body description"><pre>data AnyBot env = forall b. (Bot b, Dep b env) =&gt; AnyBot b
instance Bot (AnyBot env) where
  type Dep (AnyBot env) a = (a ~ env)
  name (AnyBot b) = name b
  reply (AnyBot b) msg = reply b msg</pre><br/>これで通りますがもしかしてDep b envが足りなかったのでしょうか？</div></div></div><div class="message event" id="message-1603600377.078900"><div class="content"><div class="summary"><div class="message__header user">ttaakkee</div><div class="message__timestamp date"><a class="date" href="#message-1603600377.078900">2020-10-25&nbsp;13:32:57 +0900</a></div></div><div class="message__body description">わあ！まさにその通りでした！ありがとございます！！<br/><br/>さっぱりどうしていいかわからなかったのですが、どのように思考したらそうなるんですか！？<br/>たけのこは型推論の流れみたいなものを学べばこれを理解できるようになるんでしょうか？༼;´༎ຶ ༎ຶ༽</div></div></div><div class="message event" id="message-1603603642.079100"><div class="content"><div class="summary"><div class="message__header user">fumieval</div><div class="message__timestamp date"><a class="date" href="#message-1603603642.079100">2020-10-25&nbsp;14:27:22 +0900</a></div></div><div class="message__body description">AnyBotにパターンマッチしたとき使えるのは、AnyBotの宣言で量化している制約のみで、一方replyが要求する制約はDep b envを含んでいるので、そこに食い違いがあることがわかります。一般論として、何が要求されていて、それを満たすためにはどこを変えればよいかをエラーメッセージなどなら見極めることが大切だと思います</div></div></div><div class="message event" id="message-1603606670.081500"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1603606670.081500">2020-10-25&nbsp;15:17:50 +0900</a></div></div><div class="message__body description">ライブラリーを作るときに、ライブラリーで提供する型は、特に理由がなければ <code>Generic</code> や <code>NFData</code> （あと、多分テストで使う都合で <code>Eq</code> や <code>Show</code> も）のインスタンスにしておいた方がいいでしょうか？<br/>他にもこれはインスタンスにしておくと助かるなぁ、という型クラスがあれば教えてください！</div></div></div><div class="message event" id="message-1603607652.081600"><div class="content"><div class="summary"><div class="message__header user">fumieval</div><div class="message__timestamp date"><a class="date" href="#message-1603607652.081600">2020-10-25&nbsp;15:34:12 +0900</a></div></div><div class="message__body description">コンストラクタを隠したいなどそうしない明確な理由がなければそうすべき、という立場です。<http://hackage.haskell.org/package/base-4.14.0.0/docs/Data-Proxy.html> Proxy や、　<http://hackage.haskell.org/package/aeson-1.5.4.1/docs/Data-Aeson.html#t:Value> aesonのValue型あたりが参考になると思います</div></div></div></div><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/91.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div></div></body></html>