<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #2</title><link rel="stylesheet" href="../../messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / questions #2</h1><div class="pager"><a href="../../html/C5666B6BB/1.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a><a href="../../html/C5666B6BB/3.html" class="pager__next">Next</a></div><div class="message_list"><div class="message" id="message-1507780337.000064"><div class="message__timestamp">2017-10-12<br/>12:52:17 +0900</div><div class="message__header">naohaq</div><div class="message__body">再帰/余再帰という言葉は「数学的帰納法」と関連が深くて、帰納/余帰納とも呼ばれます。<br/>数学的帰納法で任意の自然数nについて性質p(n)が成り立つことの証明をすることを思い出してみます。<br/>(i) Base case: p(0) が成り立つことを示す。<br/>(ii) Hypothesis: ある自然数kについてp(k)が成り立つとする。<br/>(iii) Step case: (ii)の仮定の下で、p(k+1)が成り立つことを示す。<br/>(iv) (i),(ii),(iii) より、任意の自然数nについてp(n)が成り立つと主張して証明終わり。<br/>なぜこれで全ての自然数についての証明になっているかというと、全ての自然数は、0(ないしは1)から順に1を足していったものになっているからです(ペアノの公理)<br/>帰納的データ型を扱う関数は、これとそっくりな書き方ができます。</div></div><div class="message" id="message-1507780791.000143"><div class="message__timestamp">2017-10-12<br/>12:59:51 +0900</div><div class="message__header">naohaq</div><div class="message__body">例えば、リストを処理する関数fを書くとします。<br/><pre>
f :: [a] -&gt; b
-- Base case: 0の場合に相当
f [] = z
-- Step case: k+1の場合に相当
f (x:xs) = x ⊕ f xs
</pre><br/>なぜこれで全ての <b>有限な</b> リストに対する関数を定義したことになるかといえば、全ての有限なリストは、 [] (nil)に対して : (cons)で一つずつ要素を追加していくことで作られているからです。</div></div><div class="message" id="message-1507782022.000061"><div class="message__timestamp">2017-10-12<br/>13:20:22 +0900</div><div class="message__header">naohaq</div><div class="message__body">有限なリストのように、構造が帰納的(0から順に組み立てていくようなやり方)に定義されているデータ型を「帰納的データ型」と呼びます。<br/>じゃあ無限リストはどうかというと、どこまでいってもbase caseにたどり着きません。そもそも、そういう作られかたをしていないからです。このようなデータに対しては、帰納的に処理を記述することができません。</div></div><div class="message" id="message-1507793608.000114"><div class="message__timestamp">2017-10-12<br/>16:33:28 +0900</div><div class="message__header">igrep</div><div class="message__body"><code>iterate</code> とか <code>unfoldr</code> が典型的な余再帰のための関数ってことですよね！</div></div><div class="message" id="message-1507793637.000002"><div class="message__timestamp">2017-10-12<br/>16:33:57 +0900</div><div class="message__header">igrep</div><div class="message__body">Macをお使いの方に聞きたいのですが、 <code>brew install haskell-stack</code> したときって今でもGHCやcabalがOSにインストールされている場合はそのGHCでソースからビルドする、という面倒な仕様なのでしょうか？</div></div><div class="message" id="message-1507794092.000108"><div class="message__timestamp">2017-10-12<br/>16:41:32 +0900</div><div class="message__header">aruneko</div><div class="message__body">formulaを見ると、以下のような記述があるのでおそらくそのままになっていると思います。<br/><pre>
system "stack", "-j#{jobs}", "--local-bin-path=#{bin}", "install"
</pre></div></div><div class="message" id="message-1507794575.000096"><div class="message__timestamp">2017-10-12<br/>16:49:35 +0900</div><div class="message__header">igrep</div><div class="message__body"><a href='https://github.com/Homebrew/homebrew-core/blob/master/Formula/haskell-stack.rb'>https://github.com/Homebrew/homebrew-core/blob/master/Formula/haskell-stack.rb</a> か。みたいですね。。。これはとても簡単なインストール方法とはいえないな。。。やっぱり報告しようか。。。</div></div><div class="message" id="message-1507794639.000112"><div class="message__timestamp">2017-10-12<br/>16:50:39 +0900</div><div class="message__header">aruneko</div><div class="message__body">そうですね...<br/>あるいは何か問題があってこのような形式になっているかもしれないのですけれども...</div></div><div class="message" id="message-1507877265.000118"><div class="message__timestamp">2017-10-13<br/>15:47:45 +0900</div><div class="message__header">lesguillemets</div><div class="message__body"><code>newtype Show a =&gt; Foo a = Foo a</code> みたいなコードってコンパイル通らないと思うのですが（deprecated な <code>DatatypeContexts</code> を要求される）， <code>stack new Foo</code> して上記のコードのみ書き足して <code>stack build</code> すると一言もなくコンパイルが通って挙動も想定通りになります．`stack ghci` はちゃんと通さない．stack か何かのバグ…なんでしょうか？</div></div><div class="message" id="message-1507877699.000237"><div class="message__timestamp">2017-10-13<br/>15:54:59 +0900</div><div class="message__header">lesguillemets</div><div class="message__body">追記： i) 問題かどうか（僕の勘違いじゃないか） ii) 既知かどうか iii) なんでやねん あたりで疑問に思っています．</div></div><div class="message" id="message-1507878382.000150"><div class="message__timestamp">2017-10-13<br/>16:06:22 +0900</div><div class="message__header">syocy</div><div class="message__body"><code>DatatypeContexts</code> は分からないのですが、 <code>stack build --pedantic</code> とすると警告が出るかもしれません。</div></div><div class="message" id="message-1507879077.000090"><div class="message__timestamp">2017-10-13<br/>16:17:57 +0900</div><div class="message__header">lesguillemets</div><div class="message__body">ありがとうございます． <code>--pedantic</code> でも警告はでないようですね．どこで消えてるんだろう…</div></div><div class="message" id="message-1507882982.000138"><div class="message__timestamp">2017-10-13<br/>17:23:02 +0900</div><div class="message__header">notogawa</div><div class="message__body">実際にstackがどのようなオプションをghcに渡しているかを <code>stack build --cabal-verbose</code> で見てみると， <code>-XHaskell2010</code> が渡されているのが確認できます．つまり <code>stack build</code> 時には <code>stack new</code> で生成したcabalファイルに含まれる設定 <code>default-language: Haskell2010</code> が有効となり，これは <code>DatatypeContexts</code> を包含しているのでエラーが出なくなります．一方 <code>stack ghci</code> でも同様に <code>stack -v ghci</code> でghcに渡されるオプション(と，一応ghci-scriptとして渡されるファイルの中身)を確認してみると，こちらではdefault-languageが渡されていません．ghciの場合でも <code>stack ghci --ghci-options=-XHaskell2010</code> としてあげるとbuild時同様にエラーが出なくなることが確認できます．これがstackの想定通りの挙動なのかはわかりませんが，少なくともbuild側についてはcabalファイルに書かれた設定に対し忠実に動作しているように思えます．</div></div><div class="message" id="message-1507884910.000527"><div class="message__timestamp">2017-10-13<br/>17:55:10 +0900</div><div class="message__header">igrep</div><div class="message__body">関係してググっていて知ったんですが、 <br/><a href='https://ghc.haskell.org/trac/ghc/ticket/8026'>https://ghc.haskell.org/trac/ghc/ticket/8026</a> によると<br/><code>DatatypeContexts</code> 相当のことを今やりたくなったら GADTs を有効にして<br/><pre>
data Foo a where
  Foo :: Eq a =&gt; a -&gt; Foo a
</pre><br/>と書けばいいんですってね。 :naruhodo:</div></div><div class="message" id="message-1507886367.000149"><div class="message__timestamp">2017-10-13<br/>18:19:27 +0900</div><div class="message__header">lesguillemets</div><div class="message__body">なるほど！すごくスッキリしました，ありがとうございます． -XHaskell2010 のあたりを全然意識してなかったので教えていただけてよかったです．</div></div><div class="message" id="message-1507886922.000491"><div class="message__timestamp">2017-10-13<br/>18:28:42 +0900</div><div class="message__header">fumieval</div><div class="message__body">実際のところ、DatatypeContextsはGADTsと違い、パターンマッチしてもコンテキストが使えるわけではない非常にむなしい機能なんですよね…</div></div><div class="message" id="message-1507966229.000001"><div class="message__timestamp">2017-10-14<br/>16:30:29 +0900</div><div class="message__header">tanimocchi</div><div class="message__body">@tanimocchi has joined the channel</div></div><div class="message" id="message-1507966308.000004"><div class="message__timestamp">2017-10-14<br/>16:31:48 +0900</div><div class="message__header">tanimocchi</div><div class="message__body"><a href='http://d.hatena.ne.jp/sumii/20110830/p1'>http://d.hatena.ne.jp/sumii/20110830/p1</a></div></div><div class="message" id="message-1508030068.000039"><div class="message__timestamp">2017-10-15<br/>10:14:28 +0900</div><div class="message__header">hexirp</div><div class="message__body">ghc-paths-0.1.0.9がGHC-7.0.4と7.2.2でビルド出来ないみたいなんですが、これはパッケージそのものの問題として報告したほうがいいんでしょうか？cabalをよく理解していないがためにパッケージの問題なのか原因を絞り切れないので助けを借りたいです。<br/><br/>Travis CIでのログ(他のGHCバージョンでも失敗していますがそれは無関係です)<br/><a href='https://travis-ci.org/Hexirp/doctest-driver-gen/builds/284639068'>https://travis-ci.org/Hexirp/doctest-driver-gen/builds/284639068</a></div></div><div class="message" id="message-1508044203.000048"><div class="message__timestamp">2017-10-15<br/>14:10:03 +0900</div><div class="message__header">hexirp</div><div class="message__body">要約: ビルド方法が悪いのかパッケージのせいなのか知りたいです。<br/><br/>自分でforkしてビルドした結果<br/><a href='https://travis-ci.org/Hexirp/ghc-paths/builds/288111730'>https://travis-ci.org/Hexirp/ghc-paths/builds/288111730</a></div></div><div class="message" id="message-1508051662.000052"><div class="message__timestamp">2017-10-15<br/>16:14:22 +0900</div><div class="message__header">igrep</div><div class="message__body">そのビルドには原因とおぼしきエラーメッセージが一切ないので全く分からないのですが、<br/><a href='https://travis-ci.org/Hexirp/ghc-paths/jobs/288111731'>https://travis-ci.org/Hexirp/ghc-paths/jobs/288111731</a><br/>こちらのフォークしてビルドした結果にある<br/><pre>
Linking /tmp/ghc-paths-0.1.0.9-4199/ghc-paths-0.1.0.9/dist/setup/setup ...
unrecognized option `--disable-benchmarks'
</pre><br/>これが原因だとすると、 Setup.hs が想定しているCabalのバージョンと、cabal-installのバージョンが離れすぎているんじゃないか、と思えます。</div></div><div class="message" id="message-1508051692.000039"><div class="message__timestamp">2017-10-15<br/>16:14:52 +0900</div><div class="message__header">igrep</div><div class="message__body">そもそも、なんでそんな古いGHCでコンパイルしようとしているのでしょうか。。。？<br/>報告してもあまり対応してくれなさそう。。。</div></div><div class="message" id="message-1508054468.000011"><div class="message__timestamp">2017-10-15<br/>17:01:08 +0900</div><div class="message__header">kakkun61</div><div class="message__body">cabal ファイルの custom-setup が 1.24 からで、実際に使ってるのが 1.16 だからかな<br/><a href='https://www.haskell.org/cabal/users-guide/developing-packages.html?highlight=custom%20setup#custom-setup-scripts'>https://www.haskell.org/cabal/users-guide/developing-packages.html?highlight=custom%20setup#custom-setup-scripts</a></div></div><div class="message" id="message-1508065505.000064"><div class="message__timestamp">2017-10-15<br/>20:05:05 +0900</div><div class="message__header">igrep</div><div class="message__body"><blockquote>Warning: ghc-paths.cabal: Ignoring unknown section type: custom-setup</blockquote>custom-setup についてはあくまで警告ですし、関係ないんじゃないっすかね。</div></div><div class="message" id="message-1508148364.000325"><div class="message__timestamp">2017-10-16<br/>19:06:04 +0900</div><div class="message__header">hexirp</div><div class="message__body">答えていただいてありがとうございます。これだけ昔のGHCに対応しようとするとやっぱり色々問題が出てきますね。諦めることにします。<br/><br/>恥ずかしいことに報告しても対応してくれなさそうという視点は持っていませんでした…</div></div><div class="message" id="message-1508389667.000101"><div class="message__timestamp">2017-10-19<br/>14:07:47 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">haddockで <code>spliceURL UnhelpfulSpan</code> というエラーがでてコケるんですがworkaround等ご存じの方いますか？<br/><br/>stack-1.5.1で<https://github.com/myuon/sdlight> のドキュメントを生成しようとしてこのようなエラーになりました。<br/><a href='https://github.com/haskell/haddock/pull/558'>https://github.com/haskell/haddock/pull/558</a> のPRでfixされているような気がしますがstack upgradeしても変わりませんでした(まだ更新されていない？)<br/>スレッドにエラーメッセージを貼っておきます</div></div><div class="message" id="message-1508389739.000150"><div class="message__timestamp">2017-10-19<br/>14:08:59 +0900</div><div class="message__header">myuon_myon</div><div class="message__body"><pre>
~$ stack haddock --no-haddock-deps
sdlight-0.9.0.6: build (lib)
Preprocessing library sdlight-0.9.0.6...
sdlight-0.9.0.6: haddock
Running Haddock for sdlight-0.9.0.6...
Preprocessing library sdlight-0.9.0.6...
Warning: The documentation for the following packages are not installed. No
links will be generated to these packages: fail-4.9.0.0


(省略)

Warning: SDLight.Widgets.Internal.Named: could not find link destinations for:
    ~
Warning: SDLight.Widgets.Core: could not find link destinations for:
    WConfigR
Warning: SDLight.Widgets.Effector: could not find link destinations for:
    Op'Appear Op'Disappear Op'GetAlpha Op'IsAppeared Op'IsDisappeared Op'Start Op'GetValue
Warning: SDLight.Widgets.Layer: could not find link destinations for:
    Op'GetCounter
Warning: SDLight.Widgets.Balloon: could not find link destinations for:
    Op'Fly
Warning: SDLight.Widgets.InputJapanese: could not find link destinations for:
    Op'GetText
Warning: SDLight.Widgets.MessageLayer: could not find link destinations for:
    Op'IsWaiting
Warning: SDLight.Widgets.ScriptEngine: could not find link destinations for:
    Op'LoadMiniScript SimpleDSL RefImage
Warning: SDLight.Widgets.Selector: could not find link destinations for:
    Op'RenderSelector Op'SetLabels
Warning: SDLight.Widgets.TabSelector: could not find link destinations for:
    Op'GetTabName Op'RenderTabSelector Op'GetCurrentSelector Op'SetTabs
haddock: internal error: spliceURL UnhelpfulSpan
CallStack (from HasCallStack):
  error, called at utils/haddock/haddock-api/src/Haddock/Backends/Xhtml/Utils.hs:79:9 in main:Haddock.Backends.Xhtml.Utils

--  While building package sdlight-0.9.0.6 using:
      /home/ioijoi/.stack/setup-exe-cache/x86_64-linux/Cabal-simple_mPHDZzAJ_1.24.2.0_ghc-8.0.2 --builddir=.stack-work/dist/x86_64-linux/Cabal-1.24.2.0 haddock --html --html-location=../$pkg-$version/ --haddock-option=--hyperlinked-source
    Process exited with code: ExitFailure 1
</pre></div></div><div class="message" id="message-1508389816.000120"><div class="message__timestamp">2017-10-19<br/>14:10:16 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">template haskellで生成した関数をexportしているのが怪しいかもしれません</div></div><div class="message" id="message-1508399505.000049"><div class="message__timestamp">2017-10-19<br/>16:51:45 +0900</div><div class="message__header">naohaq</div><div class="message__body">headだと直ってるというコメントもありますね <a href='https://github.com/haskell/haddock/issues/565'>https://github.com/haskell/haddock/issues/565</a></div></div><div class="message" id="message-1508404671.000116"><div class="message__timestamp">2017-10-19<br/>18:17:51 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">そのページの中ほどにある <a href='https://github.com/haskell/haddock/issues/565#issuecomment-281133865'>https://github.com/haskell/haddock/issues/565#issuecomment-281133865</a> で解決したっぽいです。<br/>stack install haddockで最新のhaddockを入れて、それを <code>~/.stack/programs/x86_64-linux/ghc-8.0.2/lib/ghc-8.0.2/bin</code> のものに上書きしたらいけました<br/>stackが使っているhaddockの更新方法が分からなくて困っていたので助かりました。ありがとうございます :pray: :pray: :pray:</div></div><div class="message" id="message-1508515263.000717"><div class="message__timestamp">2017-10-21<br/>01:01:03 +0900</div><div class="message__header">ncneller</div><div class="message__body">@ncneller has joined the channel</div></div><div class="message" id="message-1508628794.000017"><div class="message__timestamp">2017-10-22<br/>08:33:14 +0900</div><div class="message__header">shunsuke.masuda</div><div class="message__body">@shunsuke.masuda has joined the channel</div></div><div class="message" id="message-1508893705.000145"><div class="message__timestamp">2017-10-25<br/>10:08:25 +0900</div><div class="message__header">kazu</div><div class="message__body">オススメのテンプレートライブラリを教えてください。<br/>たとえば、${DOMAIN}みたいな文字列を"<http://example.jp|example.jp>"とかに置き換えれる機能を欲しています。</div></div><div class="message" id="message-1508894420.000055"><div class="message__timestamp">2017-10-25<br/>10:20:20 +0900</div><div class="message__header">igrep</div><div class="message__body">どの程度高機能なものを求めているかにもよりますが、<br/>@arowm さんの <a href='https://github.com/arowM/heterocephalus'>https://github.com/arowM/heterocephalus</a> はコンパイル時にテンプレートの間違いを検出してくれるのでいい感じですよ！</div></div><div class="message" id="message-1508901092.000030"><div class="message__timestamp">2017-10-25<br/>12:11:32 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">パッケージをインストールする際に、ビルドには成功しますが、インストール時に<br/><pre>
Failed to load interface for ‘Data.Hashable.Generic’
no unit id matching ‘hashable-1.2.6.1-14fEJP30YhAG9w115PODz0’ was found
</pre><br/>というエラーが出るんですが何かご存じの方いますか？<br/>ghc-8.2.1とcabal-2.0.0.2を使用しています。<br/>スレッドに詳細を書いておきます。</div></div><div class="message" id="message-1508901289.000154"><div class="message__timestamp">2017-10-25<br/>12:14:49 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">インストールしようとしているのはこのパッケージです<br/><a href='https://github.com/myuon/widx/tree/feature/widget-modules'>https://github.com/myuon/widx/tree/feature/widget-modules</a><br/><br/>以下により詳細なログを貼ります</div></div><div class="message" id="message-1508901331.000237"><div class="message__timestamp">2017-10-25<br/>12:15:31 +0900</div><div class="message__header">myuon_myon</div><div class="message__body"><pre>
/home/ioijoi/.stack/programs/x86_64-linux/ghc-8.2.1/bin/ghc returned
ExitFailure 1 with error message:
Failed to load interface for ‘Data.Hashable.Generic’
no unit id matching ‘hashable-1.2.6.1-14fEJP30YhAG9w115PODz0’ was found
CallStack (from HasCallStack):
  die', called at libraries/Cabal/Cabal/Distribution/Simple/Program/Run.hs:171:7 in Cabal-2.0.0.2:Distribution.Simple.Program.Run
  getProgramInvocationOutput, called at libraries/Cabal/Cabal/Distribution/Simple/GHC.hs:1522:11 in Cabal-2.0.0.2:Distribution.Simple.GHC
  libAbiHash, called at libraries/Cabal/Cabal/Distribution/Simple/Register.hs:260:30 in Cabal-2.0.0.2:Distribution.Simple.Register
  abiHash, called at libraries/Cabal/Cabal/Distribution/Simple/Register.hs:239:21 in Cabal-2.0.0.2:Distribution.Simple.Register
  generateRegistrationInfo, called at libraries/Cabal/Cabal/Distribution/Simple/Register.hs:135:25 in Cabal-2.0.0.2:Distribution.Simple.Register
  generateOne, called at libraries/Cabal/Cabal/Distribution/Simple/Register.hs:121:28 in Cabal-2.0.0.2:Distribution.Simple.Register
  register, called at libraries/Cabal/Cabal/Distribution/Simple.hs:770:10 in Cabal-2.0.0.2:Distribution.Simple
  defaultRegHook, called at libraries/Cabal/Cabal/Distribution/Simple.hs:584:20 in Cabal-2.0.0.2:Distribution.Simple
  regHook, called at libraries/Cabal/Cabal/Distribution/Simple/UserHooks.hs:120:5 in Cabal-2.0.0.2:Distribution.Simple.UserHooks
  cmd_hook, called at libraries/Cabal/Cabal/Distribution/Simple.hs:452:38 in Cabal-2.0.0.2:Distribution.Simple
  cmd_hook, called at libraries/Cabal/Cabal/Distribution/Simple.hs:469:4 in Cabal-2.0.0.2:Distribution.Simple
  hookedActionWithArgs, called at libraries/Cabal/Cabal/Distribution/Simple.hs:451:5 in Cabal-2.0.0.2:Distribution.Simple
  hookedAction, called at libraries/Cabal/Cabal/Distribution/Simple.hs:430:5 in Cabal-2.0.0.2:Distribution.Simple
  registerAction, called at libraries/Cabal/Cabal/Distribution/Simple.hs:184:50 in Cabal-2.0.0.2:Distribution.Simple
  defaultMainHelper, called at libraries/Cabal/Cabal/Distribution/Simple.hs:124:19 in Cabal-2.0.0.2:Distribution.Simple
  defaultMainArgs, called at Main.hs:1210:18 in main:Main
cabal: '/home/ioijoi/.stack/programs/x86_64-linux/ghc-8.2.1/bin/ghc' exited
with an error:
Failed to load interface for ‘Data.Hashable.Generic’
no unit id matching ‘hashable-1.2.6.1-14fEJP30YhAG9w115PODz0’ was found
cabal: Leaving directory '/home/ioijoi/program/widx'
CallStack (from HasCallStack):
  die', called at ./Distribution/Client/Install.hs:995:15 in main:Distribution.Client.Install
cabal: Error: some packages failed to install:
widx-0.1.0.0-ENE00C4n2nTCnkzTC7mfaY failed during the final install step. The
exception was:
ExitFailure 1
</pre></div></div><div class="message" id="message-1508901589.000174"><div class="message__timestamp">2017-10-25<br/>12:19:49 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">ちなみに、このパッケージ自体はhashableには依存していませんがすでにhashable-1.2.6.1がインストールされています</div></div><div class="message" id="message-1508905184.000013"><div class="message__timestamp">2017-10-25<br/>13:19:44 +0900</div><div class="message__header">wado</div><div class="message__body">試してみたんですけども、僕の環境では  <code>widx</code> を依存関係に追加したプロジェクトで普通に使えました。<br/><br/><pre>
$ stack --version
Version 1.6.0, Git revision 0e756d486a5a4d6fe03e0d448bb8e706c5834ca1 (5293 commits) x86_64 hpack-0.18.1

$ cat stack.yaml
resolver: lts-9.10
packages:
- .
extra-deps:
- git: <https://github.com/myuon/widx.git>
  commit: master
- colors-0.3.0.2

$ cat package.yaml
name:                test-widx
version:             0.1.0.0
#synopsis:
#description:
homepage:            <https://github.com/githubuser/test-widx#readme>
license:             BSD3
author:              Author name here
maintainer:          <mailto:example@example.com|example@example.com>
copyright:           2017 Author name here
category:            Web
extra-source-files:
- README.md

dependencies:
  - base &gt;= 4.7 &amp;&amp; &lt; 5
  - widx

executables:
  test-widx:
    source-dirs:      src
    main:             Main.hs
</pre><br/><br/><code>.stack-work</code> を削除して再度実行してみても同じですか？</div></div><div class="message" id="message-1508905418.000045"><div class="message__timestamp">2017-10-25<br/>13:23:38 +0900</div><div class="message__header">igrep</div><div class="message__body">ブランチはmasterじゃなくてfeature/widget-modulesなのでは？<br/><pre>
extra-deps:
- git: <https://github.com/myuon/widx.git>
  commit: feature/widget-modules
- colors-0.3.0.2
</pre><br/>かと。</div></div><div class="message" id="message-1508907020.000160"><div class="message__timestamp">2017-10-25<br/>13:50:20 +0900</div><div class="message__header">wado</div><div class="message__body"><blockquote>ブランチはmasterじゃなくてfeature/widget-modulesなのでは？</blockquote>確かにそうですね！変更しても問題ありませんでした。</div></div><div class="message" id="message-1508916944.000381"><div class="message__timestamp">2017-10-25<br/>16:35:44 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">わかりにくくてすみません、featureブランチの方です</div></div><div class="message" id="message-1508917061.000229"><div class="message__timestamp">2017-10-25<br/>16:37:41 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">あと、このパッケージはbackpackを使っているのでghc-8.2, cabal-2以上でないとビルドできません。stackはcabal2系に対応していないので、私はcabal-install-2.0.0.2とghc-8.2をstackで入れてパスなどを通したものを使ってビルドしています。</div></div><div class="message" id="message-1508929966.000116"><div class="message__timestamp">2017-10-25<br/>20:12:46 +0900</div><div class="message__header">aiya000</div><div class="message__body">こういうSExpr型に被せたCallowSExpr型があって、<br/><br/>PatternSynonymsでCons''パターンを（Cons'パターンのように）<br/>書きたいんですが、いまいちPatternSynonymsがわかりません…。<br/><br/>（実際に通るコード）<br/><br/><pre>haskell
{-# LANGUAGE PatternSynonyms #-}

data SExpr = Cons SExpr SExpr | AtomInt Int

newtype CallowSExpr = CallowSExpr { growup :: SExpr }

pattern AtomInt' :: Int -&gt; CallowSExpr
pattern AtomInt' x = CallowSExpr (AtomInt x)

pattern Cons' :: SExpr -&gt; SExpr -&gt; CallowSExpr
pattern Cons' x y = CallowSExpr (Cons x y)

main :: IO ()
main = do
  let x = Cons' (AtomInt 1) (AtomInt 2)
  return ()
</pre><br/><br/>（通したい追加コード）<br/><br/><pre>haskell
pattern Cons'' :: CallowSExpr -&gt; CallowSExpr -&gt; CallowSExpr
--pattern Cons'' x y &lt;- (growup {- …？ -})

y :: CallowSExpr
y = Cons'' (AtomInt' 1) (AtomInt' 2)
</pre><br/><br/>愚直にパターンを組み立てようとすると、帰納的なのでこんなになってしまいそう。<br/><br/><pre>haskell
pattern Cons'' (AtomInt' x) (AtomInt' y) = CallowSExpr (Cons x y)
pattern Cons'' (CallowSExpr (Cons (AtomInt x1) (AtomInt x2))) (AtomInt' y) = CallowSExpr (Cons (Cons (AtomInt x) (AtomInt y)) y)
{-... 以下無限に続くと思う -}
</pre><br/><br/>Cons''パターンを部分関数的にせずに、書く方法ってないですか？</div></div><div class="message" id="message-1508933679.000176"><div class="message__timestamp">2017-10-25<br/>21:14:39 +0900</div><div class="message__header">igrep</div><div class="message__body">そういえば、cabal sandboxを使ってるんですか？<br/>それともnew-buildを使ってるんですか？<br/>それとも普通のcabal buildですか？<br/>「インストール」というのはビルドしてからadd-sourceしてcabal installした場合を指してます？<br/>など、再現手順がイマイチ不明瞭なので教えていただきたく。<br/>もっとも、私からぱっとできるアドバイスは、関連するファイル、 <code>.cabal-sandbox</code> とかを一旦削除してやり直せ、ぐらいしか思い浮かばないので、cabalにバグ報告した方がいいんじゃないかと思っています。</div></div><div class="message" id="message-1508935035.000331"><div class="message__timestamp">2017-10-25<br/>21:37:15 +0900</div><div class="message__header">wado</div><div class="message__body">この辺関係ありそうな感じもしますけど、どうかな。<br/><a href='https://ghc.haskell.org/trac/ghc/ticket/14304'>https://ghc.haskell.org/trac/ghc/ticket/14304</a><br/><a href='https://github.com/haskell/cabal/issues/4755'>https://github.com/haskell/cabal/issues/4755</a></div></div><div class="message" id="message-1508937899.000051"><div class="message__timestamp">2017-10-25<br/>22:24:59 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">@igrep 再現手順についてはこれでいかがでしょうか(git cloneした直後からのログです)<br/><a href='https://gist.github.com/myuon/e49d89b6504cb645cb1d0a53d39e4b77'>https://gist.github.com/myuon/e49d89b6504cb645cb1d0a53d39e4b77</a><br/>@wado 私もTH関係かなと思ったんですが、今のコードからTHを取り除いても(makeLenses関係を手書きしても)エラーメッセージは変わりませんでした</div></div><div class="message" id="message-1508938006.000026"><div class="message__timestamp">2017-10-25<br/>22:26:46 +0900</div><div class="message__header">myuon_myon</div><div class="message__body">多分なんかのバグを踏んだのだろうという気はするんですが、ghcのバグなのかcabalのバグなのか依存してるパッケージに関連したバグなのかも不明なんですがそんな状態でcabalに報告してもいいんでしょうか？<br/>とりあえずもう少し調査を進めつつminimalな例を頑張って作ってみようとは思っています</div></div><div class="message" id="message-1508938279.000504"><div class="message__timestamp">2017-10-25<br/>22:31:19 +0900</div><div class="message__header">igrep</div><div class="message__body">うーん、確かに。MLで根回しするところからですかね。。。<br/>とりあえず <a href='https://github.com/haskell/cabal#communicating'>https://github.com/haskell/cabal#communicating</a> に書いてあったのですが、<br/> <a href='https://mail.haskell.org/mailman/listinfo/cabal-devel'>https://mail.haskell.org/mailman/listinfo/cabal-devel</a> に投げてしまうのはありじゃないかと思います。</div></div><div class="message" id="message-1508938308.000018"><div class="message__timestamp">2017-10-25<br/>22:31:48 +0900</div><div class="message__header">kazu</div><div class="message__body">ありがとうございます。<br/>エスケーピングが不要なのと、Text.Printf.printf で事足りることを思い出したので、printfを使いました！</div></div></div><div class="pager"><a href="../../html/C5666B6BB/1.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a><a href="../../html/C5666B6BB/3.html" class="pager__next">Next</a></div></body></html>