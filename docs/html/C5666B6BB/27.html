<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #27</title><link rel="stylesheet" href="/slack-log/messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / questions #27</h1><div class="pager"><a href="/slack-log/html/C5666B6BB/26.html" class="pager__previous">Previous</a><a href="/slack-log/" class="pager__top">Top</a><a href="/slack-log/html/C5666B6BB/28.html" class="pager__next">Next</a></div><div class="message_list"><div class="message" id="message-1535474190.000100"><div class="message__timestamp">2018-08-29<br/>01:36:30 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">うーん、なんででしょう...</div></div><div class="message" id="message-1535474514.000100"><div class="message__timestamp">2018-08-29<br/>01:41:54 +0900</div><div class="message__header">shogo.otake</div><div class="message__body">コピペミスしてるわけでもないみたいですし…うーん…</div></div><div class="message" id="message-1535474547.000100"><div class="message__timestamp">2018-08-29<br/>01:42:27 +0900</div><div class="message__header">shogo.otake</div><div class="message__body">これもまたフラグが必要なものだったりしますか？</div></div><div class="message" id="message-1535475485.000100"><div class="message__timestamp">2018-08-29<br/>01:58:05 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">BangPatterns<br/>LambdaCase<br/>が必要です。</div></div><div class="message" id="message-1535475789.000100"><div class="message__timestamp">2018-08-29<br/>02:03:09 +0900</div><div class="message__header">shogo.otake</div><div class="message__body">BangPatternsをつけたらビルドできました！<br/><pre>
(Nil,0)
(Bool True,1)
(Bool False,2)
(UInt8 1,3)
(UInt16 2,5)
</pre><br/>おかげさまでやりたかったことができました！遅くまで本当にありがとうございました！</div></div><div class="message" id="message-1535695926.000100"><div class="message__timestamp">2018-08-31<br/>15:12:06 +0900</div><div class="message__header">igrep</div><div class="message__body">ちょっと前出てきたすごい長い英語のHaskell入門書ってなんていうんでしたっけ。書名が出てこない... :thinking_face:</div></div><div class="message" id="message-1535695965.000100"><div class="message__timestamp">2018-08-31<br/>15:12:45 +0900</div><div class="message__header">wado</div><div class="message__body">Get programming with haskell ですか？</div></div><div class="message" id="message-1535696026.000100"><div class="message__timestamp">2018-08-31<br/>15:13:46 +0900</div><div class="message__header">igrep</div><div class="message__body">多分それです！確か割とお勧めされてましたよね？</div></div><div class="message" id="message-1535696066.000100"><div class="message__timestamp">2018-08-31<br/>15:14:26 +0900</div><div class="message__header">wado</div><div class="message__body">僕はまだ読んでる途中なので、まだレビューできていないです:innocent:</div></div><div class="message" id="message-1535697599.000100"><div class="message__timestamp">2018-08-31<br/>15:39:59 +0900</div><div class="message__header">igrep</div><div class="message__body"><a href='http://haskellbook.com/'>http://haskellbook.com/</a> のことだったかも！まぁ両方紹介しとくか！</div></div><div class="message" id="message-1535705759.000100"><div class="message__timestamp">2018-08-31<br/>17:55:59 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">質問です。遊びでRedditのようなものを作ってたのですが。`Comment`のArbitraryインスタンスで躓いています。。<br/><a href='https://gist.github.com/HirotoShioi/94367f655bd0fb00e5acb27be1ed29eb'>https://gist.github.com/HirotoShioi/94367f655bd0fb00e5acb27be1ed29eb</a><br/><code>runSumComment 100</code><br/>と実行するとランダムなコメントをn個生成してその統計を取っているのですが、StackOverFlowで実行エラーになります。<br/><br/><pre>
data Comment = Comment
    { cId          :: !Integer
    , cAuthor      :: !User
    , cParentId    :: !(Maybe Integer)
    , cPoint       :: !Int
    , cDescription :: !Text
    , cResponse    :: ![Comment]
    } deriving Show
</pre><br/><br/>原因はcResponseがコメントのリストだからねずみ講の要領でとんでもない量のコメントに膨れ上がってるからだと睨んでます。<br/>できればコメントの返信の総数を200以下に留めたいのですが、それは可能なのでしょうか。</div></div><div class="message" id="message-1535706091.000100"><div class="message__timestamp">2018-08-31<br/>18:01:31 +0900</div><div class="message__header">igrep</div><div class="message__body">総数ではなく深さを200に制限することになりますが、愚直にやるなら<br/><br/><pre>
arbitrary = go 0
 where
  go depth = do
    ...
    cResponse &lt;-
      if depth == 200
        then pure []
        else vecorOf listLen $ go (depth + 1)
    pure Comment {..}
</pre><br/><br/>ですかね。<br/>（総数も各 <code>cResponse</code> の <code>length</code> をとって足し合わせればできるかな...?）</div></div><div class="message" id="message-1535706189.000100"><div class="message__timestamp">2018-08-31<br/>18:03:09 +0900</div><div class="message__header">igrep</div><div class="message__body">あとは自分で試したことがないので自信がないのですが、 <a href='http://hackage.haskell.org/package/smallcheck'>http://hackage.haskell.org/package/smallcheck</a> を使えば大きさを指定した上でのテストができます。<br/>「任意の文字列のコメントに対してテスト」みたいなことはできなくなってしまいますが。</div></div><div class="message" id="message-1535706367.000100"><div class="message__timestamp">2018-08-31<br/>18:06:07 +0900</div><div class="message__header">igrep</div><div class="message__body">ほかには、  <code>cResponse</code> の <code>!</code> を外すとメモリ消費量はめっちゃ増えそうですがstack overflowはしないかもしれません。<br/>（ :warning: これも試さないで想像で言ってます！）</div></div><div class="message" id="message-1535721701.000100"><div class="message__timestamp">2018-08-31<br/>22:21:41 +0900</div><div class="message__header">syocy</div><div class="message__body">igrep さんのやり方でもいいと思いますが、 <code>sized</code> と <code>scale</code> を使うのがより正当なやり方かもしれません。 <a href='http://hackage.haskell.org/package/QuickCheck-2.11.3/docs/Test-QuickCheck-Gen.html'>http://hackage.haskell.org/package/QuickCheck-2.11.3/docs/Test-QuickCheck-Gen.html</a><br/><pre>
arbitrary = scale (min 200) $ sized $ \size -&gt; {- 最大でsize個のcResponseを持つCommentを生成する処理-}
</pre><br/>（今手元に環境がないのでコードは適当です）</div></div><div class="message" id="message-1535901196.000200"><div class="message__timestamp">2018-09-03<br/>00:13:16 +0900</div><div class="message__header">k.marumaru524</div><div class="message__body">@k.marumaru524 has joined the channel</div></div><div class="message" id="message-1535961077.000100"><div class="message__timestamp">2018-09-03<br/>16:51:17 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">ありがとうございます！`size`のことに関して調べてみます！</div></div><div class="message" id="message-1535967508.000100"><div class="message__timestamp">2018-09-03<br/>18:38:28 +0900</div><div class="message__header">notogawa</div><div class="message__body">ICFP行く人います？</div></div><div class="message" id="message-1535967751.000100"><div class="message__timestamp">2018-09-03<br/>18:42:31 +0900</div><div class="message__header">igrep</div><div class="message__body">HIWとHaskell Symposiumだけ行きます。 :raised_hand:</div></div><div class="message" id="message-1535975668.000100"><div class="message__timestamp">2018-09-03<br/>20:54:28 +0900</div><div class="message__header">igrep</div><div class="message__body">確か @khibinoさんは本体も参加されるんでしたっけ？</div></div><div class="message" id="message-1536013461.000200"><div class="message__timestamp">2018-09-04<br/>07:24:21 +0900</div><div class="message__header">insight.insight</div><div class="message__body">@insight.insight has joined the channel</div></div><div class="message" id="message-1536316959.000100"><div class="message__timestamp">2018-09-07<br/>19:42:39 +0900</div><div class="message__header">cdepillabout</div><div class="message__body">行きます！strangeloopも参加します。</div></div><div class="message" id="message-1536494452.000100"><div class="message__timestamp">2018-09-09<br/>21:00:52 +0900</div><div class="message__header">igrep</div><div class="message__body">mapM, filterM, じゃ物足りなくて、maximumByMとかなんでも欲しくなりません？<br/>そりゃあやろうと思えばfoldMで書けるんでしょうけども。<br/>あとずいぶん前に insertWithKeyM も欲しくなったかなぁ。<br/>なんかいい方法ありませんかねぇ。</div></div><div class="message" id="message-1536494521.000100"><div class="message__timestamp">2018-09-09<br/>21:02:01 +0900</div><div class="message__header">igrep</div><div class="message__body">おお、maximumByM はあったか！<br/><a href='https://www.stackage.org/haddock/lts-12.9/monad-loops-0.4.3/Control-Monad-Loops.html#v:maximumByM'>https://www.stackage.org/haddock/lts-12.9/monad-loops-0.4.3/Control-Monad-Loops.html#v:maximumByM</a></div></div><div class="message" id="message-1536511131.000200"><div class="message__timestamp">2018-09-10<br/>01:38:51 +0900</div><div class="message__header">takumi.k.5610</div><div class="message__body">@takumi.k.5610 has joined the channel</div></div><div class="message" id="message-1536738218.000100"><div class="message__timestamp">2018-09-12<br/>16:43:38 +0900</div><div class="message__header">igrep</div><div class="message__body">ちょっと困ってるんですが、みなさん <code>stack --resolver lts-12.9 repl --package iCalendar-0.4.0.4 --package mime-0.4.0.2</code> と実行したらどうなります？<br/>（特にMacの人）<br/><a href='https://www.reddit.com/r/haskell/comments/9f5ovv/link_error_with_icalendar0404/'>https://www.reddit.com/r/haskell/comments/9f5ovv/link_error_with_icalendar0404/</a></div></div><div class="message" id="message-1536738840.000100"><div class="message__timestamp">2018-09-12<br/>16:54:00 +0900</div><div class="message__header">kakkun61</div><div class="message__body"></div></div><div class="message" id="message-1536738881.000100"><div class="message__timestamp">2018-09-12<br/>16:54:41 +0900</div><div class="message__header">igrep</div><div class="message__body">全く同じエラーみたいですね。。。<br/>再現性が高いようで良かった。</div></div><div class="message" id="message-1536738983.000100"><div class="message__timestamp">2018-09-12<br/>16:56:23 +0900</div><div class="message__header">syocy</div><div class="message__body"></div></div><div class="message" id="message-1536739035.000100"><div class="message__timestamp">2018-09-12<br/>16:57:15 +0900</div><div class="message__header">igrep</div><div class="message__body">Macですかね。やっぱりLinux版とよく似たエラーですな。。。</div></div><div class="message" id="message-1536739149.000100"><div class="message__timestamp">2018-09-12<br/>16:59:09 +0900</div><div class="message__header">notogawa</div><div class="message__body">シンボルテーブル見ると未定義となっており入ってない． <code>Paths_iCalendar</code> モジュールのシンボルなので，<br/><code><https://github.com/chrra/iCalendar/commit/91fc4ac7abdae0bed42f0282fe39c6072a88397f></code> が原因？</div></div><div class="message" id="message-1536739482.000100"><div class="message__timestamp">2018-09-12<br/>17:04:42 +0900</div><div class="message__header">igrep</div><div class="message__body">確かに <a href='https://github.com/chrra/iCalendar'>https://github.com/chrra/iCalendar</a> をcloneしてビルドすると<br/><pre>
&lt;no location info&gt;: warning: [-Wmissing-home-modules]
[ 1 of 10] Compiling Paths_iCalendar  ( .stack-work\dist\7d103d30\build\autogen\Paths_iCalendar.hs, .stack-work\dist\7d103d30\build\Paths_iCalendar.o )
    These modules are needed for compilation but not listed in your .cabal file's other-modules: Paths_iCalendar
</pre><br/>などと出ますね。</div></div><div class="message" id="message-1536739552.000100"><div class="message__timestamp">2018-09-12<br/>17:05:52 +0900</div><div class="message__header">igrep</div><div class="message__body">ああー、報告されてた。これっぽいですね！ありがとうございました！<br/><a href='https://github.com/chrra/iCalendar/pull/30'>https://github.com/chrra/iCalendar/pull/30</a></div></div><div class="message" id="message-1536902722.000100"><div class="message__timestamp">2018-09-14<br/>14:25:22 +0900</div><div class="message__header">khibino</div><div class="message__body">ICFP 行きます。</div></div><div class="message" id="message-1536916236.000100"><div class="message__timestamp">2018-09-14<br/>18:10:36 +0900</div><div class="message__header">igrep</div><div class="message__body">こちらの質問に関連している論文が、今度のHaskell Symposium 2018に投稿されてましたので共有いたします。<br/>再帰的なデータ構造の <code>Arbitrary</code> をどうするか、というのは結構難しい問題みたいでして。<br/><a href='https://arxiv.org/pdf/1808.01520.pdf'>https://arxiv.org/pdf/1808.01520.pdf</a></div></div><div class="message" id="message-1536981440.000100"><div class="message__timestamp">2018-09-15<br/>12:17:20 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">おお、ありがとう。連休中に読んで見ます。前に講義の課題でトライ木のArbitraryインスタンスを定義してたなーと思って見直したらえらい難解でした。。<br/><a href='https://gist.github.com/HirotoShioi/94ca87534be2144250fa10b61c7ce0d8'>https://gist.github.com/HirotoShioi/94ca87534be2144250fa10b61c7ce0d8</a></div></div><div class="message" id="message-1537417014.000100"><div class="message__timestamp">2018-09-20<br/>13:16:54 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">Persistent PostgreSqlに関する質問です。<br/>以下の記事にそって`createdAt UTCTime default=CURRENT_TIME`と設定しました。<br/><a href='https://www.yesodweb.com/book/persistent#persistent_attributes'>https://www.yesodweb.com/book/persistent#persistent_attributes</a><br/><br/>しかしマイグレーションの際に以下のエラーメッセージが出力されます。<br/><br/><pre>
*** Exception: SqlError {sqlState = "42804", sqlExecStatus = FatalError, sqlErrorMsg = "column \"created_at\" is of type timestamp with time zone but default expression is of type time with time zone", sqlErrorDetail = "", sqlErrorHint = "You will need to rewrite or cast the expression."}
</pre><br/><br/>これに対する回避策はあるのでしょうか。</div></div><div class="message" id="message-1537417909.000100"><div class="message__timestamp">2018-09-20<br/>13:31:49 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">代わりに，now()を使うのはどうでしょう？<br/><a href='https://github.com/yesodweb/persistent/blob/master/docs/Persistent-entity-syntax.md#default'>https://github.com/yesodweb/persistent/blob/master/docs/Persistent-entity-syntax.md#default</a></div></div><div class="message" id="message-1537418378.000100"><div class="message__timestamp">2018-09-20<br/>13:39:38 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">ありがとうございます。やってみます。なにやらTimeZoneに関する記事がリンクされてますので、それも読んでみます。</div></div><div class="message" id="message-1537418765.000100"><div class="message__timestamp">2018-09-20<br/>13:46:05 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">Postgresでは，timestamp型のデフォルト値用にCURRENT_TIMESTAMPとnow()がサポートされています(なので，CURRENT_TIMESTAMPを使っても良いと思いますね)．<br/><a href='https://www.postgresql.jp/document/10/html/functions-datetime.html'>https://www.postgresql.jp/document/10/html/functions-datetime.html</a></div></div><div class="message" id="message-1537418833.000100"><div class="message__timestamp">2018-09-20<br/>13:47:13 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">いけました！ありがとうございます。<br/>調べてみるとpostgresqlにおけるcurrent_timeはその日の時刻のみ（日付はない）返すようです。。</div></div><div class="message" id="message-1537418848.000100"><div class="message__timestamp">2018-09-20<br/>13:47:28 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body"><a href='https://www.postgresql.jp/document/7.2/user/functions-datetime.html#FUNCTIONS-DATETIME-CURRENT'>https://www.postgresql.jp/document/7.2/user/functions-datetime.html#FUNCTIONS-DATETIME-CURRENT</a></div></div><div class="message" id="message-1537504617.000200"><div class="message__timestamp">2018-09-21<br/>13:36:57 +0900</div><div class="message__header">yuga</div><div class="message__body">@yuga has joined the channel</div></div><div class="message" id="message-1537518614.000200"><div class="message__timestamp">2018-09-21<br/>17:30:14 +0900</div><div class="message__header">www2480www</div><div class="message__body">@www2480www has joined the channel</div></div><div class="message" id="message-1537542160.000200"><div class="message__timestamp">2018-09-22<br/>00:02:40 +0900</div><div class="message__header">stackexchange.you</div><div class="message__body">@stackexchange.you has joined the channel</div></div><div class="message" id="message-1537767864.000200"><div class="message__timestamp">2018-09-24<br/>14:44:24 +0900</div><div class="message__header">trsnium</div><div class="message__body">@trsnium has joined the channel</div></div><div class="message" id="message-1537847261.000100"><div class="message__timestamp">2018-09-25<br/>12:47:41 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body"><code>catchAnyDeep</code>, <code>tryAnyDeep</code>より更に評価を強制する関数ってありますかね。。<br/>これらの関数を用いてもキャッチできない例外があって困ってます。（しかも部分関数からの例外です。。</div></div><div class="message" id="message-1537853925.000100"><div class="message__timestamp">2018-09-25<br/>14:38:45 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">なんとか解決できました！</div></div><div class="message" id="message-1537920700.000100"><div class="message__timestamp">2018-09-26<br/>09:11:40 +0900</div><div class="message__header">karoyakani</div><div class="message__body">HackerRank の <code>Substring Diff</code> <a href='https://www.hackerrank.com/challenges/substring-diff/problem'>https://www.hackerrank.com/challenges/substring-diff/problem</a> の Haskell での解法を教えて下さい　Python ならば通る方法（２次元のテーブルを作り二分探索）を使うと　n = 1500 のテストケースで Data.Array メモリーエラーになりました</div></div><div class="message" id="message-1537964991.000100"><div class="message__timestamp">2018-09-26<br/>21:29:51 +0900</div><div class="message__header">kakkun61</div><div class="message__body">書いてみたけど TLE なってしまった</div></div></div><div class="pager"><a href="/slack-log/html/C5666B6BB/26.html" class="pager__previous">Previous</a><a href="/slack-log/" class="pager__top">Top</a><a href="/slack-log/html/C5666B6BB/28.html" class="pager__next">Next</a></div></body></html>