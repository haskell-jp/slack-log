<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>haskell-jp / questions #96 at 2021-04-22 14:00:13 +0900</title>
<link rel="stylesheet" href="../../../main.css" type="text/css" media="screen">
</head>
<body>
  <div class="ui container">
    <h1>haskell-jp / questions #96 at 2021-04-22 14:00:13 +0900</h1>
    <div class="ui pagination menu">
      <a href="../96.html" class="item">Back to questions #96</a>
    </div>
    <div class="ui feed">
      <div class="event" id="message-1619067613.071300">
        <div class="content">
          <div class="summary">
            <div class="user">kazu</div>
            <div class="date"><a class="date" href="#message-1619067613.071300">2021-04-22 14:00:13 +0900</a></div>
          </div>
          <div class="description"><code>bracket</code> の第二引数(資源解放)で STM を利用すると、デッドロックを起こすことがあるのは、よく知られたことですか？</div>
        </div>
      </div>
      <div class="event" id="message-1619347815.073800">
        <div class="content">
          <div class="summary">
            <div class="user">fumieval</div>
            <div class="date"><a class="date" href="#message-1619347815.073800">2021-04-25 19:50:15 +0900</a></div>
          </div>
          <div class="description">具体例はありますか？むしろ、STMを使えばデッドロックが起きないように記述しやすいと思うのですが</div>
        </div>
      </div>
      <div class="event" id="message-1619356789.074500">
        <div class="content">
          <div class="summary">
            <div class="user">kazu</div>
            <div class="date"><a class="date" href="#message-1619356789.074500">2021-04-25 22:19:49 +0900</a></div>
          </div>
          <div class="description">僕の quic ライブラリでは 100% 再現します。STM を IORef にすると、デッドロックはなくなります。</div>
        </div>
      </div>
      <div class="event" id="message-1619356832.074700">
        <div class="content">
          <div class="summary">
            <div class="user">kazu</div>
            <div class="date"><a class="date" href="#message-1619356832.074700">2021-04-25 22:20:32 +0900</a></div>
          </div>
          <div class="description">Note that cancel will not terminate until the thread the Async refers to has terminated. This means that cancel will block for as long said thread blocks when receiving an asynchronous exception.<br/><br/>For example, it could block if:<br/><br/>    It's executing a foreign call, and thus cannot receive the asynchronous exception;<br/>    It's executing some cleanup handler after having received the exception, and the handler is blocking.</div>
        </div>
      </div>
      <div class="event" id="message-1619356877.074900">
        <div class="content">
          <div class="summary">
            <div class="user">kazu</div>
            <div class="date"><a class="date" href="#message-1619356877.074900">2021-04-25 22:21:17 +0900</a></div>
          </div>
          <div class="description">async ライブラリには上記の記述があります。block には STM の block も含まれるのでしょう。</div>
        </div>
      </div>
      <div class="event" id="message-1619356910.075100">
        <div class="content">
          <div class="summary">
            <div class="user">kazu</div>
            <div class="date"><a class="date" href="#message-1619356910.075100">2021-04-25 22:21:50 +0900</a></div>
          </div>
          <div class="description">close の STM が、どうして block するのかは、不明なんですが。。。</div>
        </div>
      </div>
      <div class="event" id="message-1619360390.075400">
        <div class="content">
          <div class="summary">
            <div class="user">fumieval</div>
            <div class="date"><a class="date" href="#message-1619360390.075400">2021-04-25 23:19:50 +0900</a></div>
          </div>
          <div class="description">「STM を IORefをすると」というのは、TVarのことを指していますか？また、closeのSTMとは何を指していますか？</div>
        </div>
      </div>
      <div class="event" id="message-1619387675.075600">
        <div class="content">
          <div class="summary">
            <div class="user">kazu</div>
            <div class="date"><a class="date" href="#message-1619387675.075600">2021-04-26 06:54:35 +0900</a></div>
          </div>
          <div class="description">「TVar を IORef にする」「bracket の第二引数」という意味でした。</div>
        </div>
      </div>
      <div class="event" id="message-1619518346.076300">
        <div class="content">
          <div class="summary">
            <div class="user">fumieval</div>
            <div class="date"><a class="date" href="#message-1619518346.076300">2021-04-27 19:12:26 +0900</a></div>
          </div>
          <div class="description">bracketの第二引数はTVarの操作だけでしょうか？`&lt;|&gt; pure ()`を加えるとどうなりますか</div>
        </div>
      </div>
    </div>
    <div class="ui pagination menu">
      <a href="../96.html" class="item">Back to questions #96</a>
    </div>
  </div>
</body>
</html>
