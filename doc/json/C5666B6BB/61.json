[
    {
        "ts": "1559552257.030000",
        "text": "まったくの思いつきで恐縮ですが、\n`forkIO`で別スレッドで処理される中で、コネクションの`close`が意図するタイミングで呼ばれていない可能性はありませんか？",
        "user": "U7GSVRQ6S",
        "type": "message"
    },
    {
        "ts": "1559552386.030200",
        "text": "`insertLog db' lf` を `bracket`を使うようにするとどうでしょうか。",
        "user": "U7GSVRQ6S",
        "type": "message"
    },
    {
        "ts": "1559552899.030500",
        "text": "ありがとうございます．\n`bracket`を利用しましたが同様の挙動になりました．\n```\ninsertLog :: String -&gt; LogField -&gt; IO()\ninsertLog db' lf = bracket\n                   (open db')\n                   close\n                   $ \\conn -&gt; execute conn \"INSERT INTO log VALUES (null,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)\" lf\n```",
        "user": "UH195J82Y",
        "type": "message"
    },
    {
        "ts": "1559553015.031100",
        "text": "<https://teratail.com/questions/5099> このような記述をみつけました。本質的な問題なのかも？\n&gt;たしか、現在の実装では、当該データベース ファイルに対する更新処理はジャーナル ファイルにいったん保持した後、ジャーナルの世代が古い順からトランザクションとして処理していき（FIFO）、最終的にジャーナル ファイルがなくなるまでファイルを更新し続けます。\n&gt;その際、更新処理が多重で走ることによりジャーナルをデータベース ファイルに適用するのが間に合わなくなってくると、ロックに関する例外を吐くようになります。",
        "user": "UF8SE896V",
        "type": "message"
    },
    {
        "ts": "1559553375.031600",
        "text": "ロックの問題はどこかで「retryすればいいよ!」と見かけたのですが，もしかしたらその処理が追い付かなくなっているのかもしれないですね．．．\nこの際pgがmysqlを導入することを検討しようかと思います．\nみなさんありがとうございます．",
        "user": "UH195J82Y",
        "type": "message"
    },
    {
        "ts": "1559553806.031800",
        "text": "ログ書くときの `forkIO` を止めて同期的に書き込むだけで若干改善されませんかね（もちろんその分動作は遅くなりますが）\n（どちらにしてもそれだけのリクエストを裁くのであればSQLiteは止めた方がいいのでしょうけども）",
        "user": "U4LGTMTMK",
        "type": "message"
    },
    {
        "ts": "1559553957.032100",
        "text": "そうですね，このプログラム自体がサイトのレスポンスタイムを記録しておきたいものなのでspawnしたいです．．\n私個人のサイトなのでsqliteでいいかなと思ったのですが，pg動かすことにします．",
        "user": "UH195J82Y",
        "type": "message"
    },
    {
        "ts": "1559564676.032500",
        "text": "ナイーブに字句解析器でトークンに位置情報を入れるというのはよくやります．",
        "user": "U4KU9ABL0",
        "type": "message"
    }
]