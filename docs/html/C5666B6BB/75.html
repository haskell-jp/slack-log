<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #75</title><link rel="stylesheet" href="../../messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / questions #75</h1><div class="pager"><a href="../../html/C5666B6BB/74.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a></div><div class="message_list"><div class="message" id="message-1574235741.117100"><div class="message__timestamp">2019-11-20<br/>16:42:21 +0900</div><div class="message__header">hexirp</div><div class="message__body">一例を挙げます。<br/>環境: stack を使っています。それによって GHC 8.6.5, cabal 2.4.0.1 が使われています。 cabal-install はちょっとわかりません。<br/>cabal ファイル: <a href='https://github.com/Hexirp/hexirp-hakyll/blob/e6b28eaf95031baf6193c8bd4bb652eefa31f70b/hexyll/hexyll.cabal'>https://github.com/Hexirp/hexirp-hakyll/blob/e6b28eaf95031baf6193c8bd4bb652eefa31f70b/hexyll/hexyll.cabal</a><br/>ログ (on Travis CI): <a href='https://travis-ci.org/Hexirp/hexirp-hakyll/builds/614356184'>https://travis-ci.org/Hexirp/hexirp-hakyll/builds/614356184</a></div></div><div class="message" id="message-1574236389.117500"><div class="message__timestamp">2019-11-20<br/>16:53:09 +0900</div><div class="message__header">igrep</div><div class="message__body"><a href='https://github.com/haskell/cabal/issues/5022'>https://github.com/haskell/cabal/issues/5022</a> 曰くパッケージそのもののバージョンではなく依存パッケージのバージョンのことを言っている可能性もありますね... でもぱっと見おかしなところがわからない。 :confused:</div></div><div class="message" id="message-1574236757.117900"><div class="message__timestamp">2019-11-20<br/>16:59:17 +0900</div><div class="message__header">hexirp</div><div class="message__body">この変更から hexyll に関する <code>Cabal file warning ***.cabal@0:0: version with tags</code> というエラーがなくなっているようなのですが、手掛かりになりますでしょうか<br/><a href='https://github.com/Hexirp/hexirp-hakyll/commit/2f857cd001109d7587ab4e82f8f15e40d5c746aa'>https://github.com/Hexirp/hexirp-hakyll/commit/2f857cd001109d7587ab4e82f8f15e40d5c746aa</a></div></div><div class="message" id="message-1574236872.118200"><div class="message__timestamp">2019-11-20<br/>17:01:12 +0900</div><div class="message__header">hexirp</div><div class="message__body">もしかしてライセンスの GPL-3-or-later という指定が原因……？</div></div><div class="message" id="message-1574237570.118400"><div class="message__timestamp">2019-11-20<br/>17:12:50 +0900</div><div class="message__header">hexirp</div><div class="message__body">cabal がバージョンとライセンスに同じ処理をかけていたりしているかもしれないですね</div></div><div class="message" id="message-1574245196.118700"><div class="message__timestamp">2019-11-20<br/>19:19:56 +0900</div><div class="message__header">igrep</div><div class="message__body">確かに、cabalはどっかのバージョンでLICENCEで使用できる値を変えたのでそれが関係しているかも知れません</div></div><div class="message" id="message-1574269430.119000"><div class="message__timestamp">2019-11-21<br/>02:03:50 +0900</div><div class="message__header">imamura.suuri</div><div class="message__body">@imamura.suuri has joined the channel</div></div><div class="message" id="message-1574296238.119300"><div class="message__timestamp">2019-11-21<br/>09:30:38 +0900</div><div class="message__header">monoid911</div><div class="message__body">@monoid911 has joined the channel</div></div><div class="message" id="message-1574333349.119500"><div class="message__timestamp">2019-11-21<br/>19:49:09 +0900</div><div class="message__header">hexirp</div><div class="message__body">hpack に移行したら <code>GPL-3.0-or-later</code> と license に書いてもエラーが出なくなりました。 cabal へ変換した後の内容は前と同じはずなのに……</div></div><div class="message" id="message-1574347809.119800"><div class="message__timestamp">2019-11-21<br/>23:50:09 +0900</div><div class="message__header">ikngtty</div><div class="message__body">@ikngtty has joined the channel</div></div><div class="message" id="message-1574426028.120100"><div class="message__timestamp">2019-11-22<br/>21:33:48 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">cabal-version がファイルの先頭にない場合、旧バージョンのファイルとして前処理されます。 SPDX の式が書けるのは、新バージョンからなはずです。詳しく見てないので断言できませんが、それが関係してる気がしますね</div></div><div class="message" id="message-1574426105.120300"><div class="message__timestamp">2019-11-22<br/>21:35:05 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">hpack はその仕様が出来てから cabal-version を最初に吐き出すようになったはずですね</div></div><div class="message" id="message-1574427495.120600"><div class="message__timestamp">2019-11-22<br/>21:58:15 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">Oh… 適当を言うのはやっぱだめですね．手元で試せる環境ができたので試しましたが，まず cabal は 1.2 からファイル仕様に関してバージョン指定ができ，どのファイル仕様を使うか cabal-version で指定できるようになりました．で， cabal-version: x.y と指定するのが普通ですが，<br/>cabal-version: >=1.10<br/>cabal-version: >=2.0<br/>だけ特別扱いされ，それぞれ 1.12 の形式と 2.0 の形式が選ばれます．<br/><br/>で， 2.2 の形式から license に書ける式が変わっており，旧来は cabal 独自の形式だったのが SPDX expression で指定するようになりました．<br/>独自の形式の AST は， <a href='http://hackage.haskell.org/package/Cabal-3.0.0.0/docs/Distribution-License.html#t:License'>http://hackage.haskell.org/package/Cabal-3.0.0.0/docs/Distribution-License.html#t:License</a> で，見ての通り GPL はバージョンだけしか指定できず or-later は指定できません．それが警告として表示されていて， 「GPL のライセンス指定してるんだと思うけど書く形式間違ってるんじゃない？」と言ってるんだと思います．で， hpack は多分 cabal-version: 2.4 とかで出力してるので通ってるとかではないですかね？</div></div><div class="message" id="message-1574429207.121000"><div class="message__timestamp">2019-11-22<br/>22:26:47 +0900</div><div class="message__header">hexirp</div><div class="message__body">その通りでした。 hpack による出力は <code>cabal-version: 2.2</code> と一番最初の個所に書いてありました。詳細な回答ありがとうございます。</div></div><div class="message" id="message-1574429282.121200"><div class="message__timestamp">2019-11-22<br/>22:28:02 +0900</div><div class="message__header">hexirp</div><div class="message__body">ところで、もっと詳細に知るには <a href='https://www.haskell.org/cabal/users-guide/file-format-changelog.html'>https://www.haskell.org/cabal/users-guide/file-format-changelog.html</a> と <a href='https://www.haskell.org/cabal/users-guide/developing-packages.html#package-properties'>https://www.haskell.org/cabal/users-guide/developing-packages.html#package-properties</a> を読めばOKでしょうか？</div></div><div class="message" id="message-1574432989.121500"><div class="message__timestamp">2019-11-22<br/>23:29:49 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">そうだと思います (僕が知った経緯は，たまたま cabal file の AST を最近いじろうと思ったことがあってっていうだけなので，本当にそのドキュメントを読むだけで良いかはちょっと自信ないですが)</div></div><div class="message" id="message-1574433076.121700"><div class="message__timestamp">2019-11-22<br/>23:31:16 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">(現状， cabal の仕様は複雑になっていく一方なんですが，エラーメッセージはかなり不親切で cabal user  guide もあまり網羅性がないので，置いてけぼり食ってるユーザかなりいそうな気がするんですよね…)</div></div><div class="message" id="message-1574478725.122000"><div class="message__timestamp">2019-11-23<br/>12:12:05 +0900</div><div class="message__header">hexirp</div><div class="message__body">エラーメッセージが不親切なのは、現に私はこの問題を最初はパッケージのバージョンに関する問題だと勘違いしてしまったわけで、かなり問題そうですね。</div></div><div class="message" id="message-1574608620.123300"><div class="message__timestamp">2019-11-25<br/>00:17:00 +0900</div><div class="message__header">yozoranotakaku</div><div class="message__body">@yozoranotakaku has joined the channel</div></div><div class="message" id="message-1574680889.123800"><div class="message__timestamp">2019-11-25<br/>20:21:29 +0900</div><div class="message__header">matsushita</div><div class="message__body">@matsushita has joined the channel</div></div><div class="message" id="message-1574920822.124100"><div class="message__timestamp">2019-11-28<br/>15:00:22 +0900</div><div class="message__header">akasak777</div><div class="message__body">@akasak777 has joined the channel</div></div><div class="message" id="message-1575079131.126800"><div class="message__timestamp">2019-11-30<br/>10:58:51 +0900</div><div class="message__header">maoe</div><div class="message__body">AppVeyorで <code>choco install -y ghc --version 8.8.1</code> すると[NuGet] The operation has timed outと言われてしまうのですがどうしたらよいかわかる人いませんか？`--timeout 0`でタイムアウトを無効にしても直りませんでした。<br/><a href='https://ci.appveyor.com/project/maoe/threadscope-3cf8u/builds/29216836/job/jadrm74fdjigwlqq'>https://ci.appveyor.com/project/maoe/threadscope-3cf8u/builds/29216836/job/jadrm74fdjigwlqq</a></div></div><div class="message" id="message-1575089581.126900"><div class="message__timestamp">2019-11-30<br/>13:53:01 +0900</div><div class="message__header">wado</div><div class="message__body">choco が落ちてるみたいですね。<br/><br/><a href='https://status.chocolatey.org/'>https://status.chocolatey.org/</a><br/><a href='https://gitter.im/chocolatey/choco'>https://gitter.im/chocolatey/choco</a></div></div><div class="message" id="message-1575089661.127500"><div class="message__timestamp">2019-11-30<br/>13:54:21 +0900</div><div class="message__header">maoe</div><div class="message__body">おーなるほど。ありがとうございます。</div></div><div class="message" id="message-1575165166.128100"><div class="message__timestamp">2019-12-01<br/>10:52:46 +0900</div><div class="message__header">takaaaao3</div><div class="message__body">@takaaaao3 has joined the channel</div></div><div class="message" id="message-1575202108.128400"><div class="message__timestamp">2019-12-01<br/>21:08:28 +0900</div><div class="message__header">toru-slack</div><div class="message__body">@toru-slack has joined the channel</div></div><div class="message" id="message-1575391713.128700"><div class="message__timestamp">2019-12-04<br/>01:48:33 +0900</div><div class="message__header">leouno</div><div class="message__body">@leouno has joined the channel</div></div><div class="message" id="message-1575421690.129900"><div class="message__timestamp">2019-12-04<br/>10:08:10 +0900</div><div class="message__header">takato.h0rikosh1</div><div class="message__body">はじめまして。初歩的な質問で恐縮いたしますが、、、<br/>この MyInteger の型クラスインスタンスの実装だと MyInteger と Integer が同一の型として扱われるようになっちゃうんですがなぜなんでしょうか？<br/><pre>newtype MyInteger = MyInteger { getInteger :: Integer } deriving (Eq, Show)

instance Num MyInteger where
  fromInteger = MyInteger
  x + y       = MyInteger $ getInteger x + getInteger y
  x - y       = MyInteger $ getInteger x - getInteger y
  x * y       = MyInteger $ getInteger x * getInteger y
  abs x       = if getInteger x &lt; 0 then x * (-x) else x
  signum x    = if getInteger x &lt; 0 then -1 else 1

-- え？
ghci&gt;MyInteger 1 + 1
MyInteger {getInteger = 2}

ghci&gt;MyInteger 1 == 1
True</pre></div></div><div class="message" id="message-1575421832.130000"><div class="message__timestamp">2019-12-04<br/>10:10:32 +0900</div><div class="message__header">lotz</div><div class="message__body">Haskellの整数値リテラルは <code>Num a =&gt; a</code> という型とみなされるので、<br/><pre>&gt; :t 1
1 :: Num p =&gt; p</pre><br/><code>MyInteger</code> はNumのインスタンスになっているので == の右辺にある 1 は MyInteger と認識されているはずです！</div></div><div class="message" id="message-1575421872.130200"><div class="message__timestamp">2019-12-04<br/>10:11:12 +0900</div><div class="message__header">notogawa</div><div class="message__body"><a href='https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.13.0.0/Prelude.html#v:fromInteger'>https://downloads.haskell.org/~ghc/latest/docs/html/libraries/base-4.13.0.0/Prelude.html#v:fromInteger</a></div></div><div class="message" id="message-1575421887.130400"><div class="message__timestamp">2019-12-04<br/>10:11:27 +0900</div><div class="message__header">lotz</div><div class="message__body">つまり<br/><pre>MyInteger 1 == 1</pre><br/>は<br/><pre>MyInteger 1 == fromInteger 1</pre><br/>と同じ挙動をしてます</div></div><div class="message" id="message-1575422241.131500"><div class="message__timestamp">2019-12-04<br/>10:17:21 +0900</div><div class="message__header">takato.h0rikosh1</div><div class="message__body">おおー！そうなんですね！<br/>理解しました！ありがとうございました:raised_hands:</div></div><div class="message" id="message-1575446794.132400"><div class="message__timestamp">2019-12-04<br/>17:06:34 +0900</div><div class="message__header">kai.tenyatendon</div><div class="message__body">@kai.tenyatendon has joined the channel</div></div><div class="message" id="message-1575748526.132900"><div class="message__timestamp">2019-12-08<br/>04:55:26 +0900</div><div class="message__header">yosuheee</div><div class="message__body">@yosuheee has joined the channel</div></div><div class="message" id="message-1575788993.133200"><div class="message__timestamp">2019-12-08<br/>16:09:53 +0900</div><div class="message__header">s.inagaki58</div><div class="message__body">@s.inagaki58 has joined the channel</div></div><div class="message" id="message-1575795579.137000"><div class="message__timestamp">2019-12-08<br/>17:59:39 +0900</div><div class="message__header">igrep</div><div class="message__body">stack ghciで、開発しているパッケージと、それを使ったサンプルコードを同時に（ <code>:reload</code> でリロードできるよう）読もうとして<br/><pre>stack ghci -- &lt;パッケージ名&gt;:lib サンプルコード.hs</pre><br/>と書いたのですが、<br/><pre>Cannot use 'stack ghci' with both file targets and package targets</pre><br/>というエラーが出てしまいます。<br/>多分 <code>サンプルコード.hs</code> の方をパッケージのcabalファイルにおける <code>executable</code> なり <code>test-suite</code> なりに一時的にせよ書いてしまえばいいと思うのですが、他に良い方法はないでしょうか？</div></div><div class="message" id="message-1575795929.137100"><div class="message__timestamp">2019-12-08<br/>18:05:29 +0900</div><div class="message__header">igrep</div><div class="message__body">多分自己解決しました。一旦<br/><code>stack ghci -- &lt;パッケージ名&gt;:lib</code> でパッケージを読んだ後、 <code>:add</code> コマンドで`サンプルコード.hs` を追加するといいみたいです。 <code>:add</code> なんて便利なのがあったんですね。</div></div><div class="message" id="message-1575797458.137300"><div class="message__timestamp">2019-12-08<br/>18:30:58 +0900</div><div class="message__header">igrep</div><div class="message__body">面白い。 <code>stack ghci</code> を <code>-v</code> オプション付きで実行してみたら<br/><pre>Run process: ghc-8.6.5.exe --interactive -ghci-script=C:\Users\igrep\AppData\Local\Temp\haskell-stack-ghci\0752026d\ghci-script</pre><br/>なんて出てきて（実際にはもっと長いコマンド）、<br/>その <code>C:\Users\igrep\AppData\Local\Temp\haskell-stack-ghci\0752026d\ghci-script</code> を開いてみたら<br/><pre>:add 読み込んでいるパッケージのモジュール...
:module + 読み込んでいるパッケージのモジュール...</pre><br/>ってしてた。<br/>要はどちらもひたすら <code>:add</code> してるだけってことか:sweat_smile:</div></div><div class="message" id="message-1576425347.000200"><div class="message__timestamp">2019-12-16<br/>00:55:47 +0900</div><div class="message__header">chobochobo</div><div class="message__body">@chobochobo has joined the channel</div></div><div class="message" id="message-1576486723.000500"><div class="message__timestamp">2019-12-16<br/>17:58:43 +0900</div><div class="message__header">atc1014</div><div class="message__body">@atc1014 has joined the channel</div></div><div class="message" id="message-1576707292.000200"><div class="message__timestamp">2019-12-19<br/>07:14:52 +0900</div><div class="message__header">8hjkl8</div><div class="message__body">@8hjkl8 has joined the channel</div></div><div class="message" id="message-1576795201.000200"><div class="message__timestamp">2019-12-20<br/>07:40:01 +0900</div><div class="message__header">kiboreeb9m14d</div><div class="message__body">@kiboreeb9m14d has joined the channel</div></div><div class="message" id="message-1576933883.000500"><div class="message__timestamp">2019-12-21<br/>22:11:23 +0900</div><div class="message__header">nashnicolas2020</div><div class="message__body">@nashnicolas2020 has joined the channel</div></div><div class="message" id="message-1576972290.000800"><div class="message__timestamp">2019-12-22<br/>08:51:30 +0900</div><div class="message__header">URMPG677D</div><div class="message__body">@URMPG677D has joined the channel</div></div></div><div class="pager"><a href="../../html/C5666B6BB/74.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a></div></body></html>