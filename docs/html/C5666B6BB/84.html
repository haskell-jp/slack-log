<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #84</title><link rel="stylesheet" href="../../main.css" type="text/css" media="screen"></head><body><div class="ui container"><h1>haskell-jp / questions #84</h1><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/83.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div><div class="message_list ui feed"><div class="message event" id="message-1588315812.091400"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1588315812.091400">2020-05-01&nbsp;15:50:12 +0900</a></div></div><div class="message__body description">詳しい事情はhaskell-cafeあたりで何度か触れられていると思います（自分もぶっちゃけよく調べてない...<br/><a href='https://takenobu-hs.github.io/haskell-wiki-search/?siteview=full'>https://takenobu-hs.github.io/haskell-wiki-search/?siteview=full</a> からチェックを入れて検索してみてください。</div></div></div><div class="message event" id="message-1588315838.091600"><div class="content"><div class="summary"><div class="message__header user">cj.bc-sd</div><div class="message__timestamp date"><a class="date" href="#message-1588315838.091600">2020-05-01&nbsp;15:50:38 +0900</a></div></div><div class="message__body description">みてみます！<br/>ありがとうございます</div></div></div><div class="message event" id="message-1588315860.091800"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1588315860.091800">2020-05-01&nbsp;15:51:00 +0900</a></div></div><div class="message__body description">あと、base-4.13以降のドキュメントについては <a href='https://wiki.haskell.jp/Hikers%20Guide%20to%20Haskell#base-4.13%E4%BB%A5%E9%99%8D%E3%81%AE%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88'>https://wiki.haskell.jp/Hikers%20Guide%20to%20Haskell#base-4.13%E4%BB%A5%E9%99%8D%E3%81%AE%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88</a> でも触れているとおり、GHC添付のドキュメントを探れ、とのこと。</div></div></div><div class="message event" id="message-1588315927.092000"><div class="content"><div class="summary"><div class="message__header user">cj.bc-sd</div><div class="message__timestamp date"><a class="date" href="#message-1588315927.092000">2020-05-01&nbsp;15:52:07 +0900</a></div></div><div class="message__body description">ｵｫ…知らなかった…<br/>ありがとうございます<br/>ちょっとわかりづらい…</div></div></div><div class="message event" id="message-1588396588.092400"><div class="content"><div class="summary"><div class="message__header user">U012WHCBRSR</div><div class="message__timestamp date"><a class="date" href="#message-1588396588.092400">2020-05-02&nbsp;14:16:28 +0900</a></div></div><div class="message__body description">@U012WHCBRSR has joined the channel</div></div></div><div class="message event" id="message-1588400929.092700"><div class="content"><div class="summary"><div class="message__header user">U012R7RMZB8</div><div class="message__timestamp date"><a class="date" href="#message-1588400929.092700">2020-05-02&nbsp;15:28:49 +0900</a></div></div><div class="message__body description">@U012R7RMZB8 has joined the channel</div></div></div><div class="message event" id="message-1588404058.093000"><div class="content"><div class="summary"><div class="message__header user">akagi15</div><div class="message__timestamp date"><a class="date" href="#message-1588404058.093000">2020-05-02&nbsp;16:20:58 +0900</a></div></div><div class="message__body description">@akagi15 has joined the channel</div></div></div><div class="message event" id="message-1588404290.093200"><div class="content"><div class="summary"><div class="message__header user">akagi15</div><div class="message__timestamp date"><a class="date" href="#message-1588404290.093200">2020-05-02&nbsp;16:24:50 +0900</a></div></div><div class="message__body description">質問させていただきます.<br/>このプログラムのlikeReturn に相当するような処理は実現可能でしょうか?<br/><br/>ST s (STArray s a b) を引数にとって, &lt;ST action&gt; をその内部に適用しつつ,runSTをその内部で利用したいというかなりわがままな利用ができたら色々とキレイに書けるので試行錯誤しています.<br/><br/>&gt;  update i test = readArray  test i &gt;&gt;= writeArray (_test test) (i + 1) <br/>の形にしたり,<br/>&gt; runSTTest :: STTest s -&gt; Int -&gt; ST s Int<br/>にするとシンタックスが手続き型っぽくなるので,できないものかと.<br/><br/>unsafePerformIOを使ってunsafeRunSTを作ればできそうですが悩みどころです.<br/><br/>現行で発生するエラーは下記になります<br/><br/>&gt;  *• Couldn’t match type ‘s1’ with ‘s’*<br/>&gt;    *‘s1’ is a rigid type variable bound by*<br/>&gt;     *the type signature for:*<br/>&gt;      *likeReturn :: Test s -&gt; STTest s*<br/>&gt;     *at /Users/akagi/Documents/Programs/Haskell/VirtualEconomy/src/Sample.hs:26:1-36*<br/>&gt;    *‘s’ is a rigid type variable bound by*<br/>&gt;     *the type signature for:*<br/>&gt;      *likeReturn :: forall s. Test s -&gt; STTest s*<br/>&gt;     *at /Users/akagi/Documents/Programs/Haskell/VirtualEconomy/src/Sample.hs:25:1-42*<br/>&gt;    *Expected type: ST s1 (Test s1)*<br/>&gt;     *Actual type: ST s1 (Test s)*<br/>&gt;   *• In the expression: ST (\ s -&gt; (# s, x #))*<br/>&gt;    *In an equation for ‘likeReturn’:*<br/>&gt;      *likeReturn x = ST (\ s -&gt; (# s, x #))*<br/>&gt;   *• Relevant bindings include*<br/>&gt;     *x :: Test s*<br/>&gt;      *(bound at /Users/akagi/Documents/Programs/Haskell/VirtualEconomy/src/Sample.hs:26:12)*<br/>&gt;     *likeReturn :: Test s -&gt; STTest s*<br/>&gt;      *(bound at /Users/akagi/Documents/Programs/Haskell/VirtualEconomy/src/Sample.hs:26:1)*</div></div></div><div class="message event" id="message-1588409583.094600"><div class="content"><div class="summary"><div class="message__header user">as_capabl</div><div class="message__timestamp date"><a class="date" href="#message-1588409583.094600">2020-05-02&nbsp;17:53:03 +0900</a></div></div><div class="message__body description">質問の意図が取れているか自信がないのですが、<br/>• runSTTestが <code>ST s Int</code> ではなく <code>Int</code> を返せば、 <code>runSTTest ... &gt;&gt;= f</code> ではなく <code>f (runSTTest ...)</code> と書けるので恰好いい<br/>• なので、runSTTestの中でrunSTを呼び、外側のSTに紐づいたSTMArrayを参照したい<br/>というモチベーションでしょうか。内側にいるとはいえ、STのRankN多相で守られた配列を参照しようとしている事になるので、無理っぽい気がします</div></div></div><div class="message event" id="message-1588409638.094800"><div class="content"><div class="summary"><div class="message__header user">as_capabl</div><div class="message__timestamp date"><a class="date" href="#message-1588409638.094800">2020-05-02&nbsp;17:53:58 +0900</a></div></div><div class="message__body description"><pre>type STTest s = forall s. ST s (Test s)</pre><br/>この宣言ですが、右辺のforall sで新しいスコープの変数sが定義されてしまって、左辺のsは使用されないのでは。</div></div></div><div class="message event" id="message-1588410842.095100"><div class="content"><div class="summary"><div class="message__header user">akagi15</div><div class="message__timestamp date"><a class="date" href="#message-1588410842.095100">2020-05-02&nbsp;18:14:02 +0900</a></div></div><div class="message__body description">ご返信ありがとうございます.<br/>意図はそのとおりで,単に見た目が数式のとおりになるので,という話なのですが,難しそうですね.<br/><br/>たしかに,左辺のsは使用しませんね.左辺のsを消すと<br/><br/><blockquote> forall s. Test s -&gt; STTest</blockquote>となり<br/>動かない理由が直感的にもわかりやすいですね.<br/><br/>実際のコードでは,複数の時系列変数が大量につまったTest sのようなものを引き連れているので, わかりやすさと更新の速さを両立させたいですが,なかなかうまく行きません.</div></div></div><div class="message event" id="message-1588411225.095500"><div class="content"><div class="summary"><div class="message__header user">akagi15</div><div class="message__timestamp date"><a class="date" href="#message-1588411225.095500">2020-05-02&nbsp;18:20:25 +0900</a></div></div><div class="message__body description">更新を伴う大量のデータを引数に引き回す際にもともとはMapをつかっていたものをSTに変更しようとしていましたがrunSTをかませるとコードがかなり複雑になってしますので,難しいところです</div></div></div><div class="message event" id="message-1588456424.095900"><div class="content"><div class="summary"><div class="message__header user">U012YCXSY90</div><div class="message__timestamp date"><a class="date" href="#message-1588456424.095900">2020-05-03&nbsp;06:53:44 +0900</a></div></div><div class="message__body description">@U012YCXSY90 has joined the channel</div></div></div></div><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/83.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div></div></body></html>