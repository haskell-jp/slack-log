<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>haskell-jp / questions #102</title>
<link rel="stylesheet" href="../../main.css" type="text/css" media="screen">
</head>
<body>
  <div class="ui container">
    <h1>haskell-jp / questions #102</h1>
    <div class="ui pagination menu">
      <a href="../../html/C5666B6BB/101.html" class="item">Previous</a>
      <a href="../../" class="item">Top</a>
    </div>
    <div class="ui feed">
      <div class="event" id="message-1661954651.345509">
        <div class="content">
          <div class="summary">
            <div class="user">kakkun61</div>
            <div class="date"><a class="date" href="#message-1661954651.345509">2022-08-31 23:04:11 +0900</a></div>
          </div>
          <div class="description">cabal.project.local に相当するような stack.yaml のやつってありますか？</div>
          <a class="link-to-replies" href="102/1661954651.345509.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1662340285.680249">
        <div class="content">
          <div class="summary">
            <div class="user">kazu</div>
            <div class="date"><a class="date" href="#message-1662340285.680249">2022-09-05 10:11:25 +0900</a></div>
          </div>
          <div class="description">いくつかのデータ型があらかじめ定義されており、それらはTLV(type length value)で統一的に符号化されるとします。<br/>これに対する符号器/復号器の基本ライブラリを作りますが、データ型は将来追加されるかもしれないので、サードパーティライブラリで拡張可能としたいです。<br/><br/>まず、符号化のために以下のようなクラスを定義します。<br/><br/><pre>class Typeable a =&gt; T a where
  typeT  :: Int
  encode :: T -&gt; ByteString
  decode :: ByteString -&gt; T
  fromTLV :: TLV -&gt; Maybe a  -- TLVは後述
  fromTLV (TLV x) = cast x
  toTLS :: a -&gt; TLV
  toTLS = TLV</pre><br/>既存のデータを表す型を A と B とすると、<br/><br/><pre>data A = A ...
data B = B ...

instance A where
  typeT = 0
  encode = ...
  decode = ...

instance B where
  typeT = 1
  encode = ...
  decode = ...</pre><br/>これらの型を同じように扱えるように、 <code>ExistentialQuantification</code> を用いて、以下の型を定義します。<br/><br/><pre>data TLV = forall a. T a =&gt; TLV a</pre><br/>符号器で encode を使うのは、 <code>a</code> が与えられるので簡単です。<br/><br/><pre>encodeTLV :: TLV -&gt; ByteString
encodeTLV (TLV x) = encode x</pre><br/>問題は復号器です。TLVのTとLの部分は <code>ByteString</code> に符号化された整数なので、それをパースして V の部分の <code>ByteString</code> を切り出した後に、適切な <code>decode</code> を呼ぶだしたいのですが、どうすれば呼べるでしょうか？<br/><br/>ぱっと思いつくのは、 <code>Int -&gt; ByteString</code> の辞書を用意して、それを引くことです。拡張可能にするのは、この辞書を公開し、利用時に要素を追加可能にする必要がありそうです。<br/><br/>基本的に reflaction に関係する問題だと思います。サードバーティが <code>data C</code> を定義したら、自動的にその <code>decode</code> も呼ばれるような魔法はあるのでしょうか？</div>
          <a class="link-to-replies" href="102/1662340285.680249.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1662712288.672419">
        <div class="content">
          <div class="summary">
            <div class="user"></div>
            <div class="date"><a class="date" href="#message-1662712288.672419">2022-09-09 17:31:28 +0900</a></div>
          </div>
          <div class="description">Haskellそのものとは関係ない質問になるので恐縮ですがお聞かせ下さい<br/><br/>プログラミング初心者やHaskellの周辺に全く触れたことない人向けに一時間程度Haskellについて話す機会を得たのですが、皆さんならどういった内容を話すと良いと思われますか？</div>
          <a class="link-to-replies" href="102/1662712288.672419.html">... Replies ...</a>
        </div>
      </div>
    </div>
    <div class="ui pagination menu">
      <a href="../../html/C5666B6BB/101.html" class="item">Previous</a>
      <a href="../../" class="item">Top</a>
    </div>
  </div>
</body>
</html>
