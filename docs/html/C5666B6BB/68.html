<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #68</title><link rel="stylesheet" href="../../messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / questions #68</h1><div class="pager"><a href="../../html/C5666B6BB/67.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a></div><div class="message_list"><div class="message" id="message-1566219854.115200"><div class="message__timestamp">2019-08-19<br/>22:04:14 +0900</div><div class="message__header">k.marumaru524</div><div class="message__body">@igrep<br/>あ！！spacesがspaceになっているのが原因でした..<br/>ありがとうございます<br/>前々からspacesはやたら出てくるなぁと感じていたので教えていただいたものを使うとだいぶスッキリ書けました</div></div><div class="message" id="message-1566219992.115500"><div class="message__timestamp">2019-08-19<br/>22:06:32 +0900</div><div class="message__header">k.marumaru524</div><div class="message__body">@as_capabl これ、やりたかったけど書き方がわからなくて断念したものに近いです！ありがとうございます<br/><br/>ちなみにこんな感じになりました<br/><a href='https://github.com/mrsekut/plp-hs/commit/7f2a2425244ae40f028d9b1fa3cde321726399dc'>https://github.com/mrsekut/plp-hs/commit/7f2a2425244ae40f028d9b1fa3cde321726399dc</a></div></div><div class="message" id="message-1566220077.115700"><div class="message__timestamp">2019-08-19<br/>22:07:57 +0900</div><div class="message__header">k.marumaru524</div><div class="message__body">@takenobu.hs<br/>choiceとchainl1は初見でした<br/>早速試してみます<br/>ありがとうございます！</div></div><div class="message" id="message-1566235611.116600"><div class="message__timestamp">2019-08-20<br/>02:26:51 +0900</div><div class="message__header">k.marumaru524</div><div class="message__body">chainl1ヤバいですね..</div></div><div class="message" id="message-1566252727.117000"><div class="message__timestamp">2019-08-20<br/>07:12:07 +0900</div><div class="message__header">igrep</div><div class="message__body">おまけにひけらかし: Megaparsecには、chainlを便利にしたmakeExprParserというのがあります<br/><a href='https://hackage.haskell.org/package/megaparsec-6.4.0/docs/Text-Megaparsec-Expr.html'>https://hackage.haskell.org/package/megaparsec-6.4.0/docs/Text-Megaparsec-Expr.html</a></div></div><div class="message" id="message-1566314797.117600"><div class="message__timestamp">2019-08-21<br/>00:26:37 +0900</div><div class="message__header">k.marumaru524</div><div class="message__body">なるほど！！<br/>Parsecを拡張(?)したAuttoparsecやMegaparsecなるものがあるのですね<br/>初めて知りました<br/>ありがとうございます！<br/>makeExprParser、ちょっと調べてみます</div></div><div class="message" id="message-1566320100.118000"><div class="message__timestamp">2019-08-21<br/>01:55:00 +0900</div><div class="message__header">igrep</div><div class="message__body">Megaparsecについてはそうです。Parsecのイケてないところをいろいろ改善するために作られたライブラリーなので。<br/>Attoparsecについては、Parsecとちょっと方向性が違っていて、詳しいエラーメッセージを出せない代わりに速度を高めています</div></div><div class="message" id="message-1566320938.118200"><div class="message__timestamp">2019-08-21<br/>02:08:58 +0900</div><div class="message__header">k.marumaru524</div><div class="message__body">なるほど、それぞれ目的が異なるのですね<br/>なにも知らないですが、処理速度と詳しいエラーが出せないことがトレードオフになるのが少し不思議に感じます</div></div><div class="message" id="message-1566365661.118400"><div class="message__timestamp">2019-08-21<br/>14:34:21 +0900</div><div class="message__header">igrep</div><div class="message__body">ここでいう「詳しいエラーメッセージ」とはエラーが発生した位置を含んでいる、という意味です。</div></div><div class="message" id="message-1566394109.118700"><div class="message__timestamp">2019-08-21<br/>22:28:29 +0900</div><div class="message__header">takenobu.hs</div><div class="message__body">既知かも知れませんが参考までに、Megaparsecなどの情報です。<br/><br/>Bigmoonさんのところの記事（日本語）<br/><a href='https://haskell.e-bigmoon.com/posts/2019/07-14-megaparsec-tutorial.html'>https://haskell.e-bigmoon.com/posts/2019/07-14-megaparsec-tutorial.html</a><br/><br/>Switch from Parsec to Megaparsec（英語）<br/><a href='https://markkarpov.com/megaparsec/switch-from-parsec-to-megaparsec.html'>https://markkarpov.com/megaparsec/switch-from-parsec-to-megaparsec.html</a><br/><br/>Mizunashiさんの、いろいろなパーサまとめ記事もあり。<br/><a href='https://qiita.com/Mizunashi_Mana/items/115855bf2af9b9970198'>https://qiita.com/Mizunashi_Mana/items/115855bf2af9b9970198</a></div></div><div class="message" id="message-1566408649.119300"><div class="message__timestamp">2019-08-22<br/>02:30:49 +0900</div><div class="message__header">k.marumaru524</div><div class="message__body">うおお、ありがとうございます:man-bowing:</div></div><div class="message" id="message-1566409226.125900"><div class="message__timestamp">2019-08-22<br/>02:40:26 +0900</div><div class="message__header">k.marumaru524</div><div class="message__body">質問ばかりで恐縮ですが、こんどはコード生成に関する雑な質問です。<br/><br/>ASTまで得られた状態で、他の言語などへのコード生成の処理を書きたいと思っています。<br/>関数型言語が構文解析が得意なのは耳にしていましたが、コード生成も得意なのは初めて知りました。<br/><br/>以下のような記事を見つけ、読んでみました。<br/><a href='https://keigoi.hatenadiary.org/entry/20111206/haskell_tagless_dsl'>https://keigoi.hatenadiary.org/entry/20111206/haskell_tagless_dsl</a><br/><a href='http://nebuta.hatenablog.com/entry/2013/08/01/143926'>http://nebuta.hatenablog.com/entry/2013/08/01/143926</a><br/>一度読んだだけでは正直、わからないところもわからないという感じですが、<br/>とりあえず以下のような話題を理解するように感じました<br/><br/>- 型クラスの自作<br/>- モナドの自作<br/>- モナド変換子の概念の理解と、扱い方<br/><br/>この記事を参考にして一つずつわからないところを潰していくつもりではありますが、もしこの「コード生成」の部分に関して入門者向けの良い記事や書籍、ライブラリや実装例、検索のための語彙などをご存知でしたら教えていただけると嬉しいです。<br/><br/>ターゲットなる言語は特に問うてませんが、実装中なのはアセンブリを吐くコンパイラです。<br/>現状、コード生成部分はすごい手続き的な書き方になってしまっています..<br/><a href='https://github.com/mrsekut/hcc/blob/master/app/Main.hs'>https://github.com/mrsekut/hcc/blob/master/app/Main.hs</a><br/><br/>よろしくお願いします。</div></div><div class="message" id="message-1566425500.126500"><div class="message__timestamp">2019-08-22<br/>07:11:40 +0900</div><div class="message__header">kakkun61</div><div class="message__body">モナド変換子ならこちらがオススメです<br/><a href='http://bicycle1885.hatenablog.com/entry/2012/12/08/165236'>http://bicycle1885.hatenablog.com/entry/2012/12/08/165236</a></div></div><div class="message" id="message-1566425740.126800"><div class="message__timestamp">2019-08-22<br/>07:15:40 +0900</div><div class="message__header">kakkun61</div><div class="message__body">モナド変換子を勉強すると、モナド変換子の型別名や newtype ラッパーを作るだけで事足りるので、オリジナルのモナドを作ることはほぼないと思います</div></div><div class="message" id="message-1566435662.127000"><div class="message__timestamp">2019-08-22<br/>10:01:02 +0900</div><div class="message__header">lotz</div><div class="message__body">コード生成、とは少し違うかもしれませんが、いちにぃさんのPDFを読んで生成する話の記事は読みやすくて面白いです~<br/><https://itchyny.hatenablog.com/entry/2015/09/16/100000></div></div><div class="message" id="message-1566452346.127500"><div class="message__timestamp">2019-08-22<br/>14:39:06 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">ステップバイステップ何回も読んだなー笑</div></div><div class="message" id="message-1566488800.128200"><div class="message__timestamp">2019-08-23<br/>00:46:40 +0900</div><div class="message__header">k.marumaru524</div><div class="message__body">@kakkun61<br/>スッテプばいステップ読み進めています<br/>学びが深くてうずうずしています<br/>ありがとうございます!</div></div><div class="message" id="message-1566492615.128700"><div class="message__timestamp">2019-08-23<br/>01:50:15 +0900</div><div class="message__header">rio.nagae</div><div class="message__body">@rio.nagae has joined the channel</div></div><div class="message" id="message-1566497424.128900"><div class="message__timestamp">2019-08-23<br/>03:10:24 +0900</div><div class="message__header">k.marumaru524</div><div class="message__body">@lotz<br/><br/>まだちゃんと読んでいませんが、PDFを生成する記事もヤバそうです！(長い！そしてはてぶ数がすごい！)<br/>モナド変換子の記事をやり終えたら読んでみたいと思います<br/>ありがとうございます！</div></div><div class="message" id="message-1566531019.129600"><div class="message__timestamp">2019-08-23<br/>12:30:19 +0900</div><div class="message__header">kj1ktk</div><div class="message__body">@kj1ktk has joined the channel</div></div><div class="message" id="message-1566543030.133200"><div class="message__timestamp">2019-08-23<br/>15:50:30 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">MacOS Sierra で stack lts-12.26 (GHC 8.4.4)だと平気なんだけど、lts-14.2 (GHC 8.6.5) だとリンカで死ぬ :cry:<br/><pre>
Linking .stack-work/dist/x86_64-osx/Cabal-2.4.0.1/build/site/site ...
Undefined symbols for architecture x86_64:
  "_utimensat", referenced from:       
      _cazW_info in libHSdirectory-1.3.3.0.a(Posix.o)
ld: symbol(s) not found for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
`gcc' failed in phase `Linker'. (Exit code: 1)
Completed 166 action(s).               

--  While building package matsubara0507-ghpages-0.3.1.0 using:
      $HOME/.stack/setup-exe-cache/x86_64-osx/Cabal-simple_mPHDZzAJ_2.4.0.1_ghc-8.6.5 --builddir=.stack-work/dist/x86_64-osx/Cabal-2.4.0.1 build exe:site --ghc-options " -fdiagnostics-color=always"
    Process exited with code: ExitFailure 1
</pre><br/>utimensat 使えないのに、utimensat 使えるフラグが立っちゃうせいだと思うんだけど、うーん、なぜだろ<br/>いろんなパターンで試した結果、GHC 8.6.4 からダメっぽい（lts-13.11 は行けて lts-13.19 はダメだった、Cabal も関係なかった）</div></div><div class="message" id="message-1566543850.133300"><div class="message__timestamp">2019-08-23<br/>16:04:10 +0900</div><div class="message__header">wado</div><div class="message__body">Undefined symbols for architecture x86_64: “_utimensat”, referenced from: _cazW_info in libHSdirectory-1.3.3.0.a(Posix.o)<br/><https://stackoverflow.com/questions/56029761/undefined-symbols-for-architecture-x86-64-utimensat-referenced-from-cazw><br/><br/>似たようなの見つけました。</div></div><div class="message" id="message-1566544091.133600"><div class="message__timestamp">2019-08-23<br/>16:08:11 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">そうそう、それみた<br/>High Sierra 以上にすれば平気なんだろうけど</div></div><div class="message" id="message-1566623466.133900"><div class="message__timestamp">2019-08-24<br/>14:11:06 +0900</div><div class="message__header">knock.822</div><div class="message__body">@knock.822 has joined the channel</div></div><div class="message" id="message-1566665189.134200"><div class="message__timestamp">2019-08-25<br/>01:46:29 +0900</div><div class="message__header">realshinya1999</div><div class="message__body">@realshinya1999 has joined the channel</div></div><div class="message" id="message-1566731735.134500"><div class="message__timestamp">2019-08-25<br/>20:15:35 +0900</div><div class="message__header">yahiru1121</div><div class="message__body">@yahiru1121 has joined the channel</div></div><div class="message" id="message-1566884214.135000"><div class="message__timestamp">2019-08-27<br/>14:36:54 +0900</div><div class="message__header">sekikano721</div><div class="message__body">@sekikano721 has joined the channel</div></div><div class="message" id="message-1566915490.135300"><div class="message__timestamp">2019-08-27<br/>23:18:10 +0900</div><div class="message__header">nobuyuki.tomizawa</div><div class="message__body">@nobuyuki.tomizawa has joined the channel</div></div><div class="message" id="message-1566948379.135600"><div class="message__timestamp">2019-08-28<br/>08:26:19 +0900</div><div class="message__header">oza777you</div><div class="message__body">@oza777you has joined the channel</div></div></div><div class="pager"><a href="../../html/C5666B6BB/67.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a></div></body></html>