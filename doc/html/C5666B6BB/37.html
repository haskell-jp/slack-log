<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #37</title><link rel="stylesheet" href="/messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / questions #37</h1><div class="pager"><a href="/html/C5666B6BB/36.html" class="pager__previous">Previous</a><a href="/" class="pager__top">Top</a><a href="/html/C5666B6BB/38.html" class="pager__next">Next</a></div><div class="message_list"><div class="message" id="message-1548031254.167500"><div class="message__timestamp">2019-01-21<br/>09:40:54 +0900</div><div class="message__header">shunsuke.masuda</div><div class="message__body">こんにちは。HRRの導入を検討しておりまして、質問があります。<br/>HRR、動的に決まるテーブル名に対応していますか？<br/><br/>時系列データを日付ごとのテーブルに格納する要件がありまして、テーブル自体は実行時に作成されます。<br/>これらのテーブルですが、テーブル名に日付が含まれる以外、カラムや各種制約はすべて一致しています。<br/><br/>以上よろしくお願いします。</div></div><div class="message" id="message-1548031538.167800"><div class="message__timestamp">2019-01-21<br/>09:45:38 +0900</div><div class="message__header">na4zagin3</div><div class="message__body">同じく Haskell Relational Record に関する質問です。スキーマの取得時に、`defineTableFromDB` で 実際に（リモートの） DB に接続する代わりに、`mysqldump --no-data` で生成したスキーマのダンプのファイルを読み込む方法って無いのでしょうか？<br/>TH を使って、コンパイル中にローカルで mysql を起動してファイルを読み込ませた上で <code>defineTableFromDB</code> を呼ぶ方法もあると思うのですが、もっと簡潔な手段があれば教えてくださると嬉しく思います。</div></div><div class="message" id="message-1548033663.168100"><div class="message__timestamp">2019-01-21<br/>10:21:03 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">HRR 人気！</div></div><div class="message" id="message-1548033675.168400"><div class="message__timestamp">2019-01-21<br/>10:21:15 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">HRR 攻略 wiki （違う）</div></div><div class="message" id="message-1548040457.168900"><div class="message__timestamp">2019-01-21<br/>12:14:17 +0900</div><div class="message__header">shokohara</div><div class="message__body">typeとはそのtypeだったのですか。見落としていましたが、お陰様で助かりました。情報はありましたね :sob:<br/>（<@U4LGTMTMK> 別件ですがこれの修正に deriveJsonNoPrefix が活躍しました。とても快適でした、ありがとうございました :bow: ）</div></div><div class="message" id="message-1548043188.169500"><div class="message__timestamp">2019-01-21<br/>12:59:48 +0900</div><div class="message__header">igrep</div><div class="message__body">残念ながらなかったはずです。。。CREATE文のパースを避けるためにあのような方式にしていると伺ったことがあるので :disappointed:</div></div><div class="message" id="message-1548043914.169700"><div class="message__timestamp">2019-01-21<br/>13:11:54 +0900</div><div class="message__header">igrep</div><div class="message__body">ソース読んで頭の中で軽く型合わせをしただけなんで間違っているかもしれませんが、 <code>Database.Relational.Relation.table</code> 関数に <code>Database.Relational.Table.table</code> 関数にtable名と絡む名を渡して作った <code>Table</code> 型の値を渡すとできるはずです。<br/><br/>参考までにどこを調べたか共有しておくと、実際にその定義を生成している行が <a href='https://github.com/khibino/haskell-relational-record/blob/f2246bb4ac7272f27ed59e1caa36e5b00fe42f55/relational-query/src/Database/Relational/TH.hs#L220'>https://github.com/khibino/haskell-relational-record/blob/f2246bb4ac7272f27ed59e1caa36e5b00fe42f55/relational-query/src/Database/Relational/TH.hs#L220</a> にあります。<br/><code>defineTableDerivations</code> を呼んでいる関数を遡っていくと、チュートリアル <a href='http://khibino.github.io/haskell-relational-record/tutorial.html'>http://khibino.github.io/haskell-relational-record/tutorial.html</a> にも出てくる <code>defineTable</code> 関数にたどり着くのではないかと。</div></div><div class="message" id="message-1548044221.170000"><div class="message__timestamp">2019-01-21<br/>13:17:01 +0900</div><div class="message__header">igrep</div><div class="message__body">ただ、いずれにしても、日付名付きのテーブルを扱うという運用自体がSQLアンチパターン「メタデータトリブル」の匂いがするので可能ならば見直す検討はした方がいいかと思いますが。。。<br/>（ご認識の上でしたら済みません...）</div></div><div class="message" id="message-1548044763.170300"><div class="message__timestamp">2019-01-21<br/>13:26:03 +0900</div><div class="message__header">na4zagin3</div><div class="message__body">なるほど……。ありがとうございます！</div></div><div class="message" id="message-1548048506.176700"><div class="message__timestamp">2019-01-21<br/>14:28:26 +0900</div><div class="message__header">kakkun61</div><div class="message__body">これ ↓ 関連なんですが、base パッケージを Haddock ビルド（ドキュメント生成）したときって何かオプション指定しないと GHC が持ってる方の base パッケージに対してドキュメントが生成されるとかいうことありますかね？<br/><a href='https://haskell-jp.slack.com/archives/C4M4TT8JJ/p1547693188111300'>https://haskell-jp.slack.com/archives/C4M4TT8JJ/p1547693188111300</a><br/><br/>起こっていることとしては、<br/>• GHC のソース（base パッケージを含む）をダウンロードする<br/>• 該当ソースコードを書き換える<br/>• <i>libraries/base</i> に <i>stack.yaml</i> を配置する<br/>• <code>stack haddock</code> する<br/>• 生成されたドキュメント（と HTML になったソースコード）を見ても変更が反映されてない<br/><br/>で、GHC が持ってる方の base を見に行ってるのかなぁと根拠のない推測をしてみたしだい<br/><br/>GHC が持ってる方の base を書き換えてみてみればいいか<br/>どこにあるのだろう<br/>そもそも、ソースコードの状態で（オブジェクトファイルとかじゃなく）持ってるんだろうか？</div></div><div class="message" id="message-1548050627.177500"><div class="message__timestamp">2019-01-21<br/>15:03:47 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">Haskellとは関係ないかもしれないけど、電子書籍版のThinking with typesを購入された方っていますか？<br/>本当に購入したものがKindleで読めるのか知りたいです。（この規模の書籍をpdfで読むのは厳しいので）。<br/><a href='https://leanpub.com/thinking-with-types'>https://leanpub.com/thinking-with-types</a></div></div><div class="message" id="message-1548066656.177900"><div class="message__timestamp">2019-01-21<br/>19:30:56 +0900</div><div class="message__header">kakkun61</div><div class="message__body">なんか自分が勘違いしてるかもしれないんですが、PDF でも Kindle で読めるのでは？</div></div><div class="message" id="message-1548069971.178100"><div class="message__timestamp">2019-01-21<br/>20:26:11 +0900</div><div class="message__header">sugano</div><div class="message__body">おそらくEPUB版のことを言っているかと…<br/>見た感じEPUB版のサンプルがないんですね…</div></div><div class="message" id="message-1548071126.179200"><div class="message__timestamp">2019-01-21<br/>20:45:26 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">そう、Epub版のサンプルがないからちょっと不安なんです:sob:</div></div><div class="message" id="message-1548071405.180800"><div class="message__timestamp">2019-01-21<br/>20:50:05 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">ハードカバー版もあるけど、送料が70ドルもするんですよね。。なので電子書籍版にしようかと</div></div><div class="message" id="message-1548073182.181100"><div class="message__timestamp">2019-01-21<br/>21:19:42 +0900</div><div class="message__header">takenobu.hs</div><div class="message__body">stackでHaddockを生成する方法は把握できてないのですが、環境設定でトラブルようでしたら、GHCを丸ごとビルドしてしまうのが手っ取り早いです。（CPUによって、30分から1時間くらいでビルド完了するはずです:slightly_smiling_face:）<br/><br/>ドキュメント生成込みでGHCをビルドするには、このあたりを参考にしてもらえるかと思います。<br/><a href='https://qiita.com/takenobu-hs/items/c1309b93ca17b87e5955#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%82%E3%83%93%E3%83%AB%E3%83%89%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88'>https://qiita.com/takenobu-hs/items/c1309b93ca17b87e5955#%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%82%E3%83%93%E3%83%AB%E3%83%89%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88</a><br/><br/>あと、Dockerを使える環境の場合は、近い雛形のDockerfileを以下に置いています。<br/>（そのDockerfileでは、ドキュメント生成をしない設定なので、mk/build.mkをドキュメント生成するように修正必要です。）<br/><a href='https://github.com/takenobu-hs/ghc-build-docker'>https://github.com/takenobu-hs/ghc-build-docker</a></div></div><div class="message" id="message-1548073700.181700"><div class="message__timestamp">2019-01-21<br/>21:28:20 +0900</div><div class="message__header">kakkun61</div><div class="message__body">やってみます！</div></div><div class="message" id="message-1548074212.181900"><div class="message__timestamp">2019-01-21<br/>21:36:52 +0900</div><div class="message__header">kakkun61</div><div class="message__body">あ、なるほど<br/>自分の中では “PDF ⊂ 電子書籍” だったので変な感じがしてました</div></div><div class="message" id="message-1548136855.190500"><div class="message__timestamp">2019-01-22<br/>15:00:55 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">本当に初歩的な質問なのですが、MacBookのターミナルでghciをするときにファイル(例えば関数の定義する時など)を引用することはできるのでしょうか？ターミナルは一回一回消されるので、ファイルを引用する方法を知りたいです</div></div><div class="message" id="message-1548136953.190600"><div class="message__timestamp">2019-01-22<br/>15:02:33 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">こんな感じかな<br/><a href='http://www.kotha.net/ghcguide_ja/7.0.4/loading-source-files.html'>http://www.kotha.net/ghcguide_ja/7.0.4/loading-source-files.html</a><br/><pre>
ghci&gt; :load ModuleName
</pre></div></div><div class="message" id="message-1548138861.191400"><div class="message__timestamp">2019-01-22<br/>15:34:21 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">ファイルの保存先はどこでもよろしいですか？</div></div><div class="message" id="message-1548145044.191600"><div class="message__timestamp">2019-01-22<br/>17:17:24 +0900</div><div class="message__header">shunsuke.masuda</div><div class="message__body">ありがとうございます。試してみます！</div></div><div class="message" id="message-1548153098.192000"><div class="message__timestamp">2019-01-22<br/>19:31:38 +0900</div><div class="message__header">igrep</div><div class="message__body">ファイルを <code>:load</code> したい場合はそのままファイル名を指定すればできます。</div></div><div class="message" id="message-1548154908.192300"><div class="message__timestamp">2019-01-22<br/>20:01:48 +0900</div><div class="message__header">ncaq</div><div class="message__body">私はYesodで中規模webサービスを作っていますが,結局細かいところはReactとかを持ち出すことになるので,大規模になるとServantの方が良くて中規模までならYesodとかでサクサクっと書くのが良いのかなと思っています<br/><a href='https://www.ncaq.net/2017/12/03/00/00/00/'>https://www.ncaq.net/2017/12/03/00/00/00/</a></div></div><div class="message" id="message-1548160385.192900"><div class="message__timestamp">2019-01-22<br/>21:33:05 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">ありがとうございます:blush:</div></div><div class="message" id="message-1548163067.196500"><div class="message__timestamp">2019-01-22<br/>22:17:47 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">試しにこのような簡単な関数を作ってみたのですが、エラーが出ました。</div></div><div class="message" id="message-1548163077.196900"><div class="message__timestamp">2019-01-22<br/>22:17:57 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body"></div></div><div class="message" id="message-1548163520.197300"><div class="message__timestamp">2019-01-22<br/>22:25:20 +0900</div><div class="message__header">matsubara0507</div><div class="message__body"><pre>
doubleMe x = x + x
</pre><br/>が書いてあるファイルの名前はなんですか？</div></div><div class="message" id="message-1548164961.197800"><div class="message__timestamp">2019-01-22<br/>22:49:21 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">baby.hsをhaskellというファイルに入れてます</div></div><div class="message" id="message-1548169340.200400"><div class="message__timestamp">2019-01-23<br/>00:02:20 +0900</div><div class="message__header">sugano</div><div class="message__body">関数名ではなくモジュール名かファイル名だと思います、</div></div><div class="message" id="message-1548169364.201200"><div class="message__timestamp">2019-01-23<br/>00:02:44 +0900</div><div class="message__header">sugano</div><div class="message__body">load baby.hs でうまくいきませんか？</div></div><div class="message" id="message-1548172078.203000"><div class="message__timestamp">2019-01-23<br/>00:47:58 +0900</div><div class="message__header">yharuhi39</div><div class="message__body"><code>:cd /path/to/directory</code> で同じディレクトリーに要ることも確認してみては？</div></div><div class="message" id="message-1548196047.204000"><div class="message__timestamp">2019-01-23<br/>07:27:27 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">今外なので帰ったらやってみますね！ありがとうございます:blush:</div></div><div class="message" id="message-1548220064.205400"><div class="message__timestamp">2019-01-23<br/>14:07:44 +0900</div><div class="message__header">yethan.goes.asna</div><div class="message__body">0.1刻みのリストが欲しかったんですけど、何でこうなっちゃうかわかりますか？</div></div><div class="message" id="message-1548220463.205700"><div class="message__timestamp">2019-01-23<br/>14:14:23 +0900</div><div class="message__header">hiratara</div><div class="message__body">浮動小数点数の演算の誤差です。たいていの言語で同じ結果になると思います。<br/><pre>
&gt; 0.2 + 0.1 == 0.3
False
</pre><br/>後から 10 で割るといいですかね。<br/><pre>
&gt; map (/ 10) [1 .. 10]
[0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1.0]
</pre></div></div><div class="message" id="message-1548221332.206200"><div class="message__timestamp">2019-01-23<br/>14:28:52 +0900</div><div class="message__header">yethan.goes.asna</div><div class="message__body">なるほど！ありがとうございます！</div></div><div class="message" id="message-1548231787.206900"><div class="message__timestamp">2019-01-23<br/>17:23:07 +0900</div><div class="message__header">ncaq</div><div class="message__body">本当に誤差がないものがほしいならData.Ratioという有理数を使うと良いですよ<br/><pre>
Prelude Data.Ratio&gt; [0 :: Rational, 0.2 .. 1]
[0 % 1,1 % 5,2 % 5,3 % 5,4 % 5,1 % 1]
</pre></div></div><div class="message" id="message-1548236286.207500"><div class="message__timestamp">2019-01-23<br/>18:38:06 +0900</div><div class="message__header">yethan.goes.asna</div><div class="message__body">そんな便利なものが！あざす！</div></div><div class="message" id="message-1548238422.209500"><div class="message__timestamp">2019-01-23<br/>19:13:42 +0900</div><div class="message__header">yethan.goes.asna</div><div class="message__body">質問とかじゃないんですが、二分検索法で任意の桁数の平方根の近似を求めるコードを書いてみました。haskellを覚え始めたばかりでお作法をよくわかってないので、変なところがあればツッコミ入れてくれると嬉しいです。<br/><a href='https://gist.github.com/gaxiiiiiiiiiiii/00c6a9f7096e033a2ebbf007955ec96b'>https://gist.github.com/gaxiiiiiiiiiiii/00c6a9f7096e033a2ebbf007955ec96b</a></div></div><div class="message" id="message-1548241840.209600"><div class="message__timestamp">2019-01-23<br/>20:10:40 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">まず，Haskellコードとしての指摘なんですが:<br/>• 現状だと <code>[]</code> が <code>find</code> に渡されると，このコードは止まらなくなります． 渡されないことを想定しているものがある場合，次のように明示的に書いておくといいと思います．<br/><br/><pre>
find _ [] = error "empty list"
</pre><br/><br/>• 関数適用は基本的に <code>()</code> で囲まなくて大丈夫だと思っておけば良いです．例えば今回の場合，<br/><br/><pre>
(length xs) `div` 2 == length xs `div` 2
</pre><br/><br/>と書けます．</div></div><div class="message" id="message-1548243115.209900"><div class="message__timestamp">2019-01-23<br/>20:31:55 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">ところで，アルゴリズム的な指摘なんですが， Haskell では <code>[a]</code> は単連結リストになります．(実際には Haskell の構文に違反するので書けないですが，擬似的には次のようなデータ型になります<br/><br/><pre>
type [a] = [] a
data [] a = [] | a : [a]
</pre><br/>)<br/>なので， <code>splitAt</code> や <code>last</code> ， <code>length</code> は効率よくできるわけではなく， <code>[]</code> か <code>:</code> をパターンマッチでずっと紐解いていき所定の場所を見つけるみたいなことを行います．<br/>なので，今回の場合<br/><br/><pre>
find :: Ord a =&gt; a -&gt; [a] -&gt; a
find _ [] = error "empty list"
find n [x] = x
find n (x:xs)
  | x * x &gt;= n = x
  | otherwise  = find n xs
</pre><br/><br/>と書いた方が実は速いです．一般にリストに対して線形探索より効率の良い二分探索は書けず，データを作る際二分探索木にするなどデータ構造の方を工夫する必要があります．</div></div><div class="message" id="message-1548245364.210800"><div class="message__timestamp">2019-01-23<br/>21:09:24 +0900</div><div class="message__header">igrep</div><div class="message__body">あと根本的な問題として、任意の桁数を求める場合に <code>Float</code> を出力にしてしまうと結局桁あふれするのでは。。。 :cold_sweat:<br/><a href='https://haskell-jp.slack.com/archives/C5666B6BB/p1548231787206900?thread_ts=1548220064.205400&amp;cid=C5666B6BB'>https://haskell-jp.slack.com/archives/C5666B6BB/p1548231787206900?thread_ts=1548220064.205400&amp;cid=C5666B6BB</a> で紹介している <code>Rational</code> にするのを推奨します。</div></div><div class="message" id="message-1548245567.211800"><div class="message__timestamp">2019-01-23<br/>21:12:47 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">こうなりました。この場合はどうなんでしょうか？</div></div><div class="message" id="message-1548245585.212700"><div class="message__timestamp">2019-01-23<br/>21:13:05 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">で、not scopeと出たので、hsを無くしてやってみても、結果は変わりませんでした。</div></div><div class="message" id="message-1548245632.213400"><div class="message__timestamp">2019-01-23<br/>21:13:52 +0900</div><div class="message__header">igrep</div><div class="message__body"><code>load</code> じゃなくて <code>:load</code> ですね。。。GHCiの特別なコマンドは必ずコロン <code>:</code> で始まる点に注意してください。。。</div></div><div class="message" id="message-1548249032.213800"><div class="message__timestamp">2019-01-23<br/>22:10:32 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">ついにこうなりました笑笑</div></div><div class="message" id="message-1548252575.215700"><div class="message__timestamp">2019-01-23<br/>23:09:35 +0900</div><div class="message__header">yethan.goes.asna</div><div class="message__body">お二方、ありがとうございます！今飲み会空けで頭が回らないんですが、明日以降咀嚼します！</div></div><div class="message" id="message-1548252597.216500"><div class="message__timestamp">2019-01-23<br/>23:09:57 +0900</div><div class="message__header">yethan.goes.asna</div><div class="message__body">漠然と投げたのにリアクションがあって、凄く嬉しいです！！</div></div><div class="message" id="message-1548285844.221100"><div class="message__timestamp">2019-01-24<br/>08:24:04 +0900</div><div class="message__header">sugano</div><div class="message__body">can’t findになってますね、、、</div></div><div class="message" id="message-1548286074.223600"><div class="message__timestamp">2019-01-24<br/>08:27:54 +0900</div><div class="message__header">igrep</div><div class="message__body">この :point_down: 指摘のとおりではないかと。<br/><a href='https://haskell-jp.slack.com/archives/C5666B6BB/p1548172078203000?thread_ts=1548136855.190500&amp;cid=C5666B6BB'>https://haskell-jp.slack.com/archives/C5666B6BB/p1548172078203000?thread_ts=1548136855.190500&amp;cid=C5666B6BB</a><br/><br/><pre>
import System.Directory
putStrLn =&lt;&lt; getCurrentDirectory
</pre><br/><br/>とGHCiに入力すれば、今いるディレクトリーのパスがどこかわかります。<br/>（追記: パスに日本語が混ざっている場合を想定して、 :point_up: のコマンドを微修正しました。）<br/>表示されたパスと、baby.hsがあるディレクトリーのパスが合っているか確かめてください。<br/><br/>もしかして、こうしたターミナルの操作をあまりやったことがない？</div></div></div><div class="pager"><a href="/html/C5666B6BB/36.html" class="pager__previous">Previous</a><a href="/" class="pager__top">Top</a><a href="/html/C5666B6BB/38.html" class="pager__next">Next</a></div></body></html>