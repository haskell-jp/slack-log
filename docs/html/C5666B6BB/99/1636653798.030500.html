<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>haskell-jp / questions #99 at 2021-11-12 03:03:18 +0900</title>
<link rel="stylesheet" href="../../../main.css" type="text/css" media="screen">
</head>
<body>
  <div class="ui container">
    <h1>haskell-jp / questions #99 at 2021-11-12 03:03:18 +0900</h1>
    <div class="ui pagination menu">
      <a href="../99.html" class="item">Back to questions #99</a>
    </div>
    <div class="ui feed">
      <div class="event" id="message-1636653798.030500">
        <div class="content">
          <div class="summary">
            <div class="user">benzene.chlorobenzene</div>
            <div class="date"><a class="date" href="#message-1636653798.030500">2021-11-12 03:03:18 +0900</a></div>
          </div>
          <div class="description">stackのLTS18.16で、muslを静的リンクしたaesonに依存するバイナリを作ろうとして躓いています。<br/>再現手順：<br/>1. <a href='https://qiita.com/lambda_funtaro/items/5ac47f83616f8c07d4db'>https://qiita.com/lambda_funtaro/items/5ac47f83616f8c07d4db</a> の通りに設定する（stack.yaml中のdockerのrepoはutdemir/ghc-musl:v22-ghc8107にする）<br/>2. package.yamlのdependenciesにaesonを加える<br/>3. <code>stack build --docker</code>する<br/>4. ビルドに失敗する↓<br/><pre>Error: While constructing the build
plan, the following exceptions were
encountered:

In the dependencies
for hashable-1.3.0.0:
    integer-gmp must
                match &gt;=0.4 &amp;&amp; &lt;1.1, but
                the stack configuration
                has no specified
                version  (latest
                matching version
                is 1.0.3.0)
needed due to test-0.1.0.0
               -&gt; hashable-1.3.0.0

In the dependencies
for integer-logarithms-1.0.3.1:
    integer-gmp must match &lt;1.1, but the
                stack configuration has
                no specified version
                (latest matching version
                is 1.0.3.0)
needed due to test-0.1.0.0
               -&gt; integer-logarithms-1.0.3.1

In the dependencies
for scientific-0.3.7.0:
    integer-gmp needed, but the stack
                configuration has no
                specified version
                (latest matching version
                is 1.0.3.0)
needed due to test-0.1.0.0
               -&gt; scientific-0.3.7.0

Some different approaches to resolving
this:

  * Recommended action: try adding the
    following to your extra-deps
    in (略)/stack.yaml:

- integer-gmp-1.0.3.0@sha256:514e81647473ce380cf1814821664c0dcedc2801ad8dbf41b19a10f916e1cc75,2138

Plan construction failed.</pre></div>
        </div>
      </div>
      <div class="event" id="message-1636666798.031000">
        <div class="content">
          <div class="summary">
            <div class="user">igrep</div>
            <div class="date"><a class="date" href="#message-1636666798.031000">2021-11-12 06:39:58 +0900</a></div>
          </div>
          <div class="description">エラーメッセージ最後の指示どおり、 <code>stack.yaml</code> の <code>extra-deps</code> に<br/><pre>- integer-gmp-1.0.3.0@sha256:514e81647473ce380cf1814821664c0dcedc2801ad8dbf41b19a10f916e1cc75,2138</pre><br/>を追記してもダメでしたか？</div>
        </div>
      </div>
      <div class="event" id="message-1636670776.031200">
        <div class="content">
          <div class="summary">
            <div class="user">benzene.chlorobenzene</div>
            <div class="date"><a class="date" href="#message-1636670776.031200">2021-11-12 07:46:16 +0900</a></div>
          </div>
          <div class="description">追記しても死ぬことを書きそびれてました、エラーメッセージの指示通りextra-depsに追記して再度 <code>stack build --docker</code> したところ、<br/><pre>integer-gmp         &gt; setup: can't find include file ghc-gmp.h
integer-gmp         &gt; 
Progress 1/12
'cabal copy' failed.  Error message:

--  While building package integer-gmp-1.0.3.0 (scroll up to its section to see the error) using:
      /tmp/stack-6497fa01978e9e34/integer-gmp-1.0.3.0/.stack-work/dist/x86_64-linux-dk85569e7f830e7dc606115fd702e078fb/Cabal-3.2.1.0/setup/setup --builddir=.stack-work/dist/x86_64-linux-dk85569e7f830e7dc606115fd702e078fb/Cabal-3.2.1.0 copy
    Process exited with code: ExitFailure 1

Possible causes of this issue:
* No module named "Main". The 'main-is' source file should usually have a header indicating that it's a 'Main' module.
* A cabal file that refers to nonexistent other files (e.g. a license-file that doesn't exist). Running 'cabal check' may point out these issues.
* The Setup.hs file is changing the installation target dir.</pre><br/>のようなエラーを吐いてビルドに失敗しました</div>
        </div>
      </div>
      <div class="event" id="message-1636670847.031400">
        <div class="content">
          <div class="summary">
            <div class="user">benzene.chlorobenzene</div>
            <div class="date"><a class="date" href="#message-1636670847.031400">2021-11-12 07:47:27 +0900</a></div>
          </div>
          <div class="description">これ、静的リンクオプション外して--dockerなしで <code>stack build</code> するとextra-deps無しで通るんですよね</div>
        </div>
      </div>
    </div>
    <div class="ui pagination menu">
      <a href="../99.html" class="item">Back to questions #99</a>
    </div>
  </div>
</body>
</html>
