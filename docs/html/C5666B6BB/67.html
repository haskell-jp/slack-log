<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #67</title><link rel="stylesheet" href="../../messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / questions #67</h1><div class="pager"><a href="../../html/C5666B6BB/66.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a></div><div class="message_list"><div class="message" id="message-1564557369.063600"><div class="message__timestamp">2019-07-31<br/>16:16:09 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">一応補足ですが，現在の GHC では full laziness が入るタイミングが調整されていて，<br/><pre>
factMemo :: Int -&gt; Integer
factMemo = (map fact' [0..] !!)
  where
    fact' 0 = 1
    fact' n = fromIntegral n * factMemo (n - 1)

fact :: Int -&gt; Integer
fact x = map fact' [0..] !! x
  where
    fact' 0 = 1
    fact' n = fromIntegral n * fact (n - 1)
</pre><br/>はどちらも <code>fact'</code> は外に出されます．このため， <code>map fact' [0..]</code> も CAF として扱われます． GHCi のバイトコード出すパスでは， core 2 core のパスが少し簡略化されてるので， full laziness が真面目に入ってないだけだと思いますね．<br/><br/>なので，スーパーコンビネータかどうかは指標の一つではありますが，実際にはどう最適化が入るかによって CAF になるかはかなり左右されます</div></div><div class="message" id="message-1564577136.064100"><div class="message__timestamp">2019-07-31<br/>21:45:36 +0900</div><div class="message__header">ULXKBEPR6</div><div class="message__body">@ULXKBEPR6 has joined the channel</div></div><div class="message" id="message-1564580251.064400"><div class="message__timestamp">2019-07-31<br/>22:37:31 +0900</div><div class="message__header">ULZRSHT1C</div><div class="message__body">@ULZRSHT1C has joined the channel</div></div><div class="message" id="message-1564587041.064600"><div class="message__timestamp">2019-08-01<br/>00:30:41 +0900</div><div class="message__header">y_taka_23</div><div class="message__body">Liquid Haskell について言えば、`{-@ @-}` は GHC にとっては単なるコメントなのでもっと早い段階で消えそう……な気がしますが根拠はないです。</div></div><div class="message" id="message-1564590486.066800"><div class="message__timestamp">2019-08-01<br/>01:28:06 +0900</div><div class="message__header">yharuhi39</div><div class="message__body">確かに あれはただのコメントでプラグまですらなかったですね:persevere: 雰囲気的に(?) 型が削除される以前に消されてそうですね…</div></div></div><div class="pager"><a href="../../html/C5666B6BB/66.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a></div></body></html>