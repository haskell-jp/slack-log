<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #72</title><link rel="stylesheet" href="../../messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / questions #72</h1><div class="pager"><a href="../../html/C5666B6BB/71.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a></div><div class="message_list"><div class="message" id="message-1569686578.026200"><div class="message__timestamp">2019-09-29<br/>01:02:58 +0900</div><div class="message__header">shunkichi.sato</div><div class="message__body">添付の例で期待した結果が得られません<br/>ターミナルで実行すると <code>["</code> とだけ表示され、あとは <code>Ctrl+C</code> するしかない状態になります<br/>最終行の <code>(c:r)</code> の部分が犯人らしいことは分かっているのですが<br/>どういうわけなのでしょうか</div></div><div class="message" id="message-1569689522.026800"><div class="message__timestamp">2019-09-29<br/>01:52:02 +0900</div><div class="message__header">minorinoki_haskjp</div><div class="message__body">最終行<br/><pre>
    (l,(c:r)) = break (== c) str
</pre><br/>の左辺の <code>c</code> は <code>split</code> の引数の <code>c</code> ではなく、新たに束縛される変数の名前となります。そして、その新たに束縛された <code>c </code> が <code>break (== c)</code> で参照されます。つまり、その行は<br/><pre>
    (l,(d:r)) = break (== d) str
</pre><br/>と書いたのと同じ意味になります。<br/>直し方ですが、この場合は <code>break</code> の結果の2番目の最初の文字は必要ないので、単にワイルドカードで受けて<br/><pre>
    (l,(_:r)) = break (== c) str
</pre><br/>と書けば良いでしょう。</div></div><div class="message" id="message-1569720556.027300"><div class="message__timestamp">2019-09-29<br/>10:29:16 +0900</div><div class="message__header">yuuuuusuke0210</div><div class="message__body">@yuuuuusuke0210 has joined the channel</div></div><div class="message" id="message-1569728119.028300"><div class="message__timestamp">2019-09-29<br/>12:35:19 +0900</div><div class="message__header">nakamurajun69</div><div class="message__body">@nakamurajun69 has joined the channel</div></div><div class="message" id="message-1569780114.028700"><div class="message__timestamp">2019-09-30<br/>03:01:54 +0900</div><div class="message__header">shunkichi.sato</div><div class="message__body">ここで訊くのが妥当か分からないのですが...<br/><code>Text.Regex.Posix</code> を用いた正規表現についてです<br/>以下の最終行で値が返らないのは何故でしょうか？<br/><pre>
&gt; import Text.Regex.Posix
&gt; "2019/09/30" =~ "([0-9]{4})/([0-9]{1,2})/([0-9]{1,2})" :: Bool
True
&gt; "2019/09/30" =~ "([0-9]{4})/([0-9]{1,2})/([0-9]{1,2})" :: String
"2019/09/30"
&gt; "2019/09/30" =~ "([0-9]{4})?/([0-9]{1,2})/([0-9]{1,2})" :: Bool  
True
&gt; "2019/09/30" =~ "([0-9]{4})?/([0-9]{1,2})/([0-9]{1,2})" :: String
"2019/09/30"
&gt; "2019/09/30" =~ "([0-9]{4})?/?([0-9]{1,2})/([0-9]{1,2})" :: Bool
True
&gt; "2019/09/30" =~ "([0-9]{4})?/?([0-9]{1,2})/([0-9]{1,2})" :: String
"
</pre><br/>なお、西暦や月を省略した日付にも対応するパターンを作りたいというところです</div></div><div class="message" id="message-1569802374.029200"><div class="message__timestamp">2019-09-30<br/>09:12:54 +0900</div><div class="message__header">igrep</div><div class="message__body">取り急ぎ。Text.Regex.Posixの正規表現エンジンがどうなってるかわからないので推測ですが、正規表現の組み合わせ爆発が起きているのではないかと思います。<br/>でも無限ループに入ってしまっているとしたらバグっぽいなぁ。</div></div><div class="message" id="message-1569830097.029600"><div class="message__timestamp">2019-09-30<br/>16:54:57 +0900</div><div class="message__header">blackenedgold</div><div class="message__body">手元で試したところ、結果は返りました。どのバージョンをお使いですか？<br/><br/><br/><pre>
&gt; "2019/09/30" =~ "([0-9]{4})?/?([0-9]{1,2})/([0-9]{1,2})" :: String
"2019/09/30"
</pre></div></div><div class="message" id="message-1569830145.029800"><div class="message__timestamp">2019-09-30<br/>16:55:45 +0900</div><div class="message__header">blackenedgold</div><div class="message__body">因みにここでいう結果が返らないは空文字列が返されるという意味ですよね？</div></div><div class="message" id="message-1569830229.030100"><div class="message__timestamp">2019-09-30<br/>16:57:09 +0900</div><div class="message__header">igrep</div><div class="message__body">私が手元で試したときは、無限ループにハマってしまってました。<br/>上げていただいた出力例が <code>"</code> だけで終わっていることからして、satunさんの手元でもそうなっていると思われます。</div></div><div class="message" id="message-1569830382.030300"><div class="message__timestamp">2019-09-30<br/>16:59:42 +0900</div><div class="message__header">igrep</div><div class="message__body">肝心のパッケージのバージョンですが、私の手元では :point_down: でした。<br/>    regex-base-0.93.2<br/>    regex-posix-0.95.2</div></div><div class="message" id="message-1569830921.030500"><div class="message__timestamp">2019-09-30<br/>17:08:41 +0900</div><div class="message__header">blackenedgold</div><div class="message__body">同じく regex-base-0.93.2, regex-posix-0.95.2 です :thinking_face:</div></div><div class="message" id="message-1569926655.031900"><div class="message__timestamp">2019-10-01<br/>19:44:15 +0900</div><div class="message__header">shunkichi.sato</div><div class="message__body">バージョン同じくです<br/>値が返らないの意味は、igrepさんの仰る通りです</div></div><div class="message" id="message-1569972013.032100"><div class="message__timestamp">2019-10-02<br/>08:20:13 +0900</div><div class="message__header">igrep</div><div class="message__body">あとはOSと、GHCのバージョンでしょうかね... :thinking_face:<br/>私はWindows 10で、GHC は8.6.5です。</div></div><div class="message" id="message-1570009380.032900"><div class="message__timestamp">2019-10-02<br/>18:43:00 +0900</div><div class="message__header">mail048</div><div class="message__body">@mail048 has joined the channel</div></div><div class="message" id="message-1570089332.033200"><div class="message__timestamp">2019-10-03<br/>16:55:32 +0900</div><div class="message__header">shingo_okawa</div><div class="message__body">@shingo_okawa has joined the channel</div></div><div class="message" id="message-1570423669.034000"><div class="message__timestamp">2019-10-07<br/>13:47:49 +0900</div><div class="message__header">kakkun61</div><div class="message__body"><code>stack build --ghc-options '-ddump-splices'</code> ってどのディレクトリーに出力されるんでしたっけ？</div></div><div class="message" id="message-1570424335.034100"><div class="message__timestamp">2019-10-07<br/>13:58:55 +0900</div><div class="message__header">igrep</div><div class="message__body"><code>.stack-work</code> を掘れ、とだけありますね...<br/>あと、 <a href='https://github.com/commercialhaskell/stack/pull/4242'>https://github.com/commercialhaskell/stack/pull/4242</a> のおかげで <code>--ddump-dir</code> というオプションが <code>stack build</code> にできてるはず！</div></div><div class="message" id="message-1570431900.034500"><div class="message__timestamp">2019-10-07<br/>16:05:00 +0900</div><div class="message__header">kakkun61</div><div class="message__body">そうそう、その PR 見ておっと思ったけど手元の stack 1.9.3 にはまだなかった<br/>（依存ライブラリーが stack 2 でビルドできなくてって 1.9 使ってる</div></div><div class="message" id="message-1570433560.034800"><div class="message__timestamp">2019-10-07<br/>16:32:40 +0900</div><div class="message__header">igrep</div><div class="message__body">とりあえず ~/.stack-work を掘るのじゃ（今手元ではHaskellのプロジェクト触ってないので面倒くさい）。そんなに難しいところではなかったはず</div></div><div class="message" id="message-1570447456.035100"><div class="message__timestamp">2019-10-07<br/>20:24:16 +0900</div><div class="message__header">uemkam04</div><div class="message__body">@uemkam04 has joined the channel</div></div><div class="message" id="message-1570545309.037100"><div class="message__timestamp">2019-10-08<br/>23:35:09 +0900</div><div class="message__header">shokohara</div><div class="message__body">こんばんは<br/>OSX 10.14.6でGHC7.10.3用にinteroをビルドしようとしてるんですが、`Guess: You might need the "tinfo" package, e.g. libtinfo-dev.` と言われてinteroを入れられません。どうしたらいいでしょうか？<br/><a href='https://twitter.com/shokohara_/status/1179957099675054080?s=20'>https://twitter.com/shokohara_/status/1179957099675054080?s=20</a><br/><a href='https://twitter.com/shokohara_/status/1179968733105672193?s=20'>https://twitter.com/shokohara_/status/1179968733105672193?s=20</a></div></div><div class="message" id="message-1570547313.045600"><div class="message__timestamp">2019-10-09<br/>00:08:33 +0900</div><div class="message__header">minorinoki_haskjp</div><div class="message__body">問題の解決ではないのでアレですが、私はAtCoder用コードの動作確認は最新のGHC (8.6.5)でやってます。GHC 8.0以降で追加された言語拡張を使わないこと、モノイド周りの関数を使うときはData.Monoidをimportすることに気をつければだいたい大丈夫です。うっかりでCEをやらかしてもペナルティーはつきませんし、提出してCEが出たら直す、というやり方で大抵は問題ないと思います。（直前の提出のCEに気づかず解けない問題にチャレンジして数十分経過、なんてことになると悲惨ですけども）</div></div><div class="message" id="message-1570547639.048600"><div class="message__timestamp">2019-10-09<br/>00:13:59 +0900</div><div class="message__header">minorinoki_haskjp</div><div class="message__body">libtinfoはLinuxっぽい響きですし、その「Guess:」は的外れなguessだと思います。interoのソース <a href='https://github.com/chrisdone/intero/blob/bab8e85b1aea9b03dfe05048bcdc0395e05e9b20/elisp/intero.el#L2252'>https://github.com/chrisdone/intero/blob/bab8e85b1aea9b03dfe05048bcdc0395e05e9b20/elisp/intero.el#L2252</a> を見た感じ、インストールに失敗すると無条件に「Guess: tinfoがどうのこうの」というメッセージを出すようですし。</div></div><div class="message" id="message-1570548267.048900"><div class="message__timestamp">2019-10-09<br/>00:24:27 +0900</div><div class="message__header">notogawa</div><div class="message__body">そのGuess云々のちょい上あたりで新しいhaskelineとかを入れようとして，古いghc-7.10.3とbaseバージョンが合わないためinteroのビルドは失敗します．ghc-7.10.3時代のlts-6.29あたりに合わせて，そこを<br/><pre>
           "haskeline-0.7.2.1"
           "ghc-paths-0.1.0.9" "mtl-2.2.1" "network-2.6.3.1" "random-1.1" "syb-0.6"))
</pre><br/>とかに変更すると，interoのビルドが成功するようになります．この際 <code>intero.el</code> の隣りに <code>intero.elc</code> がある場合，これを消しておかないと上記変更しても読み込む設定が何も変わらないので注意してください．<br/>ただし，この変更すると逆に今度は新しいresolverに対してinteroがビルドできなくなるかもしれない？ので，何か適切に工夫するなり諦めるなりしてください．<br/>本来 <code>intero.el</code> は，このあたりのバージョンをハードコードしてしまうのではなく．要求されたresolverから対応するltsに含まれる各パッケージバージョンを採用するようにすべきかもしれません．</div></div></div><div class="pager"><a href="../../html/C5666B6BB/71.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a></div></body></html>