<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>haskell-jp / atcoder-lang-updates #8</title>
<link rel="stylesheet" href="../../main.css" type="text/css" media="screen">
</head>
<body>
  <div class="ui container">
    <h1>haskell-jp / atcoder-lang-updates #8</h1>
    <div class="ui pagination menu">
      <a href="../../html/CL3AXB1AL/7.html" class="item">Previous</a>
      <a href="../../" class="item">Top</a>
    </div>
    <div class="ui feed">
      <div class="event" id="message-1680965304.727929">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1680965304.727929">2023-04-08 23:48:24 +0900</a></div>
          </div>
          <div class="description">すみません， <code>containers</code> を最新版に更新すると installed <code>ghc-heap-9.4.4</code> とconflict して Hackage上から落としてくるのですが，Hackage上には <code>ghc-heap-9.4.1</code> や <code>ghc-heap-9.6.1</code> など <code>x.y.1</code> しかないため <code>containers</code> をアップデートしながら <code>ghc-heap-9.4.4</code>  をインストールすることは不可能とわかりました．「使えない」状態でインストールされるかどうか，も上手に検証できないため， <code>ghc-heap</code> は排除します．</div>
        </div>
      </div>
      <div class="event" id="message-1680966973.022129">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1680966973.022129">2023-04-09 00:16:13 +0900</a></div>
          </div>
          <div class="description">license report は 取り敢えず <code>cabal v2-freeze</code> だけやった Mac 上の環境で <code>cabal-plan license-report</code> を走らせて書いてきました．</div>
        </div>
      </div>
      <div class="event" id="message-1681042850.137679">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1681042850.137679">2023-04-09 21:20:50 +0900</a></div>
          </div>
          <div class="description">なんとかfreeze 前に手元環境で Exposed modules の imports を全部チェックできました！　生成したチェック用のソースは: <a href='https://gist.github.com/gksato/0993d739f2ac6e81100f41815a27a978#file-3-imports-hs'>https://gist.github.com/gksato/0993d739f2ac6e81100f41815a27a978#file-3-imports-hs</a></div>
        </div>
      </div>
      <div class="event" id="message-1682392268.747599">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1682392268.747599">2023-04-25 12:11:08 +0900</a></div>
          </div>
          <div class="description">コードテストばっかり投げてて実際の提出をサボっていて，数日前にやっと<br/><a href='https://atcoder.jp/contests/language-test-202301/submissions/40808418'>https://atcoder.jp/contests/language-test-202301/submissions/40808418</a><br/>を投げたのですが，そしたら<br/><br/><b>コンパイルエラー</b><br/><pre>Warning: The package list for '<http://hackage.haskell.org|hackage.haskell.org>' is 16 days old.
Run 'cabal update' to get the latest list of available packages.
Warning: The package list for '<http://hackage.haskell.org|hackage.haskell.org>' is 16 days old.
Run 'cabal update' to get the latest list of available packages.
Warning: The directory
/home/runner/.cabal/store/ghc-9.4.4/incoming/new-2/home/runner/.cabal/store/ghc-9.4.4/submission-0.1.0.0-e-main-65f18b2df59be1b1a37cc9cf6a1a6fef2ceea8c33303cd81c9373b649724db38/bin
is not in the system search path.</pre><br/>という警告が出てしまいました．<br/><br/>その上，最後の， <code>Warning: The directory</code> 云々の警告は未だ原因調査できておらず，どうやったら除去できるかもよくわかりません（あとで <a href='#C5666B6BB'>questions</a> にも投げようかと思います）．<br/><br/>しかし，今回こちらで問題にしたいのは <code>Warning: The package list for</code> 云々の方です．これは見慣れた警告で，なんとかなりそうです．言語/ライブラリ追加は終了しているものの，コマンド変更は未だ受け付けられていますので，コンパイル・インストールコマンドを修正して解決してしまって良さそうです．この警告が出される条件を <code>cabal-install</code> のコードを追って確かめれば，ad-hoc には，コンパイルコマンド<br/><br/><pre>$ source ~/.ghcup/env &amp;&amp; cd /judge/submission &amp;&amp; cabal v2-install --installdir=.. --install-method=copy --offline</pre><br/>を実行する直前に，package repository cacheのtarのmodification dateを更新しておけばいいとわかります：<br/><br/><pre>$ touch ~/.cabal/packages/hackage.haskell.org/01-index.tar</pre><br/>しかし，この方法はあまりに ad-hoc で implementation-dependent なので，この方法を実行していいかわからず，相談がしたかったのでこちらに書き込ませていただきました．<br/><br/>なお，このような方法に頼らなくても，  <code>cabal --ignore-expiry v2-install</code> でコンパイルするか， <code>cabal.project</code> に <code>ignore-expiry: True</code> を足すかすれば良いかと思ったのですが， <code>ignore-expiry</code> は  <code>cabal v2-update</code> の時に Hackage の署名の期限を検証しないことを表すもので，この問題には無関係のようですね（勘違いして cabal の github に issue を投げてしまったので，恥ずかしい思いをしました）．</div>
        </div>
      </div>
      <div class="event" id="message-1682392531.153299">
        <div class="content">
          <div class="summary">
            <div class="user">igrep</div>
            <div class="date"><a class="date" href="#message-1682392531.153299">2023-04-25 12:15:31 +0900</a></div>
          </div>
          <div class="description">よくわからないんですけど、 <code>Warning: The package list for '<http://hackage.haskell.org|hackage.haskell.org>' is 16 days old.</code> については cabal update をどこかで実行すればよいように見えるんですが、ダメなんですかね？<br/>あと、<br/><pre>Warning: The directory
/home/runner/.cabal/store/ghc-9.4.4/incoming/new-2/home/runner/.cabal/store/ghc-9.4.4/submission-0.1.0.0-e-main-65f18b2df59be1b1a37cc9cf6a1a6fef2ceea8c33303cd81c9373b649724db38/bin
is not in the system search path.</pre><br/>こちらは件のパスが <code>PATH</code> に入っていない、というものなので、可能なら無視したほうがいいと思います。</div>
        </div>
      </div>
      <div class="event" id="message-1682393224.286059">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1682393224.286059">2023-04-25 12:27:04 +0900</a></div>
          </div>
          <div class="description"><code>cabal v2-update</code> はコンパイル時に実行しようとするとインターネット接続を仮定してしまうので，だめです．後半は無視した方が良いのはわかっているのですが，そのパス的にどうにもバグくさいのでどうしたら良いかがよくわからないという状況です．</div>
        </div>
      </div>
      <div class="event" id="message-1682470671.109409">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1682470671.109409">2023-04-26 09:57:51 +0900</a></div>
          </div>
          <div class="description">ありそうなのは， <code>cabal v2-build</code> が これらのWarning を出さないように見えるので，<br/><br/><pre>cabal v2-build &amp;&amp; cabal v2-install --verbose=0 --installdir=.. --install-method=copy --offline</pre><br/>でやっちゃう，というのは手としてあるかもしれません．</div>
          <a class="link-to-replies" href="8/1682470671.109409.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1682470953.091509">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1682470953.091509">2023-04-26 10:02:33 +0900</a></div>
          </div>
          <div class="description">ただ，手元環境とサーバ環境で表示される警告が違うので，あんまり確信を持って修正できないのが正直なところなんですよね…．</div>
        </div>
      </div>
      <div class="event" id="message-1682473545.001119">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1682473545.001119">2023-04-26 10:45:45 +0900</a></div>
          </div>
          <div class="description">あるいは，さっきのコマンドだと２回コンパイルしてしまうみたいなので，<br/><br/><pre>cabal v2-build &amp;&amp; cabal v2-exec -- bash -c 'cp $(which main) ../main'</pre><br/>でもいいかもしれないですね．</div>
        </div>
      </div>
      <div class="event" id="message-1682510145.007589">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1682510145.007589">2023-04-26 20:55:45 +0900</a></div>
          </div>
          <div class="description">意見募集: とくに反対がなければ，コンパイルコマンドを<br/><br/><pre>cd /judge/submission
source ~/.ghcup/env
cabal v2-build --offline &amp;&amp; cabal v2-exec -- bash -c 'cp $(which main) ../'</pre><br/>に変更しようと思いますが，どうでしょう？</div>
          <a class="link-to-replies" href="8/1682510145.007589.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1682513764.246829">
        <div class="content">
          <div class="summary">
            <div class="user">cojna</div>
            <div class="date"><a class="date" href="#message-1682513764.246829">2023-04-26 21:56:04 +0900</a></div>
          </div>
          <div class="description"><code>cabal v2-install --verbose=0</code> ではだめでしたか？</div>
          <a class="link-to-replies" href="8/1682513764.246829.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1682595802.688999">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1682595802.688999">2023-04-27 20:43:22 +0900</a></div>
          </div>
          <div class="description">なるほど．ご指摘を受けて修正するなら，<br/><br/><pre>cd /judge/submission
source ~/.ghcup/env
cabal v2-build --offline &amp;&amp; cp $(cabal list-bin main) ../</pre><br/>でしょうか．</div>
        </div>
      </div>
      <div class="event" id="message-1682600348.733489">
        <div class="content">
          <div class="summary">
            <div class="user">cojna</div>
            <div class="date"><a class="date" href="#message-1682600348.733489">2023-04-27 21:59:08 +0900</a></div>
          </div>
          <div class="description">cabal v2-installの挙動はちょっと調べてもよくわからないところがあるので，v2-installは使わずv2-buildしてバイナリ抜き出す方針が良さそうですね</div>
        </div>
      </div>
      <div class="event" id="message-1682600591.717579">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1682600591.717579">2023-04-27 22:03:11 +0900</a></div>
          </div>
          <div class="description">では，改善もされたことですし，明日まで待って特に反対がなければ<br/><br/><pre>cd /judge/submission
source ~/.ghcup/env
cabal v2-build --offline &amp;&amp; cp $(cabal list-bin main) ../</pre><br/>に提案シートを書き換えた上で feedback に追加freezeの要望を出します．</div>
          <a class="link-to-replies" href="8/1682600591.717579.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1682806606.394059">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1682806606.394059">2023-04-30 07:16:46 +0900</a></div>
          </div>
          <div class="description">報告を忘れていましたが，昨日未明（おとといの深夜）に記入してきました．<br/>• <a href='https://docs.google.com/spreadsheets/d/1HXyOXt5bKwhKWXruzUvfMFHQtBxfZQ0047W7VVObnXI/edit#gid=408033513&amp;range=L38'>提案ページの編集</a><br/>• <a href='https://docs.google.com/spreadsheets/d/1HXyOXt5bKwhKWXruzUvfMFHQtBxfZQ0047W7VVObnXI/edit#gid=1835616968&amp;range=I102'>フィードバックページの編集</a></div>
        </div>
      </div>
      <div class="event" id="message-1685765893.274489">
        <div class="content">
          <div class="summary">
            <div class="user">cojna</div>
            <div class="date"><a class="date" href="#message-1685765893.274489">2023-06-03 13:18:13 +0900</a></div>
          </div>
          <div class="description">Language Test Contestが4/11版に更新されたようです<br/><a href='https://atcoder.jp/contests/language-test-202301'>https://atcoder.jp/contests/language-test-202301</a></div>
          <a class="link-to-replies" href="8/1685765893.274489.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1686447567.947069">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1686447567.947069">2023-06-11 10:39:27 +0900</a></div>
          </div>
          <div class="description">遅くなりましたが，<https://gist.github.com/gksato/0993d739f2ac6e81100f41815a27a978#file-3-imports-hs> のインポートテストコードがCompile を通ることを確認しました．</div>
        </div>
      </div>
      <div class="event" id="message-1686448242.037629">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1686448242.037629">2023-06-11 10:50:42 +0900</a></div>
          </div>
          <div class="description">環境構築用の <code>cabal.project.freeze</code> ファイルをコードテスト：<br/><br/><pre>main :: IO ()
main = putStr =&lt;&lt; readFile "/judge/submission/cabal.project.freeze"</pre><br/>で取得しました！<br/><br/><a href='https://gist.github.com/gksato/0993d739f2ac6e81100f41815a27a978#file-4-cabal-project-freeze'>https://gist.github.com/gksato/0993d739f2ac6e81100f41815a27a978#file-4-cabal-project-freeze</a></div>
        </div>
      </div>
      <div class="event" id="message-1686921303.827259">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1686921303.827259">2023-06-16 22:15:03 +0900</a></div>
          </div>
          <div class="description">事態の収拾がつかなくなりそうでAtCoder社員さまの労力が心配ですが，こんな確認事項がSpreadsheetに追加されました:<br/><br/><a href='https://docs.google.com/spreadsheets/d/1HXyOXt5bKwhKWXruzUvfMFHQtBxfZQ0047W7VVObnXI/edit#gid=1056940558&amp;range=C13'>https://docs.google.com/spreadsheets/d/1HXyOXt5bKwhKWXruzUvfMFHQtBxfZQ0047W7VVObnXI/edit#gid=1056940558&amp;range=C13</a><br/><blockquote>時間が開いてしまったため言語およびライブラリのアップデートを許可することにします<br/>ただし以下のような変更は依然として却下です<br/>- これまでに申請済みのライセンスが変わる<br/>- 新規言語、新規ライブラリの追加<br/>参考: <a href='https://docs.google.com/spreadsheets/d/1HXyOXt5bKwhKWXruzUvfMFHQtBxfZQ0047W7VVObnXI/edit#gid=1835616968&amp;range=K111'>https://docs.google.com/spreadsheets/d/1HXyOXt5bKwhKWXruzUvfMFHQtBxfZQ0047W7VVObnXI/edit#gid=1835616968&amp;range=K111</a></blockquote>これに乗じて GHC 9.4.5 をつっこめますね！ <a href='https://gitlab.haskell.org/ghc/ghc/-/issues/22998'>GHC Issue #22998</a> とか不安だったので地味にホッとしています…．異論がなければ，仮想環境ビルドを 9.4.5 に bump して試した上で 書き換えを行います．</div>
          <a class="link-to-replies" href="8/1686921303.827259.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1686921436.399909">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1686921436.399909">2023-06-16 22:17:16 +0900</a></div>
          </div>
          <div class="description">なお，同時に次回の Freeze が 6/19 で確定しました！</div>
        </div>
      </div>
      <div class="event" id="message-1686957789.585189">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1686957789.585189">2023-06-17 08:23:09 +0900</a></div>
          </div>
          <div class="description">バージョンアップ作業中です．<br/>• <code>unix-2.7.3</code>  (installed with GHC) の <code>unix-2.8.1.1</code> へのアップデートを試みましたが，`unix-2.8.1.1` は <code>filepath &gt;= 1.4.100.0</code>  を要求し，これが既存のバージョン指定 <code>filepath &lt; 1.4.100</code> に矛盾したため，とりあえず <code>unix ==2.7.3</code> で固定しておきます．異論があればお願いします．なお，`filepath &lt;1.4.100` を外してもインストールは可能と思われます．`filepath &lt;1.4.100` のバージョン指定の由来は次のとおりです：4/11 freeze時に， <code>hpc</code>  (the version bundled with GHC-9.4.4 + all versions on Hackage) と <code>filepath &gt;=1.4.100</code> がdependency上かコード上(dependency rangeで許可されているがコンパイルエラーが出るという意味)で非互換であるため， <code>hpc</code> を外し <code>filepath</code> を installed with GHC のバージョンに固定しておくという経過措置をとったものです．</div>
          <a class="link-to-replies" href="8/1686957789.585189.html">... Replies ...</a>
        </div>
      </div>
    </div>
    <div class="ui pagination menu">
      <a href="../../html/CL3AXB1AL/7.html" class="item">Previous</a>
      <a href="../../" class="item">Top</a>
    </div>
  </div>
</body>
</html>
