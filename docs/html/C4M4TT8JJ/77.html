<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / random #77</title><link rel="stylesheet" href="../../main.css" type="text/css" media="screen"></head><body><div class="ui container"><h1>haskell-jp / random #77</h1><div class="pager ui pagination menu"><a href="../../html/C4M4TT8JJ/76.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div><div class="message_list ui feed"><div class="message event" id="message-1594567863.471900"><div class="content"><div class="summary"><div class="message__header user">as_capabl</div><div class="message__timestamp date"><a class="date" href="#message-1594567863.471900">2020-07-13&nbsp;00:31:03 +0900</a></div></div><div class="message__body description">cabalで、わりとクリティカルなのに謎のTest failureでマージされず、投げた本人も放置したまま一年が経過したPRがあるんですが、たとえばこれを私が引き継ぐといったような事は可能なんでしょうかね <a href='https://github.com/haskell/cabal/pull/6103'>https://github.com/haskell/cabal/pull/6103</a></div></div></div><div class="message event" id="message-1594568282.476500"><div class="content"><div class="summary"><div class="message__header user">as_capabl</div><div class="message__timestamp date"><a class="date" href="#message-1594568282.476500">2020-07-13&nbsp;00:38:02 +0900</a></div></div><div class="message__body description">「クリティカル」というのは私の主観なのですが、<br/>cabalはバージョン3系列でv2-***のコマンドがデフォルトになった訳で、<br/>だとするとこの件のように「v1では出来たけどv2では出来ない」みたいなものがあると、<br/>それはregressionという扱いになってマズいんじゃねーの、と個人的には思っていて、<br/>なのに特に界隈で問題になっている様子もないので何だかなーと思っている所です</div></div></div><div class="message event" id="message-1594569901.477600"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date"><a class="date" href="#message-1594569901.477600">2020-07-13&nbsp;01:05:01 +0900</a></div></div><div class="message__body description">引き継いで別途 PR 作るのは構わない気がします<br/>PR 作ったものの拒否されるのが嫌ならば事前にネゴっておく必要があると思いますが</div></div></div><div class="message event" id="message-1594570119.480400"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date"><a class="date" href="#message-1594570119.480400">2020-07-13&nbsp;01:08:39 +0900</a></div></div><div class="message__body description">別話題ですが、型別名っていつでも相互に入れ替えができると思っていたんですがそういうわけじゃないんですね（type synonym instances の前提）<br/>型クラスの解決に影響を与えるみたい<br/><pre>instance C String -- NG
-- instance C [Char] -- OK
instance {- OVERLAPPABLE -} C [a]</pre></div></div></div><div class="message event" id="message-1594595452.481800"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1594595452.481800">2020-07-13&nbsp;08:10:52 +0900</a></div></div><div class="message__body description">めっちゃ便利そう。Haskellのソースコード一括置換ツール。書き換えの規則を等式で表現できる（ <code>RULES</code> プラグマみたいに）<br/><a href='https://engineering.fb.com/open-source/retrie/'>https://engineering.fb.com/open-source/retrie/</a></div></div></div><div class="message event" id="message-1594595888.482000"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1594595888.482000">2020-07-13&nbsp;08:18:08 +0900</a></div></div><div class="message__body description">TypeSynonymInstancesを有効にしていようといまいと<br/><pre>instance C [Char]</pre><br/>にはFlexibleInstancesが必要なのでは。<br/>そしてもちろんFlexibleInstancesを有効にしてれば[Char]でもStringでも問題ない</div></div></div><div class="message event" id="message-1594613717.482300"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date"><a class="date" href="#message-1594613717.482300">2020-07-13&nbsp;13:15:17 +0900</a></div></div><div class="message__body description">flexible instances も有効でした<br/><code>String</code> だと ↓ のエラーが出るんですが <code>[Char]</code> だと出なかったんですよね<br/><pre>    . Overlapping instances for FromRecord String
        arising from a use of `runQuery''
      Matching instances:
        instance FromRecord String
          -- Defined in `postgresql-pure-0.1.3.0:Database.PostgreSQL.Pure.Internal.Parser'
        instance postgresql-pure-0.1.3.0:Database.PostgreSQL.Pure.Internal.Data.FromField
                   a =&gt;
                 FromRecord [a]
          -- Defined in `postgresql-pure-0.1.3.0:Database.PostgreSQL.Pure.Internal.Parser'</pre></div></div></div><div class="message event" id="message-1594613914.482600"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1594613914.482600">2020-07-13&nbsp;13:18:34 +0900</a></div></div><div class="message__body description">うーん、普通に単純な例を手元で試した限り問題なかったので、バグか、 <code>Overlappable</code> の仕様じゃないっすかね... :confused:</div></div></div><div class="message event" id="message-1594614466.482900"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date"><a class="date" href="#message-1594614466.482900">2020-07-13&nbsp;13:27:46 +0900</a></div></div><div class="message__body description">あ、使用するコードも書いてみました？定義する分には問題がなく解決時に問題になるので</div></div></div><div class="message event" id="message-1594614787.483200"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1594614787.483200">2020-07-13&nbsp;13:33:07 +0900</a></div></div><div class="message__body description">とりあえず <code>OVERLAPPABBLE</code> する限り問題なさそう<br/><pre>{-# LANGUAGE FlexibleInstances #-}

class Hoge a where
  hoge :: a -&gt; a

instance Hoge String where
  hoge = id

instance {-# OVERLAPPABLE #-} Hoge [a] where
  hoge = id

main :: IO ()
main = print $ hoge "a"</pre><br/>書いてて気づいたんですけど、 <code>{-# OVERLAPPABLE #-}</code> ではなく`{- OVERLAPPABLE -}` となっているのは問題のコードでも、ですか？</div></div></div><div class="message event" id="message-1594615094.483400"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date"><a class="date" href="#message-1594615094.483400">2020-07-13&nbsp;13:38:14 +0900</a></div></div><div class="message__body description">ギクッと思ったがちゃんと <code>{-# #-}</code> でした…… GHC バージョンとか依存かな</div></div></div><div class="message event" id="message-1594616043.483600"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date"><a class="date" href="#message-1594616043.483600">2020-07-13&nbsp;13:54:03 +0900</a></div></div><div class="message__body description">なんか再現しなくなった:fearful: あれぇ？確かに昨日はウンウン悩んでたんだけどなぁ</div></div></div><div class="message event" id="message-1594631947.484700"><div class="content"><div class="summary"><div class="message__header user">highmt</div><div class="message__timestamp date"><a class="date" href="#message-1594631947.484700">2020-07-13&nbsp;18:19:07 +0900</a></div></div><div class="message__body description">同じ現象かかりませんが、自分も overlapping instances ではまったことがあります。<br/>上記と見かけ上同じようなことが以下の手順で再現できます。<br/><br/>Lib.hs<br/><pre>
{-# LANGUAGE FlexibleInstances #-}

class C a where
  testInst :: a -&gt; Int

instance C [a] where
-- instance {-# OVERLAPPABLE #-} C [a] where -- (あとでこちらに変える; 手順(2)参照)
  testInst = const 1
</pre><br/><br/>Main.hs<br/><pre>
{-# LANGUAGE FlexibleInstances #-}
module Main where
import Lib

instance C [Char] where
  testInst = const 2
-- instance C String where -- (あとでこちらに変える; 手順(3)参照)
--   testInst = const 3

main :: IO ()
main = putStrLn $ show $ testInst "a"
</pre><br/><br/><br/>(0) cabal clean<br/><br/>(1) ↑の状態で cabal run<br/>→ Overlapping instances for C [Char]<br/><br/>(2) Lib のみ修正し {-# OVERLAPPABLE #} を追加し、cabal run<br/>→ OK<br/>→ 2<br/><br/>(3) Main のみ修正して C String に変えて、cabal run<br/>→ Overlapping instances for C [Char]<br/><br/><br/>どうも、手順(2) で Lib.o のみ更新され Lib.hi ファイルが更新されないのと関係があるようです。<br/>((2)の OVERLAPPABLE の効果が(3)で効かない)<br/>手順(3) のあと Lib.hi を消してcabal runするとビルドが通り3が表示されます。<br/>手元にある発見時の.cabalではbaseが4.11となっているので、だいぶ前からの挙動のようです。<br/>(何度もごちゃごちゃしてすみません。)</div></div></div><div class="message event" id="message-1594632942.485000"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date"><a class="date" href="#message-1594632942.485000">2020-07-13&nbsp;18:35:42 +0900</a></div></div><div class="message__body description">おあー、動的ビルド絡みですか。なるほど～。</div></div></div><div class="message event" id="message-1594646475.485800"><div class="content"><div class="summary"><div class="message__header user">takenobu.hs</div><div class="message__timestamp date"><a class="date" href="#message-1594646475.485800">2020-07-13&nbsp;22:21:15 +0900</a></div></div><div class="message__body description">GitHubのissue上で状況を聞いてみると良いかと思います。 issueが多くて埋もれてるのかもしれませんね。<br/><code>Cc: @phadej</code> を入れておくと、cabal主要開発者のOlegさんに伝わると思います。</div></div></div><div class="message event" id="message-1594739435.488600"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date"><a class="date" href="#message-1594739435.488600">2020-07-15&nbsp;00:10:35 +0900</a></div></div><div class="message__body description">HDBC への変換をかまさず relational-record のバックに postgresql-pure を使うライブラリーをリリースした<br/><a href='http://hackage.haskell.org/package/relational-query-postgresql-pure'>http://hackage.haskell.org/package/relational-query-postgresql-pure</a><br/>generic 力が足りなくて手動インスタンスを書かないといけないので「import だけ書き換えれば」というわけにはいきませんが、そのうち自動生成したい</div></div></div><div class="message event" id="message-1594768831.489900"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1594768831.489900">2020-07-15&nbsp;08:20:31 +0900</a></div></div><div class="message__body description">ICFP 2020、keynote speakerがめっちゃ著名人でやばい :open_mouth:<br/><a href='https://haskell-jp.slack.com/archives/C4NDY2TF1/p1594768739027800'>https://haskell-jp.slack.com/archives/C4NDY2TF1/p1594768739027800</a></div></div></div><div class="message event" id="message-1594768864.490100"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1594768864.490100">2020-07-15&nbsp;08:21:04 +0900</a></div></div><div class="message__body description">台湾のあの人 <a href='https://icfp20.sigplan.org/details/icfp-2020-icfp-keynotes/2/Audrey-Tang'>https://icfp20.sigplan.org/details/icfp-2020-icfp-keynotes/2/Audrey-Tang</a> と、Elm作った人 <a href='https://icfp20.sigplan.org/details/icfp-2020-icfp-keynotes/1/Evan-Czaplicki'>https://icfp20.sigplan.org/details/icfp-2020-icfp-keynotes/1/Evan-Czaplicki</a></div></div></div></div><div class="pager ui pagination menu"><a href="../../html/C4M4TT8JJ/76.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div></div></body></html>