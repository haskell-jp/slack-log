<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #20</title><link rel="stylesheet" href="../../main.css" type="text/css" media="screen"></head><body><div class="ui container"><h1>haskell-jp / questions #20</h1><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/19.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a><a href="../../html/C5666B6BB/21.html" class="pager__next item">Next</a></div><div class="message_list ui feed"><div class="message event" id="message-1525518103.000098"><div class="content"><div class="summary"><div class="message__header user">umezuryuplus</div><div class="message__timestamp date">2018-05-05&nbsp;20:01:43 +0900</div></div><div class="message__body description">@umezuryuplus has joined the channel</div></div></div><div class="message event" id="message-1525595344.000028"><div class="content"><div class="summary"><div class="message__header user">yosikawa</div><div class="message__timestamp date">2018-05-06&nbsp;17:29:04 +0900</div></div><div class="message__body description">@yosikawa has joined the channel</div></div></div><div class="message event" id="message-1525602697.000005"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2018-05-06&nbsp;19:31:37 +0900</div></div><div class="message__body description">syslog使ってます</div></div></div><div class="message event" id="message-1525799562.000218"><div class="content"><div class="summary"><div class="message__header user">karoyakani</div><div class="message__timestamp date">2018-05-09&nbsp;02:12:42 +0900</div></div><div class="message__body description">fusion の質問です。Bird の本に頻出する型  f . foldr g a = foldr h b [PoFAD] (pp.34) が良く分かりません。何かもっと詳しい説明・文献がありますでしょうか？<br/>他の型であれば、例えば "foldr/build fusion" や "destroy/unfoldr fusion" や "Church/Cochurch fusion" ならば以下の文献がありますが、これらとも違いますよね？<br/>[PoFAD] (2010) "Pearls of Funcional Algorithm Design" Bird, R<br/>[FPCA 1993] "A Short Cut to Deforestation" Gill, A. Launchbury, J. Jones, S.L.P.<br/>[ICFP 2002] "Shortcut Fusion for Accumulating Parameters &amp; Zip-like Functions" Svenningsson, J.<br/>[Oxford 2011] "Theory and Practice of Fusion," Hinze, R. Harper, James, D.W.H.</div></div></div><div class="message event" id="message-1525820750.000267"><div class="content"><div class="summary"><div class="message__header user">maoe</div><div class="message__timestamp date">2018-05-09&nbsp;08:05:50 +0900</div></div><div class="message__body description">hsyslogのことですか？</div></div></div><div class="message event" id="message-1525829196.000060"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2018-05-09&nbsp;10:26:36 +0900</div></div><div class="message__body description">そうです。</div></div></div><div class="message event" id="message-1525829255.000232"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2018-05-09&nbsp;10:27:35 +0900</div></div><div class="message__body description">特に理由はありませんが、成り行きでhsyslogを直接使う場合と monad-logger-syslogから使う場合があります。</div></div></div><div class="message event" id="message-1525836257.000187"><div class="content"><div class="summary"><div class="message__header user">hiroto.shioi</div><div class="message__timestamp date">2018-05-09&nbsp;12:24:17 +0900</div></div><div class="message__body description"><code>optparse-applicative</code>に関する質問です。サブコマンドで定義したhelp文を`--help`コマンドで表示させる方法はあるのでしょうか。以下のようなコマンドを受け付けることを期待しています<br/><br/><pre>
:main processTicket --help
</pre><br/><br/>コードをGistに掲載しました。<br/><a href='https://gist.github.com/HirotoShioi/e88f3d1622d7d7961e906191263d3d31#file-optparse-applicative-L24'>https://gist.github.com/HirotoShioi/e88f3d1622d7d7961e906191263d3d31#file-optparse-applicative-L24</a></div></div></div><div class="message event" id="message-1525837593.000034"><div class="content"><div class="summary"><div class="message__header user">matsubara0507</div><div class="message__timestamp date">2018-05-09&nbsp;12:46:33 +0900</div></div><div class="message__body description">普通に helper が使えたはず<br/><pre>
command "collectEmails" (info (pure CollectEmails &lt;**&gt; helper)
            (progDesc "Collect emails requested by single user"))
</pre></div></div></div><div class="message event" id="message-1525838048.000030"><div class="content"><div class="summary"><div class="message__header user">hiroto.shioi</div><div class="message__timestamp date">2018-05-09&nbsp;12:54:08 +0900</div></div><div class="message__body description">できた。。！ありがとうございます！</div></div></div><div class="message event" id="message-1525838232.000081"><div class="content"><div class="summary"><div class="message__header user">1to100pen</div><div class="message__timestamp date">2018-05-09&nbsp;12:57:12 +0900</div></div><div class="message__body description">Hutton の “A tutorial on the universality and expressiveness of fold” <a href='http://www.cs.nott.ac.uk/~pszgmh/fold.pdf'>http://www.cs.nott.ac.uk/~pszgmh/fold.pdf</a> の “3.2 The fusion property of fold” にも解説があります。 <br/>Wadler の “Theorems for free!” <a href='https://people.mpi-sws.org/~dreyer/tor/papers/wadler.pdf'>https://people.mpi-sws.org/~dreyer/tor/papers/wadler.pdf</a>  に Theorems for free の応用として <strike> “Figure 1: Examples of Theorems from type” にも解説なしで</strike> （後から訂正：「3.2 Fold」に）出てきます。</div></div></div><div class="message event" id="message-1525839760.000192"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;13:22:40 +0900</div></div><div class="message__body description">subparserの代わりにhsubparserっていうそれに特化したようなのがあったかと思います（今手元で調べられる状況じゃなくて恐縮ですが）。</div></div></div><div class="message event" id="message-1525840855.000147"><div class="content"><div class="summary"><div class="message__header user">hiroto.shioi</div><div class="message__timestamp date">2018-05-09&nbsp;13:40:55 +0900</div></div><div class="message__body description">ありました！</div></div></div><div class="message event" id="message-1525848117.000307"><div class="content"><div class="summary"><div class="message__header user">karoyakani</div><div class="message__timestamp date">2018-05-09&nbsp;15:41:57 +0900</div></div><div class="message__body description">ありがとうございました　特に前者は参考になりました</div></div></div><div class="message event" id="message-1525852073.000292"><div class="content"><div class="summary"><div class="message__header user">hiroto.shioi</div><div class="message__timestamp date">2018-05-09&nbsp;16:47:53 +0900</div></div><div class="message__body description">全く見当違いかもしれませんが、Cardano-SLはkatipを使いたいとか言ってました。<br/><a href='https://hackage.haskell.org/package/katip'>https://hackage.haskell.org/package/katip</a><br/>Running a program which logs 500k times a simple message using both <code>katip</code> and <code>log-warper</code> showed that <code>katip</code> is much faster and uses less memory than <code>log-warper</code>.</div></div></div><div class="message event" id="message-1525856257.000429"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;17:57:37 +0900</div></div><div class="message__body description">64bitの符号なし整数を、次のような形式のJSONで送ってくる（私が直接いじれない）サーバーがあります。<br/><pre>
{ high: &lt;上位32bitを表す符号付き整数&gt;, low: &lt;下位32bitを表す符号付き整数&gt; }
</pre><br/>この形式のJSONから <code>Int64</code> を作り出す方法を考えているのですが、バイナリ力が低くて悩んでおります。<br/>上位ビットは <code>shiftL 32</code> とすればいいのはすぐにわかったですが、下位ビットについてどうすればいいか、教えていただきたいです。<br/>例:<br/>input: <code>{ high: 177247787, low: -813694976 }</code><br/>output: <code>761273451934646272</code></div></div></div><div class="message event" id="message-1525856456.000374"><div class="content"><div class="summary"><div class="message__header user">cosmiafu</div><div class="message__timestamp date">2018-05-09&nbsp;18:00:56 +0900</div></div><div class="message__body description">このサーバーおかしいだろう。。。</div></div></div><div class="message event" id="message-1525856562.000282"><div class="content"><div class="summary"><div class="message__header user">cosmiafu</div><div class="message__timestamp date">2018-05-09&nbsp;18:02:42 +0900</div></div><div class="message__body description">if low <blockquote>0 then low else ((low :: Int64) + 2 ^ 32)</blockquote></div></div></div><div class="message event" id="message-1525856584.000075"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2018-05-09&nbsp;18:03:04 +0900</div></div><div class="message__body description">Word32にキャストできたような</div></div></div><div class="message event" id="message-1525856595.000055"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;18:03:15 +0900</div></div><div class="message__body description">そう、今同僚と話してたら気づきました。</div></div></div><div class="message event" id="message-1525856605.000433"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;18:03:25 +0900</div></div><div class="message__body description"><code>fromIntegral (negate 813694976) :: Word32</code></div></div></div><div class="message event" id="message-1525856665.000034"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;18:04:25 +0900</div></div><div class="message__body description"><blockquote>このサーバーおかしいだろう。。。</blockquote><br/>JSの仕様上64bit整数を直接表現できない故の苦渋の策なんでしょうね。。。</div></div></div><div class="message event" id="message-1525856666.000146"><div class="content"><div class="summary"><div class="message__header user">cosmiafu</div><div class="message__timestamp date">2018-05-09&nbsp;18:04:26 +0900</div></div><div class="message__body description">Prelude <a href='http://Data.Int'>Data.Int</a><blockquote>(-1 :: Word)</blockquote><br/>&lt;interactive&gt;:3:3: warning: [-Woverflowed-literals]<br/>    Literal -1 is out of the Word range 0..18446744073709551615<br/>18446744073709551615<br/><br/>＝。＝Warningが出るけど</div></div></div><div class="message event" id="message-1525856706.000433"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2018-05-09&nbsp;18:05:06 +0900</div></div><div class="message__body description">下位はWord32にキャストしてからInt64にキャスト、 <code>shiftL 32</code> した上位と足し算、で大丈夫…ですよね？多分</div></div></div><div class="message event" id="message-1525856713.000231"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;18:05:13 +0900</div></div><div class="message__body description">はい、リテラルでやると警告が出ますが明示的に <code>fromIntegral</code> する分には問題ないはずです。</div></div></div><div class="message event" id="message-1525856832.000271"><div class="content"><div class="summary"><div class="message__header user">cosmiafu</div><div class="message__timestamp date">2018-05-09&nbsp;18:07:12 +0900</div></div><div class="message__body description">Hmmm，Cの強制coercionが欲しい（</div></div></div><div class="message event" id="message-1525856853.000084"><div class="content"><div class="summary"><div class="message__header user">cosmiafu</div><div class="message__timestamp date">2018-05-09&nbsp;18:07:33 +0900</div></div><div class="message__body description">そもそもやはりこのサーバーがおかしいと思う＝。＝</div></div></div><div class="message event" id="message-1525856904.000117"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;18:08:24 +0900</div></div><div class="message__body description"><pre>
177247787 `shiftL` 32 + (fromIntegral (fromIntegral (negate 813694976) :: Word32) :: Word64)
</pre></div></div></div><div class="message event" id="message-1525856908.000165"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2018-05-09&nbsp;18:08:28 +0900</div></div><div class="message__body description">まあ、「JSの仕様上64bit整数を直接表現できない故の苦渋の策」でしょうねぇ</div></div></div><div class="message event" id="message-1525856933.000177"><div class="content"><div class="summary"><div class="message__header user">cosmiafu</div><div class="message__timestamp date">2018-05-09&nbsp;18:08:53 +0900</div></div><div class="message__body description">え？？？そうなの？</div></div></div><div class="message event" id="message-1525856953.000277"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2018-05-09&nbsp;18:09:13 +0900</div></div><div class="message__body description">JavaScriptは浮動小数点数しかございませんので</div></div></div><div class="message event" id="message-1525856971.000099"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;18:09:31 +0900</div></div><div class="message__body description">JSの数値リテラルは全部doubleとして処理されてしまうのです。。。 :disappointed_relieved:</div></div></div><div class="message event" id="message-1525856980.000557"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2018-05-09&nbsp;18:09:40 +0900</div></div><div class="message__body description">整数は（倍精度浮動小数点の仮数部である）53bitまでしか使えません<br/><a href='http://blog.tmyt.jp/entry/20101201/1291166929'>http://blog.tmyt.jp/entry/20101201/1291166929</a></div></div></div><div class="message event" id="message-1525856994.000548"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2018-05-09&nbsp;18:09:54 +0900</div></div><div class="message__body description">よってこういうことが起こる</div></div></div><div class="message event" id="message-1525857007.000507"><div class="content"><div class="summary"><div class="message__header user">cosmiafu</div><div class="message__timestamp date">2018-05-09&nbsp;18:10:07 +0900</div></div><div class="message__body description">これはさすが。。。</div></div></div><div class="message event" id="message-1525857087.000146"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2018-05-09&nbsp;18:11:27 +0900</div></div><div class="message__body description">なので、高速化のためにJITコンパイラが「こいつはループカウンタとしてしか使われていないから整数に置き換えてもいいな」みたいな推論をしてやる必要があったりします。そういう涙ぐましい努力の結果JavaScriptのあのスピードがあるという感じだそうです</div></div></div><div class="message event" id="message-1525857179.000331"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;18:12:59 +0900</div></div><div class="message__body description">上記の回答でできたっぽいですが <code>fromIntegral</code> 2回使っているところが非常に醜いので <code>TypeApplications</code> を使ってみました。<br/><pre>
177247787 `shiftL` 32 + (fromIntegral @Word64 (fromIntegral @Word32 (negate 813694976)))
</pre></div></div></div><div class="message event" id="message-1525857242.000163"><div class="content"><div class="summary"><div class="message__header user">cosmiafu</div><div class="message__timestamp date">2018-05-09&nbsp;18:14:02 +0900</div></div><div class="message__body description">:face_with_monocle:＠ とはなに？</div></div></div><div class="message event" id="message-1525857801.000110"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;18:23:21 +0900</div></div><div class="message__body description">TypeApplicationsは、<br/><code>id</code> や <code>const</code>, 今回の <code>fromIntegral</code> のような多相関数を、「どの型に対する関数にするか」を <code>@&lt;型名&gt;</code> で明示できるようにしてくれます。<br/><br/>例えば <code>id</code> は <code>a -&gt; a</code> という型ですが、 <code>id @Int</code> のように <code>@</code> で <code>Int</code> を明示することで、 <code>Int -&gt; Int</code> として処理させることができます。<br/><br/>GHCiで試すと :point_down: のようになります。<br/><pre>
&gt; :set -XTypeApplications
&gt; :t id
id :: a -&gt; a
&gt; :t id @Int
id @Int :: Int -&gt; Int
</pre></div></div></div><div class="message event" id="message-1525858600.000210"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;18:36:40 +0900</div></div><div class="message__body description">すみません、 <code>TypeApplications</code> を使った方法、間違いでした（最初の方でうまくいったように見えた理由がいまいちわかりませんが）。正しくは :point_down: です。<br/><pre>
177247787 `shiftL` 32 + (fromIntegral @Word32 @Word64 (fromIntegral @Int32 @Word32 (negate 813694976)))
</pre><br/>却って冗長になってしまいましたね。。。 :disappointed:</div></div></div><div class="message event" id="message-1525858663.000168"><div class="content"><div class="summary"><div class="message__header user">fumieval</div><div class="message__timestamp date">2018-05-09&nbsp;18:37:43 +0900</div></div><div class="message__body description">私の回答はこれです <code>shiftL 177247787 32 .|. 0xffffffff .&amp;. (-813694976)</code></div></div></div><div class="message event" id="message-1525858737.000477"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;18:38:57 +0900</div></div><div class="message__body description">確かに。足し算しなくても <code>.|.</code> でいいのか。</div></div></div><div class="message event" id="message-1525858817.000406"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;18:40:17 +0900</div></div><div class="message__body description">なるほど。よく考えたら元はJSONなんだから <code>Integer</code> として処理してしまったもいいんですね。</div></div></div><div class="message event" id="message-1525859323.000385"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2018-05-09&nbsp;18:48:43 +0900</div></div><div class="message__body description"><code>.|.</code> と <code>+</code> ってどっちが「善」なんでしょうかね（ill-definedな問）</div></div></div><div class="message event" id="message-1525859451.000196"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-05-09&nbsp;18:50:51 +0900</div></div><div class="message__body description">今回の場合 <code>.|.</code> の方が理にかなっていると思いますよ <code>+</code> の場合桁上がりを考慮しないといけない分わずかに処理が遅くなる可能性もありますが、今回のような計算の場合、起こりえないことがあらかじめわかっていますし。</div></div></div><div class="message event" id="message-1525860103.000540"><div class="content"><div class="summary"><div class="message__header user">fumieval</div><div class="message__timestamp date">2018-05-09&nbsp;19:01:43 +0900</div></div><div class="message__body description">CPUのサイクル数はほとんど同じのはずですが、ビット演算の文脈なので.|.の方がいいと思います(なおxorも可といえば可)</div></div></div><div class="message event" id="message-1525863618.000470"><div class="content"><div class="summary"><div class="message__header user">as_capabl</div><div class="message__timestamp date">2018-05-09&nbsp;20:00:18 +0900</div></div><div class="message__body description">大きな整数はStringで返ってくるような仕様もあるようです（サーバーは変えられないとの事ですが、正しい仕様は何かという議論について参考までに） <a href='https://github.com/syucream/hastodon/issues/9'>https://github.com/syucream/hastodon/issues/9</a></div></div></div><div class="message event" id="message-1525921279.000178"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2018-05-10&nbsp;12:01:19 +0900</div></div><div class="message__body description">64bitの符号なし整数をInt64では1bitたりない気がします。</div></div></div><div class="message event" id="message-1525921326.000250"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2018-05-10&nbsp;12:02:06 +0900</div></div><div class="message__body description">64bitの符号あり整数ならいいでしょうが。</div></div></div><div class="message event" id="message-1525921948.000185"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2018-05-10&nbsp;12:12:28 +0900</div></div><div class="message__body description">64bitの符号なし整数はInt64でなくてWord64をつかうのですね。</div></div></div></div><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/19.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a><a href="../../html/C5666B6BB/21.html" class="pager__next item">Next</a></div></div></body></html>