<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #82</title><link rel="stylesheet" href="../../main.css" type="text/css" media="screen"></head><body><div class="ui container"><h1>haskell-jp / questions #82</h1><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/81.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div><div class="message_list ui feed"><div class="message event" id="message-1585548122.008700"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date"><a class="date" href="#message-1585548122.008700">2020-03-30&nbsp;15:02:02 +0900</a></div></div><div class="message__body description">あ、なるほど、representational 以外の role 持つやつだと表示されるんですね。ありがとうございます、解決しました</div></div></div><div class="message event" id="message-1585548203.008900"><div class="content"><div class="summary"><div class="message__header user">highmt</div><div class="message__timestamp date"><a class="date" href="#message-1585548203.008900">2020-03-30&nbsp;15:03:23 +0900</a></div></div><div class="message__body description">解決したみたいでよかったです。<br/>いちおう、8.8.3で<br/><pre>GHCi, version 8.8.3: <https://www.haskell.org/ghc/>  :? for help
ghci&gt; :set -XTypeFamilies
ghci&gt; :set -XGADTs
ghci&gt; type family F a
ghci&gt; data T a b c = MkT b (F c)
ghci&gt; :i T
type role T phantom representational nominal
data T a b c = MkT b (F c)
        -- Defined at &lt;interactive&gt;:4:1</pre><br/>でした。</div></div></div><div class="message event" id="message-1585553848.009400"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1585553848.009400">2020-03-30&nbsp;16:37:28 +0900</a></div></div><div class="message__body description">@igrep set the channel topic: お悩み相談専用チャンネル。回答は原則スレッド機能でやりましょう。複数の質問を同時に投稿しやすくするための配慮です。</div></div></div><div class="message event" id="message-1585559354.009800"><div class="content"><div class="summary"><div class="message__header user">shin1hi</div><div class="message__timestamp date"><a class="date" href="#message-1585559354.009800">2020-03-30&nbsp;18:09:14 +0900</a></div></div><div class="message__body description">popl 2011 年からの概念なんですね。勉強せねば。<br/>ありがとうございます。</div></div></div><div class="message event" id="message-1585560874.010200"><div class="content"><div class="summary"><div class="message__header user">shin1hi</div><div class="message__timestamp date"><a class="date" href="#message-1585560874.010200">2020-03-30&nbsp;18:34:34 +0900</a></div></div><div class="message__body description">equivalent な型を同じ role をもつというのですね。</div></div></div><div class="message event" id="message-1585562533.010500"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date"><a class="date" href="#message-1585562533.010500">2020-03-30&nbsp;19:02:13 +0900</a></div></div><div class="message__body description">どういう equivalent を持ってくるかが重要で、ここでは representational equivalent という概念を持ってきます。なお、やってる事は基本的に structural equivalent とあまり変わりませんが、role system によって各データ型の equivalent のレベルを調整できる点が異なります。その調整を行うために指定するのが(パラメータの) role です</div></div></div><div class="message event" id="message-1585562644.010700"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date"><a class="date" href="#message-1585562644.010700">2020-03-30&nbsp;19:04:04 +0900</a></div></div><div class="message__body description">representational equivalent とは直感的には、実行時に同じ表現を持つということを表します</div></div></div><div class="message event" id="message-1585566505.011300"><div class="content"><div class="summary"><div class="message__header user">shin1hi</div><div class="message__timestamp date"><a class="date" href="#message-1585566505.011300">2020-03-30&nbsp;20:08:25 +0900</a></div></div><div class="message__body description">ありがとうございます。</div></div></div><div class="message event" id="message-1585619243.011700"><div class="content"><div class="summary"><div class="message__header user">hiroyuki.nagata</div><div class="message__timestamp date"><a class="date" href="#message-1585619243.011700">2020-03-31&nbsp;10:47:23 +0900</a></div></div><div class="message__body description">@hiroyuki.nagata has joined the channel</div></div></div><div class="message event" id="message-1585710648.014800"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1585710648.014800">2020-04-01&nbsp;12:10:48 +0900</a></div></div><div class="message__body description">hourglassパッケージにおける <code>WeekDay</code> <a href='https://hackage.haskell.org/package/hourglass-0.2.12/docs/Time-Types.html#t:WeekDay'>https://hackage.haskell.org/package/hourglass-0.2.12/docs/Time-Types.html#t:WeekDay</a> と <code>Date</code> を受け取って、「指定した日付から次のhoge曜日まで何日かかるかを返す」関数 <code>daysUntilNext</code> という関数を定義してみました。もっとクールな計算方法があれば教えていただきたいです。<br/>なんかうまいことやれば  <code>if</code> とかで分岐しなくて済みそうなんですが、ぱっと思いつきませんでした。<br/><pre>daysUntilNext :: WeekDay -&gt; Date -&gt; Int
daysUntilNext nextWeekDay baseDate =
    if nextWeekDay &gt; baseWeekDay
      then fromEnum nextWeekDay - fromEnum baseWeekDay
      else fromEnum nextWeekDay - fromEnum baseWeekDay + 7
    where
      baseWeekDay = getWeekDay baseDate</pre></div></div></div><div class="message event" id="message-1585710885.014900"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1585710885.014900">2020-04-01&nbsp;12:14:45 +0900</a></div></div><div class="message__body description">例えば、以下のように計算します:<br/>• 今日（2020年4月1日(水)）から次の月曜日（2020年4月6日）であれば <code>5</code><br/>• 今週日曜日（2020年4月5日）から次の月曜日であれば <code>1</code><br/>• 今週月曜日（2020年3月30日）から次の月曜日であれば <code>7</code></div></div></div><div class="message event" id="message-1585713632.015100"><div class="content"><div class="summary"><div class="message__header user">as_capabl</div><div class="message__timestamp date"><a class="date" href="#message-1585713632.015100">2020-04-01&nbsp;13:00:32 +0900</a></div></div><div class="message__body description"><pre>(fromEnum nextWeekDay - fromEnum baseWeekDay) `mod` 7</pre><br/> すればいいかと思いましたが、月→月が0になってしまうので良くないですね</div></div></div><div class="message event" id="message-1585713767.015400"><div class="content"><div class="summary"><div class="message__header user">as_capabl</div><div class="message__timestamp date"><a class="date" href="#message-1585713767.015400">2020-04-01&nbsp;13:02:47 +0900</a></div></div><div class="message__body description">負の数の剰余は、ちょっと前にTwitterでバズってたツイートがあった気がする</div></div></div><div class="message event" id="message-1585713924.015700"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1585713924.015700">2020-04-01&nbsp;13:05:24 +0900</a></div></div><div class="message__body description">どちらにしても、完全に分岐をなくすのはやっぱ難しそうですね...</div></div></div><div class="message event" id="message-1585714709.016000"><div class="content"><div class="summary"><div class="message__header user">tikuwakunn</div><div class="message__timestamp date"><a class="date" href="#message-1585714709.016000">2020-04-01&nbsp;13:18:29 +0900</a></div></div><div class="message__body description">少し汚いですが、こんな感じでどうでしょうか？</div></div></div><div class="message event" id="message-1585719148.016600"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1585719148.016600">2020-04-01&nbsp;14:32:28 +0900</a></div></div><div class="message__body description">今試してみたらテスト通りました。ありがとうございます！</div></div></div></div><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/81.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div></div></body></html>