<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>haskell-jp / questions #103</title>
<link rel="stylesheet" href="../../main.css" type="text/css" media="screen">
</head>
<body>
  <div class="ui container">
    <h1>haskell-jp / questions #103</h1>
    <div class="ui pagination menu">
      <a href="../../html/C5666B6BB/102.html" class="item">Previous</a>
      <a href="../../" class="item">Top</a>
    </div>
    <div class="ui feed">
      <div class="event" id="message-1674372468.666109">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1674372468.666109">2023-01-22 16:27:48 +0900</a></div>
          </div>
          <div class="description"><code>ghc-bignum</code> ってデフォルトが <code>native</code> になってますけど， これを <code>gmp</code> にしようと思ったら <code>ghcup</code> でGHCをインストールする時点でなんとかしないといけないですか…？</div>
          <a class="link-to-replies" href="103/1674372468.666109.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1674523876.552029">
        <div class="content">
          <div class="summary">
            <div class="user"></div>
            <div class="date"><a class="date" href="#message-1674523876.552029">2023-01-24 10:31:16 +0900</a></div>
          </div>
          <div class="description">@ has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1674613262.313509">
        <div class="content">
          <div class="summary">
            <div class="user">kazu</div>
            <div class="date"><a class="date" href="#message-1674613262.313509">2023-01-25 11:21:02 +0900</a></div>
          </div>
          <div class="description">GHC 9.4 で stdc++ に依存するようになってしまったようですが、その理由はなんでしょうか？<br/>centos だと、configure が stdc++ を見つけられずに、インストールできません。。。</div>
          <a class="link-to-replies" href="103/1674613262.313509.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1674682624.529619">
        <div class="content">
          <div class="summary">
            <div class="user">kk</div>
            <div class="date"><a class="date" href="#message-1674682624.529619">2023-01-26 06:37:04 +0900</a></div>
          </div>
          <div class="description">@kk has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1674770921.336499">
        <div class="content">
          <div class="summary">
            <div class="user">gan20</div>
            <div class="date"><a class="date" href="#message-1674770921.336499">2023-01-27 07:08:41 +0900</a></div>
          </div>
          <div class="description">@gan20 has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1674891407.269969">
        <div class="content">
          <div class="summary">
            <div class="user">HN</div>
            <div class="date"><a class="date" href="#message-1674891407.269969">2023-01-28 16:36:47 +0900</a></div>
          </div>
          <div class="description">@HN has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1675173538.017639">
        <div class="content">
          <div class="summary">
            <div class="user">まど</div>
            <div class="date"><a class="date" href="#message-1675173538.017639">2023-01-31 22:58:58 +0900</a></div>
          </div>
          <div class="description">@まど has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1675174781.070379">
        <div class="content">
          <div class="summary">
            <div class="user">ai-ou</div>
            <div class="date"><a class="date" href="#message-1675174781.070379">2023-01-31 23:19:41 +0900</a></div>
          </div>
          <div class="description">@ai-ou has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1675217802.518109">
        <div class="content">
          <div class="summary">
            <div class="user">yoshitsugu</div>
            <div class="date"><a class="date" href="#message-1675217802.518109">2023-02-01 11:16:42 +0900</a></div>
          </div>
          <div class="description">@yoshitsugu has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1675566381.795629">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1675566381.795629">2023-02-05 12:06:21 +0900</a></div>
          </div>
          <div class="description"><a href='https://haskell-jp.slack.com/archives/CL3AXB1AL/p1675402815431589'>https://haskell-jp.slack.com/archives/CL3AXB1AL/p1675402815431589</a> （at <a href='#CL3AXB1AL'>atcoder-lang-update</a>)<br/><blockquote>がんばりました。直接installしていない物も含む、全transitive dependencyのライセンスのリスト:　<https://docs.google.com/spreadsheets/d/1HXyOXt5bKwhKWXruzUvfMFHQtBxfZQ0047W7VVObnXI/edit#gid=1835616968&amp;range=E5></blockquote>この件で，あるパッケージ群の全transitive dependenciesからlicenseを取ってくる作業をしたのですが，私の知識の範囲でできる限り車輪の再開発を避けて:<br/>1. cabal-installにdependencyを解いてもらい，<br/>2. それをもとにHackage API を叩いて <code>.cabal</code> ファイルをもらってくる，<br/>3.  <code>Cabal-syntax</code> パッケージを使ってその <code>.cabal</code> ファイルをパースしてライセンス情報を取る<br/>みたいな手段を取りました．この1.に関して質問させてください．<br/><br/>ここでやりたいことは，「ビルドやインストールはしなくていいけど，現環境から見た，既ビルドのものも含めた全transitive dependenciesのリストが欲しい」ということになります．このために今回は結構乱暴な手段を取りました．Docker環境があったので，まっさらなGHC+Cabalをghcupでインストールしたのち，対象のパッケージ群を全部 <code>cabal install --lib</code> して <code>ghc-pkg　list</code> でインストールされている全パッケージのリストを取ってきたのです．しかし，これでは余計なパッケージまで見ている気がしますし，もうちょっとなんとかならんのか，という気がします．<br/><br/>色々いじっていると，適当に一個だけcabal packageを持つcabal projectを作り，Cabal packageの <code>.cabal</code> ファイルは目的とするパッケージ群をdependenciesに持つ library だけを持つようにし，project の <code>cabal.project</code> にはそれらのライブラリについて設定すべきフラグを持たせるようにすると，  <code>cabal freeze</code> で <code>cabal.project.freeze</code> がなんかそれっぽいファイルになるのですが，これで合ってるのでしょうか…？ <code>cabal freeze</code> が良い方法なのか，あるいは別の方法があればお教えいただければありがたいです．</div>
          <a class="link-to-replies" href="103/1675566381.795629.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1675937034.855919">
        <div class="content">
          <div class="summary">
            <div class="user"></div>
            <div class="date"><a class="date" href="#message-1675937034.855919">2023-02-09 19:03:54 +0900</a></div>
          </div>
          <div class="description">RIOパッケージをbase代替として取り入れています。<br/><code>RIO.Utf8Builder</code> の値を <i>ロギング用途ではなく</i> 標準出力に吐き出すには何を用いるのが良いのでしょうか？<br/>具体的にやりたいこととしては、情報を標準出力に出力するCLIツールを作ろうとしています。<br/>今はとりあえずTextやByteStringに変換した後に <code>putStrLn</code> 等で出力をしているのですが、他により良い方法があったりしますか？<br/><br/>【現状の方法だった場合: ByteStringにするべきかTextにするべきか】<br/>Text or ByteStringへの変換をする場合、どちらの方が良いとかあるでしょうか？それともあまり考えなくて良いのでしょうか<br/>最初は`textDisplay` が用意されていることから、Textを使うべきなのかな？と思っていました。<br/>しかし、`RIO.Utf8Builder`が内部的には <code>Data.ByteString.Builder.Builder</code> を用いているようなのでByteStringの方が良いのかな？とも考えて悩んでいます。</div>
          <a class="link-to-replies" href="103/1675937034.855919.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1676140328.299019">
        <div class="content">
          <div class="summary">
            <div class="user">mocamocaland</div>
            <div class="date"><a class="date" href="#message-1676140328.299019">2023-02-12 03:32:08 +0900</a></div>
          </div>
          <div class="description">@mocamocaland has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1676196208.626109">
        <div class="content">
          <div class="summary">
            <div class="user">h r</div>
            <div class="date"><a class="date" href="#message-1676196208.626109">2023-02-12 19:03:28 +0900</a></div>
          </div>
          <div class="description">@h r has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1676619242.957009">
        <div class="content">
          <div class="summary">
            <div class="user">kazu</div>
            <div class="date"><a class="date" href="#message-1676619242.957009">2023-02-17 16:34:02 +0900</a></div>
          </div>
          <div class="description">GHCの管理が phabricator から gitlab になり、例えば<br/><a href='https://phabricator.haskell.org/D4884'>https://phabricator.haskell.org/D4884</a><br/>のようなリンクが追えないのですが、gitlabへはどう変換されているのでしょうか？</div>
          <a class="link-to-replies" href="103/1676619242.957009.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1676844723.772979">
        <div class="content">
          <div class="summary">
            <div class="user">minus1216</div>
            <div class="date"><a class="date" href="#message-1676844723.772979">2023-02-20 07:12:03 +0900</a></div>
          </div>
          <div class="description">代替Preludeを使いたいと考えているのですが、新しくてまとまっている比較記事などはありますか？</div>
          <a class="link-to-replies" href="103/1676844723.772979.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1676912908.924149">
        <div class="content">
          <div class="summary">
            <div class="user"></div>
            <div class="date"><a class="date" href="#message-1676912908.924149">2023-02-21 02:08:28 +0900</a></div>
          </div>
          <div class="description">GHC 9からTemplate Haskellでinstanceを定義する時に相互参照が出来なくなってコンパイルが通らなくなったという問題を抱えているのですが、この破壊的変更がどこかにまとまってる場所や、より良い回避方法を知っている方は居ますか?<br/>具体的にどういうことが起きているのかは自分のサイトに書きました。<br/><a href='https://www.ncaq.net/2023/02/21/01/48/48/'>GHC 9からTemplate Haskellでinstanceを定義する時に相互参照が出来なくなった - ncaq</a></div>
          <a class="link-to-replies" href="103/1676912908.924149.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1677283347.252899">
        <div class="content">
          <div class="summary">
            <div class="user">nobsun</div>
            <div class="date"><a class="date" href="#message-1677283347.252899">2023-02-25 09:02:27 +0900</a></div>
          </div>
          <div class="description">言語拡張 CPP を指定したソースコードの確認のために、CPPの処理だけが済んだ段階のソースコードを出力したいと思うのですが、ghc オプション指定でできないものでしょうか？</div>
          <a class="link-to-replies" href="103/1677283347.252899.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1677690080.128899">
        <div class="content">
          <div class="summary">
            <div class="user">Greg Fragin</div>
            <div class="date"><a class="date" href="#message-1677690080.128899">2023-03-02 02:01:20 +0900</a></div>
          </div>
          <div class="description">@Greg Fragin has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1678031344.687819">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1678031344.687819">2023-03-06 00:49:04 +0900</a></div>
          </div>
          <div class="description">ふと思ったのですが，GHCの compiler backend (LLVMとかNCGとか)って機械語吐くのに必要なんだから，ライブラリだけビルドする時って無関係，なんでしたっけ…？ こういう時どういう資料を漁ればいいかよくわからなくなってしまって．</div>
          <a class="link-to-replies" href="103/1678031344.687819.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1678377424.257919">
        <div class="content">
          <div class="summary">
            <div class="user">フラワー</div>
            <div class="date"><a class="date" href="#message-1678377424.257919">2023-03-10 00:57:04 +0900</a></div>
          </div>
          <div class="description">@フラワー has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1678493250.805059">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1678493250.805059">2023-03-11 09:07:30 +0900</a></div>
          </div>
          <div class="description">あるpackage の executable 中に入っている module の関数が欲しくて、copy-and-paste するつもりなのですが、こういう時って LICENSE ファイルを複数作るか、追記するか、どうするのが普通なんでしょう？</div>
          <a class="link-to-replies" href="103/1678493250.805059.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1678767625.971099">
        <div class="content">
          <div class="summary">
            <div class="user"></div>
            <div class="date"><a class="date" href="#message-1678767625.971099">2023-03-14 13:20:25 +0900</a></div>
          </div>
          <div class="description">@ has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1679039675.127259">
        <div class="content">
          <div class="summary">
            <div class="user">kudos3939</div>
            <div class="date"><a class="date" href="#message-1679039675.127259">2023-03-17 16:54:35 +0900</a></div>
          </div>
          <div class="description">@kudos3939 has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1679400116.294859">
        <div class="content">
          <div class="summary">
            <div class="user">西澤秀樹</div>
            <div class="date"><a class="date" href="#message-1679400116.294859">2023-03-21 21:01:56 +0900</a></div>
          </div>
          <div class="description">@西澤秀樹 has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1679925721.880759">
        <div class="content">
          <div class="summary">
            <div class="user">Hisawo TAKASE</div>
            <div class="date"><a class="date" href="#message-1679925721.880759">2023-03-27 23:02:01 +0900</a></div>
          </div>
          <div class="description">@Hisawo TAKASE has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1680184874.825459">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1680184874.825459">2023-03-30 23:01:14 +0900</a></div>
          </div>
          <div class="description"><a href='ttps://haskell-jp.slack.com/archives/CL3AXB1AL/p1680155886899719'>https://haskell-jp.slack.com/archives/CL3AXB1AL/p1680155886899719</a> の関係で <code>strict-wrapper</code> のコード (<https://github.com/tomjaguarpaw/strict-wrapper/blob/48a2695995a4c4c9d853b5f45175f6cf1241ebb2/lib/Data/Strict/Wrapper.hs#LL223-L262>) を読んでたんですが，ここの <code>strict</code> と <code>unstrict</code> 関数が怖いことをしていると思うので，皆様のご意見を伺いたいです．参照先のコードは大体<br/><br/><pre>data SPair a b = SPair !a !b

strict :: (a, b) -&gt; SPair a b
strict x = case x of
  (!_, !_) -&gt; unsafeCoerce x

unstrict :: SPair a b -&gt; (a, b)
unstrict = unsafeCoerce</pre><br/>のようなことをしており，これって <code>SPair a b</code> と <code>(a, b)</code> の runtime representation が完全に一致しているということを主張している気がするんですが，そんな保証ってありましたっけ…？</div>
          <a class="link-to-replies" href="103/1680184874.825459.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1680423862.784269">
        <div class="content">
          <div class="summary">
            <div class="user">igrep</div>
            <div class="date"><a class="date" href="#message-1680423862.784269">2023-04-02 17:24:22 +0900</a></div>
          </div>
          <div class="description">GHCupって、使用するGHCなどのバージョンをディレクトリーによって置き換える機能はないのでしょうか？ざっとドキュメントを読んだ限り見当たらなかったので。GHCはcabal.projectなどで簡単に切り替えられるからいいんですけど、ghcupでインストールされるhaskell-language-serverがバイナリーを付けてくれないバージョンだったもので...</div>
          <a class="link-to-replies" href="103/1680423862.784269.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1680424405.298879">
        <div class="content">
          <div class="summary">
            <div class="user">Hiromi ISHII / mr_konn</div>
            <div class="date"><a class="date" href="#message-1680424405.298879">2023-04-02 17:33:25 +0900</a></div>
          </div>
          <div class="description">IDEが用いるバージョンの固定であれば、VSCodeならhaskell.toolchain 項目で具体的なバージョン集合を指定できますね。HLSの公式バイナリが対応していないバージョンのGHCを使う場合はghcup compile機能で自前でHLSをビルドして、そのカスタムビルドのバージョン文字列を指定して使ったりしてます。<br/>他のエディタでも多分使えるはずだとは思いますが使ったことがないのでわからないですね</div>
        </div>
      </div>
      <div class="event" id="message-1680964474.946189">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1680964474.946189">2023-04-08 23:34:34 +0900</a></div>
          </div>
          <div class="description">ghc-heapってbundled versionでないものを使うと不具合は起こるのでしょうか…？ なんの気なしにdependencyに入れたらcabal-install が GHC-9.4.4 上に ghc-heap-9.6.1 を引っ張ってきている…</div>
        </div>
      </div>
      <div class="event" id="message-1681290375.582189">
        <div class="content">
          <div class="summary">
            <div class="user">nobsun</div>
            <div class="date"><a class="date" href="#message-1681290375.582189">2023-04-12 18:06:15 +0900</a></div>
          </div>
          <div class="description">Windows 11 の WSL Ubuntu に ghcup で、stack を含む開発環境をセットアップしたのですが、stack new hoge をすると<br/><pre>Downloading template new-template to create project hoge in directory hoge/...

Error: [S-1688]
       Stack failed to download the template new-template from
       <https://api.github.com/repos/commercialhaskell/stack-templates/contents/new-template.hsfiles>.

       While downloading, Stack encountered an HTTP error. Stack made the request:

       Request {
  host                 = "<http://api.github.com|api.github.com>"
  port                 = 443
  secure               = True
  requestHeaders       = [("User-Agent","The Haskell Stack")]
  path                 = "/repos/commercialhaskell/stack-templates/contents/new-template.hsfiles"
  queryString          = ""
  method               = "GET"
  proxy                = Nothing
  rawBody              = False
  redirectCount        = 10
  responseTimeout      = ResponseTimeoutDefault
  requestVersion       = HTTP/1.1
  proxySecureMode      = ProxySecureWithConnect
}


       and the content of the error was:

       ConnectionTimeout</pre><br/>となります。wsl あるいは windows 11 の問題のような気もしますが、もし、なにか対処法にヒントがあれば教えていただけると幸いです。<br/>ネットワークは繋がっていますし、wget で <a href='https://api.github.com/'>https://api.github.com/</a>... にも繋がるように見えています。</div>
        </div>
      </div>
      <div class="event" id="message-1681367761.457429">
        <div class="content">
          <div class="summary">
            <div class="user">光志賀</div>
            <div class="date"><a class="date" href="#message-1681367761.457429">2023-04-13 15:36:01 +0900</a></div>
          </div>
          <div class="description">@光志賀 has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1681741820.333629">
        <div class="content">
          <div class="summary">
            <div class="user"></div>
            <div class="date"><a class="date" href="#message-1681741820.333629">2023-04-17 23:30:20 +0900</a></div>
          </div>
          <div class="description">@ has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1681791728.925269">
        <div class="content">
          <div class="summary">
            <div class="user">Keonhwa Ryu</div>
            <div class="date"><a class="date" href="#message-1681791728.925269">2023-04-18 13:22:08 +0900</a></div>
          </div>
          <div class="description">@Keonhwa Ryu has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1682165305.270449">
        <div class="content">
          <div class="summary">
            <div class="user"></div>
            <div class="date"><a class="date" href="#message-1682165305.270449">2023-04-22 21:08:25 +0900</a></div>
          </div>
          <div class="description">@ has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1682511649.072529">
        <div class="content">
          <div class="summary">
            <div class="user">kazu</div>
            <div class="date"><a class="date" href="#message-1682511649.072529">2023-04-26 21:20:49 +0900</a></div>
          </div>
          <div class="description">M1 の mac で AArch64 の GHC をお使いの方：<br/>network パッケージのビルドに異常に時間がかかりませんか？<br/>cabal build で hsc2hs が走るのですが、これがとても時間がかかるような気がしています。<br/>.hsc から .hs ができさえすれば、コンパイルには時間がかからないようです。</div>
        </div>
      </div>
      <div class="event" id="message-1682522713.812699">
        <div class="content">
          <div class="summary">
            <div class="user">gksato</div>
            <div class="date"><a class="date" href="#message-1682522713.812699">2023-04-27 00:25:13 +0900</a></div>
          </div>
          <div class="description">MacOS 13.3.1 on Intel Mac 上，built-in の terminal 上の bash で，GHCup を使って cabal-install 3.8.1.0 と GHC 9.4.4 をインストールした状態で，自作のcabal packageに対して <code>cabal v2-install</code> を実行すると GHC のコンパイル時警告が握り潰されるのですが，原因特定・解決のためには何をすると良いでしょうか？ <code>cabal v2-build</code> を使うとコンパイル時警告が握り潰されないこと， このPC上，Docker container上の Ubuntu で同様の環境を作成したときにも同様の事象が発生することは確認しているのですが，どうも同様の環境を再現しているはずの AtCoder 実行環境では GHCのコンパイル警告は正しく表示される (<https://atcoder.jp/contests/language-test-202301/submissions/40950719>) ようなのです．</div>
        </div>
      </div>
    </div>
    <div class="ui pagination menu">
      <a href="../../html/C5666B6BB/102.html" class="item">Previous</a>
      <a href="../../" class="item">Top</a>
    </div>
  </div>
</body>
</html>
