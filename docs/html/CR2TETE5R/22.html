<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>haskell-jp / beginners #22</title>
<link rel="stylesheet" href="../../main.css" type="text/css" media="screen">
</head>
<body>
  <div class="ui container">
    <h1>haskell-jp / beginners #22</h1>
    <div class="ui pagination menu">
      <a href="../../html/CR2TETE5R/21.html" class="item">Previous</a>
      <a href="../../" class="item">Top</a>
    </div>
    <div class="ui feed">
      <div class="event" id="message-1665272454.027519">
        <div class="content">
          <div class="summary">
            <div class="user">j.nakajima</div>
            <div class="date"><a class="date" href="#message-1665272454.027519">2022-10-09 08:40:54 +0900</a></div>
          </div>
          <div class="description">@j.nakajima has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1665356484.685789">
        <div class="content">
          <div class="summary">
            <div class="user">Naoya Ito</div>
            <div class="date"><a class="date" href="#message-1665356484.685789">2022-10-10 08:01:24 +0900</a></div>
          </div>
          <div class="description">@Naoya Ito has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1665619227.383829">
        <div class="content">
          <div class="summary">
            <div class="user">Slackbot</div>
            <div class="date"><a class="date" href="#message-1665619227.383829">2022-10-13 09:00:27 +0900</a></div>
          </div>
          <div class="description">Reminder: beginnersチャンネルは、新しい人がスムーズにHaskellに慣れるための質問を歓迎するチャンネルです。 Haskell-Beginners ML や IRCの#haskell-beginners  や RedditのMonthly Hask Anythingのような位置づけを意図しています。  beginnersチャンネルでの回答側は、以下の左側のような応答を厳禁とする運用です。 • それはくだらない質問だ → くだらない質問など無い • その質問は以前にもあった → 質問者はそんなこと知らない • Google検索せよ → 検索できないから質問している  beginnersチャンネルでは、例えば以下のレベルの質問から歓迎します。 • <code>:</code> とは何のことですか。 • タプルとは何ですか。 </div>
        </div>
      </div>
      <div class="event" id="message-1665737308.311929">
        <div class="content">
          <div class="summary">
            <div class="user"></div>
            <div class="date"><a class="date" href="#message-1665737308.311929">2022-10-14 17:48:28 +0900</a></div>
          </div>
          <div class="description">Haskellでのデバッグ方法がわからず、質問させていただいてもよろしいでしょうか。<br/>やりたいことは、JavaScriptの`console.log`のように、関数のなかの変数を`GHCi`のコンソールに出力したいです。<br/>具体的には、以下の関数で、`repeatedL1`　の部分がどんな値になっているかを見たいです。<br/><pre>cartCombine :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
cartCombine func l1 l2 = zipWith func newL1 cycledL2
    where
        nToAdd = length l2
        repeatedL1 = map (take nToAdd . repeat) l1
        newL1 = mconcat repeatedL1
        cycledL2 = cycle l2</pre><br/>ここで、<br/><pre>repeatedL1 = map (take nToAdd . repeat) l1
show repeatedL1
newL1 = mconcat repeatedL1
……</pre><br/>などとすると、エラーになってしまいます。<br/><br/>ご教示いただけますと幸いです。<br/>よろしくお願いいたします。</div>
          <a class="link-to-replies" href="22/1665737308.311929.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1665918777.693479">
        <div class="content">
          <div class="summary">
            <div class="user">liveinwood</div>
            <div class="date"><a class="date" href="#message-1665918777.693479">2022-10-16 20:12:57 +0900</a></div>
          </div>
          <div class="description">Practical Haskell という本を読んでいます。分からない点があるので質問させてください。<br/><br/><pre>module Main (main) where

import GHC.IO.IOMode (IOMode(ReadMode))
import GHC.IO.Handle (hGetContents, hClose)
import <http://System.IO|System.IO> (openFile)

main :: IO ()
main = do
    h &lt;- openFile "./some.txt" ReadMode
    s &lt;- hGetContents h
    hClose h
    print s</pre><br/>これを実行するとエラーになります。`./some.txt: hGetContents: illegal operation (delayed read on closed handle)`<br/><br/>エラーになる理屈は理解していて、`hClose h`と`print s`を入れ替えれば動作します。<br/>他の解決策として   <code>seq</code> または   <code>deepseq</code>  を使っても解決できると書いてあるのですが、具体的に使い方は書いてありませんでした。<br/><br/><code>hClose h</code> する前に文字列全体を読み込めばいいので、`let !size = length s` を追加して、文字列全体を読み込むように処理を強制しました。これは動作しました。<br/><pre>{-# LANGUAGE BangPatterns #-}
module Main (main) where

import GHC.IO.IOMode (IOMode(ReadMode))
import GHC.IO.Handle (hGetContents, hClose)
import <http://System.IO|System.IO> (openFile)

main :: IO ()
main = do
    h &lt;- openFile "./some.txt" ReadMode
    s &lt;- hGetContents h
    let !size = length s
    hClose h
    print s</pre><br/><code>let !size = length s</code>  を追加したのと同じ理屈で  <code>let ds =  s </code>deepseq` s` を追加したのですが、これだとエラーになります。<br/><br/><pre>{-# LANGUAGE BangPatterns #-}
module Main (main) where

import GHC.IO.IOMode (IOMode(ReadMode))
import GHC.IO.Handle (hGetContents, hClose)
import <http://System.IO|System.IO> (openFile)
import Control.DeepSeq

main :: IO ()
main = do
    h &lt;- openFile "./some.txt" ReadMode
    s &lt;- hGetContents h
    let ds =  s `deepseq` s
    hClose h
    print ds</pre><br/><code>let ds =  s </code>deepseq` s`  ではエラーになる理由をご教示いただけないでしょうか。よろしくお願い致します。</div>
          <a class="link-to-replies" href="22/1665918777.693479.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1666062034.575279">
        <div class="content">
          <div class="summary">
            <div class="user">liveinwood</div>
            <div class="date"><a class="date" href="#message-1666062034.575279">2022-10-18 12:00:34 +0900</a></div>
          </div>
          <div class="description">遅延評価についてよく分からなくなってきました。<br/><pre>module Main (main) where

import qualified <http://System.IO|System.IO> as SIO

main :: IO ()
main = do
    h &lt;- SIO.openFile "./input.txt" SIO.ReadMode
    content &lt;- SIO.hGetContents h
    SIO.hClose h
    print content</pre><br/>これは実行するとエラーになる理由はわかります。`content` を評価する時には既にファイルがクローズされているから。<br/><br/><pre>module Main (main) where

main :: IO ()
main = do
    putStrLn "please input1 "
    input &lt;- getLine
    putStrLn "please input2 "
    putStrLn $ "your input is " ++ input</pre><br/>同様に考えて、 <code>input</code>を評価する時に標準入力を受け付けることになり、下のような出力順になるのでは？と考えたのですが、<br/>そうはならず。コードに書いてある順序通りの出力になりました。<br/><br/><pre>please input1 
please input2 
your input is aaa</pre><br/>これまでちゃんと理解せずにいたのですが、混乱しています。<br/><br/><code>getLine</code>がlazyではないから評価された時点で入力待ち状態になる、と考えると納得できそうですが、<br/>そもそも <code>getLine</code>  が評価されるのは「please input2」 を出力した後なのでは？<br/>たぶん「遅延評価」「式を評価する」ということの意味を正確に理解できていないと思うのですが、どなたかご教示いただけないでしょうか。</div>
          <a class="link-to-replies" href="22/1666062034.575279.html">... Replies ...</a>
        </div>
      </div>
      <div class="event" id="message-1666147001.076179">
        <div class="content">
          <div class="summary">
            <div class="user">mochizuki</div>
            <div class="date"><a class="date" href="#message-1666147001.076179">2022-10-19 11:36:41 +0900</a></div>
          </div>
          <div class="description">@mochizuki has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1666689195.737389">
        <div class="content">
          <div class="summary">
            <div class="user">Yoshikuni Kato</div>
            <div class="date"><a class="date" href="#message-1666689195.737389">2022-10-25 18:13:15 +0900</a></div>
          </div>
          <div class="description">\</div>
        </div>
      </div>
      <div class="event" id="message-1666822096.525419">
        <div class="content">
          <div class="summary">
            <div class="user">gnkm</div>
            <div class="date"><a class="date" href="#message-1666822096.525419">2022-10-27 07:08:16 +0900</a></div>
          </div>
          <div class="description">@gnkm has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1667060090.805199">
        <div class="content">
          <div class="summary">
            <div class="user">Jake Lengyel</div>
            <div class="date"><a class="date" href="#message-1667060090.805199">2022-10-30 01:14:50 +0900</a></div>
          </div>
          <div class="description">@Jake Lengyel has joined the channel</div>
        </div>
      </div>
      <div class="event" id="message-1667135722.364259">
        <div class="content">
          <div class="summary">
            <div class="user">toyboot4e</div>
            <div class="date"><a class="date" href="#message-1667135722.364259">2022-10-30 22:15:22 +0900</a></div>
          </div>
          <div class="description">こんばんは。 <a href='https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours'>Write Yourself a Scheme in 48 hours</a> をやっています。記事中では <code>String</code> が使用されていますが、代わりに <code>Text</code> (データ型) を使ってみたいと思います。</div>
        </div>
      </div>
      <div class="event" id="message-1667135853.108099">
        <div class="content">
          <div class="summary">
            <div class="user">toyboot4e</div>
            <div class="date"><a class="date" href="#message-1667135853.108099">2022-10-30 22:17:33 +0900</a></div>
          </div>
          <div class="description">ただ実際使おうにも、 1 文字を表すのに <code>Char</code> を使うべきか <code>Text.singleton</code> かなど迷う点が多くありそうです。</div>
        </div>
      </div>
      <div class="event" id="message-1667135922.740229">
        <div class="content">
          <div class="summary">
            <div class="user">toyboot4e</div>
            <div class="date"><a class="date" href="#message-1667135922.740229">2022-10-30 22:18:42 +0900</a></div>
          </div>
          <div class="description">(そのためインプットが欲しいと思います)。 <code>Text</code> と <code>Parsec</code> を使ったおすすめのリポジトリなどあれば、お聞かせ願えますでしょうか :eyes:</div>
        </div>
      </div>
    </div>
    <div class="ui pagination menu">
      <a href="../../html/CR2TETE5R/21.html" class="item">Previous</a>
      <a href="../../" class="item">Top</a>
    </div>
  </div>
</body>
</html>
