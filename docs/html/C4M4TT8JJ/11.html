<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / random #11</title><link rel="stylesheet" href="../../messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / random #11</h1><div class="pager"><a href="../../html/C4M4TT8JJ/10.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a><a href="../../html/C4M4TT8JJ/12.html" class="pager__next">Next</a></div><div class="message_list"><div class="message" id="message-1518662343.000172"><div class="message__timestamp">2018-02-15<br/>11:39:03 +0900</div><div class="message__header">voqn.tyrant</div><div class="message__body">ああ、説明が足りませんでした。<br/>構文木を評価した結果の型を以下のようにして、型の構造はシンプルなままにして外側から注釈をつけられるような Functor として扱えないかなって取り組んでみたのです<br/><br/><pre>hs
data ValF a
  = Unit
  | Bool    Bool
  | Integer Integer
  | List    [a]
  | Func ([a] -&gt; Either Error a)
</pre><br/>ビルトインの関数やラムダ式を <code>Func</code>   にあてがう用途に足したのですが、この時点でFunctorの導出は出来ないなって気づいて</div></div><div class="message" id="message-1518662486.000122"><div class="message__timestamp">2018-02-15<br/>11:41:26 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">aはアノテーションにして，型情報とかを入れたい感じですか？</div></div><div class="message" id="message-1518662602.000163"><div class="message__timestamp">2018-02-15<br/>11:43:22 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body"><code>Func</code> の型の意味がよく分かってないんですが， <code>([a], Either Error a)</code> ではなくて関数型なんです？</div></div><div class="message" id="message-1518662627.000001"><div class="message__timestamp">2018-02-15<br/>11:43:47 +0900</div><div class="message__header">voqn.tyrant</div><div class="message__body">更にコレを <code>newtype Fix f = Fix (f (Fix f))</code> でラップすると、外側から中に注釈を差し込めるっていう感じです</div></div><div class="message" id="message-1518662820.000206"><div class="message__timestamp">2018-02-15<br/>11:47:00 +0900</div><div class="message__header">voqn.tyrant</div><div class="message__body"><code>Func</code> はhaskellの方で実装しているビルトイン関数本体を渡すように考えていて eval する時にそれを適用させてインタプリタを実装する、という目論見でした。</div></div><div class="message" id="message-1518662933.000070"><div class="message__timestamp">2018-02-15<br/>11:48:53 +0900</div><div class="message__header">voqn.tyrant</div><div class="message__body">ここの “Adding basic primitives” の項に書いてあるような感じ <a href='https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours/Evaluation,_Part_1'>https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours/Evaluation,_Part_1</a></div></div><div class="message" id="message-1518663227.000179"><div class="message__timestamp">2018-02-15<br/>11:53:47 +0900</div><div class="message__header">voqn.tyrant</div><div class="message__body"><a href='https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours/Defining_Scheme_Functions'>https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours/Defining_Scheme_Functions</a><br/>こっちの方が近いかもです。この例の <code>LispVal</code> のように、関数をメンバーに持たせて、apply の型を <code>Val -&gt; [Val] -&gt; Either Error Val</code> という風にしたかった</div></div><div class="message" id="message-1518663231.000031"><div class="message__timestamp">2018-02-15<br/>11:53:51 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">うーん，それは，<br/><pre>
type Val = Fix ValF
eval :: Val -&gt; Either Error Val
...
eval (FunApp name xs) = buildinf name xs
</pre><br/>みたいな実装になる気がしたのですが(ビルトインをeval時に埋め込むなら)，Funはどういう感じの実装になるんでしょう？(ちょっと察しが悪くてすいません)</div></div><div class="message" id="message-1518663367.000139"><div class="message__timestamp">2018-02-15<br/>11:56:07 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">あー分かりました．ListがFunAppなんですね(Lisp脳じゃなかった)．evalのシステムはFunctorなくても実装できそうな気がするんですが，ValFに関して何かトラバースがしたい感じなんでしょうか？</div></div><div class="message" id="message-1518663785.000133"><div class="message__timestamp">2018-02-15<br/>12:03:05 +0900</div><div class="message__header">voqn.tyrant</div><div class="message__body">ValFに、「何も注釈つけてない版」でテストを書いて、AstからValFに変換する時にはシンボルの位置情報をつけたり、型推論の結果を注釈側に足したり、って言う風にしたかったんです。もちろん素朴にValの構造をコピペして <code>LocatedVal</code> とか <code>TypedVal</code> とかを作っても同様の事が出来はするんですが、ボイラープレートの山が出来るし…</div></div><div class="message" id="message-1518664011.000114"><div class="message__timestamp">2018-02-15<br/>12:06:51 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">印象としては，Func fというデータで関数fは注釈情報を受け取ることは想定してないように見えるんですが，想定してるんですかね？想定してるなら，確かにうまくなんとかしたい感じはあるんですが，想定してないなら<br/><pre>
  ...
  | Func ([Val] -&gt; Either Error Val)

apply (Func f) args = &lt;argsから注釈抜いて[Val]に変換したのを適用する&gt;
</pre><br/>みたいなんが正しそうな気がするんですよね</div></div><div class="message" id="message-1518664398.000014"><div class="message__timestamp">2018-02-15<br/>12:13:18 +0900</div><div class="message__header">voqn.tyrant</div><div class="message__body">!!</div></div><div class="message" id="message-1518664498.000109"><div class="message__timestamp">2018-02-15<br/>12:14:58 +0900</div><div class="message__header">voqn.tyrant</div><div class="message__body">ありがとうございます、確かにそうだった。後で試してみます</div></div><div class="message" id="message-1518664618.000112"><div class="message__timestamp">2018-02-15<br/>12:16:58 +0900</div><div class="message__header">voqn.tyrant</div><div class="message__body">ついでに、この手のテクニックって結構紹介されていて、　<https://stackoverflow.com/questions/38462563/how-to-work-with-ast-with-cofree-annotation><br/><br/>ekmett さんのライブラリでも Fix-Functor の組み合わせでTHのライブラリ作っていたりします<br/><a href='https://github.com/ekmett/recursion-schemes/pull/23'>https://github.com/ekmett/recursion-schemes/pull/23</a></div></div><div class="message" id="message-1518664859.000073"><div class="message__timestamp">2018-02-15<br/>12:20:59 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">ASTでcofree annotationを使ったことはあるんですが，実行時表現をそれで作るのはあまりやったことなかったです．<br/>(個人的にFixの辛いとこは，type synonymを使わなきゃいけないのも合わさって，型エラーがやばいことになるとこだと思ってるので，素直にannotation変数追加してDeriveFunctor使っちゃうことも多いです)</div></div><div class="message" id="message-1518665584.000122"><div class="message__timestamp">2018-02-15<br/>12:33:04 +0900</div><div class="message__header">voqn.tyrant</div><div class="message__body">たぶん実行時表現まで（本当はAstそのもの使いたい）そうしたがってしまうのはLispっ子ゆえの悪癖かもしれない…</div></div><div class="message" id="message-1519011331.000030"><div class="message__timestamp">2018-02-19<br/>12:35:31 +0900</div><div class="message__header">msakai</div><div class="message__body">3/19（月）にオープンハウスがありますので、興味のある方は是非〜<br/><a href='https://preferred-networks.connpass.com/event/79219/'>https://preferred-networks.connpass.com/event/79219/</a></div></div><div class="message" id="message-1519026160.000054"><div class="message__timestamp">2018-02-19<br/>16:42:40 +0900</div><div class="message__header">maru8m.jp</div><div class="message__body">@maru8m.jp has joined the channel</div></div><div class="message" id="message-1519027141.000214"><div class="message__timestamp">2018-02-19<br/>16:59:01 +0900</div><div class="message__header">kakkun61</div><div class="message__body">話がちょっとそれて、cofree が何か知らないんですが、この ↓ AST って cofree 使ってるんですかね<br/>この PDF 読みながら実装してるんですが <a href='http://www.cs.ru.nl/~W.Swierstra/Publications/DataTypesALaCarte.pdf'>http://www.cs.ru.nl/~W.Swierstra/Publications/DataTypesALaCarte.pdf</a><br/><a href='https://github.com/kakkun61/liquoh/blob/0eea3ea99e480f11e419febeac476fc3caa32d07/src/Text/Liquoh/Interpreter/Expression.hs'>https://github.com/kakkun61/liquoh/blob/0eea3ea99e480f11e419febeac476fc3caa32d07/src/Text/Liquoh/Interpreter/Expression.hs</a></div></div><div class="message" id="message-1519039514.000199"><div class="message__timestamp">2018-02-19<br/>20:25:14 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">@kakkun61 多分， <a href='#C8KBGEBR7'>code-review</a> の方がいいと思うので，そっち行きますね</div></div><div class="message" id="message-1519227767.000810"><div class="message__timestamp">2018-02-22<br/>00:42:47 +0900</div><div class="message__header">voqn.tyrant</div><div class="message__body">HPCでテストのカバレッジを取る時、deriving で導出した部分は（特にderiving (Eq, Show, Ord, Typeable) あたり）は除外したいって思ってしまうのですが、みなさんどうしてるんだろ</div></div><div class="message" id="message-1519390651.000303"><div class="message__timestamp">2018-02-23<br/>21:57:31 +0900</div><div class="message__header">gaminume_ts29</div><div class="message__body">@gaminume_ts29 has joined the channel</div></div><div class="message" id="message-1519561156.000006"><div class="message__timestamp">2018-02-25<br/>21:19:16 +0900</div><div class="message__header">quote.curly</div><div class="message__body">@quote.curly has joined the channel</div></div><div class="message" id="message-1519633041.000110"><div class="message__timestamp">2018-02-26<br/>17:17:21 +0900</div><div class="message__header">igrep</div><div class="message__body">なにがありましたっけ？「Haskell風の別の言語」というとPureScriptやElmが思い浮かびますが、それ以外があまり出てこない… Ivoryとか？ <a href='https://twitter.com/qnighy/status/967959302118895616?s=09'>https://twitter.com/qnighy/status/967959302118895616?s=09</a></div></div><div class="message" id="message-1519633609.000064"><div class="message__timestamp">2018-02-26<br/>17:26:49 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">Agda とか Idris とか？</div></div><div class="message" id="message-1519633681.000154"><div class="message__timestamp">2018-02-26<br/>17:28:01 +0900</div><div class="message__header">ncaq</div><div class="message__body">Fay, Haste, Royなどがありますが皆まだ生きてるのかは知らない…</div></div><div class="message" id="message-1519633742.000122"><div class="message__timestamp">2018-02-26<br/>17:29:02 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">Curry というのがあった<br/><a href='https://en.wikipedia.org/wiki/Curry_(programming_language)'>https://en.wikipedia.org/wiki/Curry_(programming_language)</a></div></div><div class="message" id="message-1519635239.000391"><div class="message__timestamp">2018-02-26<br/>17:53:59 +0900</div><div class="message__header">syocy</div><div class="message__body">定義によるが Haste は Haskell 風言語ではなく Haskell そのものと言えそう。</div></div><div class="message" id="message-1519637509.000379"><div class="message__timestamp">2018-02-26<br/>18:31:49 +0900</div><div class="message__header">voqn.tyrant</div><div class="message__body">haskell実装だとlunaとかも</div></div><div class="message" id="message-1519638672.000073"><div class="message__timestamp">2018-02-26<br/>18:51:12 +0900</div><div class="message__header">kakkun61</div><div class="message__body">JVM で動く Eta とか</div></div><div class="message" id="message-1519642184.000391"><div class="message__timestamp">2018-02-26<br/>19:49:44 +0900</div><div class="message__header">junji.hashimoto</div><div class="message__body">ml系</div></div><div class="message" id="message-1519643881.000275"><div class="message__timestamp">2018-02-26<br/>20:18:01 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">ML系とHaskell違くない？</div></div><div class="message" id="message-1519644552.000106"><div class="message__timestamp">2018-02-26<br/>20:29:12 +0900</div><div class="message__header">syocy</div><div class="message__body">JVM系で言うと、Eta は GHC を使ってるので Haskell そのものと十分言える。Frege は Haskell 2010 を参考にしている部分が多いが GHC を使っておらず Haskell 完全準拠ではないはずなので Haskell 系の別言語と言えそう。（このあたり @y_taka_23 さんが詳しいはず…）</div></div><div class="message" id="message-1519645917.000165"><div class="message__timestamp">2018-02-26<br/>20:51:57 +0900</div><div class="message__header">igrep</div><div class="message__body">ああ、すみません、熱に浮かされていたせいかいろいろど忘れしてました…:sweat_smile:</div></div><div class="message" id="message-1519647741.000338"><div class="message__timestamp">2018-02-26<br/>21:22:21 +0900</div><div class="message__header">y_taka_23</div><div class="message__body">@syocy Frege と Eta は Haskell と言ってしまってよいでしょう。両者とも Haskell 2010 準拠を謳って（少なくとも目指しては）います。Eta はさらに GHC7 相当の拡張を載せることで既存の Hackage ライブラリを再利用可能にしている、という点が Frege に対するアドバンテージです。C-FFI を使っているライブラリはそのままでは動かせないので、パッチを当てるための仕組みがあります。<br/><br/>コードベースに関して言うなら、Frege は GHC とは別系統です（そもそも当初は JVM 言語ですらなく v1 は Perl 実装だった）。Eta は GHC のフォークで、STG 生成までは GHC と同じコードを使います。ちなみにビルドツール Etlas も Cabal のフォークです。</div></div><div class="message" id="message-1519647784.000258"><div class="message__timestamp">2018-02-26<br/>21:23:04 +0900</div><div class="message__header">y_taka_23</div><div class="message__body">なんか早口のオタクみたいになってしまった。</div></div><div class="message" id="message-1519692370.000090"><div class="message__timestamp">2018-02-27<br/>09:46:10 +0900</div><div class="message__header">kakkun61</div><div class="message__body"><a href='http://slackarchive.io'>slackarchive.io</a> の収集がなんか止まってるように見えますね<br/><a href='https://haskell-jp.slackarchive.io'>https://haskell-jp.slackarchive.io</a></div></div><div class="message" id="message-1519716338.000201"><div class="message__timestamp">2018-02-27<br/>16:25:38 +0900</div><div class="message__header">maoe</div><div class="message__body">gtk2hsではなくてgi-gtkを使ったことがある人はいますか？gtk2hsはAPIに抜けがあったり公式に新しいアプリでは非推奨と書いてあるんですが、既存のアプリをポートする価値があるかなと検討してます。</div></div><div class="message" id="message-1519720430.000295"><div class="message__timestamp">2018-02-27<br/>17:33:50 +0900</div><div class="message__header">kameoka.ryota</div><div class="message__body">@kameoka.ryota has joined the channel</div></div><div class="message" id="message-1519722242.000325"><div class="message__timestamp">2018-02-27<br/>18:04:02 +0900</div><div class="message__header">shnarazk</div><div class="message__body">一度だけgtk2hsからgi-gtkに書き直したことがあります。<br/>cairo周りの変更への追従もあり、色々と修正が必要でしたが、使えない機能（ウィジェット）がないのはよいと思いました。</div></div><div class="message" id="message-1519723895.000125"><div class="message__timestamp">2018-02-27<br/>18:31:35 +0900</div><div class="message__header">maoe</div><div class="message__body">特にハマったところもない感じでしょうか。依存関係にxml-conduitが入っていて、conduit周りの依存を引っ張ってきてしまうのも気になるところです。</div></div><div class="message" id="message-1519726455.000317"><div class="message__timestamp">2018-02-27<br/>19:14:15 +0900</div><div class="message__header">shnarazk</div><div class="message__body">そうですねえ、まずサンプルプログラムで違いを理解してから移植に取り組んだのですが、それほど大きな違いはなかったと思います。依存パッケージは増えますが、新しいHeaderBarなどを使いたかったのでgtk-giにしました。しかしgtk2hsも開発続いていたんですね（今知りました）。</div></div><div class="message" id="message-1519730689.000410"><div class="message__timestamp">2018-02-27<br/>20:24:49 +0900</div><div class="message__header">thimura</div><div class="message__body">私も最近 gi-gtk に移行したのですが、ListStore まわりの移植でちょっとハマったくらいですかね (gi-gtk-hs を知らなかった)</div></div><div class="message" id="message-1519763746.000311"><div class="message__timestamp">2018-02-28<br/>05:35:46 +0900</div><div class="message__header">maoe</div><div class="message__body">gi-gtkにListStoreがあってgi-gtk-hsにはSeqStoreというgtk2hsのListStoreのコピーがあるんですね。どう違うのでしょうか。</div></div><div class="message" id="message-1519799513.000006"><div class="message__timestamp">2018-02-28<br/>15:31:53 +0900</div><div class="message__header">fumieval</div><div class="message__body">インスタンスのメソッドが未定義でも警告で済まされてしまうせいで二度も足止めを食らってしまった… :hole: <a href='https://hackage.haskell.org/package/exceptions-0.9.0/docs/Control-Monad-Catch.html#v:generalBracket'>https://hackage.haskell.org/package/exceptions-0.9.0/docs/Control-Monad-Catch.html#v:generalBracket</a></div></div><div class="message" id="message-1519809862.000390"><div class="message__timestamp">2018-02-28<br/>18:24:22 +0900</div><div class="message__header">thimura</div><div class="message__body">gi-gtk の ListStore は gobject-introspection そのままなので、格納する値は GValue にする必要がありますが、<br/>一方、gi-gtk-hs の SeqStore だと Haskell の任意の型を入れられるという感じですかね？</div></div><div class="message" id="message-1519822511.000076"><div class="message__timestamp">2018-02-28<br/>21:55:11 +0900</div><div class="message__header">maoe</div><div class="message__body">なるほど、ListStoreの方は使いにくそうですね</div></div><div class="message" id="message-1519829703.000554"><div class="message__timestamp">2018-02-28<br/>23:55:03 +0900</div><div class="message__header">msakai</div><div class="message__body">知らなかった……<br/><a href='https://twitter.com/masahiro_sakai/status/968861617038360576'>https://twitter.com/masahiro_sakai/status/968861617038360576</a></div></div><div class="message" id="message-1519866293.000121"><div class="message__timestamp">2018-03-01<br/>10:04:53 +0900</div><div class="message__header">igrep</div><div class="message__body">気が向いたらでいいのでTwitterで突っついといて頂けると助かります:pray:</div></div><div class="message" id="message-1519866689.000246"><div class="message__timestamp">2018-03-01<br/>10:11:29 +0900</div><div class="message__header">igrep</div><div class="message__body">今できることはそれぐらいしかないので…<br/>取り急ぎ私からも再度お願いしました <br/><a href='https://twitter.com/igrep/status/969016207432040449?s=19'>https://twitter.com/igrep/status/969016207432040449?s=19</a></div></div></div><div class="pager"><a href="../../html/C4M4TT8JJ/10.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a><a href="../../html/C4M4TT8JJ/12.html" class="pager__next">Next</a></div></body></html>