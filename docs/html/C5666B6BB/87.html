<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #87</title><link rel="stylesheet" href="../../main.css" type="text/css" media="screen"></head><body><div class="ui container"><h1>haskell-jp / questions #87</h1><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/86.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div><div class="message_list ui feed"><div class="message event" id="message-1592620487.062600"><div class="content"><div class="summary"><div class="message__header user">cj.bc-sd</div><div class="message__timestamp date"><a class="date" href="#message-1592620487.062600">2020-06-20&nbsp;11:34:47 +0900</a></div></div><div class="message__body description">返信遅くなりましたがうまく行きました！！！<br/>ありがとうございます！！<br/>Lensはoverやsetやviewと使うものだという固定概念がありました…今度からもっと型を注意してみるようにしてみます<br/><br/><pre>Prelude Control.Lens&gt; _2 (\a -&gt; print ("PRINTED: " ++ show a) &gt;&gt; return (Just "a")) (("hoge",6), 1.20)
"PRINTED: 1.2"
(("hoge",6),Just "a")
Prelude Control.Lens&gt; (_1 . _2) (\a -&gt; print ("PRINTED: " ++ show a) &gt;&gt; return (Just "a")) (("hoge",6), 1.20)
"PRINTED: 6"
(("hoge",Just "a"),1.2)</pre><br/>そうなんですねwすごい偶然</div></div></div><div class="message event" id="message-1592726883.064100"><div class="content"><div class="summary"><div class="message__header user">dex10619</div><div class="message__timestamp date"><a class="date" href="#message-1592726883.064100">2020-06-21&nbsp;17:08:03 +0900</a></div></div><div class="message__body description">初歩的な質問ですが、お尋ねさせてください。<br/>仮定として、Main.hsに以下のような相対パス指定のファイル読み込みのコードが書かれているとします。<br/><br/><pre>readFile "../hoge.txt" --1つ上の階層のパスからファイルを読み込み</pre><br/>この時、current working directoryに依存せずに、「Main.hsファイルを起点とした相対パス指定」でファイルを読み込みたいです。<br/>（「stack exec XXX-exe」でプロセスを起動すると、current working directory起点とした相対パス指定になるため、場合によりうまく動かないです。）<br/><br/>上記のやりたいことを実現するための、お決まりのパターンとかってありますか？<br/>getCurrentDirectoryだと、簡単には行かなそうです。</div></div></div><div class="message event" id="message-1592729423.064300"><div class="content"><div class="summary"><div class="message__header user">matonix</div><div class="message__timestamp date"><a class="date" href="#message-1592729423.064300">2020-06-21&nbsp;17:50:23 +0900</a></div></div><div class="message__body description">私が同じような問題に当たっときは「コンパイル時に相対パス指定したファイルを埋め込む」という方法を取りました。<br/>以下のパッケージがそのような手段を提供しています。<br/><a href='https://hackage.haskell.org/package/file-embed-0.0.12.0'>https://hackage.haskell.org/package/file-embed-0.0.12.0</a><br/>他の方法をご存じの方がいらっしゃいましたらよろしくお願いします（私も気になってます…）</div></div></div><div class="message event" id="message-1592730211.064700"><div class="content"><div class="summary"><div class="message__header user">dex10619</div><div class="message__timestamp date"><a class="date" href="#message-1592730211.064700">2020-06-21&nbsp;18:03:31 +0900</a></div></div><div class="message__body description">@matonix<br/>回答ありがとうございます。上記の方法はなかなかテクニカルですね。。<br/>意外と手軽にできる方法はなかったりするのですかね:cry:</div></div></div><div class="message event" id="message-1592730946.064900"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1592730946.064900">2020-06-21&nbsp;18:15:46 +0900</a></div></div><div class="message__body description">コンパイル時のことって基本的に忘れられてしまうので難しいですね。<br/>イマイチ目的が想像できませんが、プロジェクトルートからの相対パスか、 <a href='https://www.haskell.org/cabal/users-guide/developing-packages.html?highlight=paths_#accessing-data-files-from-package-code'>https://www.haskell.org/cabal/users-guide/developing-packages.html?highlight=paths_#accessing-data-files-from-package-code</a> などに書かれている <code>Paths_pkgname</code> を使った方が賢明かと思います。<br/>それでもコンパイルされる <code>Main.hs</code> の場所が欲しい、ということであれば、Template Haskellの <code>location</code> が使えるかな、と思ったけどこれはフルパスはとれないっぽいな<br/><a href='http://hackage.haskell.org/package/template-haskell-2.16.0.0/docs/Language-Haskell-TH-Syntax.html#v:location'>http://hackage.haskell.org/package/template-haskell-2.16.0.0/docs/Language-Haskell-TH-Syntax.html#v:location</a></div></div></div><div class="message event" id="message-1592732425.067800"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date"><a class="date" href="#message-1592732425.067800">2020-06-21&nbsp;18:40:25 +0900</a></div></div><div class="message__body description">自分も <code>Paths_pkgname</code> が正攻法に思います</div></div></div><div class="message event" id="message-1592732460.068500"><div class="content"><div class="summary"><div class="message__header user">maoe</div><div class="message__timestamp date"><a class="date" href="#message-1592732460.068500">2020-06-21&nbsp;18:41:00 +0900</a></div></div><div class="message__body description">コンパイル時に指定したパスが実行時にも存在することが保証されている前提ならCPPを有効にして <code>__FILE__</code> マクロを使う手もあります。</div></div></div><div class="message event" id="message-1592733614.068800"><div class="content"><div class="summary"><div class="message__header user">dex10619</div><div class="message__timestamp date"><a class="date" href="#message-1592733614.068800">2020-06-21&nbsp;19:00:14 +0900</a></div></div><div class="message__body description">@igrep @kakkun61 @maoe<br/>なるほど、ありがとうございます！<br/>確かに<br/><br/><blockquote>コンパイル時のことって基本的に忘れられてしまうので難しいですね。</blockquote>これが真理な気がしてきました。。</div></div></div><div class="message event" id="message-1592734058.069000"><div class="content"><div class="summary"><div class="message__header user">dex10619</div><div class="message__timestamp date"><a class="date" href="#message-1592734058.069000">2020-06-21&nbsp;19:07:38 +0900</a></div></div><div class="message__body description">基本的にstackを利用してprojectを作成する際は、実行体である.exeファイルはstackのサンドボックス内に作られるので、プロセスの起動もサンドボックス内の特定のディレクトリで行う、という形をとるのが素直な気がしてきました:bow:</div></div></div><div class="message event" id="message-1593074145.069800"><div class="content"><div class="summary"><div class="message__header user">U016QSXFF96</div><div class="message__timestamp date"><a class="date" href="#message-1593074145.069800">2020-06-25&nbsp;17:35:45 +0900</a></div></div><div class="message__body description">@U016QSXFF96 has joined the channel</div></div></div></div><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/86.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div></div></body></html>