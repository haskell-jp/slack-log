<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #85</title><link rel="stylesheet" href="../../main.css" type="text/css" media="screen"></head><body><div class="ui container"><h1>haskell-jp / questions #85</h1><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/84.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div><div class="message_list ui feed"><div class="message event" id="message-1589264392.131800"><div class="content"><div class="summary"><div class="message__header user">gettaplacetogo</div><div class="message__timestamp date"><a class="date" href="#message-1589264392.131800">2020-05-12&nbsp;15:19:52 +0900</a></div></div><div class="message__body description">(GHCはcabalではないので、 <code>cabal.project</code> や <code>vector.cabal</code> を読まないのは当たり前っちゃあ当たり前で、問題はprecompiled packageがGHCからvisibleでないことだけなのですが)</div></div></div><div class="message event" id="message-1589267238.132300"><div class="content"><div class="summary"><div class="message__header user">a3.works</div><div class="message__timestamp date"><a class="date" href="#message-1589267238.132300">2020-05-12&nbsp;16:07:18 +0900</a></div></div><div class="message__body description">@a3.works has joined the channel</div></div></div><div class="message event" id="message-1589296218.132800"><div class="content"><div class="summary"><div class="message__header user">gettaplacetogo</div><div class="message__timestamp date"><a class="date" href="#message-1589296218.132800">2020-05-13&nbsp;00:10:18 +0900</a></div></div><div class="message__body description"><code>stack build</code> -&gt; <code>stack ghc</code> でとりあえずうまくいきました！ ただ， <code>vector</code> は project root 直下に <code>&lt;projectroot&gt;/src/Data/Vector</code> とあるのではなく <code>&lt;projectroot&gt;/Data/Vector</code> とあるので，project rootでコンパイルしようとすると <code>cabal</code> でも <code>stack</code> でも失敗するのは盲点でした (これを改善しても <code>cabal</code> だと失敗するのですが・・・．)</div></div></div><div class="message event" id="message-1589336050.133300"><div class="content"><div class="summary"><div class="message__header user">akt.hrms</div><div class="message__timestamp date"><a class="date" href="#message-1589336050.133300">2020-05-13&nbsp;11:14:10 +0900</a></div></div><div class="message__body description">@akt.hrms has joined the channel</div></div></div><div class="message event" id="message-1589345019.133500"><div class="content"><div class="summary"><div class="message__header user">ncaq</div><div class="message__timestamp date"><a class="date" href="#message-1589345019.133500">2020-05-13&nbsp;13:43:39 +0900</a></div></div><div class="message__body description">REPLと本番コードで有効な言語拡張が一致していないとか?</div></div></div><div class="message event" id="message-1589349600.133700"><div class="content"><div class="summary"><div class="message__header user">cutsea110</div><div class="message__timestamp date"><a class="date" href="#message-1589349600.133700">2020-05-13&nbsp;15:00:00 +0900</a></div></div><div class="message__body description">それはありそうだと思ってググったりもしたのですが、ghciから今有効になっている言語拡張のリストとか出せますかね。</div></div></div><div class="message event" id="message-1589349674.133900"><div class="content"><div class="summary"><div class="message__header user">ncaq</div><div class="message__timestamp date"><a class="date" href="#message-1589349674.133900">2020-05-13&nbsp;15:01:14 +0900</a></div></div><div class="message__body description"><code>:show language</code> で出せるはずです</div></div></div><div class="message event" id="message-1589349845.134100"><div class="content"><div class="summary"><div class="message__header user">cutsea110</div><div class="message__timestamp date"><a class="date" href="#message-1589349845.134100">2020-05-13&nbsp;15:04:05 +0900</a></div></div><div class="message__body description">おお、出ました。ありがとうございます。</div></div></div><div class="message event" id="message-1589349867.134300"><div class="content"><div class="summary"><div class="message__header user">cutsea110</div><div class="message__timestamp date"><a class="date" href="#message-1589349867.134300">2020-05-13&nbsp;15:04:27 +0900</a></div></div><div class="message__body description"><code>:set</code>でも出る感じ。</div></div></div><div class="message event" id="message-1589349931.134500"><div class="content"><div class="summary"><div class="message__header user">ncaq</div><div class="message__timestamp date"><a class="date" href="#message-1589349931.134500">2020-05-13&nbsp;15:05:31 +0900</a></div></div><div class="message__body description">あと思いつく原因としてはexportの範囲の違いが考えられますね どうもghciはpackageがexportしてなかったりimportしてない型も構わず出すようですけど, それを指定すると当然エラーになります</div></div></div><div class="message event" id="message-1589350095.134700"><div class="content"><div class="summary"><div class="message__header user">cutsea110</div><div class="message__timestamp date"><a class="date" href="#message-1589350095.134700">2020-05-13&nbsp;15:08:15 +0900</a></div></div><div class="message__body description">プログラムに付与したプラグマと合わせたけど変わらん。</div></div></div><div class="message event" id="message-1589353829.140500"><div class="content"><div class="summary"><div class="message__header user">gettaplacetogo</div><div class="message__timestamp date"><a class="date" href="#message-1589353829.140500">2020-05-13&nbsp;16:10:29 +0900</a></div></div><div class="message__body description"><code>gitrev</code> パッケージって誰か使ったことのある方いらっしゃいます? Template Haskell 使って実行バイナリの中に Git revision hashを書き込んでくれる可愛いパッケージで、Option parser library (`&lt;project root&gt;/src/TheApplicationProject/OptionParser.hs` みたいなファイル)で <code>--version</code> の実装に使っています。ですが、 <code>&lt;project root&gt;</code> で <code>git checkout</code> して <code>stack build</code> しても <code>stack exec executable -- --version</code> の Git revision hashが更新されないことが多数で、いちいち <code>stack clean</code> しないといけなくて困っています。`gitrev` の実装では <code>addDependentFile</code> を <code>.git/HEAD</code> やらに対してちゃんと実行しているように見えるので、行き詰まってしまっているのですが、どなたかお心当たりのある方いらっしゃいます?</div></div></div><div class="message event" id="message-1589354479.144900"><div class="content"><div class="summary"><div class="message__header user">wado</div><div class="message__timestamp date"><a class="date" href="#message-1589354479.144900">2020-05-13&nbsp;16:21:19 +0900</a></div></div><div class="message__body description">gitrev はメンテされていないので githash の方が良いかも？<br/><a href='https://github.com/snoyberg/githash'>https://github.com/snoyberg/githash</a></div></div></div><div class="message event" id="message-1589355093.145300"><div class="content"><div class="summary"><div class="message__header user">cutsea110</div><div class="message__timestamp date"><a class="date" href="#message-1589355093.145300">2020-05-13&nbsp;16:31:33 +0900</a></div></div><div class="message__body description">自己解決しました。<br/><a href='https://wiki.haskell.org/GHC/Type_families'>https://wiki.haskell.org/GHC/Type_families</a><br/>この What is the problem? にある<br/><pre>GHC will happily infer the type g :: F a -&gt; F a. But you can't write that type signature or, indeed, the more specific one above. (Arguably this behaviour, where GHC infers a type it can't check, is very confusing. I suppose we could make GHC reject both programs, with and without type signatures.)</pre><br/>でした。<br/>そうか、GHC will infer the type, But You can't that type.<br/>確かに very confusing だった。 :bomb:</div></div></div><div class="message event" id="message-1589360668.152400"><div class="content"><div class="summary"><div class="message__header user">gettaplacetogo</div><div class="message__timestamp date"><a class="date" href="#message-1589360668.152400">2020-05-13&nbsp;18:04:28 +0900</a></div></div><div class="message__body description">ありがとうございます。しかし、この問題は <code>gitrev</code> 及び <code>githash</code> 共通の問題であることが発覚しました。 <code>.git/HEAD</code> が コミットハッシュである際には <code>addDependentFile ".git/HEAD"</code> されますが、 <code>.git/HEAD</code> が <code>ref: branch</code> の際には <code>addDependentFile "branch"</code> のみが呼ばれ、 <code>addDependentFile ".git/HEAD"</code> は呼ばれないため、 <code>git checkout</code> では recompileはtriggerされない、という問題のようです。</div></div></div><div class="message event" id="message-1589360841.154300"><div class="content"><div class="summary"><div class="message__header user">gettaplacetogo</div><div class="message__timestamp date"><a class="date" href="#message-1589360841.154300">2020-05-13&nbsp;18:07:21 +0900</a></div></div><div class="message__body description">どっちも「現在のブランチを取得する」関数持ってるので明確にバグですね・・・。</div></div></div><div class="message event" id="message-1589360964.155200"><div class="content"><div class="summary"><div class="message__header user">gettaplacetogo</div><div class="message__timestamp date"><a class="date" href="#message-1589360964.155200">2020-05-13&nbsp;18:09:24 +0900</a></div></div><div class="message__body description">あとで適当にプルリク投げようと思います。お騒がせしました。</div></div></div><div class="message event" id="message-1589375299.159000"><div class="content"><div class="summary"><div class="message__header user">gettaplacetogo</div><div class="message__timestamp date"><a class="date" href="#message-1589375299.159000">2020-05-13&nbsp;22:08:19 +0900</a></div></div><div class="message__body description"> この件ですが、 そもそも <code>.git/HEAD</code> が <code>ref: branch\n</code> であるところを <code>drop 5</code> してブランチファイルを <code>branch\n</code> として検索した結果「ブランチファイルが存在してない扱いになる」ことが判明しました。面白かったのでお知らせします。</div></div></div><div class="message event" id="message-1589491465.159400"><div class="content"><div class="summary"><div class="message__header user">kanshu.yokoo</div><div class="message__timestamp date"><a class="date" href="#message-1589491465.159400">2020-05-15&nbsp;06:24:25 +0900</a></div></div><div class="message__body description">@kanshu.yokoo has joined the channel</div></div></div><div class="message event" id="message-1589619346.159700"><div class="content"><div class="summary"><div class="message__header user">kawai.natsuo</div><div class="message__timestamp date"><a class="date" href="#message-1589619346.159700">2020-05-16&nbsp;17:55:46 +0900</a></div></div><div class="message__body description">@kawai.natsuo has joined the channel</div></div></div><div class="message event" id="message-1589722941.170400"><div class="content"><div class="summary"><div class="message__header user">na4zagin3</div><div class="message__timestamp date"><a class="date" href="#message-1589722941.170400">2020-05-17&nbsp;22:42:21 +0900</a></div></div><div class="message__body description">haskell-gi における、GObject Introspection の Haskellの命名規則に反する識別子名の取扱について他の方の意見が聞きたいので、質問します。<br/>現状では、小文字始まりの識別子は先頭大文字化、その他はそのまま（例：`ABC` → <code>ABC</code>、`channelName` → <code>ChannelName</code>）なのですが、<br/>これでは数字始まりの識別子名が扱えない為に、<https://github.com/haskell-gi/haskell-gi/issues/292> にて、そのような定数名tk先頭が大文字ならそのまま、そうでなければ <code>Const'</code> を接頭（例：`ABC` → <code>ABC</code>、`channelName` → <code>Const'channelName</code>、`3270_Attn` → <code>Const'3270_Attn</code> ）しようという話になっています。<br/>恐らく GObject の識別子名には <code>'</code> は用いることができないものと思われる（C言語において識別子名に <code>'</code> は用いることができない故 <a href='https://twitter.com/na4zagin3/status/1262012340339265536'>https://twitter.com/na4zagin3/status/1262012340339265536</a>）ので、この方針は機能するものと思います。<br/>しかしながら、小文字始まりの定数名にも <code>Const'</code> が着くのは若干気持ち悪さがあったりしますし、他の方法等思いつく方等いらっしゃいますか？</div></div></div><div class="message event" id="message-1589761621.170800"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1589761621.170800">2020-05-18&nbsp;09:27:01 +0900</a></div></div><div class="message__body description">完全に決めの問題なんで好みが大きいとは思いますが、厳密に名前の衝突を避ける必要があるなら Const' はよい案ではないでしょうか。<br/>個人的にはさすがにそこまでしなくとも <code>C'</code> でよくない？という気はします。<br/>いずれにしても、慣習として関わる人が納得できるものであればなんでもよいかと</div></div></div><div class="message event" id="message-1589770742.178400"><div class="content"><div class="summary"><div class="message__header user">gettaplacetogo</div><div class="message__timestamp date"><a class="date" href="#message-1589770742.178400">2020-05-18&nbsp;11:59:02 +0900</a></div></div><div class="message__body description">Template haskellの再コンパイル時のdirtiness checkについて質問があって、 <code>addDependentFile</code> でディレクトリでない存在するファイルの変更・削除の追跡ができるのはわかるのですが、ディレクトリに対するファイルの削除・追加とか、ファイルの新規作成の追跡ってできないものでしょうか・・・。この前お聞きした <code>githash</code> だの <code>gitrev</code> だのにpull requestを書きたいのですが、Gitブランチの参照先の変化がファイルの新規作成によって起こる可能性があって、困り果てています。 <a href='https://haskell-jp.slack.com/archives/C5666B6BB/p1589353829140500'>https://haskell-jp.slack.com/archives/C5666B6BB/p1589353829140500</a></div></div></div><div class="message event" id="message-1589804092.181600"><div class="content"><div class="summary"><div class="message__header user">na4zagin3</div><div class="message__timestamp date"><a class="date" href="#message-1589804092.181600">2020-05-18&nbsp;21:14:52 +0900</a></div></div><div class="message__body description">ありがとうございます！　私も <code>C'</code> で良いと思いますし、実質的に IBus バウンディングにしか影響が無いようなので、 <code>C'</code>にしてもらいました</div></div></div><div class="message event" id="message-1589848262.182100"><div class="content"><div class="summary"><div class="message__header user">nemoto1257</div><div class="message__timestamp date"><a class="date" href="#message-1589848262.182100">2020-05-19&nbsp;09:31:02 +0900</a></div></div><div class="message__body description">@nemoto1257 has joined the channel</div></div></div><div class="message event" id="message-1590111595.182500"><div class="content"><div class="summary"><div class="message__header user">setonaidl</div><div class="message__timestamp date"><a class="date" href="#message-1590111595.182500">2020-05-22&nbsp;10:39:55 +0900</a></div></div><div class="message__body description">@setonaidl has joined the channel</div></div></div><div class="message event" id="message-1590148448.182800"><div class="content"><div class="summary"><div class="message__header user">murata.muu</div><div class="message__timestamp date"><a class="date" href="#message-1590148448.182800">2020-05-22&nbsp;20:54:08 +0900</a></div></div><div class="message__body description">@murata.muu has joined the channel</div></div></div><div class="message event" id="message-1590323492.191500"><div class="content"><div class="summary"><div class="message__header user">t-mishima</div><div class="message__timestamp date"><a class="date" href="#message-1590323492.191500">2020-05-24&nbsp;21:31:32 +0900</a></div></div><div class="message__body description">すみません、ちょっと詰まってしまったので質問させてください。<br/>FreeBSD(12.1)上でncursesパッケージをビルドすると以下のようなエラーメッセージが出ます。<br/><https://hackage.haskell.org/package/ncurses><br/>(Ver 0.2.16)<br/>&gt; &gt;&gt; cabal build<br/>(略)<br/>[4 of 5] Compiling UI.NCurses       ( dist/build/UI/NCurses.hs, dist/build/UI/NCurses.o )<br/>&gt; lib/UI/NCurses.chs:442:27: error:<br/>&gt;     * Couldn't match type `CWchar' with `CInt'<br/>&gt;       Expected type: CWString -&gt; IO CInt<br/>&gt;         Actual type: Ptr CInt -&gt; IO CInt<br/>&gt;     * In the second argument of `withCWString', namely `(waddwstr win)'<br/>&gt;       In the expression: withCWString str (waddwstr win)<br/>&gt;       In the second argument of `($)', namely<br/>&gt;         `\ win -&gt; withCWString str (waddwstr win)'<br/>&gt;     |<br/>&gt; 442 |         withCWString str ({# call waddwstr #} win)<br/>&gt;     |                           ^^^^^^^^^^^^<br/>&gt; <br/>&gt; lib/UI/NCurses.chs:447:38: error:<br/>&gt;     * Couldn't match type `CWchar' with `CInt'<br/>&gt;       Expected type: CWString -&gt; IO CInt<br/>&gt;         Actual type: Ptr CInt -&gt; IO CInt<br/>&gt;     * In the second argument of `withCWString', namely `(waddwstr win)'<br/>&gt;       In the expression: withCWString (T.unpack txt) (waddwstr win)<br/>&gt;       In the second argument of `($)', namely<br/>&gt;         `\ win -&gt; withCWString (T.unpack txt) (waddwstr win)'<br/>&gt;     |<br/>&gt; 447 |         withCWString (T.unpack txt) ({# call waddwstr #} win)<br/>&gt;     |                                      ^^^^^^^^^^^^<br/>&gt; <br/>&gt; lib/UI/NCurses.chs:725:53: error:<br/>&gt;     * Couldn't match type `CWchar' with `CInt'<br/>&gt;       Expected type: Ptr CInt<br/>&gt;         Actual type: Ptr CWchar<br/>&gt;     * In the third argument of `hsncurses_init_cchar_t', namely<br/>&gt;         `cChars'<br/>&gt;       In a stmt of a 'do' block:<br/>&gt;         hsncurses_init_cchar_t<br/>&gt;           (CCharT pBuf) cAttrs cChars (fromIntegral cCharsLen)<br/>&gt;       In the expression:<br/>&gt;         do hsncurses_init_cchar_t<br/>&gt;              (CCharT pBuf) cAttrs cChars (fromIntegral cCharsLen)<br/>&gt;            io (CCharT pBuf)<br/>&gt;     |<br/>&gt; 725 |         {# call hsncurses_init_cchar_t #} (CCharT pBuf) cAttrs cChars (fromIntegral cCharsLen)<br/>&gt;     |<br/>エラーメッセージにあるとおり、引数の型が合わないことが原因のようです。<br/>FFIで呼び出すC言語の関数waddwstrはヘッダファイル(ncurses.h)では<br/>extern NCURSES_EXPORT(int) waddwstr(WINDOW *,const wchar_t *);のように宣言されています。<br/>しかし、c2hsでNCurses.chsがNCurses.hsファイルに展開されると<br/>foreign import ccall safe "UI/NCurses.chs.h waddwstr"<br/>  waddwstr :: ((Window) -&gt; ((C2HSImp.Ptr C2HSImp.CInt) -&gt; (IO C2HSImp.CInt)))<br/>となってしまいます。<br/><br/>どのあたりを確認すべきか、何かアドバイスがありましたら宜しくお願いします</div></div></div><div class="message event" id="message-1590364248.192900"><div class="content"><div class="summary"><div class="message__header user">k.kent8192</div><div class="message__timestamp date"><a class="date" href="#message-1590364248.192900">2020-05-25&nbsp;08:50:48 +0900</a></div></div><div class="message__body description">Haskell入門するためにhaskell-ide-engineをVSCodeでやろうと思って公式のインストールをやったのですが、正しくインストールできているかわかりません。確認する方法はありますか？</div></div></div></div><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/84.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div></div></body></html>