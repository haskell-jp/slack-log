<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / code-review #2</title><link rel="stylesheet" href="../../main.css" type="text/css" media="screen"></head><body><div class="ui container"><h1>haskell-jp / code-review #2</h1><div class="pager ui pagination menu"><a href="../../html/C8KBGEBR7/1.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a><a href="../../html/C8KBGEBR7/3.html" class="pager__next item">Next</a></div><div class="message_list ui feed"><div class="message event" id="message-1514532873.000055"><div class="content"><div class="summary"><div class="message__header user">highmt</div><div class="message__timestamp date">2017-12-29&nbsp;16:34:33 +0900</div></div><div class="message__body description">@highmt has joined the channel</div></div></div><div class="message event" id="message-1514546046.000131"><div class="content"><div class="summary"><div class="message__header user">iruyan_zak</div><div class="message__timestamp date">2017-12-29&nbsp;20:14:06 +0900</div></div><div class="message__body description">@iruyan_zak has joined the channel</div></div></div><div class="message event" id="message-1514602199.000054"><div class="content"><div class="summary"><div class="message__header user">cdepillabout</div><div class="message__timestamp date">2017-12-30&nbsp;11:49:59 +0900</div></div><div class="message__body description">@cdepillabout has joined the channel</div></div></div><div class="message event" id="message-1514792176.000008"><div class="content"><div class="summary"><div class="message__header user">krdlab</div><div class="message__timestamp date">2018-01-01&nbsp;16:36:16 +0900</div></div><div class="message__body description">@krdlab has joined the channel</div></div></div><div class="message event" id="message-1514912836.000313"><div class="content"><div class="summary"><div class="message__header user">siosio</div><div class="message__timestamp date">2018-01-03&nbsp;02:07:16 +0900</div></div><div class="message__body description">@siosio has joined the channel</div></div></div><div class="message event" id="message-1514967806.000019"><div class="content"><div class="summary"><div class="message__header user">fujiyan18</div><div class="message__timestamp date">2018-01-03&nbsp;17:23:26 +0900</div></div><div class="message__body description">@fujiyan18 has joined the channel</div></div></div><div class="message event" id="message-1515072380.000033"><div class="content"><div class="summary"><div class="message__header user">maru10tgg</div><div class="message__timestamp date">2018-01-04&nbsp;22:26:20 +0900</div></div><div class="message__body description">@maru10tgg has joined the channel</div></div></div><div class="message event" id="message-1515337272.000069"><div class="content"><div class="summary"><div class="message__header user">hrkr</div><div class="message__timestamp date">2018-01-08&nbsp;00:01:12 +0900</div></div><div class="message__body description">@hrkr has joined the channel</div></div></div><div class="message event" id="message-1515413697.000236"><div class="content"><div class="summary"><div class="message__header user">wat-aro</div><div class="message__timestamp date">2018-01-08&nbsp;21:14:57 +0900</div></div><div class="message__body description">@wat-aro has joined the channel</div></div></div><div class="message event" id="message-1515478518.000264"><div class="content"><div class="summary"><div class="message__header user">n4to4k</div><div class="message__timestamp date">2018-01-09&nbsp;15:15:18 +0900</div></div><div class="message__body description">@n4to4k has joined the channel</div></div></div><div class="message event" id="message-1515485894.000101"><div class="content"><div class="summary"><div class="message__header user">yoshikunijujo</div><div class="message__timestamp date">2018-01-09&nbsp;17:18:14 +0900</div></div><div class="message__body description">@yoshikunijujo has joined the channel</div></div></div><div class="message event" id="message-1516066480.000103"><div class="content"><div class="summary"><div class="message__header user">falsandtru</div><div class="message__timestamp date">2018-01-16&nbsp;10:34:40 +0900</div></div><div class="message__body description">@falsandtru has joined the channel</div></div></div><div class="message event" id="message-1516066970.000182"><div class="content"><div class="summary"><div class="message__header user">hiratara</div><div class="message__timestamp date">2018-01-16&nbsp;10:42:50 +0900</div></div><div class="message__body description">@hiratara has joined the channel</div></div></div><div class="message event" id="message-1516342727.000080"><div class="content"><div class="summary"><div class="message__header user">tomohiko.okazaki</div><div class="message__timestamp date">2018-01-19&nbsp;15:18:47 +0900</div></div><div class="message__body description">@tomohiko.okazaki has joined the channel</div></div></div><div class="message event" id="message-1516599341.000093"><div class="content"><div class="summary"><div class="message__header user">masakolee</div><div class="message__timestamp date">2018-01-22&nbsp;14:35:41 +0900</div></div><div class="message__body description">@masakolee has joined the channel</div></div></div><div class="message event" id="message-1516877539.000358"><div class="content"><div class="summary"><div class="message__header user">yokomotod</div><div class="message__timestamp date">2018-01-25&nbsp;19:52:19 +0900</div></div><div class="message__body description">@yokomotod has joined the channel</div></div></div><div class="message event" id="message-1517175500.000077"><div class="content"><div class="summary"><div class="message__header user">tukejonny</div><div class="message__timestamp date">2018-01-29&nbsp;06:38:20 +0900</div></div><div class="message__body description">@tukejonny has joined the channel</div></div></div><div class="message event" id="message-1517243690.000318"><div class="content"><div class="summary"><div class="message__header user">ice08235523</div><div class="message__timestamp date">2018-01-30&nbsp;01:34:50 +0900</div></div><div class="message__body description">@ice08235523 has joined the channel</div></div></div><div class="message event" id="message-1517280334.000039"><div class="content"><div class="summary"><div class="message__header user">h_hosokawa</div><div class="message__timestamp date">2018-01-30&nbsp;11:45:34 +0900</div></div><div class="message__body description">@h_hosokawa has joined the channel</div></div></div><div class="message event" id="message-1517378641.000047"><div class="content"><div class="summary"><div class="message__header user">nobuteru.kawano</div><div class="message__timestamp date">2018-01-31&nbsp;15:04:01 +0900</div></div><div class="message__body description">@nobuteru.kawano has joined the channel</div></div></div><div class="message event" id="message-1517459360.000007"><div class="content"><div class="summary"><div class="message__header user">h_hosokawa</div><div class="message__timestamp date">2018-02-01&nbsp;13:29:20 +0900</div></div><div class="message__body description">@h_hosokawa has left the channel</div></div></div><div class="message event" id="message-1518479890.000198"><div class="content"><div class="summary"><div class="message__header user">voqn.tyrant</div><div class="message__timestamp date">2018-02-13&nbsp;08:58:10 +0900</div></div><div class="message__body description">@voqn.tyrant has joined the channel</div></div></div><div class="message event" id="message-1518486717.000131"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date">2018-02-13&nbsp;10:51:57 +0900</div></div><div class="message__body description">@kakkun61 has joined the channel</div></div></div><div class="message event" id="message-1518506969.000069"><div class="content"><div class="summary"><div class="message__header user">fujimura</div><div class="message__timestamp date">2018-02-13&nbsp;16:29:29 +0900</div></div><div class="message__body description">@fujimura has joined the channel</div></div></div><div class="message event" id="message-1518581958.000081"><div class="content"><div class="summary"><div class="message__header user">voqn.tyrant</div><div class="message__timestamp date">2018-02-14&nbsp;13:19:18 +0900</div></div><div class="message__body description">コード晒してよかですか</div></div></div><div class="message event" id="message-1518582062.000064"><div class="content"><div class="summary"><div class="message__header user">voqn.tyrant</div><div class="message__timestamp date">2018-02-14&nbsp;13:21:02 +0900</div></div><div class="message__body description"><a href='https://github.com/VoQn/cacco/blob/master/src/Cacco/Lexer.hs'>https://github.com/VoQn/cacco/blob/master/src/Cacco/Lexer.hs</a><br/>趣味で言語作ってるんだけど、「not haskeller の人が見ても分かるように」っていう意識で書いている</div></div></div><div class="message event" id="message-1518582116.000180"><div class="content"><div class="summary"><div class="message__header user">voqn.tyrant</div><div class="message__timestamp date">2018-02-14&nbsp;13:21:56 +0900</div></div><div class="message__body description">（ウォッチャーがLisperとOcamlerだからっていう理由で）</div></div></div><div class="message event" id="message-1518582411.000119"><div class="content"><div class="summary"><div class="message__header user">matsubara0507</div><div class="message__timestamp date">2018-02-14&nbsp;13:26:51 +0900</div></div><div class="message__body description">こういうの便利そう<br/><a href='https://github.com/VoQn/cacco/blob/master/doc/basics.asciidoc#strict-type-literals'>https://github.com/VoQn/cacco/blob/master/doc/basics.asciidoc#strict-type-literals</a></div></div></div><div class="message event" id="message-1518584596.000224"><div class="content"><div class="summary"><div class="message__header user">voqn.tyrant</div><div class="message__timestamp date">2018-02-14&nbsp;14:03:16 +0900</div></div><div class="message__body description">モチベの拠り所がユーザーフレンドリーなリテラル持ってる言語を、っていう感じなので</div></div></div><div class="message event" id="message-1518587787.000028"><div class="content"><div class="summary"><div class="message__header user">voqn.tyrant</div><div class="message__timestamp date">2018-02-14&nbsp;14:56:27 +0900</div></div><div class="message__body description"><a href='https://github.com/VoQn/cacco/commit/0cb416ca3ea05fe8f8ef746908d61d8f35c059a3'>https://github.com/VoQn/cacco/commit/0cb416ca3ea05fe8f8ef746908d61d8f35c059a3</a><br/>10進数の浮動小数点リテラルのstrict-type-literal 対応した</div></div></div><div class="message event" id="message-1518587922.000188"><div class="content"><div class="summary"><div class="message__header user">voqn.tyrant</div><div class="message__timestamp date">2018-02-14&nbsp;14:58:42 +0900</div></div><div class="message__body description">IEEE 754-2008 binary16 (16bit float) にプリミティブで対応しているのは、遠い目標にwasm経由して直にWebGLのシェーダーにアクセスする為とかですね</div></div></div><div class="message event" id="message-1518611568.000296"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2018-02-14&nbsp;21:32:48 +0900</div></div><div class="message__body description">枝葉末節なんですが、綴りにいくつか誤りを見つけたのでプルリクを投げました</div></div></div><div class="message event" id="message-1518611996.000250"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2018-02-14&nbsp;21:39:56 +0900</div></div><div class="message__body description">"block comment is keeping" では意味が通らない、などもありますが、眠いので寝て起きてからにします</div></div></div><div class="message event" id="message-1518614796.000116"><div class="content"><div class="summary"><div class="message__header user">voqn.tyrant</div><div class="message__timestamp date">2018-02-14&nbsp;22:26:36 +0900</div></div><div class="message__body description">typo周りは指摘まじありがたいです！英語力もアレなので 圧倒的感謝</div></div></div><div class="message event" id="message-1518617286.000579"><div class="content"><div class="summary"><div class="message__header user">matsubara0507</div><div class="message__timestamp date">2018-02-14&nbsp;23:08:06 +0900</div></div><div class="message__body description">ちなみに、stack.yaml で tasty-1.0 を指定してるんですけど、その前となんか大きく変わったんですか？</div></div></div><div class="message event" id="message-1518630673.000597"><div class="content"><div class="summary"><div class="message__header user">syocy</div><div class="message__timestamp date">2018-02-15&nbsp;02:51:13 +0900</div></div><div class="message__body description">@syocy has joined the channel</div></div></div><div class="message event" id="message-1518651769.000252"><div class="content"><div class="summary"><div class="message__header user">voqn.tyrant</div><div class="message__timestamp date">2018-02-15&nbsp;08:42:49 +0900</div></div><div class="message__body description">stack-work に残ってキャッシュが相当古くて、tasty-discover の CLI option の --tree-display を受け付けなかったんですよね。また、0.1x 系から 1.0 系になったという事で、できればメジャーバージョンに上げとこうっていうぐらいでした。</div></div></div><div class="message event" id="message-1518672173.000092"><div class="content"><div class="summary"><div class="message__header user">shin16s</div><div class="message__timestamp date">2018-02-15&nbsp;14:22:53 +0900</div></div><div class="message__body description">@shin16s has joined the channel</div></div></div><div class="message event" id="message-1518881120.000038"><div class="content"><div class="summary"><div class="message__header user">info</div><div class="message__timestamp date">2018-02-18&nbsp;00:25:20 +0900</div></div><div class="message__body description">@info has joined the channel</div></div></div><div class="message event" id="message-1519039771.000173"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2018-02-19&nbsp;20:29:31 +0900</div></div><div class="message__body description">結論としては，(まだちょっと把握できてない部分もあるんですが)見た感じCofree annotationを使う意義は無さそうと言う感じです<br/><a href='https://haskell-jp.slack.com/archives/C4M4TT8JJ/p1519027141000214?thread_ts=1518659662.000031&amp;cid=C4M4TT8JJ'>https://haskell-jp.slack.com/archives/C4M4TT8JJ/p1519027141000214?thread_ts=1518659662.000031&amp;cid=C4M4TT8JJ</a></div></div></div><div class="message event" id="message-1519040250.000084"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date">2018-02-19&nbsp;20:37:30 +0900</div></div><div class="message__body description">いろいろ説明不足ですみません。<br/>このコード（今型検査にこけるんですが）は、Liquid 用の AST を実行するもので、Jekyll で採用されてたりするんですが、Jekyll 方言があってそれをベース方言のインタープリターをいじらずに拡張できるようにしたいというものです。<br/>で、そのベース方言部分です。</div></div></div><div class="message event" id="message-1519040276.000106"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2018-02-19&nbsp;20:37:56 +0900</div></div><div class="message__body description">まず，cofree annotationを使う動機から説明すると，構文木を扱う際各木に注釈情報を埋め込みたい時があって(例えば，パース時のソースコード上の位置や，型情報など)，このような情報はコンパイル時どんどん変遷していくため，決めうちじゃなくて何らかの型変数にしておきたいということがあります．<br/><br/>ただ，これを単純に実現すると，<br/>data Expr a = Val Int a | Add (Expr a) (Expr a) a<br/>というように注釈情報を埋め込みたい場所に一々型変数を書かなければいけません．これを何とかしたいというのが動機です</div></div></div><div class="message event" id="message-1519040439.000321"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2018-02-19&nbsp;20:40:39 +0900</div></div><div class="message__body description">data types a la carteもcofree annotationもデータ型をopenにするという方向では一緒なのですが，それぞれ方向性はdata types a la carteはsumに対してのopen性，cofree annotationはrecursion schemeに関してのopen性みたいな感じで異なるのでそこらへんは注意です(まあ結果的に，これらを併用することが可能なのですが)</div></div></div><div class="message event" id="message-1519040602.000160"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2018-02-19&nbsp;20:43:22 +0900</div></div><div class="message__body description">で，実際にどのようにcofree annotationが解決するかなのですが，ASTを以下のようにrecursion schemeのBaseで定義しておきます．<br/>data ExprF e = ValF Int | AddF e e<br/>(ここでeは元のaと関係なく，再帰する箇所を表します．まあこの辺はdata types a la carteと一緒で，それが併用できる所以なんですが)</div></div></div><div class="message event" id="message-1519040707.000109"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2018-02-19&nbsp;20:45:07 +0900</div></div><div class="message__body description">で，通常はこれをFix f = f (Fix f)という原始的なオペレータでfixするんですが，Cofree f a = (a, f (Cofree f a))というオペレータでfixすることで，再帰する箇所全てに後から任意の注釈を埋め込めるようにできるというのがcofree annotatingと言われる手法ですね</div></div></div><div class="message event" id="message-1519040908.000416"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2018-02-19&nbsp;20:48:28 +0900</div></div><div class="message__body description">ただこのcofree annotatingは，multipleなデータに対して弱くって， <a href='https://stackoverflow.com/questions/38462563/how-to-work-with-ast-with-cofree-annotation'>https://stackoverflow.com/questions/38462563/how-to-work-with-ast-with-cofree-annotation</a> とか @voqn.tyrant さんが使っていたIndexed functorでそれをうまく扱えるようにするというのが度々話題に上がっています</div></div></div><div class="message event" id="message-1519040971.000259"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2018-02-19&nbsp;20:49:31 +0900</div></div><div class="message__body description">今回の場合，特に注釈情報は必要なさそうに見えるので(?)，cofreeを導入する必要はなさそうに見えます</div></div></div><div class="message event" id="message-1519041318.000139"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2018-02-19&nbsp;20:55:18 +0900</div></div><div class="message__body description">(ところで，僕もあまり詳しく無いのですが，Data types a la carteの結構すぐにoverlappingする問題って，みんなどうやって解決してるんですかね？)</div></div></div><div class="message event" id="message-1519043350.000010"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2018-02-19&nbsp;21:29:10 +0900</div></div><div class="message__body description">あ，あとこれって，その他(cofree使うか以外で)の感想待ちだったりしますか？</div></div></div><div class="message event" id="message-1519044505.000187"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date">2018-02-19&nbsp;21:48:25 +0900</div></div><div class="message__body description">cofree については全然知らなくって、「なんか VoQn さんのコードと似てる気がするけど知らない内に cofree 使ってるんだろうか？」という感じで提出したコードでした<br/>まさに<br/><blockquote>まあこの辺はdata types a la carteと一緒で，それが併用できる所以なんですが</blockquote>というところで同じなのかなぁと勘違いしたようです<br/>ただ cofree は好奇心を覚えるので説明は咀嚼してみます</div></div></div></div><div class="pager ui pagination menu"><a href="../../html/C8KBGEBR7/1.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a><a href="../../html/C8KBGEBR7/3.html" class="pager__next item">Next</a></div></div></body></html>