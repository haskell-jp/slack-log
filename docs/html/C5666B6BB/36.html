<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #36</title><link rel="stylesheet" href="../../messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / questions #36</h1><div class="pager"><a href="../../html/C5666B6BB/35.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a><a href="../../html/C5666B6BB/37.html" class="pager__next">Next</a></div><div class="message_list"><div class="message" id="message-1547704255.129000"><div class="message__timestamp">2019-01-17<br/>14:50:55 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">そうなんですよー。でもやろうとするといくつかの関数でリストを期待してるのに実際はTextだよってエラーが出るんです</div></div><div class="message" id="message-1547704360.129200"><div class="message__timestamp">2019-01-17<br/>14:52:40 +0900</div><div class="message__header">kakkun61</div><div class="message__body">Text.Parsec.Text あるしできそうな <a href='http://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Text.html'>http://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Text.html</a></div></div><div class="message" id="message-1547704532.130300"><div class="message__timestamp">2019-01-17<br/>14:55:32 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">僕がなにか見落としてるんですかね。。もうちょっと調べてみます</div></div><div class="message" id="message-1547709141.130500"><div class="message__timestamp">2019-01-17<br/>16:12:21 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">Text を Segment 型にパースしたいんですか？</div></div><div class="message" id="message-1547712762.131000"><div class="message__timestamp">2019-01-17<br/>17:12:42 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">そうです</div></div><div class="message" id="message-1547716228.131200"><div class="message__timestamp">2019-01-17<br/>18:10:28 +0900</div><div class="message__header">as_capabl</div><div class="message__body">おそらく、attoparsecの <code>takeWhile</code> みたいな物ですね <a href='http://hackage.haskell.org/package/attoparsec-0.13.2.2/docs/Data-Attoparsec-Text.html'>http://hackage.haskell.org/package/attoparsec-0.13.2.2/docs/Data-Attoparsec-Text.html</a></div></div><div class="message" id="message-1547716300.131400"><div class="message__timestamp">2019-01-17<br/>18:11:40 +0900</div><div class="message__header">as_capabl</div><div class="message__body">「 <code>takeWhile</code> みたいなTextに特化したコンビネータを使うとattoparsecが速いよ(意訳)」みたいな事が書いてあるので、parsecでリストを経由しない手段は恐らく無さそう</div></div><div class="message" id="message-1547718615.131800"><div class="message__timestamp">2019-01-17<br/>18:50:15 +0900</div><div class="message__header">igrep</div><div class="message__body">確かmegaparsecならだいたいそのあたり解決してたかと思います…</div></div><div class="message" id="message-1547723834.132200"><div class="message__timestamp">2019-01-17<br/>20:17:14 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">なるほどー。ではParsecを利用する場合には今の実装(fromStringを多用する）である意味あってるんですね。<br/>このモジュールの使い方が本当にわからない。<br/>Text.Parsec.Text<br/><a href='http://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Text.html'>http://hackage.haskell.org/package/parsec-3.1.13.0/docs/Text-Parsec-Text.html</a></div></div><div class="message" id="message-1547737304.132500"><div class="message__timestamp">2019-01-18<br/>00:01:44 +0900</div><div class="message__header">ms_020916</div><div class="message__body">@ms_020916 has joined the channel</div></div><div class="message" id="message-1547745206.133900"><div class="message__timestamp">2019-01-18<br/>02:13:26 +0900</div><div class="message__header">yamanntyu22</div><div class="message__body">stackで以下のプログラムを組んでコンパイルしたときに次のような感じになってしまったのですが原因などはわかるでしょうか？</div></div><div class="message" id="message-1547745236.134000"><div class="message__timestamp">2019-01-18<br/>02:13:56 +0900</div><div class="message__header">yamanntyu22</div><div class="message__body"></div></div><div class="message" id="message-1547745276.134300"><div class="message__timestamp">2019-01-18<br/>02:14:36 +0900</div><div class="message__header">yamanntyu22</div><div class="message__body"></div></div><div class="message" id="message-1547745306.134600"><div class="message__timestamp">2019-01-18<br/>02:15:06 +0900</div><div class="message__header">yamanntyu22</div><div class="message__body"></div></div><div class="message" id="message-1547745393.134900"><div class="message__timestamp">2019-01-18<br/>02:16:33 +0900</div><div class="message__header">yamanntyu22</div><div class="message__body">実行結果</div></div><div class="message" id="message-1547766121.135200"><div class="message__timestamp">2019-01-18<br/>08:02:01 +0900</div><div class="message__header">igrep</div><div class="message__body">取り急ぎぱっと見でわかることを。Access Violationが発生すると言うことはGHCとか関連する何かのバグである可能性が濃厚ですね…</div></div><div class="message" id="message-1547766394.135400"><div class="message__timestamp">2019-01-18<br/>08:06:34 +0900</div><div class="message__header">igrep</div><div class="message__body">ただ、それ以前に、Access Violationの手前に出てくるエラーからしてC:\sr\snapshots 以下にあるファイルが壊れているように見えます。<br/>一旦削除してやり直すと結果が変わるのではないかと。</div></div><div class="message" id="message-1547766473.135600"><div class="message__timestamp">2019-01-18<br/>08:07:53 +0900</div><div class="message__header">igrep</div><div class="message__body">あと、エラーメッセージもなるべくコピペしてください。<br/>画像は困ります…<br/>もしかしてコマンドプロンプトでのやり方が分からなかった？</div></div><div class="message" id="message-1547767822.135800"><div class="message__timestamp">2019-01-18<br/>08:30:22 +0900</div><div class="message__header">yamanntyu22</div><div class="message__body"></div></div><div class="message" id="message-1547767881.136600"><div class="message__timestamp">2019-01-18<br/>08:31:21 +0900</div><div class="message__header">yamanntyu22</div><div class="message__body">あれからsnapshot以下のファイルを消去して再ビルドしてみましたが先ほどあげたエラーを出しました。</div></div><div class="message" id="message-1547773229.137100"><div class="message__timestamp">2019-01-18<br/>10:00:29 +0900</div><div class="message__header">igrep</div><div class="message__body">OSはどれでしょうか？Windows 7 64bit?</div></div><div class="message" id="message-1547773257.137400"><div class="message__timestamp">2019-01-18<br/>10:00:57 +0900</div><div class="message__header">yamanntyu22</div><div class="message__body">OSはwindows10です</div></div><div class="message" id="message-1547773267.137600"><div class="message__timestamp">2019-01-18<br/>10:01:07 +0900</div><div class="message__header">yamanntyu22</div><div class="message__body">６４bitです</div></div><div class="message" id="message-1547778261.138100"><div class="message__timestamp">2019-01-18<br/>11:24:21 +0900</div><div class="message__header">kakkun61</div><div class="message__body"><pre>

    &lt;no location info&gt;: error:
        Warning: Couldn't figure out C compiler information!
                 Make sure you're using GNU gcc, or clang
    Preprocessing library for Yampa-0.11..
    Building library for Yampa-0.11..
    `gcc.exe' failed in phase `C pre-processor'. (Exit code: 1)
</pre><br/>これを見るに gcc か clang がない？</div></div><div class="message" id="message-1547782617.138300"><div class="message__timestamp">2019-01-18<br/>12:36:57 +0900</div><div class="message__header">igrep</div><div class="message__body">おっとすみません、同じエラーかと勘違いしてました（スマホで見ていたせいか気づきませんでした...）。<br/>今出たエラーは <a href='https://haskell-jp.slack.com/archives/C5666B6BB/p1547767822135800'>https://haskell-jp.slack.com/archives/C5666B6BB/p1547767822135800</a> の方なんですね。<br/>stack.yaml にはlts-12.16と書いているのにGHC 8.6.3が動いているように見えるのが気になりますね。。。 :thinking_face:<br/><code>stack build --verbose</code> したらどうなるのか気になります。</div></div><div class="message" id="message-1547809665.139400"><div class="message__timestamp">2019-01-18<br/>20:07:45 +0900</div><div class="message__header">shokohara</div><div class="message__body">皆さんはemacsで何を使ってjump to definitionされてますか？</div></div><div class="message" id="message-1547814095.140400"><div class="message__timestamp">2019-01-18<br/>21:21:35 +0900</div><div class="message__header">shokohara</div><div class="message__body">haskdogsで</div></div><div class="message" id="message-1547814119.140600"><div class="message__timestamp">2019-01-18<br/>21:21:59 +0900</div><div class="message__header">shokohara</div><div class="message__body">いい感じ飛べるようになりました :bow:</div></div><div class="message" id="message-1547819133.142800"><div class="message__timestamp">2019-01-18<br/>22:45:33 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">haskellをHTML内で使うときはどのコードを使えばよろしいでしょうか？また、そのときはAtomで使えばプログラムをシミュレーションすることはできるでしょうか？</div></div><div class="message" id="message-1547819266.142900"><div class="message__timestamp">2019-01-18<br/>22:47:46 +0900</div><div class="message__header">shokohara</div><div class="message__body"><blockquote>HTML内で使う</blockquote><br/>どういったことでしょうか？ブラウザで表示とかを連想しました。</div></div><div class="message" id="message-1547823226.143500"><div class="message__timestamp">2019-01-18<br/>23:53:46 +0900</div><div class="message__header">aiya000</div><div class="message__body">ghc-jsとかそういう……？</div></div><div class="message" id="message-1547847721.144900"><div class="message__timestamp">2019-01-19<br/>06:42:01 +0900</div><div class="message__header">igrep</div><div class="message__body">そうですね、元の質問 <a href='https://haskell-jp.slack.com/archives/C5666B6BB/p1547616849106800'>https://haskell-jp.slack.com/archives/C5666B6BB/p1547616849106800</a> にあった、外部のパッケージの定義まではジャンプできませんが、私もvimでタグジャンプを使うことが多いですね。<br/>:thinking_face: .oO(Haskell IDE Engineでもできるらしいけどそういえば試してないな...)</div></div><div class="message" id="message-1547847951.145200"><div class="message__timestamp">2019-01-19<br/>06:45:51 +0900</div><div class="message__header">igrep</div><div class="message__body">JSPとかPHPでやっているようなことをやりたいんですかね？<br/>どっかで聞いたことがある気もしますが、あまり使われていないように思います。<br/>どちらにしてももうちょっと詳しく何をやりたいのか聞きたいですね。</div></div><div class="message" id="message-1547852579.147100"><div class="message__timestamp">2019-01-19<br/>08:02:59 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">私の知り合いであるエンジニアの方にhaskellは将来性があると言われやってみた所少しずつ基礎が付いてきたのでweb作りに実践してみよう。と思ったところなのですが。</div></div><div class="message" id="message-1547855180.147400"><div class="message__timestamp">2019-01-19<br/>08:46:20 +0900</div><div class="message__header">igrep</div><div class="message__body">Haskellでやる場合、Haskellでwebサーバーを書いて、blaze-htmlやtype-of-htmlを使って書き出したり、heterocephalusやmustacheなどのテンプレートエンジンを使ってやることが多いですね。<br/><a href='https://gihyo.jp/book/2017/978-4-7741-9237-6'>https://gihyo.jp/book/2017/978-4-7741-9237-6</a> の最後の方に載ってるwebアプリのサンプルが参考になるかと思います。<br/>(Thanks @hiratara さん！)</div></div><div class="message" id="message-1547857048.147700"><div class="message__timestamp">2019-01-19<br/>09:17:28 +0900</div><div class="message__header">shokohara</div><div class="message__body">僕はyesod使って勉強目的で簡単な掲示板作ったことがあります。<br/>ただ次のことは本当に僕の個人的な思いですが、haskellは画面表示用データのJSON等を返すことに専念して(servantを使う) html, css, jsはvue.jsを使っていくのが理想的だと考えてます。B to Cだと特に。本当に偏見ですが、簡単なサイトなら良いですが、客が満足するレベルのフロントをhaskellのエンジニアが色々な意味で長期間に渡って作ってメンテし続けられるのだろうか・・・</div></div><div class="message" id="message-1547861640.148900"><div class="message__timestamp">2019-01-19<br/>10:34:00 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">@igrep ありがとうございます:blush:見てみようと思います！！</div></div><div class="message" id="message-1547861702.150600"><div class="message__timestamp">2019-01-19<br/>10:35:02 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">@shokohara そうですか、、、やはりwebサイトはhaskellで作るのは難しいのですね。アドバイスありがとうございます:blush:</div></div><div class="message" id="message-1547863357.151000"><div class="message__timestamp">2019-01-19<br/>11:02:37 +0900</div><div class="message__header">takechi101010</div><div class="message__body">@takechi101010 has joined the channel</div></div><div class="message" id="message-1547864914.151400"><div class="message__timestamp">2019-01-19<br/>11:28:34 +0900</div><div class="message__header">shokohara</div><div class="message__body">難しいわけでは全くありません</div></div><div class="message" id="message-1547864957.151600"><div class="message__timestamp">2019-01-19<br/>11:29:17 +0900</div><div class="message__header">shokohara</div><div class="message__body">簡単ですし保守も楽ですよ。ただ</div></div><div class="message" id="message-1547865213.151800"><div class="message__timestamp">2019-01-19<br/>11:33:33 +0900</div><div class="message__header">shokohara</div><div class="message__body">ただ僕がyesodでフロントエンドエンジニアと上手く連携してtoC向けのいい製品を開発してる事例を知らないだけという話になります。（僕も業務で使いたいので事例があれば教えてくれると嬉しいです）</div></div><div class="message" id="message-1547870845.152200"><div class="message__timestamp">2019-01-19<br/>13:07:25 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">了解です！ありがとうございます:blush:</div></div><div class="message" id="message-1547870875.152400"><div class="message__timestamp">2019-01-19<br/>13:07:55 +0900</div><div class="message__header">igrep</div><div class="message__body">確かにShoさんの仰るとおり、いわゆるSPAで作るような、高度なGUIを作るのは難しいです。GHCJSを使うとそこそこいけるかと思いますが、前例も少なくかなり大変でしょう。<br/>ですが別に多少画面遷移が多いくらいで十分便利なものは作れるでしょうし、SPAの複雑さがないぶんむしろ簡単だと思います。</div></div><div class="message" id="message-1547878847.153200"><div class="message__timestamp">2019-01-19<br/>15:20:47 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">@igrep わざわざ追加コメしてくださりありがとうございます:blush:</div></div><div class="message" id="message-1547985195.153900"><div class="message__timestamp">2019-01-20<br/>20:53:15 +0900</div><div class="message__header">shokohara</div><div class="message__body">Aesonによる失敗の説明文が詳しくないため特定に時間がかかりそうです。THやGenericで作られたFromJSONインスタンスを元にして（手書きは避けたい）詳細なエラーを書き出す方法などありませんでしょうか。<br/><code>"Error in $: When parsing the record Message of type Web.Slack.Common.Message the key type was not present."</code><br/><br/>Scalaのcirceでは以下のようなエラーが出ます。<br/><pre>
scala&gt; parser.decode[User]("""{"id":1, "name_fuga":"taro"}""")
//res96: cats.data.Xor[io.circe.Error,User] = Left(io.circe.DecodingFailure: Attempt to decode value on failed cursor: El(DownField(name),false))
</pre><br/>元URL <a href='https://qiita.com/ryoppy/items/664bd9a0dfd54ff1c6f6#decode'>https://qiita.com/ryoppy/items/664bd9a0dfd54ff1c6f6#decode</a></div></div><div class="message" id="message-1547991106.154100"><div class="message__timestamp">2019-01-20<br/>22:31:46 +0900</div><div class="message__header">igrep</div><div class="message__body">残念ながらありません。THで出したものもそれなりに詳しく出している認識ですが... :disappointed:<br/><code>"Error in $: When parsing the record Message of type Web.Slack.Common.Message the key type was not present."</code><br/>推測ですが <code>type</code> というキーがJSONに含まれてないものと読めます。</div></div><div class="message" id="message-1547991614.154400"><div class="message__timestamp">2019-01-20<br/>22:40:14 +0900</div><div class="message__header">igrep</div><div class="message__body">試しに <a href='https://github.com/haskell-jp/slack-log'>https://github.com/haskell-jp/slack-log</a> から持ってきた適当なJSONを元に、下記のような <code>test.json</code> を作って試したところ、同じメッセージを再現できたので、 「 <code>type</code> というキーがない」というエラーで間違いないと思います。<br/><br/><pre>
{
    "ts": "1541835316.110000",
    "text": "test",
    "user": "U4L0B71L1"
}
</pre><br/><br/>試したコードはこれ:<br/><br/><pre>
stack exec ghci
:m + Web.Slack.Common Data.Aeson
eitherDecodeFileStrict "test.json" :: IO (Either String Message)
</pre></div></div><div class="message" id="message-1548022538.162200"><div class="message__timestamp">2019-01-21<br/>07:15:38 +0900</div><div class="message__header">hexirp</div><div class="message__body">(igrep さんの推測が合っているという前提で) なんか type という言葉がレコード型のキーだから使われているのか意味ある言葉として使われているのかわかりづらいですね</div></div><div class="message" id="message-1548026720.162600"><div class="message__timestamp">2019-01-21<br/>08:25:20 +0900</div><div class="message__header">igrep</div><div class="message__body">ですね... ダブルクォートか何かで囲っていて欲しいところですね...</div></div></div><div class="pager"><a href="../../html/C5666B6BB/35.html" class="pager__previous">Previous</a><a href="../../" class="pager__top">Top</a><a href="../../html/C5666B6BB/37.html" class="pager__next">Next</a></div></body></html>