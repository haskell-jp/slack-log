<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / random #4</title><link rel="stylesheet" href="../../main.css" type="text/css" media="screen"></head><body><div class="ui container"><h1>haskell-jp / random #4</h1><div class="pager ui pagination menu"><a href="../../html/C4M4TT8JJ/3.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a><a href="../../html/C4M4TT8JJ/5.html" class="pager__next item">Next</a></div><div class="message_list ui feed"><div class="message event" id="message-1513853090.000070"><div class="content"><div class="summary"><div class="message__header user">giwanaga17</div><div class="message__timestamp date">2017-12-21&nbsp;19:44:50 +0900</div></div><div class="message__body description">@giwanaga17 has joined the channel</div></div></div><div class="message event" id="message-1513937708.000359"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date">2017-12-22&nbsp;19:15:08 +0900</div></div><div class="message__body description">評判どうなんですかねー<br/>セールで5ドル<br/><a href='https://www.packtpub.com/application-development/haskell-high-performance-programming'>https://www.packtpub.com/application-development/haskell-high-performance-programming</a></div></div></div><div class="message event" id="message-1513940141.000075"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2017-12-22&nbsp;19:55:41 +0900</div></div><div class="message__body description"><a href='https://www.packtpub.com/application-development/haskell-design-patterns'>https://www.packtpub.com/application-development/haskell-design-patterns</a> も5ドルですって！</div></div></div><div class="message event" id="message-1513940538.000235"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date">2017-12-22&nbsp;20:02:18 +0900</div></div><div class="message__body description">Packt 社の品質は物によるそうですが <a href='http://note.golden-lucky.net/2017/12/blog-post.html'>http://note.golden-lucky.net/2017/12/blog-post.html</a></div></div></div><div class="message event" id="message-1513940812.000084"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2017-12-22&nbsp;20:06:52 +0900</div></div><div class="message__body description">ではなおさら安いうちに買っておきたいですね！私は買います！</div></div></div><div class="message event" id="message-1513964288.000077"><div class="content"><div class="summary"><div class="message__header user">eagle.hokkaido2317</div><div class="message__timestamp date">2017-12-23&nbsp;02:38:08 +0900</div></div><div class="message__body description">@eagle.hokkaido2317 has joined the channel</div></div></div><div class="message event" id="message-1513997414.000013"><div class="content"><div class="summary"><div class="message__header user">takenobu.hs</div><div class="message__timestamp date">2017-12-23&nbsp;11:50:14 +0900</div></div><div class="message__body description">GHC の 8.4.1のアルファ版のリリースについての補足です。 お楽しみ！:haskell:<br/><br/><a href='https://www.reddit.com/r/haskell_jp/comments/7lm52h/ghc_841alpha1_available_ghc841%E3%81%AE%E3%82%A2%E3%83%AB%E3%83%95%E3%82%A1%E7%89%88/'>https://www.reddit.com/r/haskell_jp/comments/7lm52h/ghc_841alpha1_available_ghc841%E3%81%AE%E3%82%A2%E3%83%AB%E3%83%95%E3%82%A1%E7%89%88/</a></div></div></div><div class="message event" id="message-1514017190.000022"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2017-12-23&nbsp;17:19:50 +0900</div></div><div class="message__body description">あちこちで古いと言われてなぜか悔しかったので意地で更新しました。<br/><a href='https://qiita.com/igrep/items/da1d8df6d40eb001a561'>https://qiita.com/igrep/items/da1d8df6d40eb001a561</a><br/>残念ながら、追記が多くて読みにくくなってしまってはいますが。。。 :disappointed:</div></div></div><div class="message event" id="message-1514173807.000019"><div class="content"><div class="summary"><div class="message__header user">naohaq</div><div class="message__timestamp date">2017-12-25&nbsp;12:50:07 +0900</div></div><div class="message__body description">questionsの方でも書きましたが、Linuxは昔は複数のファイルディスクリプタ(fd)の変化を監視して待つシステムコールがselect(2)しかなかったんですよね。<br/>selectは変化を監視したいfdをビットマップで指定する(fd = nを待つ場合はビットnを立てる)ようなインターフェースになっているので、あまり沢山のfdは扱えないようになっていました。ビットマップをスキャンしたり更新したりするのはカーネルの負担になるので。</div></div></div><div class="message event" id="message-1514174058.000023"><div class="content"><div class="summary"><div class="message__header user">naohaq</div><div class="message__timestamp date">2017-12-25&nbsp;12:54:18 +0900</div></div><div class="message__body description">今のLinuxカーネルにはepoll(*BSDでいうところのkqueue)があってfdの変化をイベントキューのようなインターフェースで待てるので、そのような制限をかける必要がなくなったと。</div></div></div><div class="message event" id="message-1514330132.000126"><div class="content"><div class="summary"><div class="message__header user">kakkun61</div><div class="message__timestamp date">2017-12-27&nbsp;08:15:32 +0900</div></div><div class="message__body description">先生と生徒 <a href='https://github.com/hspec/sensei'>https://github.com/hspec/sensei</a></div></div></div><div class="message event" id="message-1514344351.000040"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2017-12-27&nbsp;12:12:31 +0900</div></div><div class="message__body description">最大値の数ビット分だけメモリーをあらかじめ確保する必要があった、っていうことですか？</div></div></div><div class="message event" id="message-1514354986.000026"><div class="content"><div class="summary"><div class="message__header user">fujimura</div><div class="message__timestamp date">2017-12-27&nbsp;15:09:46 +0900</div></div><div class="message__body description">ZaloraはHaskellやめちゃったんですかねえ <a href='https://github.com/zalora/'>https://github.com/zalora/</a></div></div></div><div class="message event" id="message-1514355034.000046"><div class="content"><div class="summary"><div class="message__header user">fujimura</div><div class="message__timestamp date">2017-12-27&nbsp;15:10:34 +0900</div></div><div class="message__body description">数年前、PHPから乗り換えるって言ってたけど、GitHubにも動きがないし、Haskellerがいる気配もなくなってしまった</div></div></div><div class="message event" id="message-1514364072.000126"><div class="content"><div class="summary"><div class="message__header user">naohaq</div><div class="message__timestamp date">2017-12-27&nbsp;17:41:12 +0900</div></div><div class="message__body description">はい。プロセスが持てるfdの数が1024個だとすると、1024bitのデータをユーザースペースとカーネルとでやり取りする必要がありました。どんな定義になっているかはこちらの記事 <a href='https://qiita.com/fujinochan/items/2337ce48a998cf67966b'>https://qiita.com/fujinochan/items/2337ce48a998cf67966b</a> で言及されています</div></div></div><div class="message event" id="message-1514414113.000038"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2017-12-28&nbsp;07:35:13 +0900</div></div><div class="message__body description"><a href='https://github.com/commercialhaskell/stack/issues/2240'>https://github.com/commercialhaskell/stack/issues/2240</a><br/>ダウンロード、s3直なのをどうにかしたいですね</div></div></div><div class="message event" id="message-1514415773.000149"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2017-12-28&nbsp;08:02:53 +0900</div></div><div class="message__body description"><a href='https://github.com/sozysozbot/akrantiain2'>https://github.com/sozysozbot/akrantiain2</a><br/>自分がHaskellで書いたコードを置いておくとプロの方々がマサカリを投げてくださると聞いて</div></div></div><div class="message event" id="message-1514421390.000074"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2017-12-28&nbsp;09:36:30 +0900</div></div><div class="message__body description">stack使ってない</div></div></div><div class="message event" id="message-1514421529.000003"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2017-12-28&nbsp;09:38:49 +0900</div></div><div class="message__body description">テストはよくあるフレームワーク使おう</div></div></div><div class="message event" id="message-1514421577.000071"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2017-12-28&nbsp;09:39:37 +0900</div></div><div class="message__body description">ciやろう</div></div></div><div class="message event" id="message-1514421624.000041"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2017-12-28&nbsp;09:40:24 +0900</div></div><div class="message__body description">すみませんが、まだ中身は読んでいません</div></div></div><div class="message event" id="message-1514425716.000036"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2017-12-28&nbsp;10:48:36 +0900</div></div><div class="message__body description">もっとキレのいいマサカリが準備できるとよかったのですが。</div></div></div><div class="message event" id="message-1514426971.000061"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2017-12-28&nbsp;11:09:31 +0900</div></div><div class="message__body description">まさか <code>Makefile</code> とは。。。なぜcabalも使わなかったのか逆に気になりますね。。。</div></div></div><div class="message event" id="message-1514427645.000092"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2017-12-28&nbsp;11:20:45 +0900</div></div><div class="message__body description"><a href='https://github.com/sozysozbot/akrantiain2/blob/master/Makefile#L6'>https://github.com/sozysozbot/akrantiain2/blob/master/Makefile#L6</a><br/>実はcabalはつかっています。</div></div></div><div class="message event" id="message-1514427801.000183"><div class="content"><div class="summary"><div class="message__header user">notogawa</div><div class="message__timestamp date">2017-12-28&nbsp;11:23:21 +0900</div></div><div class="message__body description">igrepさんのは「自プロジェクトをcabalizeしなかった(.cabalファイルを作らない)のは何故ですか」という話ですよね ．<br/>dependenciesをinstallするとこの話じゃなくて</div></div></div><div class="message event" id="message-1514427828.000064"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2017-12-28&nbsp;11:23:48 +0900</div></div><div class="message__body description">そうです</div></div></div><div class="message event" id="message-1514429776.000066"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2017-12-28&nbsp;11:56:16 +0900</div></div><div class="message__body description"><a href='https://github.com/sozysozbot/akrantiain2/blob/f1b741b11cea585f72ba2ce6c68cdf9411fa172e/akrantiain2.hs#L48-L59'>https://github.com/sozysozbot/akrantiain2/blob/f1b741b11cea585f72ba2ce6c68cdf9411fa172e/akrantiain2.hs#L48-L59</a> らへんのエラー処理ですが、<br/>自分の場合、 <code>IO (Either e a)</code> みたいな値は <code>e</code> が <code>Exception</code> のインスタンスとなるように変換した上で :point_down: みたいな関数で処理することが多いですね。<br/><pre>
throwOnLeft = either throwIO return
</pre></div></div></div><div class="message event" id="message-1514431281.000052"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2017-12-28&nbsp;12:21:21 +0900</div></div><div class="message__body description">どうなんでしょうね。パース結果がせっかくEither で来ているのにException?</div></div></div><div class="message event" id="message-1514431355.000054"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2017-12-28&nbsp;12:22:35 +0900</div></div><div class="message__body description">パーサーの中ならExceptionもいいかもしれないですが。</div></div></div><div class="message event" id="message-1514431581.000047"><div class="content"><div class="summary"><div class="message__header user">as_capabl</div><div class="message__timestamp date">2017-12-28&nbsp;12:26:21 +0900</div></div><div class="message__body description">私だったら <code>EitherT</code> コンストラクタを被せてdo文で書くと思います(リンクはMaybeTですが似たような感じで書けるはず) <a href='https://github.com/as-capabl/armageddon/blob/f5f6d676e00f508fe37efa77cedad89b58cf1023/app/Content.hs#L137'>https://github.com/as-capabl/armageddon/blob/f5f6d676e00f508fe37efa77cedad89b58cf1023/app/Content.hs#L137</a></div></div></div><div class="message event" id="message-1514431782.000043"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2017-12-28&nbsp;12:29:42 +0900</div></div><div class="message__body description">全部同じ型のエラーだったらその方がよさそうですね。<br/><code>main</code> 関数のような、トップレベルに近い、「中の処理でいろいろな例外が起こりうるけどもう復帰できないから最後に最低限何が起きたのかログだけ書いておこう！」みたいな状況でを想定してました。（が、今回の場合全部同じエラーなのかな？）</div></div></div><div class="message event" id="message-1514432393.000064"><div class="content"><div class="summary"><div class="message__header user">as_capabl</div><div class="message__timestamp date">2017-12-28&nbsp;12:39:53 +0900</div></div><div class="message__body description">確かに、そういう状況だと例外がいいですね</div></div></div><div class="message event" id="message-1514433891.000118"><div class="content"><div class="summary"><div class="message__header user">notogawa</div><div class="message__timestamp date">2017-12-28&nbsp;13:04:51 +0900</div></div><div class="message__body description">コンストラクタ1つでその種類は番号を持たせることで識別するようなエラー型の設計はやや気になります．<br/>エラーが起きたときそれが何のエラーかを判定してワークアラウンドするなりというのはよくあることと思いますが，<br/>エラー番号で識別することになると識別(=パターンマッチによる)の網羅性が緩くなる懸念が発生します．<br/>種類毎にコンストラクタを定義して，番号が欲しい場合は数値への変換を別途定義しておくのが好ましいのではないかと．</div></div></div><div class="message event" id="message-1514435724.000059"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2017-12-28&nbsp;13:35:24 +0900</div></div><div class="message__body description">ところで， <code>EitherT</code> は非推奨になったので，使うなら <code>ExceptT</code> ですかね？<br/><a href='https://www.stackage.org/haddock/lts-10.1/either-4.5/Control-Monad-Trans-Either.html'>https://www.stackage.org/haddock/lts-10.1/either-4.5/Control-Monad-Trans-Either.html</a></div></div></div><div class="message event" id="message-1514435916.000029"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2017-12-28&nbsp;13:38:36 +0900</div></div><div class="message__body description">そうですが、IOと一緒につかうExceptTは。。<br/><a href='https://www.fpcomplete.com/blog/2016/11/exceptions-best-practices-haskell'>https://www.fpcomplete.com/blog/2016/11/exceptions-best-practices-haskell</a></div></div></div><div class="message event" id="message-1514436012.000018"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2017-12-28&nbsp;13:40:12 +0900</div></div><div class="message__body description">違うモナド間の移動が発生するのは大変ですので、できれば避けたい。<br/>Yesodでこりごりです。</div></div></div><div class="message event" id="message-1514436315.000045"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2017-12-28&nbsp;13:45:15 +0900</div></div><div class="message__body description">yesod monad, conduit monad, aws monad ...</div></div></div><div class="message event" id="message-1514437959.000061"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2017-12-28&nbsp;14:12:39 +0900</div></div><div class="message__body description">確かに <code>ExceptT</code> については、局所的に使うのであれば、って感じですかね。。。</div></div></div><div class="message event" id="message-1514438733.000041"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2017-12-28&nbsp;14:25:33 +0900</div></div><div class="message__body description">ところで，あんまり議論をよく見ていないんですが，このUIの良し悪しはともかくUIをそのまま守るなら，わざわざ <code>&gt;&gt;&gt;=</code> みたいな汎用的なインタフェースを用意しないで，こんな感じで書くのが好きですね<br/><pre>
  ...
  toks &lt;- pure &lt;$&gt; runParser toTokens () fname input `catchEither` \e -&gt; do
      printError e
      exitWith $ ExitFailure TOKEN_FAILURE_CODE
  ...

catchEither :: Either a b -&gt; (a -&gt; b) -&gt; b
catchEither e f = either f id e

printError :: (Show a) =&gt; a -&gt; IO ()
printError x = do
  hPrint stderr x
  hPutStrLn stderr "\n\nPress Enter after reading this message."
  void getLine
</pre></div></div></div><div class="message event" id="message-1514438874.000035"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2017-12-28&nbsp;14:27:54 +0900</div></div><div class="message__body description">そうか。 <code>IO</code> が絡むから <code>&gt;&gt;&gt;=</code> なんて作ったのかな、と思っていたけど、よく見たら <code>IO (Either e a)</code> ですらないんですね。</div></div></div><div class="message event" id="message-1514439150.000061"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2017-12-28&nbsp;14:32:30 +0900</div></div><div class="message__body description">それから， <a href='https://github.com/sozysozbot/akrantiain2/blob/f1b741b11cea585f72ba2ce6c68cdf9411fa172e/akrantiain2.hs#L72'>https://github.com/sozysozbot/akrantiain2/blob/f1b741b11cea585f72ba2ce6c68cdf9411fa172e/akrantiain2.hs#L72</a> ですが，cabalのパッケージシステムを使うと，version情報をPaths_&lt;pkg&gt;というcabalが自動生成するモジュールから取れたりするので，その点でもcabalパッケージへの移行はおすすめですね</div></div></div><div class="message event" id="message-1514439874.000097"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2017-12-28&nbsp;14:44:34 +0900</div></div><div class="message__body description">あと， <a href='https://github.com/sozysozbot/akrantiain2/blob/master/Akrantiain/Pattern_match.hs#L86'>https://github.com/sozysozbot/akrantiain2/blob/master/Akrantiain/Pattern_match.hs#L86</a> これとかは現状コメントとしてなんですかね？ doctest(<https://github.com/sol/doctest>) を使うとこういうサンプルコードコメントをコメントの書式を変えるだけで Haddockでハイライティングされて，さらにテストに流用できるようになるので，おすすめですね．cabalパッケージ化すると，<https://github.com/phadej/cabal-doctest> がパッケージと依存一覧を自動生成してくれるようになるのでこれもおすすめです(cabalのバージョンが1.24以上じゃないと使えないのが難ですが)</div></div></div><div class="message event" id="message-1514442410.000006"><div class="content"><div class="summary"><div class="message__header user">as_capabl</div><div class="message__timestamp date">2017-12-28&nbsp;15:26:50 +0900</div></div><div class="message__body description">インターフェイスとして露出させるならEitherTもといExceptTは嫌ですね。逆に外に漏らさないというメリットでもあるので、適材適所だと思います</div></div></div><div class="message event" id="message-1514447243.000012"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2017-12-28&nbsp;16:47:23 +0900</div></div><div class="message__body description">帰宅したらたくさんのマサカリが来ていてありがたい限りです</div></div></div><div class="message event" id="message-1514447399.000179"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2017-12-28&nbsp;16:49:59 +0900</div></div><div class="message__body description">年末年始でゆっくり直していきます</div></div></div><div class="message event" id="message-1514447479.000021"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2017-12-28&nbsp;16:51:19 +0900</div></div><div class="message__body description">自プロジェクトをcabalizeできることを知ったのがコードを書き始めた後だったからです（完）</div></div></div><div class="message event" id="message-1514447564.000096"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2017-12-28&nbsp;16:52:44 +0900</div></div><div class="message__body description">番号振ったのは…なんでだっけ（忘れた）</div></div></div><div class="message event" id="message-1514447649.000165"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2017-12-28&nbsp;16:54:09 +0900</div></div><div class="message__body description">テストにまで流用できるのですか、情報ありがとうございます</div></div></div><div class="message event" id="message-1514447762.000026"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2017-12-28&nbsp;16:56:02 +0900</div></div><div class="message__body description">そうか。。。そういえばすごいH本とかじゃその辺教えないですもんね。。。 :disappointed_relieved:</div></div></div><div class="message event" id="message-1514447861.000083"><div class="content"><div class="summary"><div class="message__header user">hs.ioling.hs</div><div class="message__timestamp date">2017-12-28&nbsp;16:57:41 +0900</div></div><div class="message__body description">そういうことです、すごいHとReal World Haskellと「関数プログラミング 珠玉のアルゴリズムデザイン」ぐらいしか当時は読んだことがなかったもので（最近やっと「Haskell入門 関数型プログラミング言語の基礎と実践」を読んだ）</div></div></div></div><div class="pager ui pagination menu"><a href="../../html/C4M4TT8JJ/3.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a><a href="../../html/C4M4TT8JJ/5.html" class="pager__next item">Next</a></div></div></body></html>