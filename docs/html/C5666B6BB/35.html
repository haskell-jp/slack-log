<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #35</title><link rel="stylesheet" href="/slack-log/messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / questions #35</h1><div class="pager"><a href="/slack-log/html/C5666B6BB/34.html" class="pager__previous">Previous</a><a href="/slack-log/" class="pager__top">Top</a><a href="/slack-log/html/C5666B6BB/36.html" class="pager__next">Next</a></div><div class="message_list"><div class="message" id="message-1547389247.079000"><div class="message__timestamp">2019-01-13<br/>23:20:47 +0900</div><div class="message__header">igrep</div><div class="message__body">でもTemplate Haskellだとコンパイル時になってしまうから、実行時はさすがにないはず...</div></div><div class="message" id="message-1547442381.080600"><div class="message__timestamp">2019-01-14<br/>14:06:21 +0900</div><div class="message__header">yharuhi39</div><div class="message__body"><a href='https://codeutopia.net/blog/2011/08/20/adventures-in-haskell-dynamic-loading-and-compiling-of-modules/'>https://codeutopia.net/blog/2011/08/20/adventures-in-haskell-dynamic-loading-and-compiling-of-modules/</a> リンクベタ付けで悪いけど、これ改良すればいけそう？ でも、ただのハックになってしまいそう、、、かなーと思ったり</div></div><div class="message" id="message-1547454365.080900"><div class="message__timestamp">2019-01-14<br/>17:26:05 +0900</div><div class="message__header">igrep</div><div class="message__body">これはさすがにimportではないんじゃないかなーって気がしますね。。。</div></div><div class="message" id="message-1547454436.082200"><div class="message__timestamp">2019-01-14<br/>17:27:16 +0900</div><div class="message__header">yharuhi39</div><div class="message__body">まぁ、これは実行時評価に近い気がしますがこんな感じでGHCのインポートプロセスをハックできそうな気がしたので、、、</div></div><div class="message" id="message-1547525697.083000"><div class="message__timestamp">2019-01-15<br/>13:14:57 +0900</div><div class="message__header">kenta.teruteru</div><div class="message__body">@kenta.teruteru has joined the channel</div></div><div class="message" id="message-1547535496.083300"><div class="message__timestamp">2019-01-15<br/>15:58:16 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">@keikagawadesu.7k has joined the channel</div></div><div class="message" id="message-1547535838.084600"><div class="message__timestamp">2019-01-15<br/>16:03:58 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">初めてプログラミングを始めたものです。かなり初歩的なとこで質問するかもしれませんが、よろしくお願い申し上げます:man-bowing:</div></div><div class="message" id="message-1547550551.087500"><div class="message__timestamp">2019-01-15<br/>20:09:11 +0900</div><div class="message__header">shokohara</div><div class="message__body"><a href='https://api.slack.com/methods/conversations.history'>https://api.slack.com/methods/conversations.history</a><br/>↓のようなJSONの <code>ts</code> をaesonでパースしたいのですが、インスタンスを定義したいんですがエラーがでます。どんな対応がありますか？<br/><br/><pre>
{
            "type": "message",
            "user": "U061F7AUR",
            "text": "What, you want to smell my shoes better?",
            "ts": "1512104434.000490"
        }
</pre><br/><br/><pre>

/Users/sho/src/github.com/shokohara/automerge/slackworkcount/src/Main.hs:30:10: error:
    Duplicate instance declarations:
      instance FromJSON LocalTime -- Defined at src/Main.hs:30:10
      instance FromJSON LocalTime
        -- Defined in ‘aeson-1.4.2.0:Data.Aeson.Types.FromJSON’
   |
30 | instance FromJSON LocalTime where
   |          ^^^^^^^^^^^^^^^^^^
</pre></div></div><div class="message" id="message-1547552020.087800"><div class="message__timestamp">2019-01-15<br/>20:33:40 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">エラーメッセージ自体は、 <code>LocalTime</code> の <code>FromJSON</code> インスタンスが二個定義されているといってます<br/>自分でインスタンスの定義をしなければ良いので？</div></div><div class="message" id="message-1547552086.088000"><div class="message__timestamp">2019-01-15<br/>20:34:46 +0900</div><div class="message__header">shokohara</div><div class="message__body">返信ありがとうございます。フォーマットが違うため自分で定義してみました。</div></div><div class="message" id="message-1547552412.088200"><div class="message__timestamp">2019-01-15<br/>20:40:12 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">なるほど、それは難儀ですね…<br/>いくつかやり方がある気はしますが、もっとも行儀の良いやり方は <code>newtype</code> 宣言で <code>LocalTime</code> をラップした型を定義して、それを使う方法ですかね…</div></div><div class="message" id="message-1547554846.088500"><div class="message__timestamp">2019-01-15<br/>21:20:46 +0900</div><div class="message__header">igrep</div><div class="message__body">ちなみに、 <a href='http://hackage.haskell.org/package/slack-web'>http://hackage.haskell.org/package/slack-web</a> にも同様のパーサーがすでに定義済みかと思いますが、それではダメなんですか？</div></div><div class="message" id="message-1547558142.091700"><div class="message__timestamp">2019-01-15<br/>22:15:42 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">この「-&gt;」で、この場合aがBoolを返すことはわかったのですがなぜもう一つaがあるのでしょうか？<br/>画像見にくくてすみません。</div></div><div class="message" id="message-1547558319.092100"><div class="message__timestamp">2019-01-15<br/>22:18:39 +0900</div><div class="message__header">aruneko</div><div class="message__body">(&gt;)の型表記は、型制約を示す <code>(Ord a) =&gt;</code> の部分と、引数および返値を表す <code>a -&gt; a-&gt; Bool</code> の部分に分かれています。<br/>(&gt;) は 2つの比較可能な値を取って、その大小をBoolで返すため、 <code>a</code> を2つ取る必要があります。</div></div><div class="message" id="message-1547559121.094000"><div class="message__timestamp">2019-01-15<br/>22:32:01 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">2つの比較可能な値はa.bで表すのではないのでしょうか？2つの値を取った上で、Bool値を、返す。ということではないのかと思ったのですが</div></div><div class="message" id="message-1547559301.095200"><div class="message__timestamp">2019-01-15<br/>22:35:01 +0900</div><div class="message__header">aruneko</div><div class="message__body">これが例えば <code>(Ord a, b) =&gt; a -&gt; b -&gt; Bool</code> のように定義してしまうと、例えば <code>a</code> が <code>Int</code> 、 <code>b</code> が <code>String</code> のようなものを比較可能になってしまいますよね。これを <code>(Ord a) -&gt; a -&gt; a -&gt; Bool</code> と定義することで、片方の型を入力するともう片方の型を自動的に固定して、同じ型でなければ比較できないという制約を作り出すことができるのです。</div></div><div class="message" id="message-1547559804.095900"><div class="message__timestamp">2019-01-15<br/>22:43:24 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">ほんとにわかりやすいです笑笑ありがとうございます:blush:</div></div><div class="message" id="message-1547559834.096700"><div class="message__timestamp">2019-01-15<br/>22:43:54 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">これが謎で他のものも理解できなかったのでこれで一気にわかると思います笑笑</div></div><div class="message" id="message-1547570518.097500"><div class="message__timestamp">2019-01-16<br/>01:41:58 +0900</div><div class="message__header">shokohara</div><div class="message__body">返信ありがとうございます。<br/>newtypeの方法を勉強も兼ねて試しました。ありがとうございます。<br/>slack-webに乗り換えを検討しています。教えてくださってありがとうございます。ただ、乗り換え中に <code>Left (SlackError "invalid_ts_latest")</code> という実行時エラーがでるようになり、この通信をデバッグしたいのですが、どのようにするのが良さそうでしょうか？（Java,Scalaだとlogback.xmlなどを書き換えたりしますが、、、）</div></div><div class="message" id="message-1547593536.097800"><div class="message__timestamp">2019-01-16<br/>08:05:36 +0900</div><div class="message__header">igrep</div><div class="message__body">残念ながらそうしたlogback.xmlのような設定ファイルはありません。<br/>Haskellでは、そもそも外部のパッケージには何もログが仕込まれていないのが普通です。<br/>直接やりたければ、ソースコードをダウンロードして、書き換えた上でstack.yamlで参照するしかないです。</div></div><div class="message" id="message-1547593785.098000"><div class="message__timestamp">2019-01-16<br/>08:09:45 +0900</div><div class="message__header">igrep</div><div class="message__body">そしてそのエラーは、Slackのサーバーが返しているものなので、通信をデバッグしてもあまり実のある結果にはならないような気がしますね。。。<br/>大方、 <code>LocalTime</code> をJSONに変換した結果の文字列が、Slackが受け付ける文字列になっていないというエラーかと。</div></div><div class="message" id="message-1547608108.102400"><div class="message__timestamp">2019-01-16<br/>12:08:28 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">$を使った関数適用の<br/>($) :: (a -&gt; b)  -&gt; a -&gt; b<br/>の部分なんですけど、()を$として使うのになぜ、aやbを使って関数を定義するのでしょうか。また、aとbということはそれぞれ違う型の値ということでしょうか？</div></div><div class="message" id="message-1547608777.102500"><div class="message__timestamp">2019-01-16<br/>12:19:37 +0900</div><div class="message__header">shokohara</div><div class="message__body">昨晩ソースをたどってみたところ、UrlEncodedFormにNothingのものは文字列のnotingがtimestampに入っていくところを確認したので、それが原因っぽいなと検討はつきました。</div></div><div class="message" id="message-1547609058.102700"><div class="message__timestamp">2019-01-16<br/>12:24:18 +0900</div><div class="message__header">maoe</div><div class="message__body">質問の意図をくみ取れているのかわかりませんが、($) は関数 <code>f :: a -&gt; b</code> と、その関数に渡す引数 <code>x :: a</code> と取って関数適用した値 <code>f x :: b</code> を返すと読めます。a と b は同じ型でも問題ありません。たとえば <code>f</code> として <code>id</code> を渡す場合などです。</div></div><div class="message" id="message-1547609835.104300"><div class="message__timestamp">2019-01-16<br/>12:37:15 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">了解です。ありがとうございます:blush:</div></div><div class="message" id="message-1547612963.104500"><div class="message__timestamp">2019-01-16<br/>13:29:23 +0900</div><div class="message__header">sugano</div><div class="message__body">この質問は，なぜ($)を言語要素としてではなく関数として用意するのか，ということでしょうか．（解決済みでしたらすいません．）</div></div><div class="message" id="message-1547616610.105100"><div class="message__timestamp">2019-01-16<br/>14:30:10 +0900</div><div class="message__header">shokohara</div><div class="message__body">調査方法を教えてくださってありがとうございます :bow:</div></div><div class="message" id="message-1547616849.106800"><div class="message__timestamp">2019-01-16<br/>14:34:09 +0900</div><div class="message__header">shokohara</div><div class="message__body">interoで <code>M-.</code> によって Jump to definition したいのですが、<br/><code>instance ToForm HistoryReq where</code> の <code>ToForm</code> の定義に飛ぼうとすると <code>http-api-data-0.3.8.1-CLVb2SyagwA9bGtbONTDYI:Web.Internal.FormUrlEncoded</code> のように表示されます。この挙動は intero では当然のものでしょうか？<br/><a href='https://github.com/shokohara/slack-web/blob/master/src/Web/Slack/Common.hs#L82'>https://github.com/shokohara/slack-web/blob/master/src/Web/Slack/Common.hs#L82</a></div></div><div class="message" id="message-1547618049.107200"><div class="message__timestamp">2019-01-16<br/>14:54:09 +0900</div><div class="message__header">shokohara</div><div class="message__body">ソースコードにジャンプしたいです</div></div><div class="message" id="message-1547618105.108300"><div class="message__timestamp">2019-01-16<br/>14:55:05 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">@sugano さん。わざわざ考えてくださって感謝します！！もう解決したので大丈夫ですよ！</div></div><div class="message" id="message-1547621442.110000"><div class="message__timestamp">2019-01-16<br/>15:50:42 +0900</div><div class="message__header">slackbot</div><div class="message__body">This message was deleted.</div></div><div class="message" id="message-1547621569.110400"><div class="message__timestamp">2019-01-16<br/>15:52:49 +0900</div><div class="message__header">shokohara</div><div class="message__body">僕は自動化したいことをリストにまとめていて、暇になったらそれに着手します。例えばSlackやGitHubから情報を集めて業務報告文の自動生成です。作っておけば自分が楽になるもの等にやる気がでます。</div></div><div class="message" id="message-1547621597.111000"><div class="message__timestamp">2019-01-16<br/>15:53:17 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">ありがとうございます！ぜひ実践したいと思います！</div></div><div class="message" id="message-1547621670.111400"><div class="message__timestamp">2019-01-16<br/>15:54:30 +0900</div><div class="message__header">igrep</div><div class="message__body">今回は特に消す必要もないですが、さすがにあまりにもHaskellから離れた質問になってしまっているので、今後はここでは控えていただきたいです。 :pray:</div></div><div class="message" id="message-1547621738.111900"><div class="message__timestamp">2019-01-16<br/>15:55:38 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">了解です。申し訳ないです。</div></div><div class="message" id="message-1547621812.112800"><div class="message__timestamp">2019-01-16<br/>15:56:52 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">一応迷惑にもなるので消しときます。申し訳ないです。</div></div><div class="message" id="message-1547622850.113300"><div class="message__timestamp">2019-01-16<br/>16:14:10 +0900</div><div class="message__header">syocy</div><div class="message__body">チャンネルの趣旨からは外れるかもしれないけど私はこれは結構重要な疑問なんじゃないかと思いますね。変に浮世離れしたイメージを持たれがちなHaskellのユーザはどんなモチベーションでプログラミングに取り組んでいるのかというのは、回答を募る意味があると思う。</div></div><div class="message" id="message-1547623264.113500"><div class="message__timestamp">2019-01-16<br/>16:21:04 +0900</div><div class="message__header">igrep</div><div class="message__body">そう、だから迷ったんですけども... :cold_sweat:</div></div><div class="message" id="message-1547623400.113700"><div class="message__timestamp">2019-01-16<br/>16:23:20 +0900</div><div class="message__header">shokohara</div><div class="message__body">@keikagawadesu.7k 僕はScalaの業務委託案件でご飯食べてますが、Haskellのしかたも踏まえた上で現場により良いコードを提供したいという思いを持って細かいツールをHaskellで作ってます。自分の評価にも繋がることとより希少な人材になれると信じて取り組んでます。</div></div><div class="message" id="message-1547623502.115500"><div class="message__timestamp">2019-01-16<br/>16:25:02 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">ごめんなさい。自分性格的に中途半端なことが嫌なので、消すか消さないかということで、1人でも困ってる方がいましたら消す考えになってました。もしそれがダメであったら申し訳ないとしか言えないです。</div></div><div class="message" id="message-1547623562.117100"><div class="message__timestamp">2019-01-16<br/>16:26:02 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">@shokohara 自分まだまだ始めたばかりですが、将来のことを考え、また自分を評価してくれるというのはとても良い考えですね。参考にさせていただきます！！</div></div><div class="message" id="message-1547623611.117300"><div class="message__timestamp">2019-01-16<br/>16:26:51 +0900</div><div class="message__header">shokohara</div><div class="message__body"><blockquote>自分を評価してくれる</blockquote><br/>これは妄想ですけどｗ多分より良い評価に繋がる気がしてます</div></div><div class="message" id="message-1547623650.117500"><div class="message__timestamp">2019-01-16<br/>16:27:30 +0900</div><div class="message__header">igrep</div><div class="message__body">まぁ、もう遅いんでいいです。<br/>どちらかというと私は「あまりにもこういう質問が増えるのはおそらく好ましくないので注意する。でも前例を残すためにも消さない方がよい」という立場でしたが、「消すな」ということをちゃんと明言するべきでした。すみません。</div></div><div class="message" id="message-1547623722.117700"><div class="message__timestamp">2019-01-16<br/>16:28:42 +0900</div><div class="message__header">igrep</div><div class="message__body"><blockquote>変に浮世離れしたイメージを持たれがちなHaskellのユーザはどんなモチベーションでプログラミングに取り組んでいるのかというのは、回答を募る意味があると思う。</blockquote>もし本当にそういう意図があっての質問だったのであれば、そう明言していれば私も特に注意はしなかったと思います。</div></div><div class="message" id="message-1547625425.120600"><div class="message__timestamp">2019-01-16<br/>16:57:05 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">たしかに前例を残し他にこのようなことがなくなるという面では消さないという案もありでしたね:cry:もう消したものは戻らないので、次から気をつけたいと思います。わざわざ忠告してくださり感謝致します:man-bowing:</div></div><div class="message" id="message-1547625491.122100"><div class="message__timestamp">2019-01-16<br/>16:58:11 +0900</div><div class="message__header">keikagawadesu.7k</div><div class="message__body">ごめんなさい。このアプリhaskellのために入れたものであまり使い方を分かっておらずこちらのメインの方にもコメ欄行ってしまいました。すみません:man-bowing:</div></div><div class="message" id="message-1547631818.122900"><div class="message__timestamp">2019-01-16<br/>18:43:38 +0900</div><div class="message__header">ktchg752</div><div class="message__body">@ktchg752 has joined the channel</div></div><div class="message" id="message-1547644276.124800"><div class="message__timestamp">2019-01-16<br/>22:11:16 +0900</div><div class="message__header">kilo7998</div><div class="message__body">@kilo7998 has joined the channel</div></div><div class="message" id="message-1547703810.125600"><div class="message__timestamp">2019-01-17<br/>14:43:30 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">ParsecってTextを返すコンビネーターを提供をしていないのでしょうか。<br/><a href='http://hackage.haskell.org/package/parsec-3.1.13.0'>http://hackage.haskell.org/package/parsec-3.1.13.0</a><br/>Stringをパースするのなんかやだなと思って色々やってるんですけど、どうしてもうまく行かなくて、最終的にパースしたものにfromStringを適用してTextに変換してます。<br/><a href='https://gist.github.com/HirotoShioi/f75a547ff2730f7905a6b9a40d2d675d#file-inlineparser-hs-L21'>https://gist.github.com/HirotoShioi/f75a547ff2730f7905a6b9a40d2d675d#file-inlineparser-hs-L21</a></div></div><div class="message" id="message-1547704000.125800"><div class="message__timestamp">2019-01-17<br/>14:46:40 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">parsec って任意の型にパースできないっけ？</div></div></div><div class="pager"><a href="/slack-log/html/C5666B6BB/34.html" class="pager__previous">Previous</a><a href="/slack-log/" class="pager__top">Top</a><a href="/slack-log/html/C5666B6BB/36.html" class="pager__next">Next</a></div></body></html>