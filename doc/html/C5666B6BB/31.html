<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #31</title><link rel="stylesheet" href="/messages.css" type="text/css" media="screen"></head><body><h1>haskell-jp / questions #31</h1><div class="pager"><a href="/html/C5666B6BB/30.html" class="pager__previous">Previous</a><a href="/" class="pager__top">Top</a><a href="/html/C5666B6BB/32.html" class="pager__next">Next</a></div><div class="message_list"><div class="message" id="message-1542858379.064700"><div class="message__timestamp">2018-11-22<br/>12:46:19 +0900</div><div class="message__header">takohati0821</div><div class="message__body">例えば、"Applicative f =&gt; (a -&gt; f b) -&gt; s -&gt; f t"で検索したらlensパッケージのTraversalがヒットして欲しい、みたいな具合です</div></div><div class="message" id="message-1542859709.064900"><div class="message__timestamp">2018-11-22<br/>13:08:29 +0900</div><div class="message__header">cohei</div><div class="message__body">型シノニムだけ結果に表示するようなオプションは見つけられませんでした…<br/>型変数名が同じなら Google は一応見つけてくれましたが、不便は不便ですね。<br/><a href='https://www.google.co.jp/search?q=%22Applicative+f+%3D%3E+%28a+-%3E+f+b%29+-%3E+s+-%3E+f+t%22'>https://www.google.co.jp/search?q=%22Applicative+f+%3D%3E+%28a+-%3E+f+b%29+-%3E+s+-%3E+f+t%22</a></div></div><div class="message" id="message-1542862734.065200"><div class="message__timestamp">2018-11-22<br/>13:58:54 +0900</div><div class="message__header">igrep</div><div class="message__body">なるほど。。。Haddockに直接相談しないとどうにもならなさそうですね。。。 :disappointed_relieved:</div></div><div class="message" id="message-1542877932.066700"><div class="message__timestamp">2018-11-22<br/>18:12:12 +0900</div><div class="message__header">hexirp</div><div class="message__body">この関数って安全ではない気がするんですが、型レベルの分岐が出来る仕組み (Type Families とか) がプリミティブじゃないので大丈夫、だったりするんですか？ <a href='http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Type-Equality.html#v:inner'>http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Type-Equality.html#v:inner</a></div></div><div class="message" id="message-1542882884.067200"><div class="message__timestamp">2018-11-22<br/>19:34:44 +0900</div><div class="message__header">mizunashi-mana</div><div class="message__body">これを見る限りは，value type constructorとtype functionは明確に区別されていて，primitiveのreflexive axiomはvalue type constructorのみに提供されているように見えますね(今はkind equalityが入ってるのでそっちで大丈夫なのか分からないですが)<br/><a href='https://www.microsoft.com/en-us/research/wp-content/uploads/2007/01/tldi22-sulzmann-with-appendix.pdf'>https://www.microsoft.com/en-us/research/wp-content/uploads/2007/01/tldi22-sulzmann-with-appendix.pdf</a></div></div><div class="message" id="message-1542915925.067500"><div class="message__timestamp">2018-11-23<br/>04:45:25 +0900</div><div class="message__header">masuwo3</div><div class="message__body">@masuwo3 has joined the channel</div></div><div class="message" id="message-1543138178.067700"><div class="message__timestamp">2018-11-25<br/>18:29:38 +0900</div><div class="message__header">hexirp</div><div class="message__body">ありがとうございます！読んでみます</div></div><div class="message" id="message-1543144528.068000"><div class="message__timestamp">2018-11-25<br/>20:15:28 +0900</div><div class="message__header">koishimst</div><div class="message__body">@koishimst has joined the channel</div></div><div class="message" id="message-1543177906.072700"><div class="message__timestamp">2018-11-26<br/>05:31:46 +0900</div><div class="message__header">cliff.asura</div><div class="message__body">@cliff.asura has joined the channel</div></div><div class="message" id="message-1543202611.075500"><div class="message__timestamp">2018-11-26<br/>12:23:31 +0900</div><div class="message__header">as_capabl</div><div class="message__body">stackって「特定のbinをstackローカルのbinパス以外にインストールする」という用途は想定していないんですかね。stack環境無しでも動くexeを作って圧縮して配布、みたいな事を考えた場合はcabalでビルドする事を考えないと駄目でしょうか</div></div><div class="message" id="message-1543202651.075600"><div class="message__timestamp">2018-11-26<br/>12:24:11 +0900</div><div class="message__header">as_capabl</div><div class="message__body">今やろうとしてるのはbinじゃなくてdllなんですが、それだと更にハードルがいくつかありそうです</div></div><div class="message" id="message-1543202789.075800"><div class="message__timestamp">2018-11-26<br/>12:26:29 +0900</div><div class="message__header">igrep</div><div class="message__body"><code>stack  --local-bin-path /path/to/install install hoge</code> ではダメなんですかね。<br/>dllはわからないですが。。。</div></div><div class="message" id="message-1543203863.076200"><div class="message__timestamp">2018-11-26<br/>12:44:23 +0900</div><div class="message__header">as_capabl</div><div class="message__body">ああ、 <code>--local-bin-path</code> でインストールされた奴はstack execなしでも動きますね。.stack-work/install以下と混同してたっぽいです。</div></div><div class="message" id="message-1543203951.076400"><div class="message__timestamp">2018-11-26<br/>12:45:51 +0900</div><div class="message__header">as_capabl</div><div class="message__body">libとかincludeはそこにインストールされないんですが、それはdll固有の問題のようです</div></div><div class="message" id="message-1543242506.078600"><div class="message__timestamp">2018-11-26<br/>23:28:26 +0900</div><div class="message__header">yharuhi39</div><div class="message__body">ああ、これすれば、Windows eshell でstack install した時に現在ディレクトリに~ とかいう謎ディレクトリが作られるの抑えられるのかな？</div></div><div class="message" id="message-1543274173.078800"><div class="message__timestamp">2018-11-27<br/>08:16:13 +0900</div><div class="message__header">igrep</div><div class="message__body">stackのconfig.yaml（Windowsだとデフォルトで C:\sr\config.yaml になるはず）で、 <code>local-bin-path</code>で指定すれば、オプションで指定しなくてもそうなるはずです。 <a href='https://docs.haskellstack.org/en/stable/yaml_configuration/#local-bin-path'>https://docs.haskellstack.org/en/stable/yaml_configuration/#local-bin-path</a></div></div><div class="message" id="message-1543381236.080400"><div class="message__timestamp">2018-11-28<br/>14:00:36 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">1.15.1のDhallでInject, Interpretの型クラスインスタンスを定義した際に以下のように定義して、dhallファイルをパースしようとすると無限ループにはまるのですが、回避策などはありますか。<br/><br/><pre>
data Person = Person {
      pName :: !Text
    , pAge  :: !Natural
    } deriving (Eq, Show)

instance Interpret Person where
    autoWith _ = autoWith $ defaultInterpretOptions {fieldModifier = T.drop 1}

instance Inject Person where
    injectWith _ = injectWith $ defaultInterpretOptions {fieldModifier = T.drop 1}
</pre><br/><br/>Interpretなら以下の方法で定義すればいいんだけど、<br/><a href='http://hackage.haskell.org/package/dhall-1.15.1/docs/Dhall.html#t:RecordType'>http://hackage.haskell.org/package/dhall-1.15.1/docs/Dhall.html#t:RecordType</a><br/><br/><pre>
instance Interpret Person where
    autoWith _ = record $ 
        Person &lt;$&gt; field "name" strictText 
               &lt;*&gt; field "age" natural
</pre><br/><br/>Injectの場合、dhall-1.15.1ではdefaultInterpretOptionsを使う以外方法が見当たらないのです。</div></div><div class="message" id="message-1543382757.081700"><div class="message__timestamp">2018-11-28<br/>14:25:57 +0900</div><div class="message__header">a_kirisaki</div><div class="message__body"><code>InputType Person</code> を自分で定義してあげないといけない予感？</div></div><div class="message" id="message-1543383159.081900"><div class="message__timestamp">2018-11-28<br/>14:32:39 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">ソースコードを見た限りそうなんですけど、レコード型のInputTypeを定義するサンプルコードが見当たらないんですよね。。<br/><a href='http://hackage.haskell.org/package/dhall-1.15.1/docs/src/Dhall.html#line-865'>http://hackage.haskell.org/package/dhall-1.15.1/docs/src/Dhall.html#line-865</a></div></div><div class="message" id="message-1543383919.082300"><div class="message__timestamp">2018-11-28<br/>14:45:19 +0900</div><div class="message__header">a_kirisaki</div><div class="message__body"><code>RecordLits</code> 直接いじろうとしてもValueの肩が <code>Exp Src X</code> なのでうまく行きそうにないですね自前でレコードの <code>Interpret</code> インスタンス書いたときそれで詰まった気がします。現状レコードは柔軟に型定義できなさそうです</div></div><div class="message" id="message-1543384405.082600"><div class="message__timestamp">2018-11-28<br/>14:53:25 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">@a_kirisaki<br/>ありがとうー<br/>思いっきり裏技になりますが、以下の方法なら可能でした（多分やったら怒られそう）<br/><br/><pre>
data Person = Person {
      pName :: !Text
    , pAge  :: !Natural
    } deriving (Eq, Generic, Show)

-- 一旦Genericを用いてInjectのインスタンス定義
instance Inject Person

-- !?
class MyInject a where
    myInject :: InputType a

instance MyInject Person where
    myInject = injectWith $ defaultInterpretOptions {fieldModifier = T.drop 1}

&gt; let p = Person "Hiroto" 29
&gt; pretty $ embed myInject p
&gt; "{ Name = "hiroto", Age = 29 }"
</pre></div></div><div class="message" id="message-1543389080.083200"><div class="message__timestamp">2018-11-28<br/>16:11:20 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">でもこれどう考えても冗長的なコードだし、aesonのように定義できる気がするんですよねー。。他のチャンネルでもきいてみます。</div></div><div class="message" id="message-1543392829.083400"><div class="message__timestamp">2018-11-28<br/>17:13:49 +0900</div><div class="message__header">as_capabl</div><div class="message__body">1.19.1だと(&gt;*&lt;)とか使って出来そう？ <a href='http://hackage.haskell.org/package/dhall-1.19.1/docs/Dhall.html#v:-62--42--60-'>http://hackage.haskell.org/package/dhall-1.19.1/docs/Dhall.html#v:-62--42--60-</a></div></div><div class="message" id="message-1543392988.083600"><div class="message__timestamp">2018-11-28<br/>17:16:28 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">1.19.1にするならDevOpsと要相談になりますねー。<br/>いま作業してるプロジェクトは1.15.1がデフォルトのようです。</div></div><div class="message" id="message-1543399524.083800"><div class="message__timestamp">2018-11-28<br/>19:05:24 +0900</div><div class="message__header">as_capabl</div><div class="message__body">ちょっと勘違いしてたんですが、最初のコードが無限ループするのって、autoWithの中でautoWithを呼んでるからってだけではないですかね。autoWithのデフォルト定義 <code> autoWith options = fmap <http://GHC.Generics.to|GHC.Generics.to> (evalState (genericAutoWith options) 1)</code> を貼り付けてoptionの所変えてやってみては？</div></div><div class="message" id="message-1543400966.084000"><div class="message__timestamp">2018-11-28<br/>19:29:26 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">やってみたんですけど、今度は型エラーでコンパイルができなくなりますね。同じ名前の関数を別からインポートする必要があるのかな。。</div></div><div class="message" id="message-1543401828.084200"><div class="message__timestamp">2018-11-28<br/>19:43:48 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">dhallは比較的まだ新しい言語だし、当時はInjectの型クラスインスタンスは定義できなかったというのも十分ありえると思います。あったとしても相当ややこしかったのかも？（少なくともチュートリアルにはサンプルコードはありませんでした</div></div><div class="message" id="message-1543422092.084400"><div class="message__timestamp">2018-11-29<br/>01:21:32 +0900</div><div class="message__header">as_capabl</div><div class="message__body"><code>genericAutoWith options</code> が <code>State Int (Type (Rep Person a))</code> で <code>to</code> が <code>Rep Person a -&gt; Person</code> になるはずなんですけど通りませんかね</div></div><div class="message" id="message-1543457716.000100"><div class="message__timestamp">2018-11-29<br/>11:15:16 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">目を通してくれてありがとうー。<br/><a href='https://gist.github.com/HirotoShioi/69a63c11e0f73afe01f9182986c052a0'>https://gist.github.com/HirotoShioi/69a63c11e0f73afe01f9182986c052a0</a><br/>色々引っ張ってきてやっとできました！</div></div><div class="message" id="message-1543470187.001000"><div class="message__timestamp">2018-11-29<br/>14:43:07 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">stack newで新しくプロジェクトを生成した際に予め用意した`.ghci`ファイルも自動的にそのプロジェクトに入れておく方法ってありますか？<br/><br/><pre> 
:set prompt "&gt; "
 :seti -XOverloadedStrings
 :seti -XScopedTypeVariables
 
 :set -Wall
 :set -fno-warn-type-defaults
 
 :set -DGHCI
 :set +s
 :set +t
 
 :set -package pretty-simple
 
 import Text.Pretty.Simple (pPrint)
 
 :set -interactive-print pPrint
</pre><br/><br/>プロジェクトを立ち上げる毎に自分のwikiから.ghciファイルをコピペするのが面倒なんです。かといってグローバルに設定すると色々問題がありそう（どのPreludeを使ってるのかわからなくなるとか）。</div></div><div class="message" id="message-1543470347.001100"><div class="message__timestamp">2018-11-29<br/>14:45:47 +0900</div><div class="message__header">igrep</div><div class="message__body">テンプレートに.ghciを含めておくことはできるかと思います。<br/>stackのconfig.yamlでdefault-templateという項目を設定しておけば、デフォルトで使うテンプレートを指定できるみたいです。<br/><a href='https://haskell.e-bigmoon.com/stack/tips/config-yaml.html'>https://haskell.e-bigmoon.com/stack/tips/config-yaml.html</a></div></div><div class="message" id="message-1543471965.001500"><div class="message__timestamp">2018-11-29<br/>15:12:45 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">できました！</div></div><div class="message" id="message-1543471984.001700"><div class="message__timestamp">2018-11-29<br/>15:13:04 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">ありがとうー！</div></div><div class="message" id="message-1543479477.002900"><div class="message__timestamp">2018-11-29<br/>17:17:57 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">テスト書いてて気づいたけど、Dhallって特定の文字列に対してはパースエラーを吐くっぽい？<br/>例えばこういうのとか<br/>"\uÞ07A\u1635"<br/><br/>"\uö4BCX"</div></div><div class="message" id="message-1543479553.003200"><div class="message__timestamp">2018-11-29<br/>17:19:13 +0900</div><div class="message__header">hiroto.shioi</div><div class="message__body">Questionじゃなかった。。</div></div><div class="message" id="message-1543486409.003800"><div class="message__timestamp">2018-11-29<br/>19:13:29 +0900</div><div class="message__header">syocy</div><div class="message__body"><code>\u0000</code> みたいなのはコードポイントの表現なので、コードポイントとしてのパースに失敗するとパースエラーになるのかなと。</div></div><div class="message" id="message-1543503046.004900"><div class="message__timestamp">2018-11-29<br/>23:50:46 +0900</div><div class="message__header">yharuhi39</div><div class="message__body"><code>\\uあああ</code> みたいなのならいけるんでしょうね。</div></div><div class="message" id="message-1543672944.000300"><div class="message__timestamp">2018-12-01<br/>23:02:24 +0900</div><div class="message__header">keigoi</div><div class="message__body">@keigoi has joined the channel</div></div><div class="message" id="message-1543675326.000600"><div class="message__timestamp">2018-12-01<br/>23:42:06 +0900</div><div class="message__header">eisaku.ozawa</div><div class="message__body">@eisaku.ozawa has joined the channel</div></div><div class="message" id="message-1543710665.000900"><div class="message__timestamp">2018-12-02<br/>09:31:05 +0900</div><div class="message__header">t-uchida</div><div class="message__body">@t-uchida has joined the channel</div></div><div class="message" id="message-1543725188.002200"><div class="message__timestamp">2018-12-02<br/>13:33:08 +0900</div><div class="message__header">wado</div><div class="message__body">haskell-jp slack のログってどこかに公開されていたと思うのですが、url わかる方いたら教えてください:man-bowing:</div></div><div class="message" id="message-1543725709.002400"><div class="message__timestamp">2018-12-02<br/>13:41:49 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">ほい <a href='https://github.com/haskell-jp/slack-log'>https://github.com/haskell-jp/slack-log</a></div></div><div class="message" id="message-1543725742.002900"><div class="message__timestamp">2018-12-02<br/>13:42:22 +0900</div><div class="message__header">matsubara0507</div><div class="message__body">doc っていうディレクトリです</div></div><div class="message" id="message-1543725761.003000"><div class="message__timestamp">2018-12-02<br/>13:42:41 +0900</div><div class="message__header">wado</div><div class="message__body">ありがとうございます！:cactus:</div></div><div class="message" id="message-1543823570.005400"><div class="message__timestamp">2018-12-03<br/>16:52:50 +0900</div><div class="message__header">igrep</div><div class="message__body">cabal new-buildやcabal new-testで、stack buildの--pedanticオプション相当のことはできるでしょうか？<br/>cabal new-build --ghc-options="-Werror -Wall"<br/>でいけるだろうと思いきや、依存しているパッケージに警告があった場合までエラーになってしまうので、意図した動作にならず、悩んでおります。</div></div><div class="message" id="message-1543824023.005500"><div class="message__timestamp">2018-12-03<br/>17:00:23 +0900</div><div class="message__header">yharuhi39</div><div class="message__body"><code>--ghc-options="-Wall -Werror"</code> とすれば良いっぽい？</div></div><div class="message" id="message-1543824139.005700"><div class="message__timestamp">2018-12-03<br/>17:02:19 +0900</div><div class="message__header">yharuhi39</div><div class="message__body">と、現状のstackのpedantic がそう解釈するらしいので (参照: <a href='https://github.com/commercialhaskell/stack/blob/master/src/Stack/Options/BuildParser.hs#L30'>https://github.com/commercialhaskell/stack/blob/master/src/Stack/Options/BuildParser.hs#L30</a>)</div></div><div class="message" id="message-1543824257.006100"><div class="message__timestamp">2018-12-03<br/>17:04:17 +0900</div><div class="message__header">igrep</div><div class="message__body">さすがにそれでは <code>--ghc-options="-Werror -Wall"</code> と結果は変わりません。。。<br/>依存パッケージに警告があった場合までエラーになってしまいます。。。</div></div><div class="message" id="message-1543824298.006300"><div class="message__timestamp">2018-12-03<br/>17:04:58 +0900</div><div class="message__header">yharuhi39</div><div class="message__body">すみません、、、-Wallしかしてないのかなと勝手に見間違いしてました&gt;&lt;</div></div><div class="message" id="message-1543826675.006600"><div class="message__timestamp">2018-12-03<br/>17:44:35 +0900</div><div class="message__header">yharuhi39</div><div class="message__body">おそらくなのですが、cabal.projectを作って、<br/><br/><pre>
packages: ./gtk2hs-buildtools.cabal

package gtk2hs-buildtools
  ghc-options: -Wall -Werror

allow-newer: all
</pre><br/><br/>みたいな感じに設定すると望みの事が出来るのでは？ (例はgtk2hs-buildtoolsをghc-8.6.1でnew-buildしようとしたときの設定です)</div></div></div><div class="pager"><a href="/html/C5666B6BB/30.html" class="pager__previous">Previous</a><a href="/" class="pager__top">Top</a><a href="/html/C5666B6BB/32.html" class="pager__next">Next</a></div></body></html>