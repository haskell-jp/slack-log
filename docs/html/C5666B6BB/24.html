<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #24</title><link rel="stylesheet" href="../../main.css" type="text/css" media="screen"></head><body><div class="ui container"><h1>haskell-jp / questions #24</h1><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/23.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a><a href="../../html/C5666B6BB/25.html" class="pager__next item">Next</a></div><div class="message_list ui feed"><div class="message event" id="message-1531312619.000421"><div class="content"><div class="summary"><div class="message__header user">kazu</div><div class="message__timestamp date">2018-07-11&nbsp;21:36:59 +0900</div></div><div class="message__body description">たとえば、19ページ。関数適用は、tail call (すなわち jump)とありますね。</div></div></div><div class="message event" id="message-1531312699.000022"><div class="content"><div class="summary"><div class="message__header user">kazu</div><div class="message__timestamp date">2018-07-11&nbsp;21:38:19 +0900</div></div><div class="message__body description">誰か忘れましたが、日本人の方がたくさん論文を読んでまとめのレポート書いてました。内容には一部間違いがありましたが。。。</div></div></div><div class="message event" id="message-1531312811.000027"><div class="content"><div class="summary"><div class="message__header user">kazu</div><div class="message__timestamp date">2018-07-11&nbsp;21:40:11 +0900</div></div><div class="message__body description">なんか書いてました。</div></div></div><div class="message event" id="message-1531312813.000096"><div class="content"><div class="summary"><div class="message__header user">kazu</div><div class="message__timestamp date">2018-07-11&nbsp;21:40:13 +0900</div></div><div class="message__body description"><a href='http://d.hatena.ne.jp/kazu-yamamoto/20130417/1366179138'>http://d.hatena.ne.jp/kazu-yamamoto/20130417/1366179138</a></div></div></div><div class="message event" id="message-1531350000.000009"><div class="content"><div class="summary"><div class="message__header user">eliza0x</div><div class="message__timestamp date">2018-07-12&nbsp;08:00:00 +0900</div></div><div class="message__body description">ありがとうございます！</div></div></div><div class="message event" id="message-1531369895.000137"><div class="content"><div class="summary"><div class="message__header user">hiroto.shioi</div><div class="message__timestamp date">2018-07-12&nbsp;13:31:35 +0900</div></div><div class="message__body description">VSCodeでHaskell IDE engineを使用していると気づいたら5,6GBもメモリを消費しているのですが、これを回避する方法はありますか。いまのところは定期的にIDEを再起動してこれを回避しています。</div></div></div><div class="message event" id="message-1531370171.000115"><div class="content"><div class="summary"><div class="message__header user">wado</div><div class="message__timestamp date">2018-07-12&nbsp;13:36:11 +0900</div></div><div class="message__body description">現状は IDE を再起動するしかないと思います…。<br/><a href='https://github.com/haskell/haskell-ide-engine/issues/665'>https://github.com/haskell/haskell-ide-engine/issues/665</a><br/><a href='https://github.com/haskell/haskell-ide-engine/issues/580'>https://github.com/haskell/haskell-ide-engine/issues/580</a></div></div></div><div class="message event" id="message-1531370288.000023"><div class="content"><div class="summary"><div class="message__header user">hiroto.shioi</div><div class="message__timestamp date">2018-07-12&nbsp;13:38:08 +0900</div></div><div class="message__body description">なるほど。ありがとうございます。</div></div></div><div class="message event" id="message-1531380475.000121"><div class="content"><div class="summary"><div class="message__header user">kayhide</div><div class="message__timestamp date">2018-07-12&nbsp;16:27:55 +0900</div></div><div class="message__body description">特定のインスタンスを持っている場合だけ処理を変えたいのですが、なにかやり方はありますでしょうか？<br/>具体的には、<br/><pre>
fromIntegral :: (Num a, Integral i) =&gt; i -&gt; a
</pre><br/>を拡張して、 <code>(Floating a, Bounded i)</code> の場合だけ、ノーマライズする処理を入れたいです。<br/><br/>気分的にはこんなコードを動くようにしたいです。<br/><br/><pre>
class FromIntegralNormalized i a where
  fromIntegralNormalized :: i -&gt; a

instance (Integral i, Num a, Bounded i, Floating a) =&gt; FromIntegralNormalized i a where
  fromIntegralNormalized = (/ fromIntegral (maxBound :: i)) . fromIntegral

instance (Integral i, Num a) =&gt; FromIntegralNormalized i a where
  fromIntegralNormalized = fromIntegral
</pre></div></div></div><div class="message event" id="message-1531401547.000108"><div class="content"><div class="summary"><div class="message__header user">mizunashi-mana</div><div class="message__timestamp date">2018-07-12&nbsp;22:19:07 +0900</div></div><div class="message__body description">基本的には，これをそのまま実現するのは難しいため，APIの見直しを推奨します．<br/><br/>APIそのままとはいきませんが，基本的にはGADTsを使って<br/><pre>
{-# LANGUAGE GADTs #-}
{-# LANGUAGE ScopedTypeVariables #-}

data WhetherNormalize i a where
  BoundedNormalize :: (Bounded i, Floating a) =&gt; i -&gt; WhetherNormalize i a
  WithoutNormalize :: i -&gt; WhetherNormalize i a

fromIntegralWithNormalize :: forall i a. (Integral i, Num a) =&gt; WhetherNormalize i a -&gt; a
fromIntegralWithNormalize (BoundedNormalize x) = fromIntegral x / fromIntegral (maxBound :: i)
fromIntegralWithNormalize (WithoutNormalize x) = fromIntegral x
</pre><br/>というのがいいと思います．<br/><br/>このような関数を多相化する場合，実行時まで制約が存在するかの判定を遅延する必要があります(要は，それぞれの制約をMaybeに包むことで多相を実現するイメージです)<br/>なお，一応この仕組みを単純に実現するコンパイラプラグインが提供されているみたいです<br/><a href='https://hackage.haskell.org/package/constraints-emerge'>https://hackage.haskell.org/package/constraints-emerge</a></div></div></div><div class="message event" id="message-1531451091.000167"><div class="content"><div class="summary"><div class="message__header user">as_capabl</div><div class="message__timestamp date">2018-07-13&nbsp;12:04:51 +0900</div></div><div class="message__body description">OVERLAPSプラグマを使えば近い事は可能です。ただし、型クラス制約が増えただけではOVERLAPSにできる条件「より具体的なインスタンス」を満たさないので、オーバーラップさせる型は個別に指定する必要があります。<br/><br/><pre>
{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, ScopedTypeVariables #-}

import <http://Data.Int|Data.Int>

class FromIntegralNormalized i a where
  fromIntegralNormalized :: i -&gt; a

boundedToFloating :: forall i a. (Integral i, Bounded i, Num a, Floating a) =&gt; i -&gt; a
boundedToFloating = (/ fromIntegral (maxBound :: i)) . fromIntegral

instance {-# OVERLAPS #-} (Integral i, Bounded i) =&gt; FromIntegralNormalized i Float where
  fromIntegralNormalized = boundedToFloating

instance {-# OVERLAPS #-} (Integral i, Bounded i) =&gt; FromIntegralNormalized i Double where
  fromIntegralNormalized = boundedToFloating

instance (Integral i, Num a) =&gt; FromIntegralNormalized i a where
  fromIntegralNormalized = fromIntegral

main = do
  print (fromIntegralNormalized (64 :: Int8) :: Int)
  print (fromIntegralNormalized (64 :: Int8) :: Float)
  print (fromIntegralNormalized (64 :: Int8) :: Double)
</pre></div></div></div><div class="message event" id="message-1531452292.000003"><div class="content"><div class="summary"><div class="message__header user">kaznak.at.work</div><div class="message__timestamp date">2018-07-13&nbsp;12:24:52 +0900</div></div><div class="message__body description">なるほど、この辺は手で書くしかないんですね。ありがとうございます。</div></div></div><div class="message event" id="message-1531452332.000014"><div class="content"><div class="summary"><div class="message__header user">kaznak.at.work</div><div class="message__timestamp date">2018-07-13&nbsp;12:25:32 +0900</div></div><div class="message__body description">この記事は両方ともとても参考になります!ありがとうございます。</div></div></div><div class="message event" id="message-1531453992.000113"><div class="content"><div class="summary"><div class="message__header user">kayhide</div><div class="message__timestamp date">2018-07-13&nbsp;12:53:12 +0900</div></div><div class="message__body description">@mizunashi-mana @as_capabl ありがとうございます！やってみます！</div></div></div><div class="message event" id="message-1531475540.000070"><div class="content"><div class="summary"><div class="message__header user">kayhide</div><div class="message__timestamp date">2018-07-13&nbsp;18:52:20 +0900</div></div><div class="message__body description"><code>OVERLAPS</code> の方法だと、呼び出し元に <code>(Num a) </code> の制約しかなかったら、ノーマライズしてくれないですね。<br/><br/><pre>
hoge :: (Num a) =&gt; a
hoge = fromIntegralNormalized (100 :: Word8)

&gt;&gt;&gt; hoge :: Int
100
&gt;&gt;&gt; hoge :: Float
100.0
 </pre></div></div></div><div class="message event" id="message-1531475644.000071"><div class="content"><div class="summary"><div class="message__header user">kayhide</div><div class="message__timestamp date">2018-07-13&nbsp;18:54:04 +0900</div></div><div class="message__body description">正攻法で GADTs を使う方法でやることにして、こんな感じになりました。<br/><br/><pre>
data Normalizing i a where
  NonNormalized :: Normalizing i a
  Normalized :: (Bounded i, Fractional a) =&gt; Normalizing i a

fromIntegral' :: forall i a. (Integral i, Num a) =&gt; Normalizing i a -&gt; i -&gt; a
fromIntegral' NonNormalized = fromIntegral
fromIntegral' Normalized    = (/ fromIntegral (maxBound :: i)) . fromIntegral
</pre></div></div></div><div class="message event" id="message-1531475838.000023"><div class="content"><div class="summary"><div class="message__header user">kayhide</div><div class="message__timestamp date">2018-07-13&nbsp;18:57:18 +0900</div></div><div class="message__body description"><code>constraints-emerge</code> のプラグインも試してみましたが、呼び出し元に <code>Emerge</code> 制約が伝播していくのが気になるので見送りました。</div></div></div><div class="message event" id="message-1531549509.000004"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-14&nbsp;15:25:09 +0900</div></div><div class="message__body description">@a_kirisaki has joined the channel</div></div></div><div class="message event" id="message-1531549571.000043"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-14&nbsp;15:26:11 +0900</div></div><div class="message__body description">GraphQLのクエリを作ってくれるモジュールに心当たりのある方はいますか？サーバを提供するものなら発見したのですが……</div></div></div><div class="message event" id="message-1531554740.000006"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-14&nbsp;16:52:20 +0900</div></div><div class="message__body description">これHaskell強い人のigrepさんとlotzさんが知らないということはやはり存在しないのでは……</div></div></div><div class="message event" id="message-1531554994.000026"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-14&nbsp;16:56:34 +0900</div></div><div class="message__body description">一応あるにはあるっぽいんですが、メンテされてなくてちょっとプロジェクトに入れにくいんですよね：graphql: Haskell GraphQL implementation - <a href='https://hackage.haskell.org/package/graphql'>https://hackage.haskell.org/package/graphql</a></div></div></div><div class="message event" id="message-1531562467.000019"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-14&nbsp;19:01:07 +0900</div></div><div class="message__body description">うお～～～ってなりながら自前で作ることしました</div></div></div><div class="message event" id="message-1531592547.000028"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-15&nbsp;03:22:27 +0900</div></div><div class="message__body description">例えば<br/><pre>
type Key = String
type Value = String
data Hoge = [(Key, Value)] 
</pre><br/>みたいな型があったとして、`Key`が重複していたらコンパイル時にエラーを出すような仕組みって作れるんでしょうか。`TemplateHaskell`を利用したらできるんでしょうか。</div></div></div><div class="message event" id="message-1531604014.000004"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-15&nbsp;06:33:34 +0900</div></div><div class="message__body description">もうひとつ、次のような型があったとして<br/><pre>
data Member = Name String | Arguments [Argument]
data Field a = Field a [Member]
</pre><br/><code>Field a</code> （例えば <code>Field Int</code> ）をとって <code>Int</code> か、他の型に包んだ <code>Some Int</code> のような型を生成できるのでしょうか。 <code>Generics</code> とか使えばできるのかなとは考えてみたのですが上手くまとまらないです。（完全にGraphQLのAST作ってそこから型作る話です）</div></div></div><div class="message event" id="message-1531616303.000031"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-07-15&nbsp;09:58:23 +0900</div></div><div class="message__body description">どんな <code>Key</code> があるのかコンパイル時にすべて求められるのであれば、可能です。<br/>Extensible Recordというのはみんなそうしたものです。<br/>fumiさんのextensibleでも、キーが重複していれば検出してくれます。</div></div></div><div class="message event" id="message-1531616355.000033"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-07-15&nbsp;09:59:15 +0900</div></div><div class="message__body description">まぁ、そこまで検索しづらいワードでもないでしょうから、検索してないならないってことなんでしょうね...</div></div></div><div class="message event" id="message-1531616686.000050"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-07-15&nbsp;10:04:46 +0900</div></div><div class="message__body description">:thinking_face: <br/><code>Foo Int</code> から <code>Int</code> や <code>Some Int</code> を生成するというのがよくわからないです。<br/>型ではなくてそういう関数を自動生成したいという話ですかね？</div></div></div><div class="message event" id="message-1531634259.000027"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-15&nbsp;14:57:39 +0900</div></div><div class="message__body description">ありがとうございます。やはりextensibleですね</div></div></div><div class="message event" id="message-1531635043.000023"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-15&nbsp;15:10:43 +0900</div></div><div class="message__body description">ちょっといい方が適当すぎました。前述の型があるとき<br/><pre>
data Nyaan a = Nyaan a
</pre><br/>みたいな型があったとしてこの <code>a</code> の型を <code>Field a</code> の型と一致させるような仕組みが作れないかなということです</div></div></div><div class="message event" id="message-1531670229.000054"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-07-16&nbsp;00:57:09 +0900</div></div><div class="message__body description">すみません、ますますわからない... :disappointed: <br/>ちょっと質問で返しちゃいますが、<br/>もともとのゴールは、GraphQLをHaskellに生成（してサーバーに送って、結果をHaskellの型に変換）させたいわけですよね。<br/>どういうアプローチでやろうとしてます？<br/>例えば、 <a href='https://github.com/haskell-graphql/graphql-api#roadmap'>https://github.com/haskell-graphql/graphql-api#roadmap</a> が<br/><blockquote>Derive client implementations from types</blockquote>と計画しているように型からクエリーを組み立てる関数を生成するっていうアプローチではない？</div></div></div><div class="message event" id="message-1531670331.000002"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-16&nbsp;00:58:51 +0900</div></div><div class="message__body description">ちょっと自分でも整理しきれてないのでいろいろ試してからまた来ます！すみません！</div></div></div><div class="message event" id="message-1531710409.000042"><div class="content"><div class="summary"><div class="message__header user">hexirp</div><div class="message__timestamp date">2018-07-16&nbsp;12:06:49 +0900</div></div><div class="message__body description">Hakyllのビルドがメモリ不足で失敗するのですが何か良い対策はありませんか？Hakyllそのものに手を入れて二つのライブラリへ分割してコンパイルさせることで対処していますが、あとあと困りそうで……</div></div></div><div class="message event" id="message-1531715093.000065"><div class="content"><div class="summary"><div class="message__header user">wado</div><div class="message__timestamp date">2018-07-16&nbsp;13:24:53 +0900</div></div><div class="message__body description"><code>travis</code> がメモリ不足で死ぬ時は <code>-j 1</code> オプションで回避したことがありますが、ちょっと違う感じですか？<br/><a href='https://haskell.e-bigmoon.com/posts/2017/12-31-travis-out-of-memory.html'>https://haskell.e-bigmoon.com/posts/2017/12-31-travis-out-of-memory.html</a></div></div></div><div class="message event" id="message-1531717943.000017"><div class="content"><div class="summary"><div class="message__header user">hexirp</div><div class="message__timestamp date">2018-07-16&nbsp;14:12:23 +0900</div></div><div class="message__body description">なるほど……手元のパソコンでビルドした時に発生するものなので違いますね。具体的にはこのバグに引っかかっていて、どうしようもないのでメモリ使用量を減らす方法はないか、という感じです<br/><a href='https://github.com/jaspervdj/hakyll/issues/613'>https://github.com/jaspervdj/hakyll/issues/613</a></div></div></div><div class="message event" id="message-1531718364.000040"><div class="content"><div class="summary"><div class="message__header user">wado</div><div class="message__timestamp date">2018-07-16&nbsp;14:19:24 +0900</div></div><div class="message__body description"><blockquote>Couldn’t repro on stackage nightly (GHC 8.4).</blockquote><br/>windows 環境が無いので確かめられないのですが、コメントにある <code>ghc-8.4</code> 系の <code>lts-12.0</code> でもやっぱりダメな感じですか？</div></div></div><div class="message event" id="message-1531732329.000156"><div class="content"><div class="summary"><div class="message__header user">hexirp</div><div class="message__timestamp date">2018-07-16&nbsp;18:12:09 +0900</div></div><div class="message__body description">ああ、頭から抜けていました！できました！ありがとうございます。</div></div></div><div class="message event" id="message-1531800161.000136"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2018-07-17&nbsp;13:02:41 +0900</div></div><div class="message__body description">unlift.ioの対応でresourcetのインスタンスにstatetを受け付けなくなってますが、<br/>どのように修正するのがおすすめでしょうか。<br/><a href='http://hackage.haskell.org/package/conduit-find'>http://hackage.haskell.org/package/conduit-find</a><br/>（リンク張り間違えていました。find-conduitでなくてこっちでした。）<br/>ちなみにこれを使いたいです。</div></div></div><div class="message event" id="message-1531802377.000121"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-07-17&nbsp;13:39:37 +0900</div></div><div class="message__body description">直接の回答でなくて恐縮ですが、UnliftIOはそもそもmonad-controlと違ってStateTを使えなくしているのが売りだったはずです。<br/><a href='https://www.fpcomplete.com/blog/2017/06/readert-design-pattern'>https://www.fpcomplete.com/blog/2017/06/readert-design-pattern</a> でも少し触れています。</div></div></div><div class="message event" id="message-1531802598.000025"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2018-07-17&nbsp;13:43:18 +0900</div></div><div class="message__body description">するとstatetつかっているようなものは<br/>readertとioref/tvarとかの組み合わせにかえるのがいいのでしょうか。</div></div></div><div class="message event" id="message-1531802636.000034"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date">2018-07-17&nbsp;13:43:56 +0900</div></div><div class="message__body description">そうなりますね。ちょっと書き換えが面倒くさそうですが...</div></div></div><div class="message event" id="message-1531822685.000046"><div class="content"><div class="summary"><div class="message__header user">junji.hashimoto</div><div class="message__timestamp date">2018-07-17&nbsp;19:18:05 +0900</div></div><div class="message__body description">結構めんどくさいというか、どうすればできるのだっけという感じがしております</div></div></div><div class="message event" id="message-1531834207.000248"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-17&nbsp;22:30:07 +0900</div></div><div class="message__body description">何回も申し訳ありませんが質問です。 <code>Data.Extensible</code> のレコードから <code>Web.Internal.FormUrlEncoded</code> の <code>Form</code> に変換する以下のようなコードで<br/><pre>
{-# LANGUAGE AllowAmbiguousTypes         #-}
{-# LANGUAGE DataKinds         #-}
{-# LANGUAGE FlexibleContexts         #-}
{-# LANGUAGE FlexibleInstances         #-}
{-# LANGUAGE MultiParamTypeClasses         #-}
{-# LANGUAGE OverloadedStrings         #-}
{-# LANGUAGE ScopedTypeVariables         #-}
{-# LANGUAGE TypeOperators     #-}
{-# LANGUAGE UndecidableInstances     #-}
{-# LANGUAGE UndecidableSuperClasses #-}


module Hrafnar.Service.Common
  ( AwaitRequest
  , Server
  ) where

import           Data.Extensible
import           Data.HashMap.Strict as HM
import           GHC.TypeLits
import           Web.Internal.FormUrlEncoded

instance Forall (KeyValue KnownSymbol (Instance1 ToFormKey h)) xs =&gt; ToForm (Field h :* xs) where
  toForm = Form . hfoldlWithIndexFor
    (Proxy :: Proxy (KeyValue KnownSymbol (Instance1 ToFormKey h)))
    (\k m v -&gt; HM.insert (toFormKey $ symbolVal $ proxyAssocKey k)  [toFormKey v] m)
    HM.empty
</pre><br/>としたのですがどうしても<br/><pre>
    • Could not deduce (ToFormKey (Field h x))
        arising from a use of ‘toFormKey’
      from the context: Forall
                          (KeyValue KnownSymbol (Instance1 ToFormKey h)) xs
        bound by the instance declaration
        at src/Hrafnar/Service/Common.hs:33:10-91
      or from: KeyValue KnownSymbol (Instance1 ToFormKey h) x
        bound by a type expected by the context:
                   KeyValue KnownSymbol (Instance1 ToFormKey h) x =&gt;
                   Membership xs x
                   -&gt; HashMap Text [Text] -&gt; Field h x -&gt; HashMap Text [Text]
        at src/Hrafnar/Service/Common.hs:(34,19)-(37,12)
    • In the expression: toFormKey v
      In the second argument of ‘HM.insert’, namely ‘[toFormKey v]’
      In the expression:
        HM.insert (toFormKey $ symbolVal $ proxyAssocKey k) [toFormKey v] m
</pre><br/>というエラーが出て悩まされています。お心当たりありませんか</div></div></div><div class="message event" id="message-1531835050.000353"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-17&nbsp;22:44:10 +0900</div></div><div class="message__body description">あ、stack lts-9.12です</div></div></div><div class="message event" id="message-1531836474.000076"><div class="content"><div class="summary"><div class="message__header user">matsubara0507</div><div class="message__timestamp date">2018-07-17&nbsp;23:07:54 +0900</div></div><div class="message__body description">おそらくですけど<br/>ToJson のインスタンスとかを参考にしたと思うんですが <a href='https://hackage.haskell.org/package/extensible-0.4.10/docs/src/Data.Extensible.Dictionary.html#line-216'>https://hackage.haskell.org/package/extensible-0.4.10/docs/src/Data.Extensible.Dictionary.html#line-216</a></div></div></div><div class="message event" id="message-1531836654.000106"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-17&nbsp;23:10:54 +0900</div></div><div class="message__body description">です</div></div></div><div class="message event" id="message-1531836836.000567"><div class="content"><div class="summary"><div class="message__header user">matsubara0507</div><div class="message__timestamp date">2018-07-17&nbsp;23:13:56 +0900</div></div><div class="message__body description">こんな風に Instance1 でいっきにやるには <code>Field h kv</code> のインスタンスも必要なので、 <code>instance ToFormKey (h (AssocValue kv)) =&gt; ToFormKey (Field h kv)</code> も定義すると通ると思います</div></div></div><div class="message event" id="message-1531895102.000157"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-18&nbsp;15:25:02 +0900</div></div><div class="message__body description">とりあえず<br/><pre>
instance ToFormKey (h (AssocValue kv)) =&gt; ToFormKey (Field h kv) where
  ToFormKey = undefined
</pre><br/>として適当な <code>Record</code> を作り <code>toForm</code> してみたのですが<br/><pre>
   • No instance for (ToFormKey (Identity Text))
        arising from a use of ‘toForm’
 </pre><br/>と出てしまいます。また、 <code>extensible</code> のソース見ながら<br/><pre>
deriving instance ToFormKey (h (AssocValue kv)) =&gt; ToFormKey (Field h kv)
</pre><br/>としたところで<br/><pre>
  • Can't make a derived instance of ‘ToFormKey (Field h kv)’:
        ‘ToFormKey’ is not a standard derivable class (Eq, Show, etc.)
        Try GeneralizedNewtypeDeriving for GHC's newtype-deriving extension
  </pre><br/>と出たのでコンパイラに従い拡張を入れたところでも同様のエラーが出ました</div></div></div><div class="message event" id="message-1531897224.000244"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-18&nbsp;16:00:24 +0900</div></div><div class="message__body description">アッインスタンス作ってないのでは</div></div></div><div class="message event" id="message-1531897614.000181"><div class="content"><div class="summary"><div class="message__header user">a_kirisaki</div><div class="message__timestamp date">2018-07-18&nbsp;16:06:54 +0900</div></div><div class="message__body description">1個前の発言は、なんかレコード構文のGenericな導出とごっちゃになって <code>instance ToForm HogeType</code> とやってみたけどダメでした</div></div></div><div class="message event" id="message-1531898615.000002"><div class="content"><div class="summary"><div class="message__header user">fumieval</div><div class="message__timestamp date">2018-07-18&nbsp;16:23:35 +0900</div></div><div class="message__body description">Identityのインスタンスも作る必要があります。また、GeneralisedNewtypeDerivingが本当に有効になっているかもう一度確認してみてください。PolyKindsもおそらく必要です</div></div></div></div><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/23.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a><a href="../../html/C5666B6BB/25.html" class="pager__next item">Next</a></div></div></body></html>