<!DOCTYPE html><html><head><meta charset="utf-8"><title>haskell-jp / questions #81</title><link rel="stylesheet" href="../../main.css" type="text/css" media="screen"></head><body><div class="ui container"><h1>haskell-jp / questions #81</h1><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/80.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div><div class="message_list ui feed"><div class="message event" id="message-1583666327.077700"><div class="content"><div class="summary"><div class="message__header user">tcokygets</div><div class="message__timestamp date"><a class="date" href="#message-1583666327.077700">2020-03-08&nbsp;20:18:47 +0900</a></div></div><div class="message__body description">いえ 何もしてないのにいつのまにかこうなってしまったので……それにいくら再インストールしても同じ問題が発生しちゃうんですよ もう手詰まりで</div></div></div><div class="message event" id="message-1583666429.077900"><div class="content"><div class="summary"><div class="message__header user">igrep</div><div class="message__timestamp date"><a class="date" href="#message-1583666429.077900">2020-03-08&nbsp;20:20:29 +0900</a></div></div><div class="message__body description">何のコマンドを実行したら発生したんですか？それともコマンドじゃなくてエディターを起動したときとか？<br/>あと、GHCはどうやってインストールしましたか？</div></div></div><div class="message event" id="message-1583672131.078200"><div class="content"><div class="summary"><div class="message__header user">koowashi</div><div class="message__timestamp date"><a class="date" href="#message-1583672131.078200">2020-03-08&nbsp;21:55:31 +0900</a></div></div><div class="message__body description">@koowashi has joined the channel</div></div></div><div class="message event" id="message-1583714881.078500"><div class="content"><div class="summary"><div class="message__header user">niijimatakashi993</div><div class="message__timestamp date"><a class="date" href="#message-1583714881.078500">2020-03-09&nbsp;09:48:01 +0900</a></div></div><div class="message__body description">@niijimatakashi993 has joined the channel</div></div></div><div class="message event" id="message-1583916124.078800"><div class="content"><div class="summary"><div class="message__header user">k.kent8192</div><div class="message__timestamp date"><a class="date" href="#message-1583916124.078800">2020-03-11&nbsp;17:42:04 +0900</a></div></div><div class="message__body description"><a href='https://teratail.com/questions/246485'>https://teratail.com/questions/246485</a></div></div></div><div class="message event" id="message-1583916141.079400"><div class="content"><div class="summary"><div class="message__header user">k.kent8192</div><div class="message__timestamp date"><a class="date" href="#message-1583916141.079400">2020-03-11&nbsp;17:42:21 +0900</a></div></div><div class="message__body description">この件に関する回答を募集しています。</div></div></div><div class="message event" id="message-1583916194.080800"><div class="content"><div class="summary"><div class="message__header user">k.kent8192</div><div class="message__timestamp date"><a class="date" href="#message-1583916194.080800">2020-03-11&nbsp;17:43:14 +0900</a></div></div><div class="message__body description">調べてもなかなか分からなくて…</div></div></div><div class="message event" id="message-1583984783.084300"><div class="content"><div class="summary"><div class="message__header user">hexirp</div><div class="message__timestamp date"><a class="date" href="#message-1583984783.084300">2020-03-12&nbsp;12:46:23 +0900</a></div></div><div class="message__body description"><a href='https://github.com/haskell/bytestring/blob/95fe6bdf13c9cc86c1c880164f7844d61d989574/Data/ByteString/Builder/Internal.hs#L348-L353'>https://github.com/haskell/bytestring/blob/95fe6bdf13c9cc86c1c880164f7844d61d989574/Data/ByteString/Builder/Internal.hs#L348-L353</a><br/>bytestring パッケージの Builder の実装ってどうしてこうなっているんですか？　予想としては差分リストと BufferRange を状態に持つアロー的な何か ( <a href='http://hackage.haskell.org/package/arrows-0.4.4.2/docs/Control-Arrow-Transformer-CoState.html'>http://hackage.haskell.org/package/arrows-0.4.4.2/docs/Control-Arrow-Transformer-CoState.html</a> ) の組み合わせだと思っています。</div></div></div><div class="message event" id="message-1584024050.093000"><div class="content"><div class="summary"><div class="message__header user">k.marumaru524</div><div class="message__timestamp date"><a class="date" href="#message-1584024050.093000">2020-03-12&nbsp;23:40:50 +0900</a></div></div><div class="message__body description">おひさしぶりです<br/><br/>Haskellで、repl付きのinterprerを実装するときの話です。<br/>以下の、HaskellでSchemeを作るサイトでは、inteprerの環境の型にIORefを使用しています。<br/><a href='https://ja.wikibooks.org/wiki/48%E6%99%82%E9%96%93%E3%81%A7Scheme%E3%82%92%E6%9B%B8%E3%81%93%E3%81%86/%E5%A4%89%E6%95%B0%E3%81%A8%E4%BB%A3%E5%85%A5'>https://ja.wikibooks.org/wiki/48%E6%99%82%E9%96%93%E3%81%A7Scheme%E3%82%92%E6%9B%B8%E3%81%93%E3%81%86/%E5%A4%89%E6%95%B0%E3%81%A8%E4%BB%A3%E5%85%A5</a><br/><br/><br/>ここで3つ質問があります。<br/>1. なぜStateが適していなくて、IORefが適しているのか<br/>2. IORefを使った場合にenvを持ち回らない方法はあるのか<br/>3. Stateを使ったときにreplが正しく動かないのはそういうものなのか、単純に僕の実装が悪いのか<br/>特に、1,2についてお聞きしたいです。<br/>質問はさておき、最終的にやりたいことは「envを持ち回らずにreplでevalを実行すること」です<br/><br/><br/>1に関しては、上記のページの上の方に解説がありますが、理由をよく理解できませんでした。<br/>関数の呼び出しの際にenvが入れ子になっていくのはわかりますが、そのときになぜStateではだめで、IORefならうまく機能するのかがわかりません<br/><br/><br/>2に関して、上のサイトを少し参考にして実装していっているものが以下です。IORefを使っていてeval関数はenvを引き回しています。StateモナドやReaderモナドを使うときのようにenvを隠蔽する必要はあるのでしょうか<br/><a href='https://github.com/mrsekut/Hytl/blob/86cca753fc/src/Eval.hs'>https://github.com/mrsekut/Hytl/blob/86cca753fc/src/Eval.hs</a><br/><br/><br/>3に関して、「これIORefじゃなくてStateにすればenv隠蔽できるやん！」と早とちりして途中まで実装したものが以下になります。Stateを使うことでenvを持ち回る事がなくなりましたが、replで動かしたときに変数呼び出しがうまく機能しません。というのも、一行入力する毎にStateあるEnvが空になっているようです。これは単に僕のreplの実装が悪いだけなのか、IOが絡む場合はStateだけではうまく動かないのか、というのをお聞きしたいです。<br/><a href='https://github.com/mrsekut/Hytl/blob/2bbf7c4058/src/Eval.hs'>https://github.com/mrsekut/Hytl/blob/2bbf7c4058/src/Eval.hs</a><br/><br/><br/><br/>よろしくおねがいします。</div></div></div></div><div class="pager ui pagination menu"><a href="../../html/C5666B6BB/80.html" class="pager__previous item">Previous</a><a href="../../" class="pager__top item">Top</a></div></div></body></html>